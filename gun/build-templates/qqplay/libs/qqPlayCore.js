var qqPlayCoreBuildInfo = { buildPath:'/trunk',version:'857',creator:'nkchen',buildTime:'Tue Nov 06 2018 17:05:45 GMT+0800 (GMT+08:00)'};var t=!("object"!=typeof BK),o=!t;if(o){"undefined"!=typeof BK==0&&(BK={isBrowser:!0}),function(t,e){if("object"==typeof t){var i=(r=function(){function t(){}return t.open=function(t){c.send({url:t},"cs.openWebView.local")},t.openTransparent=function(t,e,i){void 0===e&&(e=1);var r="cs.openWebViewWithoutUrl.local";i&&(O.removeListener(r,this),O.addListener(r,this,i)),c.send({url:t},r)},t.closeTransparent=function(t){c.send({taskId:t},"cs.closeWebview.local")},t.onMessageHandle=function(t){},t}(),c=function(){function i(){}return i.ssoRequestCallBack=function(t,e,i){BK.Script.log(0,0,"ssoRequestCallBack cmd:"+e+" errCode:"+t+" data:"+JSON.stringify(i)),x(t,i.cmd,JSON.stringify(i.data))},i.sendSSO=function(t,e){O.addListener("cs.ssoMessage.local",this,this.ssoRequestCallBack),i.send({cmd:e,data:JSON.stringify(t)},"cs.ssoMessage.local")},i.addListener=function(t,e,i){O.addListener(t,e,i)},i.removeListener=function(t,e){O.removeListener(t,e)},i.send=function(t,e){-1!=e.indexOf("cs.")&&-1!=e.indexOf(".local")?"undefined"!=typeof __browserMsg?__browserMsg.send(JSON.stringify(t),e):void 0!==window.webkit.messageHandlers&&window.webkit.messageHandlers.cmWebGameSend.postMessage({data:JSON.stringify(t),cmd:e}):BK.MQQ.SsoRequest.sendSSO(t,e)},i.sendWebMessage=function(t,e){i.send({cmd:e,data:JSON.stringify(t)},"sc.web_callback_game.local")},i}(),o=function(){function s(){}return s.accountCallBack=function(t,e,i){var r="0";1===i.nickname?r="1":1===i.avatar&&(r="2");var o=e+"_"+r;if(s.accountCallBackArr[o]){var n=s.accountCallBackArr[o];n(i.openId,i.data)}},s.getNick=function(t,e){s.accountCallBackArr["cs.get_userInfo.local_1"]=e,BK.MQQ.SsoRequest.addListener("cs.get_userInfo.local",this,this.accountCallBack),BK.MQQ.SsoRequest.send({openId:t,nickname:1},"cs.get_userInfo.local")},s.getHead=function(t,e){s.accountCallBackArr["cs.get_userInfo.local_2"]=e,BK.MQQ.SsoRequest.addListener("cs.get_userInfo.local",this,this.accountCallBack),BK.MQQ.SsoRequest.send({openId:t,avatar:1},"cs.get_userInfo.local")},s.accountCallBackArr=[],s}(),n=function(){function n(){}return n.log=function(t,e,i){"undefined"!=typeof GameStatusInfo&&0<=this.compareVersion(GameStatusInfo.QQVer,"7.6.0")&&("undefined"!=typeof __browserMsg?__browserMsg.log(t,e,"webGame_log",i,""):void 0!==window.webkit.messageHandlers&&window.webkit.messageHandlers.cmWebGameLog.postMessage({level:t,errcode:e,info1:"webGame_log",info2:i,info3:""}))},n.compareVersion=function(t,e){var i=t.split("."),r=e.split("."),o=i[0]-r[0];return 0==o&&t!=e?n.compareVersion(i.splice(1).join("."),r.splice(1).join(".")):o},n}(),s=function(){function t(){}return t.base64ToUint8Array=function(t){var e,i,r,o,n,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=.75*t.length,h=t.length,c=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u=new ArrayBuffer(a),l=new Uint8Array(u);for(e=0;e<h;e+=4)i=s.indexOf(t[e]),r=s.indexOf(t[e+1]),o=s.indexOf(t[e+2]),n=s.indexOf(t[e+3]),l[c++]=i<<2|r>>4,l[c++]=(15&r)<<4|o>>2,l[c++]=(3&o)<<6|63&n;return l},t.upload=function(t,e,i){for(var r=1024<t.length?1024:t.length,o=new Uint8Array(r),n=0;n<r/2;n++)o[n]=t[n];for(var n=t.length-r/2;n<t.length;n++)o[n]=t[n];var s=BK.Crypt.core_md5(o,r),a=new Date,h=a.getFullYear()+(a.getMonth()+1<10?0+(a.getMonth()+1):a.getMonth()+1)+a.getDate(),c=e.tmpSecretId,u=e.upLoadPrefUrl,l=e.downloadUrl,d=e.sessionToken,f=e.signature,_=e.signTime,p="/"+GameStatusInfo.gameId+"_"+BK.Crypt.bin2hex(s)+GameStatusInfo.gameId+"_"+h+".png";u=u.replace(new RegExp("http://","gm"),"");var m="put\n"+p+"\n\nhost="+u+"&x-cos-storage-class=nearline\n",g="sha1\n"+_+"\n"+BK.Crypt.hex_sha1(m)+"\n",v=BK.Crypt.hex_hmac_sha1(f,g),S="q-sign-algorithm=sha1&q-ak="+c+"&q-sign-time="+_+"&q-key-time="+_+"&q-header-list=host;x-cos-storage-class&q-url-param-list=&q-signature="+v,y=new XMLHttpRequest;y.onreadystatechange=function(){4==this.readyState&&(200==this.status?(BK.Script.log(0,0," on response res = "+this.status+"   "+JSON.stringify(this.HEADERS_RECEIVED)),l.charAt(l.length-1)==p.charAt(0)&&"/"==p.charAt(0)&&(l=l.slice(0,l.length-1)),i(this.status,l+p)):i(this.status,""))},y.open("put","https://"+u+p,!0),y.setRequestHeader("x-cos-storage-class","nearline"),y.setRequestHeader("x-cos-security-token",d),y.setRequestHeader("authorization",S),y.send(t)},t.uploadFromFile=function(t,o){var e="cs.get_file_data.local",i={cmd:e,path:t};o&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,function(t,e,i){var r=BK.FileUtil.base64ToUint8Array(i);BK.FileUtil.uploadFromBuff(r,o)}),BK.MQQ.SsoRequest.send(i,e))},t.uploadFromBuff=function(i,r){BK.QQ.queryCloudSignature(function(t,e){BK.FileUtil.upload(i,e,r)})},t}(),a=function(){function r(){}return r.share=function(t,r){if(t.inner=1,r){var e="sc.share_game_to_friend_result.local";BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,function(t,e,i){r(t,e,i),this.shareUpload(0==t?0:1),BK.MQQ.SsoRequest.removeListener(e,this)}.bind(this))}BK.Script.log(0,0,"share "+JSON.stringify(t)),BK.MQQ.SsoRequest.send(t,"cs.game_shell_share_callback.local")},r.shareToMQQ=function(t,e,i,r){var o="cs.share_game_result.local",n={cmd:o,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,gameVersion:GameStatusInfo.gameVersion,roomId:GameStatusInfo.roomId,title:t,summary:e,detailUrl:i,picUrl:r};c.send(n,o)},r.getRankList=function(t,e){var i={cmd:this.CMSHOW_SRV_GET_RANK_LIST,from:"default",objType:1,objId:0,busType:3,busId:GameStatusInfo.gameId.toString()};e&&(e.objType&&(i.objType=e.objType),e.objId&&(i.objId=e.objId),e.from&&(i.from=e.from)),BK.Script.log(1,1,"BK.QQ.reqGetRankList! "+JSON.stringify(i)),null!=i?(r._getRankListCallBack=t,BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SRV_GET_RANK_LIST,this),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SRV_GET_RANK_LIST,this,this._event4GetRankList),BK.MQQ.SsoRequest.sendSSO(i,this.CMSHOW_SRV_GET_RANK_LIST)):BK.Script.log(0,0,"reqGetRankList data undefined!")},r.consumeItems=function(t,n){var e="apollo_game_item.consume_game_items",i={cmd:e,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,items:t};n&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,function(t,e,i){var r=[],o=[];0==t&&(r=i.data.succList,o=i.data.failList),n(t,r,o)})),BK.MQQ.SsoRequest.sendSSO(i,e)},r.getUserGameItems=function(o){var t="apollo_aio_game.get_user_game_items",e={cmd:t,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId};o&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,e,i){if(null!=i){var r={};r.data=i.data,o(t,e,r)}})),BK.MQQ.SsoRequest.sendSSO(e,t)},r.buyGameItems=function(t,e,o){var i="apollo_aio_game.buy_game_items",r={cmd:i,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,curreType:t,itemIdList:e};o&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(t,e,i){if(null!=i){var r={};r.data=i.data,o(t,e,r)}})),BK.MQQ.SsoRequest.sendSSO(r,i)},r.queryCloudSignature=function(r){var t=new Date,e=t.getTime()/1e3-1,i="cs.fetch_cloud_signature.local",o={cmd:i,now:e,delta:600};r&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(t,e,i){r(t,i)}),BK.MQQ.SsoRequest.send(o,i))},r.notifyCloseGame=function(){var t={gameId:GameStatusInfo.gameId,roomId:0};BK.Script.log(0,0,"BK.QQ.notifyCloseGame!gameId = "+t.gameId+", roomId = "+t.roomId),BK.MQQ.SsoRequest.send(t,"cs.close_room.local")},r.CMSHOW_SRV_GET_RANK_LIST="apollo_router_game.game_rank_linkcmd_get_fri_rank_for_engine",r.shareToArk=function(t,e,i,r,o,n){"boolean"==typeof r&&(r=1==r?1:0);var s="cs.share_game_in_ark.local",a="sc.share_game_to_friend_result.local";"android"==GameStatusInfo.platform&&0==GameStatusInfo.QQVer.indexOf("7.6.0")&&(s="cs.game_shell_share_callback.local");var h={cmd:s,summary:e,picUrl:i,gameId:GameStatusInfo.gameId,roomId:t,gameMode:GameStatusInfo.gameMode,isSelectFriend:r,extendInfo:o};BK.Script.log(0,0,"ShareToArk summary="+h.summary+" roomId="+h.roomId+"  gameMode="+h.gameMode+"picUrl="+h.picUrl+"  gameId="+h.gameId),n&&(BK.MQQ.SsoRequest.removeListener(a,this),BK.MQQ.SsoRequest.addListener(a,this,n)),c.send(h,s)},r.shareToArkFromFile=function(i,r,o,t){BK.FileUtil.uploadFromFile(t,function(t,e){BK.QQ.shareToArk(i,r,e,!0,o)})},r.shareToArkFromBuff=function(i,r,o,t){BK.FileUtil.uploadFromBuff(t,function(t,e){200==t&&BK.QQ.shareToArk(i,r,e,!0,o)})},r.createShortCut=function(t,r){var e="";t&&(e=t);var i={extendInfo:e};if(r){var o="cs.create_xy_shortcut.local";BK.MQQ.SsoRequest.removeListener(o,this),BK.MQQ.SsoRequest.addListener(o,this,function(t,e,i){r(t,e,i),BK.MQQ.SsoRequest.removeListener(e,this)})}BK.MQQ.SsoRequest.send(i,"cs.create_xy_shortcut.local"),BK.Script.log(0,0,"createShortCut")},r.fetchOpenKey=function(t){var e="cs.on_get_open_key.local",i={gameId:GameStatusInfo.gameId};t&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,t)),BK.MQQ.SsoRequest.send(i,e)},r.scoreUpload=function(t,e,i){var r="apollo_aio_game.report_user_score_3rd",o={cmd:r,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,roomId:GameStatusInfo.roomId,gData:t};i&&(o.arkData=i),e&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,e)),BK.MQQ.SsoRequest.sendSSO(o,r)},r._getRankListCallBack=void 0,r._event4GetRankList=function(t,e,i){BK.Script.log(1,1,"BK.QQ.reqGetRankList! callback cmd:"+e+" errCode:"+t+"  data:"+JSON.stringify(i)),null!=r._getRankListCallBack&&r._getRankListCallBack(t,e,i),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SRV_GET_RANK_LIST,this)},r.uploadScoreWithoutRoom=function(t,e,i){var r="apollo_report_result.single_user_result",o=Math.floor((new Date).getTime()/1e3),n={from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,aioType:1,ts:o.toString(),src:GameStatusInfo.src,mode:void 0!==t?t:1,userData:e.userData,attr:e.attr};i&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,i)),BK.MQQ.SsoRequest.sendSSO(n,r)},r.getRankListWithoutRoom=function(t,e,i,r){var o="apollo_router_game.apollo_user_rankinglist_linkcmd_custom_ranking",n=Math.floor((new Date).getTime()/1e3),s={from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,ts:n.toString(),attr:void 0!==t?t:"score",order:void 0!==e?e:1,rankType:void 0!==i?i:0};r&&(BK.MQQ.SsoRequest.removeListener(o,this),BK.MQQ.SsoRequest.addListener(o,this,r)),BK.MQQ.SsoRequest.sendSSO(s,o)},r.qPayPurchase=function(t,e,i,r){var o=1;o=1==e?1:0;var n="https://cmshow.qq.com/apollo/html/game-platform/buy-props.html?_wv=3&adtag=inside_game&gameId="+GameStatusInfo.gameId+"&gameOrientation="+t+"&itemList="+encodeURI(JSON.stringify(i)),s={gameOrientation:t,transparent:o,businessType:2,url:n};if(r){var a="sc.apolloGameWebMessage.local";BK.MQQ.SsoRequest.removeListener(a,this),BK.MQQ.SsoRequest.addListener(a,this,function(t,e,i){0==t&&i.op&&"apolloGamePlatform.buyProps"==i.op&&r(i.data.code,i.data)}.bind(this))}BK.MQQ.SsoRequest.send(s,"cs.openWebViewWithoutUrl.local")},r.getGameItemList=function(t){var e="apollo_aio_game.get_game_itemList",i={cmd:e,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId};t&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,t)),BK.MQQ.SsoRequest.sendSSO(i,e)},r.rollbackGameItems=function(t,n){var e="apollo_game_item.rollback_game_items",i={cmd:e,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,items:t};n&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,function(t,e,i){var r=[],o=[];0==t&&(r=i.data.succList,o=i.data.failList),n(t,r,o)}.bind(this))),BK.MQQ.SsoRequest.sendSSO(i,e)},r.shareUpload=function(t){var e=t.toString();BK.QQ.uploadData("clickShowOffButton","",e,"","","")},r.uploadData=function(t,e,i,r,o,n){var s="cs.report_data_2_compass.local",a=GameStatusInfo.gameId;"ios"==GameStatusInfo.platform&&(t=t.toString(),i=i.toString());var h={cmd:s,actionName:t,enter:e,entry:e,result:i,r2:a.toString(),r3:r,r4:o,r5:n};BK.MQQ.SsoRequest.sendSSO(h,s)},r.saveGameData=function(t,e){var i="apollo_private_data.set_user_data",r=Math.floor((new Date).getTime()/1e3),o={openId:GameStatusInfo.openId,gameId:GameStatusInfo.gameId,version:GameStatusInfo.gameVersion,from:GameStatusInfo.platform,ts:r.toString(),data:t};e&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,e)),BK.MQQ.SsoRequest.send(o,i)},r.loadGameData=function(t){var e="apollo_private_data.get_user_data",i=Math.floor((new Date).getTime()/1e3),r={openId:GameStatusInfo.openId,gameId:GameStatusInfo.gameId,version:GameStatusInfo.gameVersion,from:GameStatusInfo.platform,ts:i.toString()};t&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,t)),BK.MQQ.SsoRequest.send(r,e)},r.reportGameResult=function(t,r){var e="apollo_router_game.apollo_reportcm_linkcmd_game_result";t.gameId=GameStatusInfo.gameId,0<GameStatusInfo.isWhiteUser&&BK.Script.log(1,1,"reportGameResult :"+t),BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,function(t,e,i){BK.QQ.checkNewRedPackage(),r&&r(t,e,i)}),BK.MQQ.SsoRequest.send(t,e)},r.sendB2CRedPacket=function(t,r){if(r){var e="sc.send_b2c_redpacket_result.local";BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,function(t,e,i){r(t,e,i),BK.MQQ.SsoRequest.removeListener(e,this)})}var i={groupPushData:{gameRedPacketId:1,gameId:GameStatusInfo.gameId,extraInfo:t}};BK.Script.log(1,1,"sendB2CRedPacket:"+JSON.stringify(i)),BK.MQQ.SsoRequest.send(i,"cs.send_b2c_redpacket.local"),BK.Script.log(0,0,"sendB2CRedPacket")},r}(),h=function(){function t(){}return t.close=function(){BK.MQQ.SsoRequest.sendWebMessage({},"cs.close_room.local")},t.packUp=function(){BK.MQQ.SsoRequest.sendWebMessage({},"cs.make_room_min.local")},t}(),{Webview:r,SsoRequest:c,Account:o,Script:n,FileUtil:s,QQ:a,Game:h,Misc:function(){}});void 0===t.MQQ&&(t.MQQ={Webview:i.Webview,SsoRequest:i.SsoRequest,Account:i.Account}),void 0===t.FileUtil&&(t.FileUtil=i.FileUtil),void 0===t.Script&&(t.Script=i.Script),void 0===t.QQ&&(t.QQ=i.QQ),void 0===t.Game&&(t.Game=i.Game),void 0===t.Misc&&(t.Misc=i.Misc)}var r,c,o,n,s,a,h}(BK),function(t,e){BK.Script.setErrorObserver=function(t){},t._globalErrorCallback_=function(t){}}(this),BK.Misc.compQQVersion||(BK.Misc.compQQVersion=function(t,e){for(var i=t.split("."),r=e.split("."),o=Math.min(3,Math.min(i.length,r.length)),n=0;n<o;n++)if(i[n]!=r[n])return i[n]<r[n];return!0},BK.Misc.qqVerLessthan=function(t,e){for(var i=t.split("."),r=e.split("."),o=Math.min(3,Math.min(i.length,r.length)),n=0;n<o;n++)if(i[n]<r[n])return!0;return!1});var e="apollo_router_light.apollo_activity_linkcmd_query_new_redpacket",i=0;BK.QQ.isUserInRedPackageActivity=function(){var t=GameStatusInfo.commFlagBits>>1&1&&310!==GameStatusInfo.src;return BK.Script.log(1,1,"redPackage  isUserInRedPackageActivity: "+t),t},BK.QQ.isOpenActivityPage=function(){var t=GameStatusInfo.commFlagBits>>2&1&&310!==GameStatusInfo.src;return BK.Script.log(1,1,"redPackage  isOpenActivityPage: "+t),t},BK.QQ.showRedPackageActivityPage=function(){if(BK.QQ.isOpenActivityPage()&&0===i){var t="http://cmshow.qq.com/act_apollo/h5_act/gameRedPacket/html/popup.html?game_id="+GameStatusInfo.gameId+"&page=ad&_cwv=1&wv=3&adtag=engine";BK.Script.log(1,0,"redPackage  \u6253\u5f00\u6e38\u620f\u6d6e\u5c42 :"+t),BK.MQQ.Webview.openTransparent(t),i++}},BK.QQ.checkNewRedPackage=function(){if(BK.QQ.isUserInRedPackageActivity()){var t={cmd:e,gameId:GameStatusInfo.gameId.toString()};BK.MQQ.SsoRequest.send(t,e)}},BK.QQ.onNewRedPackage=function(t,e,i){if(BK.Script.log(1,0,"BK.QQ.onNewRedPackage  redPackage errCode = "+t+" cmd = "+e+" data = "+JSON.stringify(i)),0==t)if(i.data&&i.data.redPacket&&i.data.redPacket.actId&&i.data.redPacket.taskId){var r=i.data.redPacket,o="http://cmshow.qq.com/act_apollo/h5_act/gameRedPacket/html/popup.html?game_id="+GameStatusInfo.gameId+"&page=task&task_id="+r.taskId+"&_cwv=1&wv=3&adtag=engine";BK.MQQ.Webview.openTransparent(o)}else BK.Script.log(1,0,"request new red package  redPackage ,\u6ca1\u6709\u65b0\u7ea2\u5305\u4efb\u52a1\u89e6\u53d1");else BK.Script.log(1,0,"request new red package Failed!  redPackage ErrCode:"+t)}}else{function r(t){var e,i,r;if("object"!=typeof t||null===t)return t;if(t instanceof Array)for(e=[],i=0,r=t.length;i<r;i++)"object"==typeof t[i]&&null!=t[i]?e[i]=arguments.callee(t[i]):e[i]=t[i];else for(i in e={},t)"object"==typeof t[i]&&null!=t[i]?e[i]=arguments.callee(t[i]):e[i]=t[i];return e}!function(t,e){"object"==typeof t&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Emitter=e())}(BK,function(){var n=function(t,e,i){this.once=i,this.target=t,this.callback=e};return function(){function t(){this._emits={}}return t.prototype.__emit_get=function(t){return this._emits[t]||(this._emits[t]=new Array),this._emits[t]},t.prototype.__emit_put=function(t,e){this.__emit_get(t).push(e)},t.prototype.__emit_exists=function(t,e){for(var i=this.__emit_get(t),r=!1,o=0;o<i.length;o++)if(i[o].target==e){r=!0;break}return r},t.prototype.dispose=function(){delete this._emits},t.prototype.on=function(t,e,i,r){if(0==this.__emit_exists(t,e)){var o=new n(e,i,r);this.__emit_put(t,o)}else BK.Script.log(0,0,"BK.bkEmitter.on!has found, event = "+t+", target = "+JSON.stringify(e))},t.prototype.off=function(t,e){for(var i=this.__emit_get(t),r=0;r<i.length;r++)if(i[r].target==e){i.splice(r,1);break}},t.prototype.offAll=function(e){Object.keys(this._emits).forEach(function(t){this.off(t,e)}.bind(this))},t.prototype.emitAll=function(t,e){for(var i=new Array,r=this.__emit_get(t),o=0;o<r.length;o++){var n={event:t,source:this,target:r[o].target,extras:e};r[o].callback&&r[o].callback(n),1==r[o].once&&i.push(r[o].target)}for(o=0;o<i.length;o++)this.off(t,i[o])},t.prototype.emitOnce=function(t,e){for(var i=new Array,r=this.__emit_get(t),o=0;o<r.length;o++)if(1==r[o].once){var n={event:t,source:this,target:r[o].target,extras:e};i.push(r[o].target),r[o].callback&&r[o].callback(n)}for(o=0;o<i.length;o++)this.off(t,i[o])},t}()}),function(t,e){"object"==typeof t&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.DNS=e())}(BK,function(){function t(){this.records=[],this.running=!1}return t.prototype.exists=function(t){for(var e=0;e<this.records.length;e++)if(this.records[e].hostname===t)return!0;return!1},t.prototype.query=function(t,e){for(var i=0;i<this.records.length;i++)if(this.records[i].af===e&&this.records[i].hostname===t)return this.records[i];return null},t.prototype.update=function(t,e,i,r){for(var o=0;o<this.records.length;o++)if(this.records[o].af===i&&this.records[o].hostname===t)return void this.records[o].callbacks.push(e);this.records.push({af:i,timeout:r,hostname:t,callbacks:[e]})},t.prototype.delete=function(t){for(var e=this.records.length-1;0<=e;e--)if(this.records[e].hostname===t){this.records.splice(e,1);break}},t.prototype.start=function(){if(!this.running){this.running=!0;var i=this;BK.Director.ticker.add(function(t,e){i.records.length&&BK.Misc.handleDNSQueryResult()})}},t.prototype.queryIPAddress=function(s,t,e,i){var r=!this.exists(s);if(null==e&&(e=2),null==i&&(i=0),this.update(s,t,e,i),r){var a=this;a.start(),BK.Misc.queryIPAddress(s,function(t,e,i){var r=a.query(s,e);if(r)for(var o=r.callbacks,n=0;n<o.length;n++)o[n].call(a,t,e,i);a.delete(s)},e,i)}},new t}),function(t,e){"object"==typeof t&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.HTTPParser=e())}(this,function(){var l=81920,h=/^HTTP\/1\.([01]) ([0-9]{3})(?: ((?:[\x21-\x7E](?:[\t ]+[\x21-\x7E])*)*))?$/,c=/^([!#$%'*+\-.^_`|~0-9A-Za-z]+):[\t ]*((?:[\x21-\x7E](?:[\t ]+[\x21-\x7E])*)*)[\t ]*$/,u=/^[\t ]+(.*)$/;function i(t){this.onHeaders=void 0,this.onComplete=void 0,this.reinitialize(t)}return i.prototype.reinitialize=function(t){this.execute=this._executeHeader,(this.type=t)===i.RESPONSE&&(this._state=1),this._err=void 0,this._flags=0,this._contentLen=void 0,this._nbytes=0,this._nhdrbytes=0,this._nhdrpairs=0,this._buf="",this._seenCR=!1,this.headers={},this.httpMajor=1,this.httpMinor=void 0,this.maxHeaderPairs=2e3,this.method=void 0,this.url=void 0,this.statusCode=void 0,this.statusText=void 0},i.prototype._processHdrLine=function(t){switch(this._state){case 2:if(0===t.length)return void this._headersEnd();if(null===(a=c.exec(t))){if(null===(a=u.exec(t)))return this.execute=this._executeError,this._err=new Error("Malformed header line"),this.execute(this._err),this._err;var e=a[1];0<e.length&&BK.Script.log(1,0,"processHdrLine!extra = "+e)}else{var i=a[1],r=a[2];switch(i.toLowerCase()){case"connection":"close"===(o=r.toLowerCase()).substring(0,5)?this._flags|=4:"keep-alive"===o.substring(0,10)?this._flags|=2:"upgrade"===o.substring(0,7)&&(this._flags|=8);break;case"transfer-encoding":var o;"chunked"===(o=r.toLowerCase()).substring(0,7)&&(this._flags|=1);break;case"upgrade":this._flags|=32;break;case"content-length":var n=parseInt(r,10);if(isNaN(n)||524288<n)return this.execute=this._executeError,this._err=new Error("Bad Content-Length: "+inspect(n)),this.execute(this._err),this._err;this._contentLen=n}var s=this.maxHeaderPairs;(s<=0||++this._nhdrpairs<s)&&(this.headers[i.toLowerCase()]=r)}break;case 1:if(0===t.length)return!0;var a;if(null===(a=h.exec(t)))return this.execute=this._executeError,this._err=new Error("Malformed status line"),this.execute(this._err),this._err;this.httpMinor=parseInt(a[1],10),this.statusCode=parseInt(a[2],10),this.statusText=a[3]||"",this._state=2;break;default:return this.execute=this._executeError,this._err=new Error("Unexpected HTTP parser state: "+this._state),this.execute(this._err),this._err}},i.prototype._headersEnd=function(){var t=this._flags,e=this.method&&this.method.toLowerCase(),i=40==(40&t)||"connect"===e,r=0==(4&t),o=this._contentLen;if(this._buf="",this._seenCR=!1,((this._nbytes=0)===this.httpMajor&&9===this.httpMinor||0===this.httpMinor&&0==(2&t))&&(r=!1),0<(16&t))return this.onComplete&&this.onComplete(),void this.reinitialize(this.type);if(this.onHeaders){var n=this.headers;!0===this.onHeaders(this.httpMajor,this.httpMinor,n,this.method,this.url,this.statusCode,this.statusText,i,r)&&(t=this._flags|=64)}i?(this.onComplete&&this.onComplete(),this._state=3):(0===o||0<(64&t)||0==(1&t)&&void 0===o&&!this._needsEOF())&&(this.onComplete&&this.onComplete(),this.reinitialize(this.type))},i.prototype._executeHeader=function(t){for(var e,i,r=0,o=t.length,n=this._seenCR,s=this._buf,a=this._nhdrbytes;r<o;){if(n)if(n=!1,10===t.charCodeAt(r)){if(++r,e=this._processHdrLine(s),s="","object"==typeof e)return this._err=e,this.execute(this._err),e;if(void 0===e&&2!==(c=this._state))return c<3&&r<o?"number"!=typeof(e=this.execute(t.slice(r)))?(this._err=e,this.execute(this._err),e):r+e:(3===c&&this.reinitialize(this.type),r)}else if(s+="\r",l<++a)return this.execute=this._executeError,this._err=new Error("Header size limit exceeded (81920)"),this.execute(this._err),this._err;var h,c;if(!(-1<(h=t.indexOf("\r\n",r)))){var u;if(u=13===t.charCodeAt(o-1)?(n=!0,o-1):o,l<(a+=u-r))return this.execute=this._executeError,this._err=new Error("Header size limit exceeded (81920)"),this.execute(this._err),this._err;s+=t.substring(r,u);break}if(0<(i=h-r)){if(l<(a+=i))return this.execute=this._executeError,this._err=new Error("Header size limit exceeded (81920)"),this.execute(this._err),this._err;s+=t.substring(r,h)}if(r=h+2,e=this._processHdrLine(s),s="","object"==typeof e)return this._err=e,this.execute(this._err),e;if(void 0===e&&2!==(c=this._state))return c<3&&r<o?"number"!=typeof(e=this.execute(t.slice(r)))?(this._err=e,this.execute(this._err),e):r+e:(3===c&&this.reinitialize(this.type),r)}return this._buf=s,this._seenCR=n,this._nhdrbytes=a,o},i.prototype._executeError=function(t){return BK.Script.log(1,0,"_executeError!err = "+t.message),this._err},i.prototype.execute=i.prototype._executeHeader,i.prototype._needsEOF=function(){if(this.type===i.REQUEST)return!1;var t=this.statusCode,e=this._flags;return!(void 0!==t&&(204===t||304===t||1===parseInt(t/100,1))||64&e)&&!(0<(1&e)||null!=this._contentLen)},i.REQUEST=0,i.RESPONSE=1,i}),enGameHallSucc=0,eReqDataLenErr=1e3,eReqMagicErr=1001,eReqFrontCmdErr=1002,eReqBackCmdErr=1003,eReqBackSrcErr=1004,eReqFromIdErr=1005,eSTDecryErr=1006,eReqDecryErr=1007,eSTExpire=1008,eSystmeErr=1009,eVerUnvalid=1010,eReqLimit=1011,eGetSvrErr=1012,eInitMemErr=2001,eQueryMemErr=2002,eUpdateMemErr=2003,eDelMemErr=2004,eGetConfigErr=2005,eNotifyCreateErr=2006,eGetRoomIdErr=2007,eCmdInvalid=2008,eRoomNotExist=2009,eInBlackList=2010,eMatchTimeOut=2011,eGetRoomErr=3e3,eRoomStatusErr=3001,eIsNotCreator=3002,eIsNotInRoom=3003,eFlushTsErr=3004,eLogoutIdErr=3005,eIsNotInSvc=3006,eUsrOverFlow=3007,eRoomOverFlow=3008,eRoomIsExist=3009,eRmvUsrErr=3010,eLoginSysErr=3011,eUsrHasLoginErr=3012,eRoomIsFullErr=3013,eCreateRoomErr=3014,ePlayerHasJoin=3015,eUgcDataAnti=3020,eFowardToClientErr=4e3,eFowardToSvrErr=4001;var n="139.199.216.130",s=10060,h="139.199.216.128",c=10060,l=new Object;l.Int8=33,l.Uint8=34,l.Int16=33,l.Uint16=36,l.Int32=37,l.Uint32=38,l.Int64=39,l.Uint64=40,l.Byte=41,l.Double=42,l.Float=43,l.Int8Repeated=49,l.Uint8Repeated=50,l.Int16Repeated=51,l.Uint16Repeated=52,l.Int32Repeated=53,l.Uint32Repeated=54,l.Int64Repeated=55,l.Uint64Repeated=56,l.ByteRepeated=57,l.DoubleRepeated=58,l.FloatRepeated=59;var u,d,f=120,_=12,p=GameStatusInfo.gameMode,m=GameStatusInfo.platform,g=GameStatusInfo.aioType,v=GameStatusInfo.openId,S=GameStatusInfo.isMaster;NETWORK_ENVIRONMENT_QQ_RELEASE=0,NETWORK_ENVIRONMENT_QQ_DEBUG=1,NETWORK_ENVIRONMENT_DEMO_DEV=2,CMSHOW_SRV_CMD_JOIN_ROOM="apollo_aio_game.join_room",CMSHOW_SRV_CMD_QUIT_GAME="apollo_aio_game.quit_room",CMSHOW_SRV_CMD_START_GAME="apollo_aio_game.start_game",CMSHOW_SRV_CMD_CANCEL_GAME="apollo_aio_game.cancel_game_room",CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC="apollo_game_openapi.custom_game_logic",CMSHOW_SRV_GET_RANK_LIST="apollo_router_game.game_rank_linkcmd_get_fri_rank_for_engine",CMSHOW_SC_CMD_STOP_GAME="sc.force_stop_game.local",CMSHOW_CS_CMD_MINI_WND="cs.make_room_min.local",CMSHOW_CS_CMD_CLOSE_WND="cs.close_room.local",CMSHOW_CS_CMD_CREATE_ROOM="cs.create_room.local",CMSHOW_CS_CMD_JOIN_ROOM="cs.join_room.local",CMSHOW_CS_CMD_SEND_GAME_MSG="cs.send_game_msg.local",CMSHOW_CS_CMD_GAME_TIPS="cs.game_tips.local",CMSHOW_CS_CMD_GET_PLAYER_DRESS="cs.get_dress_path.local",CMSHOW_CS_CMD_GAME_READY="cs.game_ready.local",CMSHOW_CS_CMD_GAME_START="cs.game_start.local",CMSHOW_CS_CMD_SAVE_RECOMM_VIP="cs.save_recommend_ip.local",CMSHOW_CS_CMD_GET_SRV_IP_PORT="cs.get_server_ip_port.local",CMSHOW_CS_CMD_CHECK_PUBACCOUNT_STATE="cs.check_pubAccount_state.local",CMSHOW_CS_CMD_ENTER_PUBACCOUNT_CARD="cs.enter_pubAccount_card.local",CMSHOW_CS_CMD_SHARE_PIC="cs.share_pic.local",CMSHOW_CS_CMD_SHARE_IN_ARK="cs.share_game_in_ark.local",CMSHOW_CS_CMD_QUERY_CLOUD_SIGNATURE="cs.fetch_cloud_signature.local",CMSHOW_AIO_PAUSE="sc.aio_pause.local",CMSHOW_AIO_RESUME="sc.aio_resume.local",CMD_CMSHOW_GAME_ENTER_BACKGROUND="sc.game_enter_background.local",CMD_CMSHOW_GAME_ENTER_FORGROUND="sc.game_enter_foreground.local",CMD_CMSHOW_GAME_MAXIMIZE="sc.game_maximize.local",CMD_CMSHOW_GAME_MINIMIZE="sc.game_minimize.local",CMSHOW_CS_CMD_AUDIOROOM_ENTERN="cs.audioRoom_enter.local",CMSHOW_CS_CMD_AUDIOROOM_EXIT="cs.audioRoom_exit.local",CMSHOW_CS_CMD_AUDIOROOM_UPDATEUSERINFO="cs.audioRoom_update_userinfo.local",CMSHOW_CS_CMD_AUDIOROOM_SET_MIC="cs.audioRoom_set_mic.local",CMSHOW_CS_CMD_AUDIOROOM_SET_SPEAKER="cs.audioRoom_set_speaker.local",CMSHOW_CS_CMD_AUDIOROOM_INIT="cs.audioRoom_init.local",CMSHOW_CS_CMD_AUDIOROOM_DISCONNECT="cs.audioRoom_disconnect.local",CMSHOW_CS_CMD_AUDIOROOM_CAMERASWITCH="cs.audioRoom_cameraswitch.local",CMSHOW_CS_CMD_AUDIOROOM_SET_BEAUTY="cs.audioRoom_set_beauty.local",CMSHOW_CS_CMD_AUDIOROOM_REQ_AUDIO_SESSION="cs.audioRoom_req_audio_session.local",CMSHOW_CS_CMD_LOAD_PACKAGE="cs.load_subpackage.local",CMSHOW_CS_CMD_LOAD_PERCENTAGE_NOTIFY="sc.load_percentage_nofity.local",CMSHOW_CS_CMD_FILE_CORRECTNESS_CHECK="cs.file_correctness_check.local",CMSHOW_CS_CMD_SHOW_ONE_MORE_PAGE="cs.show_one_more_page.local",checkRenderMode=(BK.QQ=new function(){this.gameCfg=r(GameStatusInfo),this.gameCfg.gameId=parseInt(this.gameCfg.gameId),this.gameCfg.gameMode=0,GameStatusInfo.gameMode=0,this.hasJoinRoomSucc=!1,this.arkData={modeWording:""},this.setArkData=function(t){this.arkData.modeWording=t},this.gameCfg.roomId&&(this.gameCfg.roomId=parseInt(this.gameCfg.roomId)),1==this.gameCfg.isMaster?this.gameCfg.isCreator=!0:this.gameCfg.isCreator=!1,this.delegate={},this.ssoJoinRoomCallback,this.ssoJoinRoomCallbackPublic,BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_ENTER_BACKGROUND,this,function(){BK.Director.tickerPause()}.bind(this)),BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_ENTER_FORGROUND,this,function(){BK.Director.tickerResume()}.bind(this)),BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_MINIMIZE,this,function(){var t="android"==GameStatusInfo.platform?1:2;renderTicker.paused=!0,d=!0,1==t&&BK.Director.tickerPause()}.bind(this)),BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_MAXIMIZE,this,function(){renderTicker.paused=!1,d=!1,BK.Director.tickerResume()}.bind(this)),this.queryCloudSignature=function(r){if(BK.Misc.compQQVersion(GameStatusInfo.QQVer,"7.6.3")){if(r){var t=JSON.parse(GameStatusInfo.extInfo),e=t.certInfo.credentials,i=e.tmpSecretId,o=e.sessionToken,n=t.certInfo.upLoadPrefUrl,s=t.certInfo.downLoadPrefUrl,a=new Date,h=(a.getFullYear(),a.getMonth(),a.getMonth(),a.getDate(),a.getTime()/1e3-1),c=h+600,u=h+";"+c,l=BK.Crypt.hex_hmac_sha1(e.tmpSecretKey,u),d={tmpSecretId:i,upLoadPrefUrl:n,downloadUrl:s,sessionToken:o,signature:l,signTime:u};r(0,d)}}else{var a=new Date,h=parseInt(a.getTime()/1e3)-1,d={cmd:CMSHOW_CS_CMD_QUERY_CLOUD_SIGNATURE,now:h,delta:600};r&&(BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_QUERY_CLOUD_SIGNATURE,this),BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_QUERY_CLOUD_SIGNATURE,this,function(t,e,i){r(t,i)}),BK.MQQ.SsoRequest.send(d,CMSHOW_CS_CMD_QUERY_CLOUD_SIGNATURE))}},this.qGetRankBoard=function(t,e,i,r){var o={gameOrientation:t,openId:GameStatusInfo.openId,transparent:1,businessType:2,url:"http://cmshow.qq.com/apollo/html/game-platform/general-chart.html?gameId="+GameStatusInfo.gameId+"&_wwv=2&gameOrientation="+t};BK.MQQ.SsoRequest.send(o,"cs.openWebViewWithoutUrl.local")},this.qPayPurchase=function(t,e,i,r){var o=1;o=1==e?1:0;var n={gameOrientation:t,openId:GameStatusInfo.openId,transparent:o,businessType:1,itemList:i};if(r){var s="sc.apolloGameWebMessage.local";BK.MQQ.SsoRequest.removeListener(s,this),BK.MQQ.SsoRequest.addListener(s,this,function(t,e,i){0==t&&i.op&&"apolloGamePlatform.buyProps"==i.op&&r(i.data.code,i.data)}.bind(this))}BK.MQQ.SsoRequest.send(n,"cs.openWebViewWithoutUrl.local")},this.consumeItems=function(t,n){var e="apollo_game_item.consume_game_items",i={cmd:e,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,items:t};n&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,function(t,e,i){var r=[],o=[];0==t&&(r=i.data.succList,o=i.data.failList),n(t,r,o)}.bind(this))),BK.MQQ.SsoRequest.send(i,e)},this.rollbackGameItems=function(t,n){var e="apollo_game_item.rollback_game_items",i={cmd:e,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,items:t};n&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,function(t,e,i){var r=[],o=[];0==t&&(r=i.data.succList,o=i.data.failList),n(t,r,o)}.bind(this))),BK.MQQ.SsoRequest.send(i,e)},this.shareToMQQ=function(t,e,i,r){var o="cs.share_game_result.local",n={cmd:o,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,gameVersion:GameStatusInfo.gameVersion,roomId:GameStatusInfo.roomId,title:t,summary:e,detailUrl:i,picUrl:r};BK.MQQ.SsoRequest.send(n,o)},this.scoreUpload=function(t,e,i){BK.Script.log(1,1,"\u6210\u7ee9\u4e0a\u62a5 scoreData:"+JSON.stringify(t));var r="apollo_aio_game.report_user_score_3rd",o={cmd:r,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,roomId:GameStatusInfo.roomId,gData:t,src:GameStatusInfo.src};i&&(o.arkData=i),e&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,e)),BK.MQQ.SsoRequest.send(o,r)},this.getRoomUserScoreInfo=function(t,e){var i="apollo_aio_game.get_room_info_3rd",r={cmd:i,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,version:GameStatusInfo.gameVersion,roomId:t};e&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,e)),BK.MQQ.SsoRequest.send(r,i)},this.getUserGameinfo=function(t,e,i){var r="apollo_aio_game.get_user_gameinfo_3rd",o={cmd:r,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,roomId:GameStatusInfo.roomId,toOpenId:t,cycleNum:e};i&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,i)),BK.MQQ.SsoRequest.send(o,r)},this.getUserCurrencyInfo=function(t,e){var i="apollo_aio_game.get_user_curreInfo",r={cmd:i,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,mask:t};e&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,e)),BK.MQQ.SsoRequest.send(r,i)},this.getCmshowDressInfo=function(t,e){var i="cs.get_dress_path.local";e&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,e));var r={openId:t};BK.MQQ.SsoRequest.send(r,"cs.get_dress_path.local")},this.getGameItemList=function(t){var e="apollo_aio_game.get_game_itemList",i={cmd:e,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId};t&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,t)),BK.MQQ.SsoRequest.send(i,e)},this.getUserGameItems=function(t){var e="apollo_aio_game.get_user_game_items",i={cmd:e,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId};t&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,t)),BK.MQQ.SsoRequest.send(i,e)},this.buyGameItems=function(t,e,i){var r="apollo_aio_game.buy_game_items",o={cmd:r,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,curreType:t,itemIdList:e};i&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,i)),BK.MQQ.SsoRequest.send(o,r)},this.notifyNewRoom=function(t,e){var i={gameId:this.gameCfg.gameId,roomId:t,retcode:e};this.gameCfg.roomId||(this.gameCfg.roomId=t),BK.Script.log(0,0,"BK.QQ.notifyNewRoom!gameId = "+i.gameId+", roomId = "+i.roomId+", retCode = "+e),BK.MQQ.SsoRequest.send(i,CMSHOW_CS_CMD_CREATE_ROOM)},this.notifyHideGame=function(){var t={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.Script.log(0,0,"BK.QQ.notifyHideGame!gameId = "+t.gameId+", roomId = "+t.roomId);var e="android"==GameStatusInfo.platform?1:2;1==e&&(BK.Script.renderMode=0,u=0),BK.MQQ.SsoRequest.send(t,CMSHOW_CS_CMD_MINI_WND)},this.notifyCloseGame=function(){this._closeRoom();var t={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.Script.log(0,0,"BK.QQ.notifyCloseGame!gameId = "+t.gameId+", roomId = "+t.roomId),BK.MQQ.SsoRequest.send(t,CMSHOW_CS_CMD_CLOSE_WND)},this.notifyReadyGame=function(){var t={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.MQQ.SsoRequest.send(t,CMSHOW_CS_CMD_GAME_READY)},this.notifyGameTips=function(t){var e={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId,tips:t};BK.MQQ.SsoRequest.send(e,CMSHOW_CS_CMD_GAME_TIPS)},this.notifyGameTipsWaiting=function(){this.notifyGameTips("\u7b49\u5f85\u73a9\u5bb6\u52a0\u5165")},this.notifyGameTipsSomeOneJoinRoom=function(t){this.notifyGameTips(t+"\u52a0\u5165\u623f\u95f4")},this.notifyGameTipsSomeOneLeaveRoom=function(t){this.notifyGameTips(t+"\u79bb\u5f00\u623f\u95f4")},this.notifyGameTipsReady=function(){this.notifyGameTips("\u6e38\u620f\u5373\u5c06\u5f00\u59cb")},this.notifyGameTipsPlaying=function(){this.notifyGameTips("\u6e38\u620f\u8fdb\u884c\u4e2d")},this.notifyGameTipsGameOver=function(){this.notifyGameTips("\u6e38\u620f\u5df2\u7ed3\u675f")},this.inviteFriend=function(t,e){var i="cs.invite_friends.local",r={cmd:i,wording:t,gameId:this.gameCfg.gameId,gameMode:8,extendInfo:{}};e&&(r.roomId=e),BK.MQQ.SsoRequest.send(r,i)},this.uploadData=function(t,e,i,r,o,n){var s="cs.report_data_2_compass.local",a=this.gameCfg.gameId;"ios"==this.gameCfg.platform&&(t=t.toString(),i=i.toString());var h={cmd:s,actionName:t,enter:e,entry:e,result:i,r2:a.toString(),r3:r,r4:o,r5:n};BK.MQQ.SsoRequest.send(h,s)},this.sharePic=function(t){var e={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId,path:t};BK.MQQ.SsoRequest.send(e,CMSHOW_CS_CMD_SHARE_PIC)};var s={},a={};this.loadPackage=function(t,e,i){if(!GameStatusInfo||"xcode"===GameStatusInfo.devPlatform)return BK.Script.log(1,1,"bk.qq.loadpackage xcode demo ."),e(t,0);var r=GameStatusInfo.QQVer,o=r.split(".");if(Number(o[0])<7||7==Number(o[0])&&Number(o[1])<7||7==Number(o[0])&&7==Number(o[1])&&Number(o[2])<5)return BK.Script.log(1,1,"bk.qq.loadpackage old version before 775 ."),e(t,0);var n={xyId:GameStatusInfo.gameId,packName:t};e&&(s[t]=e),i&&(a[t]=i),BK.MQQ.SsoRequest.send(n,CMSHOW_CS_CMD_LOAD_PACKAGE)},this.onLoadPackageFinish=function(t,e,i){BK.Script.log(0,0,"BK.QQ.onLoadPackageFinish errCode = "+t+" cmd = "+e+" data = "+JSON.stringify(i)),i.packName&&s[i.packName]&&(s[i.packName](i.packName,i.result),s[i.packName]=void 0)},BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_LOAD_PACKAGE,this,this.onLoadPackageFinish.bind(this)),this.onLoadPackagePercentage=function(t,e,i){BK.Script.log(0,0,"BK.QQ.onLoadPackagePercentage errCode = "+t+" cmd = "+e+" data = "+JSON.stringify(i)),i.packName&&a[i.packName]&&(a[i.packName](i.packName,i.percentage),a[i.packName]=void 0)},BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_LOAD_PERCENTAGE_NOTIFY,this,this.onLoadPackagePercentage.bind(this)),this.checkPakcage=function(t,e){var i={xyId:GameStatusInfo.gameId,packName:t};this.checkpakcageCallback=e,BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_FILE_CORRECTNESS_CHECK,this),BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_FILE_CORRECTNESS_CHECK,this,this._evnet4Checkpackage.bind(this)),BK.MQQ.SsoRequest.send(i,CMSHOW_CS_CMD_FILE_CORRECTNESS_CHECK)},this.checkpakcageCallback=void 0,this._evnet4Checkpackage=function(t,e,i){BK.Script.log(0,0,"BK.QQ._evnet4Checkpackage!errCode = "+t+", cmd = "+e+", data = "+JSON.stringify(i)),this.checkpakcageCallback&&this.checkpakcageCallback(i.packName,i.result),this.checkpakcageCallback=void 0,BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_FILE_CORRECTNESS_CHECK,this)},this.addSSOJoinRoomCallBack=function(t){this.ssoJoinRoomCallbackPublic=t},this.checkPubAccountState=function(t,e){e&&(BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_CHECK_PUBACCOUNT_STATE,this),BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_CHECK_PUBACCOUNT_STATE,this,e));var i=CMSHOW_CS_CMD_CHECK_PUBACCOUNT_STATE,r={cmd:i,puin:t};BK.MQQ.SsoRequest.send(r,i)},this.enterPubAccountCard=function(t){var e=CMSHOW_CS_CMD_ENTER_PUBACCOUNT_CARD,i={cmd:e,puin:t};BK.MQQ.SsoRequest.send(i,e)},this.fetchOpenKey=function(t){var e="cs.on_get_open_key.local",i={gameId:GameStatusInfo.gameId};t&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,t)),BK.MQQ.SsoRequest.send(i,e)},this.listenGameEventEnterBackground=function(t,e){var i="sc.game_enter_background.local";e&&(BK.MQQ.SsoRequest.removeListener(i,t),BK.MQQ.SsoRequest.addListener(i,t,e))},this.listenGameEventEnterForeground=function(t,e){var i="sc.game_enter_foreground.local";e&&(BK.MQQ.SsoRequest.removeListener(i,t),BK.MQQ.SsoRequest.addListener(i,t,e))},this.listenGameEventMaximize=function(t,e){var i="sc.game_maximize.local";e&&(BK.MQQ.SsoRequest.removeListener(i,t),BK.MQQ.SsoRequest.addListener(i,t,e))},this.listenGameEventMinimize=function(t,e){var i="sc.game_minimize.local";e&&(BK.MQQ.SsoRequest.removeListener(i,t),BK.MQQ.SsoRequest.addListener(i,t,e))},this._event4GetVIPInfo=function(t,e,i){BK.Script.log(0,0,"BK.QQ._event4GetVIPInfo!errCode = "+t+" cmd = "+e+" data = "+JSON.stringify(i)),this.delegate.onGetVIPInfoEvent&&this.delegate.onGetVIPInfoEvent(t,e,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_GET_SRV_IP_PORT,this)},this.notifyGetVIPInfo=function(){BK.MQQ.SsoRequest.send({},CMSHOW_CS_CMD_GET_SRV_IP_PORT),BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_GET_SRV_IP_PORT,this),BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_GET_SRV_IP_PORT,this,this._event4GetVIPInfo.bind(this))},this.notifySaveRecommVIP=function(t,e){BK.Script.log(0,0,"BK.QQ.notifySaveRecommVIP!ip = "+t+", port = "+e);var i={gameId:this.gameCfg.gameId,roomId:this.game.roomId,ip:t,port:e};BK.MQQ.SsoRequest.send(i,CMSHOW_CS_CMD_SAVE_RECOMM_VIP)},this._event4GetPlayerDress=function(t,e,i){BK.Script.log(0,0,"BK.QQ._event4GetPlayerDress!errCode = "+t+", cmd = "+e+", data = "+JSON.stringify(i)),this.delegate.onGetPlayerDressEvent&&this.delegate.onGetPlayerDressEvent(t,e,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_GET_PLAYER_DRESS,this)},this.notifyGetPlayerDress=function(t){var e={openId:t};BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_GET_PLAYER_DRESS,this),BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_GET_PLAYER_DRESS,this,this._event4GetPlayerDress.bind(this)),BK.MQQ.SsoRequest.send(e,CMSHOW_CS_CMD_GET_PLAYER_DRESS)},this._startGameLocal=function(t,e){var i={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId,resp:e,retcode:t,gameMode:this.gameCfg.gameMode};BK.MQQ.SsoRequest.send(i,CMSHOW_CS_CMD_GAME_START)},this.notifyJoinRoom=function(t,s,a){t&&0<t.length?t.forEach(function(t){var e=t.openId==v;BK.Script.log(1,1,"player.openid="+t.openId+" currentPlayerOpenId="+v);var i=0;s&&s.data&&s.data.avRoomId&&(i=s.data.avRoomId);var r=0;s&&s.data&&s.data.sdkAppId&&(r=s.data.sdkAppId);var o=0;s&&s.data&&s.data.accountType&&(o=s.data.accountType);var n={gameId:this.gameCfg.gameId,openId:t.openId,isCreator:this.gameCfg.isCreator&&t.openId==v?1:0,roomId:this.gameCfg.roomId,resp:s,retcode:a,gameMode:this.gameCfg.gameMode,avRoomId:i,sdkAppId:r,accountType:o,isMine:e,isDisableSendMsg:1};BK.Script.log(0,0,"BK.QQ.notifyJoinroom isDisableSendMsg: "+n.isDisableSendMsg),BK.MQQ.SsoRequest.send(n,CMSHOW_CS_CMD_JOIN_ROOM)},this):BK.Script.log(0,0,"BK.QQ.notifyJoinRoom!newJoinPlayers data error")},this.sendGameMsg=function(){if(this.gameCfg.roomId&&0<this.gameCfg.roomId){var t={gameId:this.gameCfg.gameId,openId:GameStatusInfo.openId,roomId:this.gameCfg.roomId,gameMode:this.gameCfg.gameMode};BK.Script.log(0,0,"SendGameMsg : gameId="+t.gameId+"  openId="+t.openId+" roomId="+t.roomId+"  gameMode="+t.gameMode),BK.MQQ.SsoRequest.send(t,CMSHOW_CS_CMD_SEND_GAME_MSG)}},this.shareToArk=function(t,e,i,r,o,n){if(BK.Misc.compQQVersion(GameStatusInfo.QQVer,"7.6.3"))this._oldShareToArk(t,e,i,r,o,n);else{var s={summary:e,extendInfo:o,localPicPath:"",picUrl:"",activityId:0,reqCode:1};0==i.indexOf("GameRes://")||0==i.indexOf("GameSandBox://")?s.localPicPath=i:s.picUrl=i,this._share(s,n)}},this._share=function(o,n){if(o.inner=1,o.localPicPath){if(n){var t="sc.share_game_to_friend_result.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,e,i){n(t,e,i),this.shareUpload(0==t?0:1),BK.MQQ.SsoRequest.removeListener(e,this)}.bind(this))}BK.Script.log(0,0,"share "+JSON.stringify(o)),BK.MQQ.SsoRequest.send(o,"cs.game_shell_share_callback.local")}else{var e="\u8f7b\u6e38\u620f";o.gameName&&(e=o.gameName);var i="\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~";o.summary&&(i=o.summary),BK.QQ.defaultSharePic(e,i,function(t,e,i){if(n){var r="sc.share_game_to_friend_result.local";BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,function(t,e,i){n(t,e,i),this.shareUpload(0==t?0:1),BK.MQQ.SsoRequest.removeListener(e,this)}.bind(this))}0==t&&(o.localPicPath=i),BK.Script.log(0,0,"share with default pic"+JSON.stringify(o)),BK.MQQ.SsoRequest.send(o,"cs.game_shell_share_callback.local")}.bind(this))}},this.share=function(t,s){this._share(t,function(t,e,i){if(0==t){var r=i.ret,o=i.shareTo,n=1==i.isFirstShare;s(r,o,n)}else s(t,-1,!1)}.bind(this))},this.shareUpload=function(t){var e=t.toString();BK.QQ.uploadData("clickShowOffButton","",e,"","","")},this._oldShareToArk=function(t,e,i,r,o,n){"boolean"==typeof r&&(r=1==r?1:0);var s={summary:e,picUrl:i,gameId:this.gameCfg.gameId,roomId:t,gameMode:this.gameCfg.gameMode,isSelectFriend:r,extendInfo:o};if(n){var a="sc.share_game_to_friend_result.local";BK.MQQ.SsoRequest.removeListener(a,this),BK.MQQ.SsoRequest.addListener(a,this,function(t,e,i){n(t,e,i),this.shareUpload(0==t?0:1),BK.MQQ.SsoRequest.removeListener(e,this)}.bind(this))}BK.Script.log(0,0,"ShareToArk summary="+s.summary+" roomId="+s.roomId+"  gameMode="+s.gameMode+"picUrl="+s.picUrl+"  gameId="+s.gameId),BK.MQQ.SsoRequest.send(s,CMSHOW_CS_CMD_SHARE_IN_ARK)},this.sendB2CRedPacket=function(t,r){if(r){var e="sc.send_b2c_redpacket_result.local";BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,function(t,e,i){r(t,e,i),BK.MQQ.SsoRequest.removeListener(e,this)}.bind(this))}var i={groupPushData:{gameRedPacketId:1,gameId:GameStatusInfo.gameId,extraInfo:t}};BK.Script.log(1,1,"sendB2CRedPacket:"+JSON.stringify(i)),BK.MQQ.SsoRequest.send(i,"cs.send_b2c_redpacket.local"),BK.Script.log(0,0,"sendB2CRedPacket")},this.createShortCut=function(t,r){var e="";t&&(e=t);var i={extendInfo:e};if(r){var o="cs.create_xy_shortcut.local";BK.MQQ.SsoRequest.removeListener(o,this),BK.MQQ.SsoRequest.addListener(o,this,function(t,e,i){r(t,e,i),BK.MQQ.SsoRequest.removeListener(e,this)}.bind(this))}BK.MQQ.SsoRequest.send(i,"cs.create_xy_shortcut.local"),BK.Script.log(0,0,"createShortCut")},this.defaultSharePic=function(t,e,i){t||(t="\u8f7b\u6e38\u620f"),e||(e="\u4e00\u8d77\u6765\u73a9\u5427\uff01");var r="GameRes://inviteIcon.png",o=1;if(BK.FileUtil.isFileExist(r)){var n=BK.Image.loadImage(r);if(n){var s=n.height,a=n.width;o=Math.abs(s/a-304/540)<.01?3:2}else BK.Script.log(1,1,"defaultSharePic loadImage inviteIcon failed.")}else o=1;1==o?i(-1,o,null):3==o?this.generateQRCodeAnd169(t,e,function(t,e){i(t,o,e)}.bind(this),"GameSandBox://shareDefault.png"):i(-1,o,null)},this.generateQRCodeAnd169=function(t,e,i,r){var o=this.composeShare(t,e,"GameRes://inviteIcon.png","GameRes://share_logo.png",r);i(0,o)},this.composeShare=function(t,e,i,r,o){var n="GameSandBox://compose.png";o&&(n=o);var s=BK.Image.loadImage(i),a=new BK.Canvas(750,750);a.fillColor={r:1,g:1,b:1,a:1},a.fillRect(0,0,750,750),BK.FileUtil.isFileExist(r)&&a.drawImage(r,0,0,125,28,32,32,126,27),s&&a.drawImage(i,0,0,s.width,s.height,0,330,750,420),a.fillColor={r:0,g:0,b:0,a:1},a.drawStyle=0,a.setTextAlign(1),a.setTextSize(40),a.textBaseLine="bottom",a.textAlign="left",a.fillText(t,35,258),a.fillColor={r:137/255,g:137/255,b:137/255,a:.5},a.drawStyle=0,a.setTextAlign(1),a.setTextSize(30),a.textBaseLine="bottom",a.textAlign="left",a.fillText(e,35,215),a.fillColor={r:1,g:1,b:1,a:1};var h=this.generatePureQRCode();return a.drawImage(h,0,0,256,256,600,64,120,120),a.fillColor={r:0,g:0,b:0,a:1},a.drawStyle=0,a.setTextAlign(1),a.setTextSize(19),a.textBaseLine="bottom",a.textAlign="left",a.fillText("\u957f\u6309\u626b\u7801\u5373\u73a9",600,28),a.saveTo(n),a.dispose(),n},this.generatePureQRCode=function(t){var e="GameSandBox://qrcode.png";t&&(e=t);var i="http://cmshow.qq.com/apollo/html/game-platform/scan-game.html?gameId="+GameStatusInfo.gameId.toString()+"&src=203";return BK.QRCode.createQRCodeToFile(e,i,{width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:2}),e},this._event4QuitGame=function(t,e,i){BK.Script.log(0,0,"BK.QQ._event4QuitGame errCode = "+t+" cmd = "+e+" data = "+JSON.stringify(i)),this.delegate.onQuitGameEvent&&this.delegate.onQuitGameEvent(t,e,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_QUIT_GAME,this)},this._event4CancelGame=function(t,e,i){BK.Script.log(0,0,"BK.QQ._event4CancelGame errCode = "+t+" cmd = "+e+" data = "+JSON.stringify(i)),this.delegate.onCancelGameEvent&&this.delegate.onCancelGameEvent(t,e,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_CANCEL_GAME,this)},this.notifyQuitGameSrv=function(){var t={cmd:CMSHOW_SRV_CMD_QUIT_GAME,from:this.gameCfg.platform,gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.Script.log(0,0,"BK.QQ.notifyQuitGameSrv!, cmd = "+t.cmd+", from = "+t.from+", gameId = "+t.gameId+", roomId = "+t.roomId),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_QUIT_GAME,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_QUIT_GAME,this,this._event4QuitGame.bind(this)),BK.MQQ.SsoRequest.send(t,CMSHOW_SRV_CMD_QUIT_GAME)},this.notifyCancelGameSrv=function(){var t={cmd:CMSHOW_SRV_CMD_CANCEL_GAME,from:this.gameCfg.platform,gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.Script.log(0,0,"BK.QQ.notifyCancelGameSrv!, cmd = "+t.cmd+", from = "+t.from+", gameId = "+t.gameId+", roomId = "+t.roomId),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_CANCEL_GAME,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_CANCEL_GAME,this,this._event4CancelGame.bind(this)),BK.MQQ.SsoRequest.send(t,CMSHOW_SRV_CMD_CANCEL_GAME)},this._event4StartGame=function(t,e,i){BK.Script.log(0,0,"BK.QQ._event4StartGame! errCode = "+t+" cmd = "+e+" data = "+JSON.stringify(i)),this.hasStartGameSucc=0==t,this._startGameLocal(t,i),this.delegate.onStartGameEvent&&this.delegate.onStartGameEvent(t,e,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_START_GAME,this)},this.notifyStartGameSrv=function(){var t={cmd:CMSHOW_SRV_CMD_START_GAME,from:this.gameCfg.platform,gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.Script.log(0,0,"BK.QQ.notifyStartGameSrv!, cmd = "+t.cmd+", from = "+t.from+", gameId = "+t.gameId+", roomId = "+t.roomId),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_START_GAME,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_START_GAME,this,this._event4StartGame.bind(this)),BK.MQQ.SsoRequest.send(t,CMSHOW_SRV_CMD_START_GAME)},this._event4JoinRoom=function(t,e,i){BK.Script.log(0,0,"BK.QQ._event4JoinRoom errCode = "+t+" cmd = "+e+" data = "+JSON.stringify(i)),this.hasJoinRoomSucc=0==t,this.delegate.onJoinRoomEvent&&this.delegate.onJoinRoomEvent(t,e,i),BK.QQ.notifyJoinRoom(this.newJoinPlayers,i,t),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_JOIN_ROOM,this),this.ssoJoinRoomCallback&&this.ssoJoinRoomCallback(t,e,i),this.ssoJoinRoomCallbackPublic&&(i.gameId=this.gameCfg.gameId,i.gameRoomId=this.gameCfg.roomId,i.avRoomId=i.data.avRoomId?i.data.avRoomId:0,i.sdkAppId=i.data.sdkAppId?i.data.sdkAppId:0,i.accountType=i.data.accountType?i.data.accountType:0,this.ssoJoinRoomCallbackPublic(t,e,i))},this.notifyNewOrJoinRoomSrv=function(t,e,i,r){var o={cmd:CMSHOW_SRV_CMD_JOIN_ROOM,from:this.gameCfg.platform,aioType:this.gameCfg.aioType,gameId:this.gameCfg.gameId,version:this.gameCfg.gameVersion,roomId:e,opType:i,gameMode:this.gameCfg.gameMode,roomVol:this.roomVol,arkData:this.arkData,src:r};BK.Script.log(1,1,"BK.QQ.notifyNewOrJoinRoomSrv!, cmd = "+o.cmd+", from = "+o.from+", aioType = "+o.aioType+", gameId = "+o.gameId+", version = "+o.version+", roomId = "+o.roomId+", opType = "+o.opType),this.newJoinPlayers=t,BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_JOIN_ROOM,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_JOIN_ROOM,this,this._event4JoinRoom.bind(this)),BK.MQQ.SsoRequest.send(o,CMSHOW_SRV_CMD_JOIN_ROOM)},this._customGameLogicCallBack=void 0,this._event4CustomLogic=function(t,e,i){null!=this._customGameLogicCallBack&&this._customGameLogicCallBack(t,e,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC,this)},this.reqCustomLogic=function(t,e){null!=t?(this._customGameLogicCallBack=e,BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC,this,this._event4CustomLogic.bind(this)),BK.MQQ.SsoRequest.send(t,CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC)):BK.Script.log(0,0,"reqCustomLogic data undefined!")},this._getRankListLogicCallBack=void 0,this._event4GetRankList=function(t,e,i){BK.Script.log(1,1,"BK.QQ.reqGetRankList! callback cmd"+e+" errCode:"+t+"  data:"+JSON.stringify(i)),null!=this._getRankListLogicCallBack&&this._getRankListLogicCallBack(t,e,i),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_GET_RANK_LIST,this)},this.getRankList=function(t,e){var i={cmd:CMSHOW_SRV_GET_RANK_LIST,from:"default",objType:1,objId:0,busType:3,busId:this.gameCfg.gameId.toString()};e&&(e.objType&&(i.objType=e.objType),e.objId&&(i.objId=e.objId),e.from&&(i.from=e.from)),BK.Script.log(1,1,"BK.QQ.reqGetRankList! "+JSON.stringify(i)),null!=i?(this._getRankListLogicCallBack=t,BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_GET_RANK_LIST,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_GET_RANK_LIST,this,this._event4GetRankList.bind(this)),BK.MQQ.SsoRequest.send(i,CMSHOW_SRV_GET_RANK_LIST)):BK.Script.log(0,0,"reqGetRankList data undefined!")},this._pushPublicMsgCallBack=void 0,this._event4PushPublicMsg=function(t,e,i){BK.Script.log(1,1,"BK.QQ.pushPublicMsg! callback cmd"+e+" errCode:"+t+"  data:"+JSON.stringify(i)),null!=this._pushPublicMsgCallBack&&this._pushPublicMsgCallBack(t,e,i)},this.pushPublicMsg=function(t,e){var i={gameid:this.gameCfg.gameId,templateid:e.templateid,report_ts:e.report_ts,tmpl_param:e.tmpl_param};BK.Script.log(1,1,"BK.QQ.pushPublicMsg! "+JSON.stringify(i)),null!=i?(this._pushPublicMsgCallBack=t,BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_PUSH_PUBLIC_MSG,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_PUSH_PUBLIC_MSG,this,this._event4PushPublicMsg.bind(this)),BK.MQQ.SsoRequest.send(i,CMSHOW_SRV_PUSH_PUBLIC_MSG)):BK.Script.log(0,0,"pushPublicMsg data undefined!")},this.hasJoinRoom=function(){return this.hasJoinRoomSucc},this.hasStartGame=function(){return this.hasStartGameSucc},this._event4StopGame=function(t,e,i){BK.Script.log(0,0,"BK.QQ._event4StopGame!errCode = "+t+" cmd = "+e+" data = "+JSON.stringify(i)),this._closeRoom(),this.delegate.onStopGameEvent&&this.delegate.onStopGameEvent(t,e,i)},this._closeRoom=function(t){BK.QQ.isNeedSSOServer=null==t||null==t||t,1==Boolean(BK.QQ.isNeedSSOServer)&&(this.hasStartGameSucc||this.gameCfg.roomId&&0!=this.gameCfg.roomId&&(this.gameCfg.isCreator?this.notifyCancelGameSrv():this.notifyQuitGameSrv()))},this.uploadScoreWithoutRoom=function(t,e,i){var r="apollo_report_result.single_user_result",o=Math.floor((new Date).getTime()/1e3),n={from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,aioType:GameStatusInfo.aioType,ts:o.toString(),src:GameStatusInfo.src,mode:void 0!==t?t:1,userData:e.userData,attr:e.attr};i&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,i)),BK.MQQ.SsoRequest.send(n,r)},this.getRankListWithoutRoom=function(t,e,i,r){var o="apollo_router_game.apollo_user_rankinglist_linkcmd_custom_ranking",n=Math.floor((new Date).getTime()/1e3),s={from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,ts:n.toString(),attr:void 0!==t?t:"score",order:void 0!==e?e:1,rankType:void 0!==i?i:0};r&&(BK.MQQ.SsoRequest.removeListener(o,this),BK.MQQ.SsoRequest.addListener(o,this,r)),BK.MQQ.SsoRequest.send(s,o)},this.saveGameData=function(t,e){var i="apollo_private_data.set_user_data",r=Math.floor((new Date).getTime()/1e3),o={openId:GameStatusInfo.openId,gameId:GameStatusInfo.gameId,version:GameStatusInfo.gameVersion,from:GameStatusInfo.platform,ts:r.toString(),data:t};e&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,e)),BK.MQQ.SsoRequest.send(o,i)},this.loadGameData=function(t){var e="apollo_private_data.get_user_data",i=Math.floor((new Date).getTime()/1e3),r={openId:GameStatusInfo.openId,gameId:GameStatusInfo.gameId,version:GameStatusInfo.gameVersion,from:GameStatusInfo.platform,ts:i.toString()};t&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,t)),BK.MQQ.SsoRequest.send(r,e)},this.reportGameResult=function(t,r){var e="apollo_router_game.apollo_reportcm_linkcmd_game_result";t.gameId=GameStatusInfo.gameId,0<GameStatusInfo.isWhiteUser&&BK.Script.log(1,1,"reportGameResult :"+t),BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,function(t,e,i){this.checkNewRedPackage(),r&&r(t,e,i)}.bind(this)),BK.MQQ.SsoRequest.send(t,e)},this.updateScoreLocal=function(t){BK.MQQ.SsoRequest.send({gameId:GameStatusInfo.gameId,score:t},"cs.game_update_score.local")},this.getRedPacketResult=function(t,e){var i="cs.get_redPacket_result.local";e&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,e)),BK.MQQ.SsoRequest.send({gameId:GameStatusInfo.gameId,score:t},i)},this.listenRedPacketEvent=function(t){var e="sc.web_callback_game.local";t&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,t))},this.skipGame=function(t,e){var i={xyId:t,extendInfo:e,src:302};BK.MQQ.SsoRequest.send(i,"cs.create_xy.local");var r=new Date,o=r.getFullYear(),n=r.getMonth()+1,s=r.getDate(),a=r.getHours(),h=""+o+(n=(""+n).length<2?"0"+n:n)+(s=""+s<2?"0"+s:s)+(a=""+a<2?"0"+a:a);BK.QQ.uploadData("gameAtoB","302",1,t,h,"")},BK.MQQ.SsoRequest.addListener(CMSHOW_SC_CMD_STOP_GAME,this,this._event4StopGame.bind(this)),e="apollo_router_light.apollo_activity_linkcmd_query_new_redpacket",GameStatusInfo.commFlagBits||(GameStatusInfo.commFlagBits=0),BK.Script.log(1,1,"redPackage  commonFlagBits : "+GameStatusInfo.commFlagBits),this.isUserInRedPackageActivity=function(){var t=GameStatusInfo.commFlagBits>>1&1,e=t&&310!==GameStatusInfo.src;return BK.Script.log(1,1,"redPackage  isUserInRedPackageActivity: "+e),e},this.isOpenActivityPage=function(){var t=GameStatusInfo.commFlagBits>>2&1,e=t&&310!==GameStatusInfo.src;return BK.Script.log(1,1,"redPackage  isOpenActivityPage: "+e),e},this.showRedPackageActivityPage=function(){BK.Director.ticker.setTimeout(function(){var t="http://cmshow.qq.com/act_apollo/h5_act/gameRedPacket/html/popup.html?game_id="+GameStatusInfo.gameId+"&page=ad&_cwv=1&wv=3&adtag=engine";BK.MQQ.Webview.openTransparent(t)}.bind(this),100,this)},this.checkNewRedPackage=function(){if(this.isUserInRedPackageActivity()){var t={cmd:e,gameId:GameStatusInfo.gameId.toString()};BK.Script.log(1,1,"redPackage \u53d1\u9001\u65b0\u7ea2\u5305\u68c0\u67e5:"+JSON.stringify(t)),BK.MQQ.SsoRequest.send(t,e)}},this.onNewRedPackage=function(t,e,i){if(BK.Script.log(0,0,"BK.QQ.onNewRedPackage  redPackage errCode = "+t+" cmd = "+e+" data = "+JSON.stringify(i)),0==t)if(i.data&&i.data.redPacket&&i.data.redPacket.actId&&i.data.redPacket.taskId){var r=i.data.redPacket,o="http://cmshow.qq.com/act_apollo/h5_act/gameRedPacket/html/popup.html?game_id="+GameStatusInfo.gameId+"&page=task&task_id="+r.taskId+"&_cwv=1&wv=3&adtag=engine";BK.MQQ.Webview.openTransparent(o)}else BK.Script.log(1,1,"request new red package  redPackage ,\u6ca1\u6709\u65b0\u7ea2\u5305\u4efb\u52a1\u89e6\u53d1");else BK.Script.log(1,1,"request new red package Failed!  redPackage ErrCode:"+t)}},void(0==u&&(BK.Script.renderMode=1,u=1))),BK.Room=function(){this.roomId,this.gameId,this.mId,this.ownerId,this.createTs,this.status,this.playerNum,this.ip0,this.ip1,this.msgSeq=1,this.ackSeq,this.lastFrame=0,this.startGameTs=0,this.createRoomCallBack,this.queryRoomInfoCallBack,this.joinRoomCallBack,this.leaveRoomCallBack,this.startGameCallBack,this.broadcastDataCallBack,this.sensitiveWordCallBack,this.setUserDataCallBack,this.getUserDataCallBack,this.sendSyncOptCallBack,this.forceStopGameCallBack,this.frameSyncListener,this.queryFrameDataCallBack,this.matchGameCallBack,this.queryMatchGameCallBack,this.quitMatchGameCallBack,this.disconnectNetCallBack,this.reJoinRoomCallBack,this.socket=new BK.Socket,this.reqArray=new Array,this.newJoinPlayers=[],this.currentPlayers=[],this.isCreator=1==GameStatusInfo.isMaster,this.gameStatusInfo=GameStatusInfo,this.serverConnected,this._environment=GameStatusInfo.isWhiteUser,this.headerVersion=769,this.recommandRoomSvrHost=h,this.recommandRoomSvrPort=c,this.netTimeOutTs=0,this.options=null,this.setArkData=function(t){BK.QQ.setArkData(t)},this.setRoomVol=function(t){BK.QQ.roomVol=t},this.read32BytesToString=function(t){for(var e="",i=0;i<32;i++){var r=t.readUint8Buffer();e+=String.fromCharCode(r)}return e},this.writeOpenIdIntoBuffer=function(t,e){var i=new BK.Buffer(32);if(open&&32==e.length)for(var r=0;r<32;r++){var o=e.charCodeAt(r);i.writeUint8Buffer(o)}else{for(r=0;r<32;r++)i.writeUint8Buffer(0);BK.Script.log(0,0,"writeOpenIdIntoBuffer.length is not 32 bytes,Write empty data")}t.writeBuffer(i)},this.addHeader=function(t,e,i){t.writeUint16Buffer(4660),t.writeUint16Buffer(this.headerVersion),t.writeUint16Buffer(0),t.writeUint16Buffer(i),t.writeUint32Buffer(e)},this.addFixedHeader=function(t,e,i,r,o,n,s,a,h){null==n&&(n=""),null==s&&(s=0),null==a&&(a=0),null==h&&(h=0),t.writeUint16Buffer(72),t.writeUint16Buffer(e),t.writeUint32Buffer(0),t.writeUint64Buffer(1111),t.writeUint64Buffer(i),t.writeUint64Buffer(r),this.writeOpenIdIntoBuffer(t,o),this.writeOpenIdIntoBuffer(t,n),t.writeUint64Buffer(s),t.writeUint64Buffer(a),t.writeUint64Buffer(h)},this.getHeader=function(t){var e=t.readUint16Buffer(),i=t.readUint16Buffer(),r=t.readUint16Buffer(),o=t.readUint16Buffer(),n=t.readUint32Buffer(),s=new Object;return s.magic=e,s.ver=i,s.stlen=o,s.bodyLen=n,s.seq=r,s},this.getFixedHeader=function(t){var e,i,r=t.readUint16Buffer(),o=t.readUint16Buffer(),n=t.readUint32Buffer(),s=t.readUint64Buffer(),a=t.readUint64Buffer(),h=t.readUint64Buffer();e=this.read32BytesToString(t),i=this.read32BytesToString(t);var c=t.readUint64Buffer(),u=t.readUint64Buffer(),l=t.readUint64Buffer(),d=new Object;return d.fixLen=r,d.cmd=o,d.ret=n,d.date=s,d.gameId=a,d.roomId=h,d.fromId=e,d.toId=i,d.token=c,d.appId=u,d.accessToken=l,d},this.getRequestCommonBuffer=function(t,e,i,r,o,n,s){var a,h,c=0;if(s&&(s.rewind(),c=s.length),h=new BK.Stream(BK.Security.getST()),a=new BK.Stream(f+c+o,1),this.addFixedHeader(a,t,e,i,r),0<c)for(var u=0;u<c;u++)a.writeUint8Buffer(s.readUint8Buffer());if(0<o){var l=new BK.Stream(n.bkJSTLVGetBuffer());for(u=0;u<l.length;u++)a.writeUint8Buffer(l.readUint8Buffer())}a=BK.Misc.arrayBufferToBKBuffer(a.data),BK.Security.encrypt(a),a=new BK.Stream(a);var d=new BK.Stream(_+a.length+h.length);return this.addHeader(d,a.length,h.length),d.writeBuffer(h),d.writeBuffer(a),d.data},this.matchGame=function(t,e,i){this.mId=e,this.gameId=parseInt(t),BK.QQ.gameCfg.gameMode=6,GameStatusInfo.gameMode=6;var r=this.socket.connect(this.recommandRoomSvrHost,this.recommandRoomSvrPort);BK.Script.log(0,0,"socket con ="+r),-1==r?BK.Script.log(0,0,"socket connect failed! "+r):this.serverConnected=1,this.matchGameCallBack=i;var o=new Object;o.cmd=36,o.arg0=t,o.arg1=e,this.reqArray.push(o),BK.Script.log(0,0,"createRoom ")},this.requestMatch=function(t,e){BK.Script.log(0,0,"match game request in");var i=new BK.Buffer(f,1);this.addFixedHeader(i,36,t,0,e);var r=BK.Security.getST();BK.Security.encrypt(i);var o=r.bufferLength(),n=new BK.Buffer(_+i.bufferLength()+o,1);return this.addHeader(n,i.bufferLength(),o),n.writeBuffer(r),n.writeBuffer(i),BK.Script.log(0,0,"match game request buffer : "+n.bufferLength()+" body len:"+i.bufferLength()),n},this.queryMatchGame=function(t,e,i){BK.Script.log(0,0,"queryMatchGame in "),this.mId=e,this.gameId=parseInt(t),this.queryMatchGameCallBack=i;var r=new Object;r.cmd=38,r.arg0=t,r.arg1=e,this.reqArray.push(r)},this.requestQueryMatch=function(t,e){BK.Script.log(0,0,"query match game request in");var i=new BK.Buffer(f,1);this.addFixedHeader(i,38,t,0,e);var r=BK.Security.getST();BK.Security.encrypt(i);var o=r.bufferLength(),n=new BK.Buffer(_+i.bufferLength()+o,1);return this.addHeader(n,i.bufferLength(),o),n.writeBuffer(r),n.writeBuffer(i),BK.Script.log(0,0,"query match game request buffer : "+n.bufferLength()+" body len:"+i.bufferLength()),n},this.quitMatchGame=function(t,e,i){BK.Script.log(0,0,"quitMatchGame in "),this.mId=e,this.gameId=parseInt(t),this.quitMatchGameCallBack=i;var r=new Object;r.cmd=40,r.arg0=t,r.arg1=e,this.reqArray.push(r)},this.requestQuitMatch=function(t,e){BK.Script.log(0,0,"quit match game request in");var i=new BK.Buffer(f,1);this.addFixedHeader(i,40,t,0,e);var r=BK.Security.getST();BK.Security.encrypt(i);var o=r.bufferLength(),n=new BK.Buffer(_+i.bufferLength()+o,1);return this.addHeader(n,i.bufferLength(),o),n.writeBuffer(r),n.writeBuffer(i),BK.Script.log(0,0,"quit match game request buffer : "+n.bufferLength()+" body len:"+i.bufferLength()),n},this.createRoom=function(t,e,i){if(this.mId=e,this.gameId=parseInt(t),1!=this.serverConnected){var r=this.socket.connect(this.recommandRoomSvrHost,this.recommandRoomSvrPort);BK.Script.log(0,0,"socket con ="+r),-1==r?BK.Script.log(0,0,"socket connect failed! "+r):this.serverConnected=1}this.createRoomCallBack=i;var o=new Object;o.cmd=6,o.arg0=t,o.arg1=e,this.reqArray.push(o),BK.Script.log(0,0,"createRoom ")},this.requestCreateRoom=function(t,e){var i=Number(this.roomId);i||(i=0),BK.Script.log(0,0,"create room request ");var r=new BK.Buffer(f,1);this.addFixedHeader(r,6,t,i,e);var o=BK.Security.getST();BK.Security.encrypt(r);var n=o.bufferLength(),s=new BK.Buffer(_+r.bufferLength()+n,1);return this.addHeader(s,r.bufferLength(),n),s.writeBuffer(o),s.writeBuffer(r),BK.Script.log(0,0,"create room request buffer : "+s.bufferLength()+" body len:"+r.bufferLength()),s},this.requestQueryRoom=function(){var t=new BK.Buffer(f,1);this.addFixedHeader(t,10,this.gameId,this.roomId,this.mId);var e=BK.Security.getST();BK.Security.encrypt(t);var i=e.bufferLength(),r=new BK.Buffer(_+t.bufferLength()+i,1);return this.addHeader(r,t.bufferLength(),i),r.writeBuffer(e),r.writeBuffer(t),r},this.queryRoom=function(t,e,i,r){this.mId=i,this.roomId=parseFloat(e),this.gameId=parseInt(t),this.queryRoomInfoCallBack=r;var o=new Object;o.cmd=10,this.reqArray.push(o),BK.Script.log(0,0,"queryRoom push")},this.joinRoom=function(t,e,i,r){this.joinRoomCallBack=e,BK.QQ.isNeedSSOServer=null==r||null==r||r,BK.Script.log(0,0,"BK.QQ.notifyJoinroom isDisableSendMsg   isAuto: "+i+",isAutoSendJoin:  "+BK.QQ.isAutoSendJoinRoomNotify);var o=new Object;o.cmd=2,o.arg0=t,this.reqArray.push(o)},this.requestJoinRoom=function(t){BK.Script.log(0,0,"join room request");var e=new BK.Buffer(f+5,1);this.addFixedHeader(e,2,this.gameId,this.roomId,this.mId);var i=new BK.TLV(5);i.bkJSTLVWriteUInt8(t,l.Uint8,201),e.writeBuffer(i.bkJSTLVGetBuffer());var r=BK.Security.getST();BK.Security.encrypt(e);var o=r.bufferLength(),n=new BK.Buffer(_+e.bufferLength()+o,1);return this.addHeader(n,e.bufferLength(),o),n.writeBuffer(r),n.writeBuffer(e),n},this.setReJoinRoomCallBack=function(t){this.reJoinRoomCallBack=t},this.reConnectAndJoinRoom=function(){var t=this.socket.connect(this.gameSvrIp,this.gameSvrPort);if(BK.Script.log(0,0,"socket con ="+t),-1==t)return BK.Script.log(0,0,"socket connect failed! "+t),-1;this.serverConnected=1,0==t&&BK.Script.log(0,0,"socket connect =0 "),0<=t&&(BK.Script.log(0,0,"rejoinroom send"),this.joinRoom(1,function(t,e){BK.Script.log(0,0,"rejoinroom statusCode:"+t+" roomid is "+e.roomId),this.reJoinRoomCallBack&&this.reJoinRoomCallBack(t,this)}))},this.leaveRoom=function(t,e){null==e&&(e=-1);var i=new Object;i.cmd=4,i.arg0=e,this.reqArray.push(i),this.leaveRoomCallBack=t,BK.Script.log(0,0,"leaveRoom push")},this.setLeaveRoomCallback=function(t){this.leaveRoomCallBack=t},this.requestLeaveRoom=function(t){var e=new BK.TLV(44),i=new BK.Buffer(40,1);this.writeOpenIdIntoBuffer(i,this.mId),i.writeUint64Buffer(t),e.bkJSTLVWriteBuffer(i,l.Byte,201);var r=new BK.Buffer(f+e.bkJSTLVGetLength(),1);this.addFixedHeader(r,4,this.gameId,this.roomId,this.mId),r.writeBuffer(e.bkJSTLVGetBuffer());var o=BK.Security.getST(),n=o.bufferLength();return BK.Security.encrypt(r),buff=new BK.Buffer(_+r.bufferLength()+n,1),this.addHeader(buff,r.bufferLength(),n),buff.writeBuffer(o),buff.writeBuffer(r),BK.Script.log(0,0,"leave room buffer : "+buff.bufferLength()+" body len:"+r.bufferLength()),buff},this._startGame=function(t){this.startGameCallBack=t;var e=new Object;e.cmd=8,this.reqArray.push(e),BK.Script.log(0,0,"startGame push")},this.startGame=function(r){GameStatusInfo.devPlatform?(BK.Script.log(0,0,"startGame dev:"),this._startGame(r)):1==BK.QQ.hasJoinRoomSucc?(BK.Script.log(0,0,"startGame qq:cmsrv confirm joinRoom response"),this._startGame(r)):(BK.Script.log(0,0,"startGame qq:waiting cmsvr joiroom response"),BK.QQ.delegate.onJoinRoomEvent=function(t,e,i){BK.Script.log(0,0,"startGame qq:wait finish.start Game"),this._startGame(r)}.bind(this))},this.setStartGameCallback=function(t){this.startGameCallBack=t},this.requestStartGame=function(){var t=new BK.Buffer(f,1);this.addFixedHeader(t,8,this.gameId,this.roomId,this.mId);var e=BK.Security.getST();BK.Security.encrypt(t);var i=e.bufferLength(),r=new BK.Buffer(_+t.bufferLength()+i,1);return this.addHeader(r,t.bufferLength(),i),r.writeBuffer(e),r.writeBuffer(t),r},this.setBroadcastDataCallBack=function(t){this.broadcastDataCallBack=t},this.sendBroadcastData=function(t){var e=new Object;e.cmd=1,e.arg0=t,this.reqArray.push(e)},this.requestsendBroadcastData=function(t){var e=t.capacity?t.capacity:t.bufferLength(),i=new BK.Buffer(f+e,1);this.addFixedHeader(i,1,this.gameId,this.roomId,this.mId),i.writeBuffer(t);var r=BK.Security.getST();BK.Security.encrypt(i);var o=r.bufferLength(),n=new BK.Buffer(_+i.bufferLength()+o,1);return this.addHeader(n,i.bufferLength(),o),n.writeBuffer(r),n.writeBuffer(i),n},this.setSensitiveWordCallBack=function(t){this.sensitiveWordCallBack=t},this.sendSensitiveWordData=function(t){var e=new Object;e.cmd=50,e.arg0=t,this.reqArray.push(e)},this.requestSendSendSensitiveWordData=function(t){var e=t.capacity?t.capacity:t.bufferLength(),i=new BK.Buffer(f+e,1);this.addFixedHeader(i,50,this.gameId,this.roomId,this.mId),i.writeBuffer(t);var r=BK.Security.getST();BK.Security.encrypt(i);var o=r.bufferLength(),n=new BK.Buffer(_+i.bufferLength()+o,1);return this.addHeader(n,i.bufferLength(),o),n.writeBuffer(r),n.writeBuffer(i),n},this.setUserData=function(t,e){BK.Script.log(0,0,"setUserData call"),this.setUserDataCallBack=e;var i=new Object;i.cmd=32,i.arg0=t,this.reqArray.push(i),BK.Script.log(0,0,"setUserData push")},this.requestSetUserData=function(t){var e=t.capacity?t.capacity:t.bufferLength(),i=new BK.Buffer(f+e,1);this.addFixedHeader(i,32,this.gameId,this.roomId,this.mId),i.writeBuffer(t);var r=BK.Security.getST();BK.Security.encrypt(i);var o=r.bufferLength(),n=new BK.Buffer(_+i.bufferLength()+o,1);return this.addHeader(n,i.bufferLength(),o),n.writeBuffer(r),n.writeBuffer(i),n},this.getUserData=function(t,e){null==t&&(t=0),this.getUserDataCallBack=e;var i=new Object;i.cmd=34,i.arg0=t,this.reqArray.push(i),BK.Script.log(0,0,"getUserData push roomId = "+t)},this.requestGetUserData=function(t){var e=new BK.Buffer(f,1);this.addFixedHeader(e,34,this.gameId,this.roomId,this.mId);var i=BK.Security.getST();BK.Security.encrypt(e);var r=i.bufferLength(),o=new BK.Buffer(_+e.bufferLength()+r,1);return this.addHeader(o,e.bufferLength(),r),o.writeBuffer(i),o.writeBuffer(e),o},this.syncOpt=function(t,e,i,r,o){this.sendSyncOptCallBack=o;var n=new Object;n.cmd=14,n.arg0=t,n.arg1=e,n.arg2=i,n.arg3=r,this.reqArray.push(n)},this.sendSyncOpt=function(t,e){var i=new BK.Buffer(1,1);i.writeUint8Buffer(0);var r=new BK.Buffer(1,1);r.writeUint8Buffer(0),this.syncOpt(i,t,r,void 0,e)},this.requestSyncOpt=function(t,e,i,r){var o=20+(t.capacity?t.capacity:t.bufferLength())+4+(e.capacity?e.capacity:e.bufferLength())+4+(i.capacity?i.capacity:i.bufferLength());if(r){var n=r.capacity?r.capacity:r.bufferLength();o=o+4+n,BK.Script.log(0,0,"requestSyncOpt with item len"+n)}var s=new BK.TLV(o);s.bkJSTLVWriteUInt32(this.msgSeq,l.Uint32,201),s.bkJSTLVWriteUInt32(this.lastFrame,l.Uint32,202),s.bkJSTLVWriteBuffer(t,l.Byte,203),s.bkJSTLVWriteBuffer(e,l.Byte,204),s.bkJSTLVWriteBuffer(i,l.Byte,205),r&&s.bkJSTLVWriteBuffer(r,l.Byte,206),BK.Script.log(0,0,"requestSyncOpt this.msgSeq:"+this.msgSeq+" this.lastFrame:"+this.lastFrame);s.bkJSParseTLV();BK.Script.log(0,0,"requestSyncOpt tlv len:"+s.bkJSTLVGetLength()+" fix header:"+f);var a=new BK.Buffer(f+s.bkJSTLVGetLength(),1);this.addFixedHeader(a,14,this.gameId,this.roomId,this.mId),a.writeBuffer(s.bkJSTLVGetBuffer());var h=BK.Security.getST();BK.Security.encrypt(a);var c=h.bufferLength(),u=new BK.Buffer(_+a.bufferLength()+c,1);return this.addHeader(u,a.bufferLength(),c),u.writeBuffer(h),u.writeBuffer(a),this.msgSeq+=1,u},this.setFrameSyncListener=function(t){this.frameSyncListener=t},this.queryFrameData=function(t,e,i){this.queryFrameDataCallBack=i;var r=new Object;r.cmd=18,r.arg0=t,r.arg1=e,this.reqArray.push(r)},this.requestQueryFrameData=function(t,e){var i=new BK.TLV(22);i.bkJSTLVWriteUInt32(this.lastFrame,l.Uint32,201),i.bkJSTLVWriteUInt32(t,l.Uint32,202),i.bkJSTLVWriteUInt16(e,l.Uint16,203);var r=new BK.Buffer(f+i.bkJSTLVGetLength(),1);this.addFixedHeader(r,18,this.gameId,this.roomId,this.mId),r.writeBuffer(i.bkJSTLVGetBuffer());var o=BK.Security.getST();BK.Security.encrypt(r);var n=o.bufferLength(),s=new BK.Buffer(_+r.bufferLength()+n,1);return this.addHeader(s,r.bufferLength(),n),s.writeBuffer(o),s.writeBuffer(r),s},this.sendControlCommand=function(t,e,i,r){var o=new Object;o.cmd=48,o.arg0=t,o.arg1=e,o.arg2=i,this.reqArray.push(o),this.controlCommandCallback=r},this.requestControlCommand=function(t,e,i){var r=new BK.TLV(14+e.bufferLength()+i.bufferLength());r.bkJSTLVWriteBuffer(e,l.Byte,201),r.bkJSTLVWriteUInt16(t,l.Uint16,202),r.bkJSTLVWriteBuffer(i,l.Byte,203);var o=new BK.Buffer(f+r.bkJSTLVGetLength(),1);this.addFixedHeader(o,48,this.gameId,this.roomId,this.mId),o.writeBuffer(r.bkJSTLVGetBuffer()),BK.Security.encrypt(o);var n=BK.Security.getST(),s=n.bufferLength(),a=new BK.Buffer(_+o.bufferLength()+s,1);return this.addHeader(a,o.bufferLength(),s),a.writeBuffer(n),a.writeBuffer(o),a},this.sendKeepAlive=function(){var t=new Object;(t.cmd=12,this.reqArray.push(t),0!=this.netTimeOutTs)&&(5<BK.Time.timestamp-this.netTimeOutTs&&this.disconnectNetCallBack&&this.disconnectNetCallBack())},this.requestSendKeepAlive=function(){var t=new BK.Buffer(f,1);this.addFixedHeader(t,12,this.gameId,this.roomId,this.mId);var e=BK.Security.getST();BK.Security.encrypt(t);var i=e.bufferLength(),r=new BK.Buffer(_+t.bufferLength()+i,1);return this.addHeader(r,t.bufferLength(),i),r.writeBuffer(e),r.writeBuffer(t),r},this.recvCreateRoom=function(t,e){BK.Script.log(0,0,"recvCreateRoom bodyLen="+e);var i=t.readBuffer(e),r=new BK.TLV(i).bkJSParseTLV();if(r){var o=r.tag202,n=o.readUint8Buffer(),s=o.readUint8Buffer(),a=o.readUint16Buffer();o.readUint64Buffer(),o.readUint32Buffer();var h=o.readUint8Buffer(),c=o.readUint8Buffer(),u=o.readUint8Buffer(),l=o.readUint8Buffer(),d=r.tag201,f=d.readUint8Buffer(),_=d.readUint8Buffer(),p=d.readUint16Buffer();d.readUint64Buffer(),d.readUint32Buffer();var m=d.readUint8Buffer(),g=d.readUint8Buffer(),v=d.readUint8Buffer(),S=d.readUint8Buffer(),y=new Object;return y.ipType_1=n,y.resServe_1=s,y.ipType_2=f,y.resServe_2=_,y.port_1=a,y.ip_1=h+"."+c+"."+u+"."+l,y.port_2=p,y.ip_2=m+"."+g+"."+v+"."+S,this.ip0=y.ip_1,this.ip1=y.ip_2,y}BK.Script.log(0,0,"recvCreateRoom parse failed.")},this.recvQueryRoom=function(t,e){BK.Script.log(0,0,"recvQueryRoom bodyLen:"+e);var i=t.readBuffer(e),r=new BK.TLV(i).bkJSParseTLV();if(r){var o=r.tag202,n=o.readUint8Buffer(),s=o.readUint8Buffer(),a=o.readUint16Buffer();o.readUint64Buffer(),o.readUint32Buffer();var h=o.readUint8Buffer(),c=o.readUint8Buffer(),u=o.readUint8Buffer(),l=o.readUint8Buffer(),d=r.tag201,f=d.readUint8Buffer(),_=d.readUint8Buffer(),p=d.readUint16Buffer();d.readUint64Buffer(),d.readUint32Buffer();var m=d.readUint8Buffer(),g=d.readUint8Buffer(),v=d.readUint8Buffer(),S=d.readUint8Buffer(),y=r.tag203,B=this.read32BytesToString(y),b=y.readUint64Buffer(),T=y.readUint8Buffer(),E=y.readUint8Buffer(),C=r.tag205;null==C&&(C=0);for(var R=[],I=0;I<E;I++){var A={};A.uid=this.read32BytesToString(y),A.status=y.readUint8Buffer(),R.push(A)}var O=new Object;return O.ipType_1=n,O.resServe_1=s,O.ipType_2=f,O.resServe_2=_,O.port_1=a,O.ip_1=h+"."+c+"."+u+"."+l,O.port_2=p,O.ip_2=m+"."+g+"."+v+"."+S,O.ownerId=B,O.createTs=b,O.status=T,O.playerNum=E,O.ext_num=C,this.ip0=O.ip_1,this.ip1=O.ip_2,this.ownerId=B,this.createTs=b,this.status=T,this.playerNum=E,this.players=R,O}BK.Script.log(0,0,"recvQueryRoom parse failed.bodyLen is 0")},this.recvJoinRoom=function(t,e){for(var i=t.readBuffer(e),r=new BK.TLV(i).bkJSParseTLV().tag201,o=this.read32BytesToString(r),n=r.readUint64Buffer(),s=r.readUint8Buffer(),a=r.readUint8Buffer(),h=[],c=0;c<a;c++){var u={},l=this.read32BytesToString(r),d=r.readUint64Buffer();s=r.readUint8Buffer();u.openId=l,u.status=s,u.joinTs=d,h.push(u)}if(this.ownerId=o,this.createTs=n,this.status=s,this.playerNum=a,0==this.currentPlayers.length)h.forEach(function(t){this.newJoinPlayers.push(t)},this);else{var f=[];BK.Script.log(0,0,"recvJoinRoom!curPlayers = "+JSON.stringify(this.currentPlayers)),BK.Script.log(0,0,"recvJoinRoom!joinPlayers = "+JSON.stringify(h));for(c=0;c<h.length;c++){u=h[c];for(var _=!1,p=0;p<this.currentPlayers.length;p++){if(this.currentPlayers[p].openId==u.openId){_=!0;break}}0==_&&f.push(u)}this.newJoinPlayers=f,BK.Script.log(0,0,"recvJoinRoom!newPlayers = "+JSON.stringify(this.newJoinPlayers))}this.currentPlayers=h,BK.Script.log(0,0,"recvJoinRoom ownerId="+o+",createTs ="+n+",playerNum:"+a)},this.recvLeaveRoom=function(t,e){var i=t.readBuffer(e),r=new BK.TLV(i).bkJSParseTLV();if(r){var o=r.tag201,n=this.read32BytesToString(o),s=t.readUint64Buffer(),a=new Object;return BK.Script.log(0,0,"recvLeaveRoom!ret = "+s),a.reason=s,a.logOutId=n,this.currentPlayers.splice(this.currentPlayers.indexOf(n)),a}BK.Script.log(0,0,"recvLeaveRoom parse failed.bodylen is "+e)},this.recvStartGame=function(t,e){this.startGameTs=BK.Time.timestamp,BK.Script.log(0,0,"recvStartGame")},this.recvPushFrameSync=function(t,e){for(var i=t.readBuffer(e),r=new BK.TLV(i).bkJSParseTLV(),o=(r.tag201,r.tag202,r.tag203),n=new Array,s=0;s<o.length;s++){var a=o[s].readUint32Buffer();this.lastFrame=a;var h=o[s].bufferLength()-4;BK.Script.log(0,0,"sync recv len= "+o[s].bufferLength()+" frameData.length="+o.length);for(var c=new Array;0<h;){BK.Script.log(0,0,"push frameNo="+this.lastFrame);var u=o[s].readUint16Buffer();BK.Script.log(0,0,"push databuf 2 datalen="+u);var l=this.read32BytesToString(o[s]),d=o[s].readUint64Buffer(),f={openId:l,itemId:d,dataBuffer:o[s].readBuffer(u)};BK.Script.log(0,0,"push databuf openid="+l),BK.Script.log(0,0,"push databuf itemid="+d),c.push(f),h-=42,h-=u}c.frameSeq=a,n.push(c)}this.frameSyncListener(n)},this.recvQueryFrameSync=function(t,e){var i=t.readBuffer(e),r=new BK.TLV(i).bkJSParseTLV();if(!r)return BK.Script.log(0,0,"recvQueryFrameSync empty."),void this.queryFrameDataCallBack(0,void 0);for(var o=r.tag201,n=new Array,s=0;s<o.length;s++){var a=o[s].readUint32Buffer(),h=o[s].bufferLength()-4;BK.Script.log(0,0,"sync query recv = "+o[s].bufferLength()+" frameData.length="+o.length);for(var c=new Array;0<h;){BK.Script.log(0,0,"push frameNo="+this.lastFrame);var u=o[s].readUint16Buffer();BK.Script.log(0,0,"push databuf 2 datalen="+u);var l=this.read32BytesToString(o[s]),d=o[s].readUint64Buffer(),f={openId:l,itemId:d,dataBuffer:o[s].readBuffer(u)};BK.Script.log(0,0,"push databuf openid="+l),BK.Script.log(0,0,"push databuf itemid="+d),c.push(f),h-=42,h-=u}c.frameSeq=a,n.push(c)}BK.Script.log(0,0,"query end"),this.queryFrameDataCallBack(0,n)},this.recvControlCommand=function(t,e){var i=t.readBuffer(e),r=new BK.TLV(i).bkJSParseTLV(),o={};r.tag201&&(o=JSON.parse(r.tag201.readAsString())),this.controlCommandCallback&&this.controlCommandCallback(0,o)},this.recvSSOJoinRoom=function(t,e,i){if(BK.Script.log(1,1,"recvSSOJoinRoom = true data="+JSON.stringify(i)),0==t){var r=i.data.avRoomId,o=i.data.sdkAppId,n=i.data.accountType;GameStatusInfo.avAppId=o,GameStatusInfo.avAccountType=n,GameStatusInfo.avRoomId=r,GameStatusInfo.roomId=this.roomId}},this.handleServerError=function(t,e){switch(BK.Script.log(0,1,"handleServerError!cmd = "+t.cmd+", errCode = "+t.ret),t.cmd){case 6:this.createRoomCallBack(t.ret,null,t.roomId);break;case 7:this.roomId=t.roomId,this.createRoomCallBack(header.ret,null,t.roomId);break;case 11:this.queryRoomInfoCallBack(t.ret,null);break;case 3:this.joinRoomCallBack(t.ret,this);break;case 4:case 5:this.leaveRoomCallBack(t.ret,null);break;case 9:this.startGameCallBack(t.ret);break;case 1:this.broadcastDataCallBack(t.fromId,null);break;case 51:this.sensitiveWordCallBack(t.ret,t.fromId,null);break;case 33:this.setUserDataCallBack(t.ret);break;case 35:this.getUserDataCallBack(t.ret,null);break;case 15:this.sendSyncOptCallBack(t.ret,null);break;case 16:break;case 19:this.queryFrameDataCallBack(t.ret,null);break;case 37:this.matchGameCallBack(t.ret);break;case 39:this.queryMatchGameCallBack(t.ret);break;case 41:this.quitMatchGameCallBack(t.ret);break;case 49:this.controlCommandCallback&&this.controlCommandCallback(t.ret,{})}},this.handleRecv=function(t){var e=this.getHeader(t);if(0!=e.stlen){t.readBuffer(e.stlen);BK.Script.log(0,0,"st.len = "+e.stlen)}var i=t.readBuffer(e.bodyLen);BK.Security.decrypt(i);var r=this.getFixedHeader(i);if((this.netTimeOutTs=0)==r.ret)switch(BK.Script.log(0,0,"handleRecv = "+r.cmd+",bodyLen="+e.bodyLen+",bodyreal="+i.bufferLength()),r.cmd){case 7:this.roomId=r.roomId;var o=this.recvCreateRoom(i,i.bufferLength()-f);BK.Script.log(0,0,"magic = "+e.magic+",stlen = "+e.stlen+",bodyLen="+e.bodyLen+",cmd="+r.cmd+",roomId="+r.roomId),this.createRoomCallBack(r.ret,o,r.roomId),BK.QQ.notifyNewRoom(this.roomId,r.ret);break;case 11:var n=this.recvQueryRoom(i,i.bufferLength()-f);this.queryRoomInfoCallBack(r.ret,n),BK.Script.log(0,0,"magic = "+e.magic+",stlen = "+e.stlen+",bodyLen="+e.bodyLen+",cmd="+r.cmd+",roomId="+r.roomId);break;case 3:if(this.recvJoinRoom(i,i.bufferLength()-f),this.joinRoomCallBack(r.ret,this),1==Boolean(BK.QQ.isNeedSSOServer))for(var s=0;s<this.newJoinPlayers.length;s++)if(this.newJoinPlayers[s].openId==v)return BK.QQ.ssoJoinRoomCallback=this.recvSSOJoinRoom.bind(this),void BK.QQ.notifyNewOrJoinRoomSrv(this.newJoinPlayers,this.roomId,this.ownerId==GameStatusInfo.openId?1:2);BK.QQ.notifyJoinRoom(this.newJoinPlayers,{},r.ret);break;case 5:var a=this.recvLeaveRoom(i,i.bufferLength()-f);this.leaveRoomCallBack&&this.leaveRoomCallBack(r.ret,a);break;case 9:this.recvStartGame(i,i.bufferLength()-f),this.startGameCallBack(r.ret),1==Boolean(BK.QQ.isNeedSSOServer)&&BK.QQ.notifyStartGameSrv(),0==r.ret&&(BK.QQ.hasJoinRoomSucc=!1);break;case 1:var h=i.readBuffer(i.bufferLength()-f);this.broadcastDataCallBack(r.fromId,h,r.toId);break;case 51:h=i.readBuffer(i.bufferLength()-f);this.sensitiveWordCallBack(r.ret,r.fromId,h,r.toId);break;case 33:h=i.readBuffer(i.bufferLength()-f);this.setUserDataCallBack(r.ret);break;case 35:h=i.readBuffer(i.bufferLength()-f);this.getUserDataCallBack(r.ret,h);break;case 15:var c=i.readUint32Buffer();this.ackSeq=c,this.sendSyncOptCallBack(r.ret,c);break;case 16:this.recvPushFrameSync(i,i.bufferLength()-f);break;case 19:this.recvQueryFrameSync(i,i.bufferLength()-f);break;case 37:this.matchGameCallBack(r.ret);break;case 39:this.roomId=r.roomId,this.queryMatchGameCallBack(r.ret);break;case 41:this.roomId=r.roomId,this.quitMatchGameCallBack(r.ret);break;case 49:this.recvControlCommand(i,i.bufferLength()-f)}else this.handleServerError(r)},this.requestSocket=function(t){var e;switch(BK.Script.log(0,0,"requestSocket = "+t.cmd),t.cmd){case 6:e=this.requestCreateRoom(t.arg0,t.arg1);break;case 10:e=this.requestQueryRoom();break;case 2:e=this.requestJoinRoom(t.arg0);break;case 4:e=this.requestLeaveRoom(t.arg0);break;case 8:e=this.requestStartGame();break;case 1:e=this.requestsendBroadcastData(t.arg0);break;case 50:e=this.requestSendSendSensitiveWordData(t.arg0);break;case 32:e=this.requestSetUserData(t.arg0);break;case 34:e=this.requestGetUserData(t.arg0);break;case 14:e=this.requestSyncOpt(t.arg0,t.arg1,t.arg2,t.arg3);break;case 18:e=this.requestQueryFrameData(t.arg0,t.arg1);break;case 36:e=this.requestMatch(t.arg0,t.arg1);break;case 38:e=this.requestQueryMatch(t.arg0,t.arg1);break;case 40:e=this.requestQuitMatch(t.arg0,t.arg1);break;case 12:e=this.requestSendKeepAlive(),0==this.netTimeOutTs&&(this.netTimeOutTs=BK.Time.timestamp);break;case 48:var i=new BK.Buffer,r=new BK.Buffer;i.writeAsString(t.arg1),r.writeAsString(t.arg2),e=this.requestControlCommand(t.arg0,i,r)}null!=e&&(BK.Script.log(0,0,"requestSocket = "+t.cmd),this.socket.send(e))},this.seperatePackHandle=function(){for(;;){var t=this.socket.receiveNotRemove(),e=t.bufferLength(),i=this.getHeader(t),r=i.stlen+i.bodyLen+_;if(BK.Script.log(0,0,"this.socket.receive():totalLen = "+e+"  onePackLen="+r),e==r){var o;BK.Script.log(0,0,"  this.socket.receive():onePackLen="+r),null!=(o=this.socket.receive(r))&&this.handleRecv(o);break}if(e<r){BK.Script.log(0,0,"  this.socket.receive():part of onePackLen="+r);break}r<e&&(BK.Script.log(0,0,"  this.socket.receive():Multipacks onePackLen="+r),null!=(o=this.socket.receive(r))&&this.handleRecv(o))}},this.curConnRetrys=0,this.curConnTimeout=0,this.prevNetState=0,this.reConnectTime=0,this.updateNet=function(){var t=this.socket.update(),e=this.socket.state;if(-1!=t)switch(this.prevNetState){case 0:switch(e){case 3:this.onErrorEvent(this);break;case 1:this.onConnectingEvent(this);break;case 2:this.onConnectedEvent(this)}break;case 1:switch(e){case 2:switch(t){case 2:this.onConnectedEvent();break;case 3:BK.Script.log(0,0,"BK.Socket.update!unexcepted status")}}break;case 2:switch(e){case 2:this.onUpdateEvent();break;default:this.onErrorEvent()}}else switch(BK.Script.log(0,0,"BK.Socket.DisconnectEvent prevNetState="+this.prevNetState),this.prevNetState){case 3:case 2:case 1:this.onDisconnectEvent()}return this.prevNetState=e,t},this.onErrorEvent=function(){BK.Script.log(0,0,"BK.Socket.ErrorEvent")},this.onUpdateEvent=function(){return 0},this.onTimeoutEvent=function(){BK.Script.log(0,0,"BK.Socket.TimeoutEvent")},this.onConnectingEvent=function(){BK.Script.log(0,0,"BK.Socket.ConnectingEvent")},this.onConnectedEvent=function(){BK.Script.log(0,0,"BK.Socket.ConnectedEvent"),this.connectedNetCallback&&this.connectedNetCallback()},this.onReconnectEvent=function(){BK.Script.log(0,0,"BK.Socket.ReconnectEvent")},this.onDisconnectEvent=function(){(BK.Script.log(0,0,"BK.Socket.DisconnectEvent"),this.disconnectNetCallBack&&this.disconnectNetCallBack(),this.reConnectTime<3)?(BK.Script.log(0,0,"BK.Socket.DisconnectEvent reconnectAndJoinRoom"),(BK.Time.timestamp-this.startGameTs)/60<5?(this.reConnectTime++,this.reConnectAndJoinRoom()):BK.Script.log(0,0,"BK.Socket.DisconnectEvent over 5 min")):this.terminatedNetCallback&&this.terminatedNetCallback()},this.setConnectedNetCallBack=function(t){this.connectedNetCallback=t},this.setDisconnectNetCallBack=function(t){this.disconnectNetCallBack=t},this.setTerminatedNetCallback=function(t){this.terminatedNetCallback=t},this.updateSocket=function(){var t=this.updateNet();if((3==t||2==t)&&0<this.reqArray.length){var e=this.reqArray.pop();null!=e&&null!=e&&this.requestSocket(e)}return 3!=t&&1!=t||this.seperatePackHandle(),t},this.createAndJoinRoom=function(t,e,o,r,n){this.createRoom(t,e,function(t,e,i){0==t?(BK.Script.log(0,0,"\u521b\u5efa\u6e38\u620f statusCode:"+t+" roomId:"+i),this.gameSvrIp=e.ip_2,this.gameSvrPort=e.port_2,this.roomSvrIp=e.ip_1,this.roomSvrPort=e.port_1,this.socket.close(),this.socket.connect(this.gameSvrIp,this.gameSvrPort),this.joinRoom(0,function(r,t){BK.Script.log(0,0,"\u52a0\u5165\u623f\u95f4 statusCode:"+r+" roomid is "+t.roomId),0==r&&(GameStatusInfo.roomId=t.roomId,BK.QQ.gameCfg.roomId=t.roomId),n?1==BK.QQ.hasJoinRoomSucc?o(r,this):BK.QQ.delegate.onJoinRoomEvent=function(t,e,i){o(r,this)}.bind(this):o(r,this)},r,n)):o(t,this)})},this.queryAndJoinRoom=function(t,e,i,r,o,n){1!=this.serverConnected&&(this.socket.close(),this.socket.connect(this.recommandRoomSvrHost,this.recommandRoomSvrPort)),this.queryRoom(t,e,i,function(t,e){0==t?(this.gameSvrIp=e.ip_2,this.gameSvrPort=e.port_2,this.roomSvrIp=e.ip_1,this.roomSvrPort=e.port_1,this.socket.close(),this.socket.connect(this.gameSvrIp,this.gameSvrPort),this.joinRoom(0,function(t,e){BK.QQ.hasJoinRoomSucc=!0,BK.Script.log(0,0,"\u52a0\u5165\u623f\u95f4 statusCode:"+t+" roomid is "+e.roomId),r(t,this)},o,n)):r(t,void 0)})},this.socialMatch=function(r){this.roomId=Number(GameStatusInfo.roomId),BK.Script.log(1,1,"1v1\u5339\u914d \u73a9\u5bb6\u6765\u6e90:"+GameStatusInfo.src+" \u623f\u95f4\u53f7:"+GameStatusInfo.roomId),this.createRoom(GameStatusInfo.gameId,GameStatusInfo.openId,function(t,e,i){BK.Script.log(1,1,"1v1\u5339\u914d \u521b\u5efa\u623f\u95f4 statusCode:"+t+" roomid:"+i),0==t?(this.isCreator=!0,this.gameSvrIp=e.ip_2,this.gameSvrPort=e.port_2,this.roomSvrIp=e.ip_1,this.roomSvrPort=e.port_1,this.socket.close(),this.socket.connect(this.gameSvrIp,this.gameSvrPort),this.joinRoom(GameStatusInfo.src,function(t,e){BK.Script.log(1,1,"1v1\u5339\u914d \u52a0\u5165\u623f\u95f4 statusCode:"+t+" roomid:"+e.roomId),0==t?(BK.Script.log(1,1,"1v1\u5339\u914d \u52a0\u5165\u623f\u95f4\u6210\u529f"),r(t,e)):(BK.Script.log(1,1,"1v1\u5339\u914d \u52a0\u5165\u623f\u95f4\u5931\u8d25 statusCode:"+t+" \u5177\u4f53\u9519\u8bef\u7801\u53c2\u89c1http://hudong.qq.com/docs/engine/api/BK.MQQ.ErrorCode.html"),r(t,this))},!0,!0)):2007==t?(this.isCreator=!1,this.queryRoom(GameStatusInfo.gameId,GameStatusInfo.roomId,GameStatusInfo.openId,function(t,e){BK.Script.log(1,1,"1v1\u5339\u914d \u67e5\u8be2\u623f\u95f4 statusCode:"+t+" roomId:"+i+" \u623f\u95f4\u4e2d\u73a9\u5bb6\u6570:"+e.playerNum),0==t&&e?(this.gameSvrIp=e.ip_2,this.gameSvrPort=e.port_2,this.roomSvrIp=e.ip_1,this.roomSvrPort=e.port_1,this.socket.close(),this.socket.connect(this.gameSvrIp,this.gameSvrPort),this.joinRoom(GameStatusInfo.src,function(t,e){BK.Script.log(1,1,"1v1\u5339\u914d \u52a0\u5165\u623f\u95f4 statusCode:"+t+" roomid:"+e.roomId),0==t?(BK.Script.log(1,1,"1v1\u5339\u914d \u52a0\u5165\u623f\u95f4\u6210\u529f"),r(t,e)):(BK.Script.log(1,1,"1v1\u5339\u914d \u52a0\u5165\u623f\u95f4\u5931\u8d25 statusCode:"+t+" \u5177\u4f53\u9519\u8bef\u7801\u53c2\u89c1http://hudong.qq.com/docs/engine/api/BK.MQQ.ErrorCode.html"),r(t,this))},!0,!0)):(BK.Script.log(1,1,"1v1\u5339\u914d \u67e5\u8be2\u623f\u95f4\u5931\u8d25 statusCode:"+t+" \u5177\u4f53\u9519\u8bef\u7801\u53c2\u89c1http://hudong.qq.com/docs/engine/api/BK.MQQ.ErrorCode.html"),r(t,this))})):(BK.Script.log(1,1,"1v1\u5339\u914d \u521b\u5efa\u623f\u95f4\u5931\u8d25 statusCode:"+t+" \u5177\u4f53\u9519\u8bef\u7801\u53c2\u89c1http://hudong.qq.com/docs/engine/api/BK.MQQ.ErrorCode.html"),r(t,this))})},this.showOneMorePage=function(i,t){var r=[],o=0;if(t&&2==t.length)for(var e=0;e<t.length;e++){o=2!=i&&GameStatusInfo.openId==t[e]?i:2==i?2:2!=i&&GameStatusInfo.openId!=t[e]?1-i:-1;var n={openId:t[e],scoreState:o};BK.Script.log(1,1,"\u73a9\u5bb6\u4fe1\u606f playerInfo:"+JSON.stringify(n)),r.push(n)}else if(this.newJoinPlayers){if(this.newJoinPlayers.forEach(function(t){o=2!=i&&GameStatusInfo.openId==t.openId?i:2==i?2:2!=i&&GameStatusInfo.openId!=t.openId?1-i:-1;var e={openId:t.openId,scoreState:o};BK.Script.log(1,1,"\u73a9\u5bb6\u4fe1\u606f playerInfo:"+JSON.stringify(e)),r.push(e)},this),this.isCreator){2!=i?o=i:2==i&&(o=2);n={openId:this.ownerId,scoreState:o};BK.Script.log(1,1,"\u73a9\u5bb6\u4fe1\u606f playerInfo:"+JSON.stringify(n)),r.push(n)}}else BK.Script.log(1,1,"\u518d\u6765\u4e00\u5c40\u5931\u8d25\uff0copenIds\uff08\u81ea\u5efa\u540e\u53f0\uff09\u6216newJoinPlayers\uff08\u975e\u81ea\u5efa\u540e\u53f0\uff09\u4e3anull\u6216\u8005undefined");var s={scoreState:i,playerInfos:r};BK.Script.log(1,1,"\u518d\u6765\u4e00\u5c40\u6210\u529f data:"+JSON.stringify(s)),BK.MQQ.SsoRequest.send(s,CMSHOW_CS_CMD_SHOW_ONE_MORE_PAGE)},this.forceLeaveRoom=function(t,e){var i=new Object;i.cmd=4,i.arg0=e,this.leaveRoomCallBack=t;var r=this.requestLeaveRoom(i.arg0),o=this.socket.update();3==o||2==o?(this.socket.send(r),BK.Script.log(0,0,"forceLeaveRoom push")):BK.Script.log(0,0,"forceLeaveRoom push Failed. Socket not allow Send.")},this._event4StopGame=function(t,e,i){BK.Script.log(0,0,"BK.Room._event4StopGame!errCode = "+t+", cmd = "+e+", data = "+JSON.stringify(i)),0==t&&this.forceLeaveRoom(function(t,e){BK.Script.log(0,0,"forceLeaveRoom callback")},0)},BK.MQQ.SsoRequest.addListener(CMSHOW_SC_CMD_STOP_GAME,this,this._event4StopGame.bind(this)),this.addDebugFunctions=function(){this.createFixedRoom=function(t,e,i,r){this.roomId=i,this.mId=e,this.gameId=t;var o=this.socket.connect(this.recommandRoomSvrHost,this.recommandRoomSvrPort);BK.Script.log(0,0,"socket con ="+o),-1!=o&&BK.Script.log(0,0,"socket connect failed! "+o),this.createRoomCallBack=r;var n=new Object;n.cmd=6,n.arg0=t,n.arg1=e,this.reqArray.push(n),BK.Script.log(0,0,"create Fixed Room ")},this.createAndJoinFixedRoom=function(t,e,i,r,o){this.createFixedRoom(t,e,i,function(t,e,i){0==t?(BK.Script.log(0,0,"\u521b\u5efa\u56fa\u5b9a\u623f\u95f4\u53f7 \u6e38\u620f statusCode:"+t+" roomId:"+i),this.gameSvrIp=e.ip_2,this.gameSvrPort=e.port_2,this.roomSvrIp=e.ip_1,this.roomSvrPort=e.port_1,this.socket.close(),this.socket.connect(this.gameSvrIp,this.gameSvrPort),this.joinRoom(0,function(t,e){BK.Script.log(0,0,"\u52a0\u5165\u623f\u95f4 statusCode:"+t+" roomid is "+e.roomId),r(t,this)},o)):r(t,this)})},this.requestCreateRoom=function(t,e){var i=this.roomId;i||(i=0),BK.Script.log(0,0,"create fixed room request in fixedRoomId:"+i);var r=new BK.Buffer(f,1);this.addFixedHeader(r,6,t,i,e);var o=BK.Security.getST();BK.Security.encrypt(r);var n=o.bufferLength(),s=new BK.Buffer(_+r.bufferLength()+n,1);return this.addHeader(s,r.bufferLength(),n),s.writeBuffer(o),s.writeBuffer(r),BK.Script.log(0,0,"create room request buffer : "+s.bufferLength()+" body len:"+r.bufferLength()),s}},Object.defineProperty(this,"environment",{get:function(){return this._environment},set:function(t){BK.Script.log(0,0,"Set Environment failed!Can't set the environment!!!")}}),GameStatusInfo.devPlatform?(this._environment=NETWORK_ENVIRONMENT_DEMO_DEV,BK.Script.log(1,1,"\u5f53\u524d\u73af\u5883\u4e3a---\u5f00\u53d1\u73af\u5883")):1==GameStatusInfo.isWhiteUser?(this._environment=NETWORK_ENVIRONMENT_QQ_DEBUG,BK.Script.log(1,1,"\u5f53\u524d\u73af\u5883\u4e3a---\u624bQ\u5f00\u53d1\u73af\u5883")):(this._environment=NETWORK_ENVIRONMENT_QQ_RELEASE,BK.Script.log(1,1,"\u5f53\u524d\u73af\u5883\u4e3a---\u6b63\u5f0f\u73af\u5883")),this._environment==NETWORK_ENVIRONMENT_QQ_DEBUG?(this.headerVersion=769,this.recommandRoomSvrHost=n,this.recommandRoomSvrPort=s):this._environment==NETWORK_ENVIRONMENT_DEMO_DEV&&(this.addDebugFunctions(),this.headerVersion=257,this.recommandRoomSvrHost=n,this.recommandRoomSvrPort=s)},function(t,e){"object"==typeof t&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.URL=e())}(BK,function(){return function(){function o(){return new RegExp(/(.*?)\.?([^\.]*?)\.?(com|net|org|biz|ws|in|me|co\.uk|co|org\.uk|ltd\.uk|plc\.uk|me\.uk|edu|mil|br\.com|cn\.com|eu\.com|hu\.com|no\.com|qc\.com|sa\.com|se\.com|se\.net|us\.com|uy\.com|ac|co\.ac|gv\.ac|or\.ac|ac\.ac|af|am|as|at|ac\.at|co\.at|gv\.at|or\.at|asn\.au|com\.au|edu\.au|org\.au|net\.au|id\.au|be|ac\.be|adm\.br|adv\.br|am\.br|arq\.br|art\.br|bio\.br|cng\.br|cnt\.br|com\.br|ecn\.br|eng\.br|esp\.br|etc\.br|eti\.br|fm\.br|fot\.br|fst\.br|g12\.br|gov\.br|ind\.br|inf\.br|jor\.br|lel\.br|med\.br|mil\.br|net\.br|nom\.br|ntr\.br|odo\.br|org\.br|ppg\.br|pro\.br|psc\.br|psi\.br|rec\.br|slg\.br|tmp\.br|tur\.br|tv\.br|vet\.br|zlg\.br|br|ab\.ca|bc\.ca|mb\.ca|nb\.ca|nf\.ca|ns\.ca|nt\.ca|on\.ca|pe\.ca|qc\.ca|sk\.ca|yk\.ca|ca|cc|ac\.cn|com\.cn|edu\.cn|gov\.cn|org\.cn|bj\.cn|sh\.cn|tj\.cn|cq\.cn|he\.cn|nm\.cn|ln\.cn|jl\.cn|hl\.cn|js\.cn|zj\.cn|ah\.cn|gd\.cn|gx\.cn|hi\.cn|sc\.cn|gz\.cn|yn\.cn|xz\.cn|sn\.cn|gs\.cn|qh\.cn|nx\.cn|xj\.cn|tw\.cn|hk\.cn|mo\.cn|cn|cx|cz|de|dk|fo|com\.ec|tm\.fr|com\.fr|asso\.fr|presse\.fr|fr|gf|gs|co\.il|net\.il|ac\.il|k12\.il|gov\.il|muni\.il|ac\.in|co\.in|org\.in|ernet\.in|gov\.in|net\.in|res\.in|is|it|ac\.jp|co\.jp|go\.jp|or\.jp|ne\.jp|ac\.kr|co\.kr|go\.kr|ne\.kr|nm\.kr|or\.kr|li|lt|lu|asso\.mc|tm\.mc|com\.mm|org\.mm|net\.mm|edu\.mm|gov\.mm|ms|nl|no|nu|pl|ro|org\.ro|store\.ro|tm\.ro|firm\.ro|www\.ro|arts\.ro|rec\.ro|info\.ro|nom\.ro|nt\.ro|se|si|com\.sg|org\.sg|net\.sg|gov\.sg|sk|st|tf|ac\.th|co\.th|go\.th|mi\.th|net\.th|or\.th|tm|to|com\.tr|edu\.tr|gov\.tr|k12\.tr|net\.tr|org\.tr|com\.tw|org\.tw|net\.tw|ac\.uk|uk\.com|uk\.net|gb\.com|gb\.net|vg|sh|kz|ch|info|ua|gov|name|pro|ie|hk|com\.hk|org\.hk|net\.hk|edu\.hk|us|tk|cd|by|ad|lv|eu\.lv|bz|es|jp|cl|ag|mobi|eu|co\.nz|org\.nz|net\.nz|maori\.nz|iwi\.nz|io|la|md|sc|sg|vc|tw|travel|my|se|tv|pt|com\.pt|edu\.pt|asia|fi|com\.ve|net\.ve|fi|org\.ve|web\.ve|info\.ve|co\.ve|tel|im|gr|ru|net\.ru|org\.ru|hr|com\.hr|ly|xyz)$/)}function n(t,e){var i=t.charAt(0),r=e.split(i);return i===t?r:r[(t=parseInt(t.substring(1),10))<0?r.length+t:t-1]}function s(t,e){for(var i,r=t.charAt(0),o=e.split("&"),n=[],s={},a=[],h=t.substring(1),c=0,u=o.length;c<u;c++)if((n=o[c].match(/(.*?)=(.*)/))||(n=[o[c],o[c],""]),""!==n[1].replace(/\s/g,"")){if(n[2]=(i=n[2]||"",decodeURIComponent(i.replace(/\+/g," "))),h===n[1])return n[2];(a=n[1].match(/(.*)\[([0-9]+)\]/))?(s[a[1]]=s[a[1]]||[],s[a[1]][a[2]]=n[2]):s[n[1]]=n[2]}return r===t?s:s[h]}return function(t,e){var i,r={};if("tld?"===t)return o();if(e=e||window.location.toString(),!t)return e;if(t=t.toString(),i=e.match(/^mailto:([^\/].+)/))r.protocol="mailto",r.email=i[1];else{if((i=e.match(/(.*?)\/#\!(.*)/))&&(e=i[1]+i[2]),(i=e.match(/(.*?)#(.*)/))&&(r.hash=i[2],e=i[1]),r.hash&&t.match(/^#/))return s(t,r.hash);if((i=e.match(/(.*?)\?(.*)/))&&(r.query=i[2],e=i[1]),r.query&&t.match(/^\?/))return s(t,r.query);if((i=e.match(/(.*?)\:?\/\/(.*)/))&&(r.protocol=i[1].toLowerCase(),e=i[2]),(i=e.match(/(.*?)(\/.*)/))&&(r.path=i[2],e=i[1]),r.path=(r.path||"").replace(/^([^\/])/,"/$1"),t.match(/^[\-0-9]+$/)&&(t=t.replace(/^([^\/])/,"/$1")),t.match(/^\//))return n(t,r.path.substring(1));if((i=n("/-1",r.path.substring(1)))&&(i=i.match(/(.*?)\.(.*)/))&&(r.file=i[0],r.filename=i[1],r.fileext=i[2]),(i=e.match(/(.*)\:([0-9]+)$/))&&(r.port=i[2],e=i[1]),(i=e.match(/(.*?)@(.*)/))&&(r.auth=i[1],e=i[2]),r.auth&&(i=r.auth.match(/(.*)\:(.*)/),r.user=i?i[1]:r.auth,r.pass=i?i[2]:void 0),r.hostname=e.toLowerCase(),"."===t.charAt(0))return n(t,r.hostname);o()&&(i=r.hostname.match(o()))&&(r.tld=i[3],r.domain=i[2]?i[2]+"."+i[3]:void 0,r.sub=i[1]||void 0),r.port||("http"===r.protocol||"ws"===r.protocol?r.port="80":"https"!==r.protocol&&"wss"!==r.protocol||(r.port="443"))}return t in r?r[t]:"{}"===t?r:void 0}}()});var y=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(t,e){"object"==typeof t&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.WebSocket=e())}(BK,function(){var r=function(){function i(){this._wsArray=[],BK.Director.ticker.add(function(t,e){i.Instance.dispatchEvent()})}return i.prototype.add=function(t){this._wsArray.push(t),BK.Script.log(1,0,"SocketEventMgr.add!so = "+t)},i.prototype.del=function(t){var e=this._wsArray.indexOf(t,0);0<=e&&(this._wsArray.splice(e,1),BK.Script.log(1,0,"SocketEventMgr.del!so = "+t))},i.prototype.dispatchEvent=function(){this._wsArray.forEach(function(t,e,i){t&&t.update()})},i.Instance=new i,i}(),t=function(){function i(t,e){this.ip=t,this.port=e,this.__nativeObj=new BK.Socket,this.prevConnTs=0,this.curConnRetrys=0,this.curConnTimeout=0,this.prevNetState=0,this.prevNetStateUpdateFlag=!1,this.options={ConnectRetryCount:3,ConnectTimeoutInterval:3e3}}return i.prototype.__internalClose=function(){return this.__nativeObj?this.__nativeObj.close():-2},i.prototype.__internalSend=function(t){return this.__nativeObj?this.__nativeObj.send(t):-2},i.prototype.__internalRecv=function(t){if(this.__nativeObj)return this.__nativeObj.receive(t)},i.prototype.__internalUpdate=function(){return this.__nativeObj?this.__nativeObj.update():-2},i.prototype.__internalConnect=function(){if(this.__nativeObj){var t=this.__nativeObj.connect(this.ip,this.port),e=this.curNetState();switch(this.prevNetState){case 3:this.onReconnectEvent(this);case 0:switch(e){case 3:this.onErrorEvent(this);break;case 1:case 4:this.prevConnTs=BK.Time.clock,this.curConnTimeout||(this.curConnTimeout=this.options.ConnectTimeoutInterval),this.onConnectingEvent(this),t=0;break;case 2:case 5:this.onConnectedEvent(this),t=0}}return this.prevNetState=e,this.prevNetStateUpdateFlag=!0,t}return-2},i.prototype.__internalCanReadLength=function(){return this.__nativeObj?this.__nativeObj.canReadLength():0},i.prototype.__internalIsEnableSSL=function(){return!!this.__nativeObj&&this.__nativeObj.getSSLEnable()},i.prototype.__internalEnableSSL=function(t){this.__nativeObj&&this.__nativeObj.setSSLEnable(t)},i.prototype.__internalUpdateSSL=function(){var t=this.__internalUpdate(),e=this.curNetState();if(-1!=t)switch(this.prevNetState){case 1:switch(e){case 2:BK.Script.log(1,0,"BK.Socket.update.ssl!connected, ip = "+this.ip+", port = "+this.port);break;case 4:case 5:break;default:var i=BK.Time.clock;return 1e3*BK.Time.diffTime(this.prevConnTs,i)>=this.curConnTimeout&&(this.curConnRetrys=this.curConnRetrys+1,this.curConnRetrys<this.options.ConnectRetryCount?(this.close(),this.connect(),this.curConnTimeout=2*this.curConnTimeout):(this.onTimeoutEvent(this),this.close())),t}break;case 2:break;case 4:switch(e){case 5:switch(t){case 2:case 3:this.clearState(),this.onConnectedEvent(this)}break;default:i=BK.Time.clock;return 1e3*BK.Time.diffTime(this.prevConnTs,i)>=this.curConnTimeout&&(this.curConnRetrys=this.curConnRetrys+1,this.curConnRetrys<this.options.ConnectRetryCount?(this.close(),this.connect(),this.curConnTimeout=2*this.curConnTimeout):(this.onTimeoutEvent(this),this.close())),t}break;case 5:switch(e){case 5:this.onUpdateEvent(this);break;case 3:this.onDisconnectEvent(this);break;default:this.onErrorEvent(this)}}else switch(this.prevNetState){case 2:case 1:this.onDisconnectEvent(this);break;case 4:case 6:case 5:this.onErrorEvent(this)}return this.prevNetStateUpdateFlag||(this.prevNetState=e,this.prevNetStateUpdateFlag=!0),t},i.prototype.__internalUpdateNoSSL=function(){var t=this.__internalUpdate(),e=this.curNetState();if(-1!=t)switch(this.prevNetState){case 1:switch(e){case 2:switch(t){case 2:this.clearState(),this.onConnectedEvent(this);break;case 3:BK.Script.log(1,0,"BK.Socket.update!unexcepted status")}break;default:var i=BK.Time.clock;return 1e3*BK.Time.diffTime(this.prevConnTs,i)>=this.curConnTimeout&&(this.curConnRetrys=this.curConnRetrys+1,this.curConnRetrys<this.options.ConnectRetryCount?(this.close(),this.connect(),this.curConnTimeout=2*this.curConnTimeout):(this.onTimeoutEvent(this),this.close())),t}break;case 2:switch(e){case 2:this.onUpdateEvent(this);break;case 3:this.onDisconnectEvent(this);break;default:this.onErrorEvent(this)}}else switch(this.prevNetState){case 2:case 1:this.onDisconnectEvent(this)}return this.prevNetStateUpdateFlag||(this.prevNetState=e,this.prevNetStateUpdateFlag=!0),t},i.prototype.curNetState=function(){return this.__nativeObj?this.__nativeObj.state:0},i.prototype.close=function(){var t=this.__internalClose();return t||(this.prevNetState=0,this.prevNetStateUpdateFlag=!0),r.Instance.del(this),t},i.prototype.send=function(t){var e=this.__internalSend(t);return e<0&&(this.onErrorEvent(this),i.prototype.close.call(this)),e},i.prototype.recv=function(t){return this.__internalRecv(t)},i.prototype.canRecvLength=function(){return this.__internalCanReadLength()},i.prototype.update=function(){return this.prevNetStateUpdateFlag=!1,this.isEnableSSL()?this.__internalUpdateSSL():this.__internalUpdateNoSSL()},i.prototype.connect=function(){var t=this.curNetState();if(0!=t&&3!=t)return 0;var e=this.__internalConnect();return e||r.Instance.add(this),e},i.prototype.isEnableSSL=function(){return this.__internalIsEnableSSL()},i.prototype.enableSSL=function(t){this.__internalEnableSSL(t)},i.prototype.onErrorEvent=function(t){BK.Script.log(1,0,"BK.Socket.ErrorEvent")},i.prototype.onUpdateEvent=function(t){return 0},i.prototype.onTimeoutEvent=function(t){BK.Script.log(1,0,"BK.Socket.TimeoutEvent")},i.prototype.onConnectingEvent=function(t){BK.Script.log(1,0,"BK.Socket.ConnectingEvent")},i.prototype.onConnectedEvent=function(t){BK.Script.log(1,0,"BK.Socket.ConnectedEvent")},i.prototype.onReconnectEvent=function(t){BK.Script.log(1,0,"BK.Socket.ReconnectEvent")},i.prototype.onDisconnectEvent=function(t){BK.Script.log(1,0,"BK.Socket.DisconnectEvent")},i.prototype.clearState=function(){},i}(),o=function(t,e){this.data=t,this.isBinary=e},s=function(u){function l(t,e,i,r,o){var n=u.call(this,t,e)||this;return n.path=r||"/",n.host=i,n.query=o,n.httpVer=1.1,n.httpParser=new HTTPParser(HTTPParser.RESPONSE),n.version=13,n.protocols=new Array,n.extensions=new Array,n.delegate={onOpen:null,onClose:null,onError:null,onMessage:null,onSendComplete:null},n.options||(n.options={}),n.options.DrainSegmentCount=8,n.options.DefaultSegmentSize=4096,n.options.PingPongInterval=0,n.options.HandleShakeRequestTimeout=1e4,n.options.HandleShakeResponseTimeout=1e4,n.options.CloseAckTimeout=2e3,n.options.PingPongTimeout=3e3,n.clear(),n}return y(l,u),l.prototype.clear=function(){this.mask4=new BK.Buffer(4,!1),this.txbuf=new BK.Buffer(128,!0),this.rxbuf=new BK.Buffer(128,!0),this.txMsgQue=new Array,this.rxbufQue=new Array,this.udataQue=new Array,this.peerClosed=!1,this.txSegCount=0,this.rxSegCount=0,this.rxFrameType=-1,this.isFinalSeg=!1,this.inTxSegFrame=!1,this.inRxSegFrame=!1,this.inPartialTxbuf=!1,this.inPingFrame=!1,this.inPongFrame=!1,this.errcode=65535,this.state=0,this.parseState=0,this.phaseTimeout=0,this.pingpongTimer=0,this.prevPhaseTickCount=0,this.prevPingPongTickCount=0,this.framePackageCount=0},l.prototype.getReadyState=function(){return this.state},l.prototype.getErrorCode=function(){return this.errcode},l.prototype.getErrorString=function(){return this.message},l.prototype.randomN=function(t){for(var e=new BK.Buffer(t,!1),i=0;i<t;i++){var r=Math.round(65535*Math.random());e.writeUint8Buffer(r)}return e},l.prototype.toHex=function(t){if(0<=t&&t<=9)return t.toString();switch(t){case 10:return"A";case 11:return"B";case 12:return"C";case 13:return"D";case 14:return"E";case 15:return"F"}return"u"},l.prototype.bufferToHexString=function(t){var e="";for(t.rewind();!t.eof;){var i=t.readUint8Buffer();e=e.concat("x"+this.toHex((240&i)>>4)+this.toHex(15&i)+" ")}return e},l.prototype.startPhaseTimeout=function(t){if(6==t)this.phaseTimeout=t,this.prevPhaseTickCount=0;else switch(this.state){case 2:1==t&&(this.phaseTimeout=t,this.prevPhaseTickCount=BK.Time.clock);break;case 3:2==t&&(this.phaseTimeout=t,this.prevPhaseTickCount=BK.Time.clock);break;case 1:3==t&&(this.phaseTimeout=t,this.prevPhaseTickCount=BK.Time.clock);break;case 4:switch(t){case 4:this.options.PingPongTimeout=Math.min(this.options.PingPongTimeout,this.options.PingPongInterval)}this.phaseTimeout=t,this.prevPhaseTickCount=BK.Time.clock}},l.prototype.handlePhaseTimeout=function(){if(6!=this.phaseTimeout){var t=BK.Time.diffTime(this.prevPhaseTickCount,BK.Time.clock);switch(this.phaseTimeout){case 1:1e3*t>this.options.HandleShakeRequestTimeout&&(BK.Script.log(1,0,"BK.WebSocket.handlePhaseTimeout!handshake request timeout"),this.prevPhaseTickCount=BK.Time.clock,this.state=-1,this.errcode=4096,this.message="handshake request timeout",u.prototype.close.call(this),this.delegate.onError&&this.delegate.onError(this));break;case 2:1e3*t>this.options.HandleShakeResponseTimeout&&(BK.Script.log(1,0,"BK.WebSocket.handlePhaseTimeout!handshake response timeout"),this.prevPhaseTickCount=BK.Time.clock,this.state=-1,this.errcode=4097,this.message="handshake response timeout",u.prototype.close.call(this),this.delegate.onError&&this.delegate.onError(this));break;case 3:1e3*t>this.options.CloseAckTimeout&&(BK.Script.log(1,0,"BK.WebSocket.handlePhaseTimeout!close ack timeout"),this.prevPhaseTickCount=BK.Time.clock,u.prototype.close.call(this),1==this.state?this.peerClosed?this.delegate.onClose&&this.delegate.onClose(this):(this.errcode=1006,this.message="abnormal close",this.delegate.onError&&this.delegate.onError(this),this.startPhaseTimeout(6)):this.delegate.onError&&this.delegate.onError(this));break;case 4:1e3*t>this.options.PingPongTimeout&&(BK.Script.log(1,0,"BK.WebSocket.handlePhaseTimeout!receive pong timeout"),this.prevPhaseTickCount=BK.Time.clock)}}},l.prototype.restartPingPongTimer=function(){4==this.state&&0<this.options.PingPongInterval&&(this.prevPingPongTickCount=BK.Time.clock)},l.prototype.handlePingPongTimer=function(){4==this.state&&0<this.options.PingPongInterval&&(1e3*BK.Time.diffTime(this.prevPingPongTickCount,BK.Time.clock)>this.options.PingPongInterval&&(this.inPingFrame=!1,this.txPingData=this.randomN(16),this.sendPingFrame(this.txPingData),this.restartPingPongTimer()))},l.prototype.doHandshakePhase=function(){var t="",e=this.query?"?"+this.query:"";t=t.concat("GET "+this.path+e+" HTTP/"+this.httpVer+"\r\n"),t=(t=(t=80==this.port||443==this.port?t.concat("Host: "+this.host+"\r\n"):t.concat("Host: "+this.host+":"+this.port+"\r\n")).concat("Upgrade: websocket\r\n")).concat("Connection: Upgrade\r\n"),t=this.isEnableSSL()?t.concat("Origin: https://"+this.host+"\r\n"):t.concat("Origin: http://"+this.host+"\r\n");var i=this.randomN(16),r=BK.Misc.encodeBase64FromBuffer(i);if(t=(t=t.concat("Sec-WebSocket-Key: "+r+"\r\n")).concat("Sec-WebSocket-Version: "+this.version+"\r\n"),this.query)for(var o=this.query.split("&"),n=0;n<o.length;n++){var s=o[n].split("=");0<s.length&&(t=t.concat(s[0]+": "+s[1]+"\r\n"))}t=t.concat("\r\n");var a=BK.Misc.sha1(r.concat("258EAFA5-E914-47DA-95CA-C5AB0DC85B11"));this.handshakeSig=BK.Misc.encodeBase64FromBuffer(a);var h=new BK.Buffer(t.length,!1);h.writeAsString(t,!1),0<u.prototype.send.call(this,h)&&(this.state=2,this.startPhaseTimeout(1))},l.prototype.doSvrHandshakePhase1=function(t){var e=this;t&&(this.httpParser.onComplete||(this.httpParser.onComplete=function(){for(var t in e.httpParser.headers);e.doSvrHandshakePhase2()?(e.restartPingPongTimer(),e.startPhaseTimeout(6),e.delegate.onOpen&&e.delegate.onOpen(e)):(e.errcode=4098,e.message="handshake parse error",e.startPhaseTimeout(6),u.prototype.close.call(e),e.delegate.onError&&e.delegate.onError(e))}),this.httpParser.execute(t),2==this.state&&(this.state=3,this.startPhaseTimeout(2)))},l.prototype.doSvrHandshakePhase2=function(){switch(this.httpParser.statusCode){case 101:return null==this.httpParser.headers.upgrade?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!missing 'upgrade' header"),!1):null==this.httpParser.headers.connection?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!missing 'connection' header"),!1):"upgrade"!=this.httpParser.headers.connection.toLowerCase()?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!error 'connection' header"),!1):null==this.httpParser.headers["sec-websocket-accept"]?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!missing 'sec-websocket-accept' header"),!1):this.handshakeSig!=this.httpParser.headers["sec-websocket-accept"]?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!error 'sec-websocket-accept' header"),!1):(this.state=4,!0)}return!1},l.prototype.doFrameDataPhase=function(t,e,i){void 0===i&&(i=!1);var r=6,o=t.length;this.extensions.length,r+=o;var n=new BK.Buffer(r,!1),s=0,a=!1;switch(this.version){case 13:a=!0,s=128}var h=!0;switch(e){case 1:case 2:i?this.inTxSegFrame?(h=!1,e=0):(h=!1,this.inTxSegFrame=!0):this.inTxSegFrame&&(e=0)}if(h?n.writeUint8Buffer(128|15&e):n.writeUint8Buffer(15&e),o<126?n.writeUint8Buffer(s|127&t.length):o<65536?(n.writeUint8Buffer(126|s),l.isLittleEndian?(n.writeUint8Buffer((65280&o)>>8),n.writeUint8Buffer(255&o)):(n.writeUint8Buffer(255&o),n.writeUint8Buffer((65280&o)>>8))):BK.Script.log(1,0,"BK.WebSocket.doFrameDataPhase!js don't support 64bit data type"),a){var c=this.randomN(4);BK.Misc.encodeBufferXorMask4(t,c),n.writeBuffer(c)}return n.writeBuffer(t),n},l.prototype.doSvrFrameDataPhase=function(t){if(!t)return!0;for(;!t.eof;){switch(this.parseState){case 0:this.mask4.rewind(),this.rxbuf=new BK.Buffer(this.options.DefaultSegmentSize,!0),this.maskBit=0,this.rxbuflen=0,this.isFinalSeg=!1,this.parseState=1;case 1:var e=t.readUint8Buffer();switch(this.isFinalSeg=!!(128&e),this.opcode=15&e,this.version){case 13:switch(this.opcode){case 3:case 4:case 5:case 6:case 7:case 11:case 12:case 13:case 14:case 15:return this.errcode=1002,this.message="protocol error",BK.Script.log(1,0,"BK.WebSocket.doSvrFrameDataPhase!unknown opcode = "+this.opcode),!1}}switch(this.opcode){case 8:case 9:case 10:case 0:break;default:if(!this.isFinalSeg&&1!=this.opcode&&2!=this.opcode)return this.errcode=1003,this.message="unsupported data",BK.Script.log(1,0,"BK.WebSocket.doSvrFrameDataPhase!illegal opcode = "+this.opcode),!1;if(-1==this.rxFrameType)this.rxFrameType=this.opcode;else if(this.rxFrameType!=this.opcode)return this.errcode=1002,this.message="protocol error",BK.Script.log(1,0,"BK.WebSocket.doSvrFrameDataPhase!rxFrameType = "+this.rxFrameType+", illegal opcode = "+this.opcode),!1}if(this.parseState=2,t.eof)return!0;case 2:var i=t.readUint8Buffer();switch(this.maskBit=(128&i)>>7,127&i){case 126:if(this.parseState=3,t.eof)return!0;break;case 127:if(this.parseState=5,t.eof)return!0;break;default:if(this.rxbuflen=127&i,1==this.maskBit?this.parseState=13:this.parseState=17,0<this.rxbuflen&&t.eof)return!0}}switch(this.parseState){case 3:var r=t.readUint8Buffer();if(this.rxbuflen|=l.isLittleEndian?(255&r)<<8:255&r,t.eof)return!0;case 4:r=t.readUint8Buffer();if(this.rxbuflen|=l.isLittleEndian?255&r:(255&r)<<8,1==this.maskBit?this.parseState=13:this.parseState=17,0<this.rxbuflen&&t.eof)return!0;break;case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:return this.errcode=1002,this.message="protocol errors",BK.Script.log(1,0,"BK.WebSocket.doSvrFrameDataPhase!js don't support 64bit data type"),!1}switch(this.parseState){case 13:if(this.mask4.writeUint8Buffer(t.readUint8Buffer()),this.parseState=14,t.eof)return!0;case 14:if(this.mask4.writeUint8Buffer(t.readUint8Buffer()),this.parseState=15,t.eof)return!0;case 15:if(this.mask4.writeUint8Buffer(t.readUint8Buffer()),this.parseState=16,t.eof)return!0;case 16:if(this.mask4.writeUint8Buffer(t.readUint8Buffer()),this.parseState=17,t.eof)return!0}if(17==this.parseState){var o=t.length-t.pointer;if(o<=this.rxbuflen-this.rxbuf.length?this.rxbuf.writeBuffer(t.readBuffer(o)):this.rxbuf.writeBuffer(t.readBuffer(this.rxbuflen-this.rxbuf.length)),this.rxbuf.length==this.rxbuflen)if(this.rxSegCount=this.rxSegCount+1,this.parseState=0,this.isFinalSeg)switch(this.rxbuf.rewind(),this.opcode){case 8:BK.Script.log(0,0,"BK.WebSocket.doSvrFrameDataPhase!receive close frame"),this.handleCloseFrame();break;case 9:BK.Script.log(0,0,"BK.WebSocket.doSvrFrameDataPhase!receive ping frame"),this.handlePingFrame();break;case 10:BK.Script.log(0,0,"BK.WebSocket.doSvrFrameDataPhase!receive pong frame"),this.handlePongFrame();break;default:this.rxbufQue.push(this.rxbuf),this.recvFrameFromRxQ(this.rxFrameType),this.rxSegCount=0,this.rxFrameType=-1}else this.rxbuf.rewind(),this.rxbufQue.push(this.rxbuf)}}return!0},l.prototype.handleCloseFrame=function(){if(this.peerClosed=!0,4==this.state){var t=this.rxbuf.readUint16Buffer(),e=this.rxbuf.readBuffer(this.rxbuflen-2);if(this.message=t?(this.errcode=t,e.readAsString()):(this.errcode=1005,"no status recv"),BK.Script.log(1,0,"BK.WebSocket.handleCloseFrame!errcode = "+this.errcode+", msg = "+this.message),this.sendCloseFrame(this.errcode,this.message?this.message:""),BK.Script.log(1,0,"BK.WebSocket.handleCloseFrame! closed by romote peer"),this.close(),this.state=0,this.delegate.onMessage)for(;0<this.udataQue.length;){var i=this.udataQue.shift();this.delegate.onMessage(this,i)}this.delegate.onClose&&this.delegate.onClose(this)}else if(1==this.state){if(BK.Script.log(1,0,"BK.WebSocket.handleCloseFrame!normal closed"),this.close(),this.state=0,this.delegate.onMessage)for(;0<this.udataQue.length;){i=this.udataQue.shift();this.delegate.onMessage(this,i)}this.delegate.onClose&&this.delegate.onClose(this)}},l.prototype.handlePingFrame=function(){if(4==this.state){if(125<this.rxbuflen)return this.errcode=4099,void(this.message="ping packet large");if(this.inPongFrame)return void BK.Script.log(1,0,"BK.WebSocket.handlePingFrame!already recv ping, drop it.");this.rxPongData=new BK.Buffer(this.rxbuflen,!0),this.rxPongData.writeBuffer(this.rxbuf.readBuffer(this.rxbuflen)),this.sendPongFrame(this.rxPongData)}},l.prototype.handlePongFrame=function(){if(4==this.state){var t=new BK.Buffer(this.rxbuflen,!0);t.writeBuffer(this.rxbuf.readBuffer(this.rxbuflen)),this.startPhaseTimeout(6),BK.Script.log(0,0,"BK.WebSocket.handlePongFrame!pong data = "+this.bufferToHexString(t))}},l.prototype.sendFrameFromTxQ=function(t){if(4==this.state&&this.packageSendCheck()){if(this.inPartialTxbuf){if(!(0<(s=u.prototype.send.call(this,this.txbuf))))return BK.Script.log(1,s,"BK.WebSocket.sendFrameFromTxQ!partial send failed, data type = "+t),!1;if(this.restartPingPongTimer(),s<this.txbuf.length){var e=this.txbuf.length-s,i=new BK.Buffer(e,!1);return this.txbuf.rewind(),this.txbuf.jumpBytes(s),i.writeBuffer(this.txbuf.readBuffer(e)),this.txbuf=i,!1}this.framePackageCount++,this.inPartialTxbuf=!1}for(var r=!0,o=0;o<this.txMsgQue.length;o++){for(var n=this.txMsgQue[o];0<n.length;){var s,a=n.shift(),h=0<n.length,c=this.doFrameDataPhase(a,t,h);if(!(0<(s=u.prototype.send.call(this,c)))){r=!1,BK.Script.log(1,s,"BK.WebSocket.sendFrameFromTxQ!send failed, data type = "+t);break}if(this.restartPingPongTimer(),s<c.length){c.rewind(),c.jumpBytes(s),this.txbuf.rewind(),this.txbuf.writeBuffer(c.readBuffer(c.length-s)),r=!(this.inPartialTxbuf=!0),BK.Script.log(1,0,"BK.WebSocket.sendFrameFromTxQ!partial send, total size = "+c.length+", tx size = "+s);break}if(0==n.length&&(this.inTxSegFrame=!1),this.framePackageCount++,!this.packageSendCheck())return}if(0==n.length&&this.txMsgQue.shift(),!r)break;if(!this.packageSendCheck())return}return r&&!this.txMsgQue.length&&this.inTxSegFrame&&(this.inTxSegFrame=!1),r}},l.prototype.recvFrameFromRxQ=function(t){for(var e=2==t,i=new BK.Buffer(128,!0);0<this.rxbufQue.length;){var r=this.rxbufQue.shift();i.writeBuffer(r)}0==e&&i.writeUint8Buffer(0),i.rewind(),this.udataQue.push(new o(i,e))},l.prototype.__sendBinaryFrame=function(t,e){var i=t.length,r=this.options.DefaultSegmentSize,o=0;t.rewind();for(var n=new Array;r<i;){var s=new BK.Buffer(r,!1);t.rewind(),t.jumpBytes(o),s.writeBuffer(t.readBuffer(r)),s.rewind(),n.push(s),o+=r,i-=r}if(0<i){s=new BK.Buffer(i,!1);t.rewind(),t.jumpBytes(o),s.writeBuffer(t.readBuffer(i)),s.rewind(),n.push(s)}return this.txMsgQue.push(n),this.txFrameType=e,this.sendFrameFromTxQ(e)},l.prototype.sendTextFrame=function(t){if(4!=this.state)return!1;var e=new BK.Buffer(128,!0);return e.writeAsString(t,!1),e.rewind(),this.__sendBinaryFrame(e,1)},l.prototype.sendBinaryFrame=function(t){if(4==this.state)return this.__sendBinaryFrame(t,2)},l.prototype.sendCloseFrame=function(t,e){if(!this.isSendClose){this.isSendClose=!0;var i=new BK.Buffer(e.length+1,!1),r=new BK.Buffer(3+e.length,!1);l.isLittleEndian?(r.writeUint8Buffer((65280&t)>>8),r.writeUint8Buffer(255&t)):(r.writeUint8Buffer(255&t),r.writeUint8Buffer((65280&t)>>8)),i.writeAsString(e,!0),r.writeBuffer(i);var o=this.doFrameDataPhase(r,8);0<u.prototype.send.call(this,o)&&(0==this.peerClosed&&(this.state=1,this.startPhaseTimeout(3)),BK.Script.log(1,0,"BK.WebSocket.sendCloseFrame!code = "+t+", reason = "+e))}},l.prototype.sendPingFrame=function(t){if(!this.inPingFrame){BK.Script.log(0,0,"BK.WebSocket.sendPingFrame!ping data = "+this.bufferToHexString(t));var e=this.doFrameDataPhase(t,9);0<u.prototype.send.call(this,e)&&(this.inPingFrame=!0,this.startPhaseTimeout(4))}},l.prototype.sendPongFrame=function(t){if(!this.inPongFrame){var e=this.doFrameDataPhase(t,10);0<u.prototype.send.call(this,e)&&(this.inPongFrame=!0)}},l.prototype.clearState=function(){this.state=0},l.prototype.onErrorEvent=function(t){0!=this.state&&1!=this.state&&(u.prototype.onErrorEvent.call(this,t),this.state=-1,this.errcode=1006,this.message="abnormal closure",this.delegate.onError&&this.delegate.onError(this))},l.prototype.onTimeoutEvent=function(t){u.prototype.onErrorEvent.call(this,t),this.state=0,this.errcode=-1e3,this.message="socket connect timeout",this.delegate.onError&&this.delegate.onError(this)},l.prototype.onDisconnectEvent=function(t){switch(u.prototype.onDisconnectEvent.call(this,t),this.state){case 2:case 3:case 4:this.state=-1,this.errcode=1006,this.message="abnormal closure",this.delegate.onError&&this.delegate.onError(this);break;case 1:this.state=0,this.delegate.onClose&&this.delegate.onClose(this),BK.Script.log(1,0,"BK.WebSocket.onDisconnectEvent!enter closed state")}},l.prototype.onConnectedEvent=function(t){u.prototype.onConnectedEvent.call(this,t),0==this.state&&(this.clear(),this.doHandshakePhase())},l.prototype.phaseBufferCheck=function(t){for(var e="\r\n\r\n",i=0,r=0;!t.eof;){if(r++,t.readUint8Buffer()==e.charCodeAt(i)){if(++i==e.length)return r}else i=0}return-1},l.prototype.packageSendCheck=function(){return this.framePackageCount<this.options.DrainSegmentCount},l.prototype.onUpdateEvent=function(t){switch(this.framePackageCount=0,u.prototype.onUpdateEvent.call(this,t),this.state){case 2:case 3:if(0<(n=t.canRecvLength())){var e=this.recv(n),i=this.phaseBufferCheck(e);if(e.rewind(),i<e.length){var r=e.readBuffer(i);if(null!=r&&this.doSvrHandshakePhase1(r.readAsString(!0)),this.handlePhaseTimeout(),4!=this.state){BK.Script.log(1,0,"BK.Websocket websocket state expected ESTABLISHED!");break}if(BK.Script.log(1,0,"BK.Websocket pointer:"+e.pointer+"length:"+e.length),null!=e)for(;!e.eof;)if(!this.doSvrFrameDataPhase(e)){this.sendCloseFrame(this.errcode,this.message?this.message:""),this.delegate.onError&&this.delegate.onError(this);break}if(this.delegate.onMessage)for(;0<this.udataQue.length;){var o=this.udataQue.shift();this.delegate.onMessage(this,o)}0<this.txMsgQue.length&&this.sendFrameFromTxQ(this.txFrameType),this.delegate.onSendComplete&&this.delegate.onSendComplete(this),this.inPongFrame=!1,this.handlePhaseTimeout(),this.handlePingPongTimer()}else null!=e&&this.doSvrHandshakePhase1(e.readAsString(!0)),this.handlePhaseTimeout()}break;case 4:for(var n=t.canRecvLength();0<n;){var s=n,a=this.recv(n);if(null!=a)for(;!a.eof;){if(!this.doSvrFrameDataPhase(a)){this.sendCloseFrame(this.errcode,this.message?this.message:""),this.delegate.onError&&this.delegate.onError(this);break}if(0==this.state)return}if((n=t.canRecvLength())==s)break}if(this.delegate.onMessage)for(;0<this.udataQue.length;){o=this.udataQue.shift();this.delegate.onMessage(this,o)}0<this.txMsgQue.length&&this.sendFrameFromTxQ(this.txFrameType),this.delegate.onSendComplete&&this.delegate.onSendComplete(this),this.inPongFrame=!1,this.handlePhaseTimeout(),this.handlePingPongTimer();break;case 1:if(0<(n=t.canRecvLength())&&this.doSvrFrameDataPhase(this.recv(n))&&this.delegate.onMessage)for(;0<this.udataQue.length;){o=this.udataQue.shift();this.delegate.onMessage(this,o)}this.handlePhaseTimeout()}return 0},l.isLittleEndian=BK.Misc.isLittleEndian(),l}(t),i=function(t,e){this.data=t,this.isBinary=e};return function(){function t(t){var n=this;this.__url=t,this.options=null,this.inTrans=!1,this.isPendingConn=!0,this.txdataQ=new Array;var e=BK.URL("{}",t);this.scheme=e.protocol,this.port=e.port,this.path=e.path,this.query=e.query,this.host=e.hostname,BK.DNS.queryIPAddress(e.hostname,function(t,e,i){switch(i=n.ipListFilter(i),t){case 0:BK.Script.log(1,0,"BK.WebSocket.queryIPAddress!iplist = "+JSON.stringify(i)),n.iplist=i,n.__nativeObj=new s(i[0],n.port,n.host,n.path,n.query),BK.Notification.on("game_network_change",n,function(t){this.__nativeObj.close(),this.__nativeObj.delegate.onClose(this.__nativeObj)}.bind(n),!0),"wss"==n.scheme&&n.__nativeObj.enableSSL(!0),n.options&&(n.setOptions(n.options),n.options=null),n.isPendingConn&&(n.connect(),n.isPendingConn=!1),n.__nativeObj.delegate.onOpen=function(t){0<n.txdataQ.length&&n.send(n.txdataQ.shift()),n.onOpen?n.onOpen(n):n.onopen&&n.onopen.call(n)},n.__nativeObj.delegate.onClose=function(t){var e={};e.code=n.getErrorCode(),e.reason=n.getErrorString(),n.onClose?n.onClose(n,e):n.onclose&&n.onclose.call(n,e)},n.__nativeObj.delegate.onError=function(t){var e={};e.code=n.getErrorCode(),e.reason=n.getErrorString(),n.onError?n.onError(n,e):n.onerror&&n.onerror.call(n,e)},n.__nativeObj.delegate.onMessage=function(t,e){if(n.onMessage)n.onMessage(n,e);else if(n.onmessage){if(1==e.isBinary){var i=e.data;i.rewind();for(var r=new ArrayBuffer(i.length),o=new DataView(r);!i.eof;)o.setUint8(i.pointer,i.readUint8Buffer());e.data=r}n.onmessage.call(n,e)}},n.__nativeObj.delegate.onSendComplete=function(t){for(var e=n.txdataQ.length;0<e&&n.__nativeObj.packageSendCheck();e--){var i=n.txdataQ.shift();i.isBinary?n.__sendBinaryFrame(i.data):n.__nativeObj.sendTextFrame(i.data)}}}})}return Object.defineProperty(t.prototype,"url",{get:function(){return this.__url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this.getReadyState()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){for(var t=0,e=0;e<this.txdataQ.length;e++)t+=this.txdataQ[e].data.length;return t},enumerable:!0,configurable:!0}),t.prototype.__sendBinaryFrame=function(t){if(Object.prototype.hasOwnProperty.call(t,"__rawBKData"))return this.__nativeObj.sendBinaryFrame(t.__rawBKData);if(t instanceof Int8Array==1||t instanceof Uint8Array==1||t instanceof Int16Array==1||t instanceof Uint16Array==1||t instanceof Int32Array==1||t instanceof Uint32Array==1||t instanceof Float32Array==1){for(var e=new BK.Buffer(t.byteLength),i=new DataView(t.buffer),r=0;r<t.byteLength;r++)e.writeUint8Buffer(i.getUint8(r));return this.__nativeObj.sendBinaryFrame(e)}if(t instanceof ArrayBuffer!=1)return this.__nativeObj.sendBinaryFrame(t);for(e=new BK.Buffer(t.byteLength),i=new DataView(t),r=0;r<t.byteLength;r++)e.writeUint8Buffer(i.getUint8(r));return this.__nativeObj.sendBinaryFrame(e)},t.prototype.ipListFilter=function(t){var r=new Array;return t.forEach(function(t){for(var e=!1,i=0;i<r.length;i++){if(t==r[i]){e=!0;break}}0==e&&r.push(t)}),r},t.prototype.getReadyState=function(){return this.__nativeObj?this.__nativeObj.getReadyState():0},t.prototype.getErrorCode=function(){return this.__nativeObj?this.__nativeObj.getErrorCode():65535},t.prototype.getErrorString=function(){return this.__nativeObj?this.__nativeObj.getErrorString():""},t.prototype.close=function(){4==this.getReadyState()&&this.__nativeObj.sendCloseFrame(1e3,"see ya")},t.prototype.connect=function(){return!this.__nativeObj||0!=this.__nativeObj.connect()},t.prototype.send=function(t){var e=this.getReadyState();if(1==e||0==e)return!1;if("string"==typeof t){if(this.__nativeObj.packageSendCheck()&&4==e)return this.__nativeObj.sendTextFrame(t);this.txdataQ.push(new i(t,!1))}else if("object"==typeof t){if(this.__nativeObj.packageSendCheck()&&4==e)return this.__sendBinaryFrame(t);this.txdataQ.push(new i(t,!0))}return!1},t.prototype.setOptions=function(t){this.__nativeObj?(t.DrainSegmentCount&&(this.__nativeObj.options.DrainSegmentCount=t.DrainSegmentCount),t.DefaultSegmentSize&&(this.__nativeObj.options.DefaultSegmentSize=t.DefaultSegmentSize),t.PingPongInterval&&(this.__nativeObj.options.PingPongInterval=t.PingPongInterval),t.HandleShakeRequestTimeout&&(this.__nativeObj.options.HandleShakeRequestTimeout=t.HandleShakeRequestTimeout),t.HandleShakeResponseTimeout&&(this.__nativeObj.options.HandleShakeResponseTimeout=t.HandleShakeResponseTimeout),t.CloseAckTimeout&&(this.__nativeObj.options.CloseAckTimeout=t.CloseAckTimeout),t.PingPongTimeout&&(this.__nativeObj.options.PingPongTimeout=t.PingPongTimeout)):this.options=t},t}()});var B=function(){function t(t,e,i,r,o,n,s){this.size={width:0,height:0},this.flipU=0,this.flipV=1,this.stretchX=1,this.stretchY=1,r&&(this.flipU=r),o&&(this.flipV=o),n&&(this.stretchX=n),s&&(this.stretchY=s),e&&(this.size.width=e),i&&(this.size.height=i),this.textureInfo=t,this.onInit(this.size.width,this.size.height),this.adjustWithTextureInfo(t)}return t.prototype.onInit=function(t,e){this.createSprites(t,e),Object.getOwnPropertyNames(this.__nativeObj).forEach(function(t){var e=t;Object.defineProperty(this,e,{get:function(){return this.__nativeObj[e]},set:function(t){this.__nativeObj[e]=t}})},this),Object.defineProperty(this,"size",{get:function(){return this.__nativeObj.contentSize},set:function(t){this.__nativeObj.contentSize=t,this.updateSize(this.textureInfo)}}),Object.defineProperty(this,"anchor",{get:function(){return this.__nativeObj.localAnchor},set:function(t){this.__nativeObj.localAnchor=t}})},t.prototype.updateSize=function(t){if(1==t.frameInfo.trimmed){var e=t.frameInfo.spriteSourceSize.x,i=t.frameInfo.spriteSourceSize.y,r=t.frameInfo.spriteSourceSize.w,o=t.frameInfo.spriteSourceSize.h,n=t.frameInfo.sourceSize,s=this.__nativeObj.contentSize;e=s.width*e/n.w,i=s.height*i/n.h,r=s.width*r/n.w,o=s.height*o/n.h,this.contentSprite.position={x:e,y:i},this.contentSprite.contentSize={width:r,height:o}}else this.contentSprite.contentSize=this.__nativeObj.contentSize},t.prototype.adjustWithTextureInfo=function(t){if(t){var e=(this.textureInfo=t).texture,i=t.frameInfo;this.updateSize(t),this.currTexturePath=t.texturePath;e=new BK.Texture(this.currTexturePath);this.contentSprite.setTexture(e),this.contentSprite.adjustTexturePosition(i.frame.x,i.frame.y,i.frame.w,i.frame.h,i.rotated)}},t.prototype.setTexture=function(t){this.__nativeObj.setTexture(t)},t.prototype.dispose=function(){BK.Director.ticker.remove(this),this.__nativeObj.dispose()},t.prototype.removeChild=function(t){return this.__nativeObj.removeChild(t)},t.prototype.removeChildById=function(t,e){return this.__nativeObj.removeChildById(t,e)},t.prototype.removeChildByName=function(t,e){return this.__nativeObj.removeChildByName(t,e)},t.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},t.prototype.addChild=function(t,e){return this.__nativeObj.addChild(t,e)},t.prototype.hittest=function(t){return this.__nativeObj.hittest(t)},t.prototype.convertToWorldSpace=function(t){return this.__nativeObj.convertToWorldSpace(t)},t.prototype.convertToNodeSpace=function(t){return this.__nativeObj.convertToNodeSpace(t)},t.prototype.createSprites=function(t,e){this.__nativeObj=new BK.SpriteNode(t,e,{},this.flipU,this.flipV,this.stretchX,this.stretchY),this.contentSprite=new BK.SpriteNode(t,e,{},this.flipU,this.flipV,this.stretchX,this.stretchY),this.__nativeObj.addChild(this.contentSprite)},t}();BK.SheetSprite||(BK.SheetSprite=B);var b,T=function(){function t(){this.sheets={},this.jsonConfigs={}}return t.prototype.getFrameInfoByFilename=function(t){for(var e in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(e)){var i=this.jsonConfigs[e],r=(this.sheets[e],i.frames),o=i.meta;this.fullWidth=o.size.w,this.fullHeight=o.size.h;for(var n=0;n<r.length;n++){var s=r[n];if(t==s.filename){var a={x:0,y:1,w:0,h:0},h=s.rotated,c=s.trimmed,u=s.spriteSourceSize,l=s.sourceSize;return a.h=(a.w=(a.y=h?(a.x=s.frame.x,this.fullHeight-s.frame.y-s.frame.w):(a.x=s.frame.x,this.fullHeight-s.frame.y-s.frame.h),s.frame.w),s.frame.h),u.y=l.h-u.y-u.h,{filename:t,frame:a,rotated:h,trimmed:c,spriteSourceSize:u,sourceSize:l}}}}return null},t.prototype.getTexturePathByFilename=function(t){for(var e in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(e))for(var i=this.jsonConfigs[e].frames,r=0;r<i.length;r++){if(i[r].filename==t)return e}return null},t.prototype.loadSheet=function(t,e,i,r,o,n,s){var a=BK.FileUtil.readFile(t).readAsString();if(a){var h=JSON.parse(a);void 0===e&&(e=t.replace(/.json$/,".png")),this.jsonConfigs[e]=h,void 0===i&&(i=4),i=4,void 0===r&&(r=1),void 0===o&&(o=1),void 0===n&&(n=1),void 0===s&&(s=1);var c=new BK.Texture(e,i,r,o,n,s);this.sheets[e]=c}else BK.Script.log(0,0,"loadSheet Failed.Please check path")},t.prototype.removeSheet=function(t,e){if(this.jsonConfigs[e])for(var i in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(i)){var r=this.jsonConfigs[i];i==e&&(delete this.jsonConfigs[e],BK.Script.log(0,0,"Delete jsonConfigs key:"+i+" val:"+r))}if(this.sheets[e])for(var i in this.sheets)if(this.sheets.hasOwnProperty(i)){r=this.sheets[i];i==e&&(delete this.sheets[e],BK.Script.log(0,0,"Delete sheets key:"+i+" val:"+r))}},t.prototype.getTextureByFilename=function(t){var e=this.getFrameInfoByFilename(t),i=this.getTexturePathByFilename(t);return e&&i?new BK.Texture(i):(BK.Script.log(0,0,"getTexture Failed.Please check path"),null)},t.prototype.getSprite=function(t,e,i){var r=this.getTextureFrameInfoByFileName(t);if(r){var o,n=r.frameInfo,s=r.texturePath,a=new BK.Texture(s);return e||(e=n.frame.w),i||(i=n.frame.h),BK.Script.log(0,0,"getSprite  texture:"+a+" width:"+e+" height:"+i),n.trimmed?o=new BK.SheetSprite(r,e,i):((o=new BK.Sprite(e,i,a,0,1,1,1)).adjustTexturePosition(n.frame.x,n.frame.y,n.frame.w,n.frame.h,n.rotated),o)}return null},t.prototype.createSheetSprite=function(t,e,i){var r=this.getTextureFrameInfoByFileName(t);if(r){var o=r.frameInfo,n=r.texturePath,s=new BK.Texture(n);return e||(e=o.frame.w),i||(i=o.frame.h),BK.Script.log(0,0,"SheetSprite  texture:"+s+" width:"+e+" height:"+i),new BK.SheetSprite(r,e,i)}return null},t.prototype.getTextureFrameInfoByFileName=function(t){var e=this.getFrameInfoByFilename(t),i=this.getTexturePathByFilename(t);return e&&i?{frameInfo:e,texturePath:i}:null},t}(),E=function(){function t(t,e,i,r,o,n){void 0===o&&(o={x:0,y:0}),this._size={width:0,height:0},this.__nativeObj=new BK.Node,this.onInit(),this._grid=r,this._size={width:e,height:e},this._leftTop=new BK.Sprite(r.left,r.top,i,0,1,1,1),this._leftTop.position={x:0,y:e-r.top},this._leftTop.zOrder=99999,this._leftTop.name="_leftTop",this.__nativeObj.addChild(this._leftTop),this._centerTop=new BK.Sprite(t-r.left-r.right,r.top,i,0,1,1,1),this._centerTop.position={x:r.left,y:e-r.top},this._centerTop.zOrder=99999,this._centerTop.name="_centerTop",this.__nativeObj.addChild(this._centerTop),this._rightTop=new BK.Sprite(r.right,r.top,i,0,1,1,1),this._rightTop.position={x:t-r.right,y:e-r.top},this._rightTop.zOrder=99999,this._rightTop.name="_rightTop",this.__nativeObj.addChild(this._rightTop),this._leftCenter=new BK.Sprite(r.left,e-r.top-r.bottom,i,0,1,1,1),this._leftCenter.position={x:0,y:r.bottom},this._leftCenter.name="_leftCenter",this.__nativeObj.addChild(this._leftCenter),this._centerCenter=new BK.Sprite(t-r.left-r.right,e-r.top-r.bottom,i,0,1,1,1),this._centerCenter.position={x:r.left,y:r.bottom},this._centerCenter.name="_centerCenter",this.__nativeObj.addChild(this._centerCenter),this._rightCenter=new BK.Sprite(r.right,e-r.bottom-r.top,i,0,1,1,1),this._rightCenter.position={x:t-r.right,y:r.bottom},this._rightCenter.name="_rightCenter",this.__nativeObj.addChild(this._rightCenter),this._leftBottom=new BK.Sprite(r.left,r.bottom,i,0,1,1,1),this._leftBottom.position={x:0,y:0},this._leftBottom.name="_leftBottom",this.__nativeObj.addChild(this._leftBottom),this._centerBottom=new BK.Sprite(t-r.left-r.right,r.bottom,i,0,1,1,1),this._centerBottom.position={x:r.left,y:0},this._centerBottom.name="_centerBottom",this.__nativeObj.addChild(this._centerBottom),this._rightBottom=new BK.Sprite(r.right,r.bottom,i,0,1,1,1),this._rightBottom.position={x:t-r.right,y:0},this._rightBottom.name="_rightBottom",this.__nativeObj.addChild(this._rightBottom),1==n?(this._leftTop.adjustTexturePosition(o.x+(e-r.top),o.y+(t-r.left),r.left,r.top,n),this._centerTop.adjustTexturePosition(o.x+(e-r.top),o.y+r.right,t-r.left-r.right,r.top,n),this._rightTop.adjustTexturePosition(o.x+(e-r.top),o.y,r.right,r.top,n),this._leftCenter.adjustTexturePosition(o.x+r.bottom,o.y+(t-r.left),r.left,e-r.top-r.bottom,n),this._centerCenter.adjustTexturePosition(o.x+r.bottom,o.y+r.right,t-r.left-r.right,e-r.top-r.bottom,n),this._rightCenter.adjustTexturePosition(o.x+r.bottom,o.y,r.right,e-r.bottom-r.top,n),this._leftBottom.adjustTexturePosition(o.x,o.y+(t-r.left),r.left,r.bottom,n),this._centerBottom.adjustTexturePosition(o.x,o.y+r.right,t-r.left-r.right,r.bottom,n),this._rightBottom.adjustTexturePosition(o.x,o.y,r.right,r.bottom,n)):(this._leftTop.adjustTexturePosition(0+o.x,e-r.top+o.y,r.left,r.top),this._centerTop.adjustTexturePosition(r.left+o.x,e-r.top+o.y,t-r.left-r.right,r.top),this._rightTop.adjustTexturePosition(t-r.right+o.x,e-r.top+o.y,r.right,r.top),this._leftCenter.adjustTexturePosition(0+o.x,r.bottom+o.y,r.left,e-r.top-r.bottom),this._centerCenter.adjustTexturePosition(r.left+o.x,r.bottom+o.y,t-r.left-r.right,e-r.top-r.bottom),this._rightCenter.adjustTexturePosition(t-r.right+o.x,r.bottom+o.y,r.right,e-r.bottom-r.top),this._leftBottom.adjustTexturePosition(0+o.x,0+o.y,r.left,r.bottom),this._centerBottom.adjustTexturePosition(r.left+o.x,0+o.y,t-r.left-r.right,r.bottom),this._rightBottom.adjustTexturePosition(t-r.right+o.x,0+o.y,r.right,r.bottom))}return t.prototype.onInit=function(){Object.getOwnPropertyNames(this.__nativeObj).forEach(function(t){var e=t;"size"!=e&&Object.defineProperty(this,e,{get:function(){return this.__nativeObj[e]},set:function(t){this.__nativeObj[e]=t}})},this)},Object.defineProperty(t.prototype,"alpha",{get:function(){return this._rightBottom.vertexColor.a},set:function(t){this._leftTop.vertexColor={r:1,g:1,b:1,a:t},this._centerTop.vertexColor={r:1,g:1,b:1,a:t},this._rightTop.vertexColor={r:1,g:1,b:1,a:t},this._leftCenter.vertexColor={r:1,g:1,b:1,a:t},this._centerCenter.vertexColor={r:1,g:1,b:1,a:t},this._rightCenter.vertexColor={r:1,g:1,b:1,a:t},this._leftBottom.vertexColor={r:1,g:1,b:1,a:t},this._centerBottom.vertexColor={r:1,g:1,b:1,a:t},this._rightBottom.vertexColor={r:1,g:1,b:1,a:t}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},set:function(t){var e=(this._size=t).width-this._grid.left-this._grid.right,i=t.height-this._grid.top-this._grid.bottom;this._leftTop.position={x:0,y:t.height-this._grid.top},this._leftCenter.size={width:this._grid.left,height:i},this._leftCenter.position={x:0,y:this._grid.bottom},this._rightCenter.size={width:this._grid.right,height:i},this._rightCenter.position={x:t.width-this._grid.right,y:this._grid.bottom},this._centerCenter.size={width:e,height:i},this._centerTop.size={width:e,height:this._grid.top},this._centerTop.position={x:this._grid.left,y:t.height-this._grid.top},this._centerBottom.size={width:e,height:this._grid.bottom},this._centerBottom.position={x:this._grid.left,y:0},this._rightCenter.size={width:this._grid.right,height:i},this._rightCenter.position={x:t.width-this._grid.right,y:this._grid.bottom},this._rightBottom.position={x:t.width-this._grid.right,y:0},this._rightTop.position={x:t.width-this._grid.right,y:t.height-this._grid.top}},enumerable:!0,configurable:!0}),t.prototype.pos=function(t,e){this.__nativeObj.position={x:t,y:e}},t.prototype.dispose=function(){this.__nativeObj.dispose()},t.prototype.attachBody=function(t){this.__nativeObj.attachComponent(t)},t.prototype.addChild=function(t){this.__nativeObj.addChild(t)},t.prototype.removeChildById=function(t,e){return this.__nativeObj.removeChildById(t,e)},t.prototype.removeChildByName=function(t,e){return this.__nativeObj.removeChildByName(t,e)},t.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},t.prototype.hittest=function(t){return this.__nativeObj.hittest(t)},t}();function C(){var t=arguments.length;(this._shadowColor={r:0,g:0,b:0,a:0},this._shadowOffset={x:0,y:0},this._shadowRadius=0,this._textBaseLine=0,this._textAlign=0,this._useH5Mode=0,this._a=1,this._b=0,this._c=0,this._d=1,this._tx=0,this._ty=0,2==t)&&(this.__nativeObj=new BK.CanvasNode(arguments[0],arguments[1]),this.setFlipXY(0,1),Object.getOwnPropertyNames(this.__nativeObj).forEach(function(t){var e=t;"scale"!=e&&"transform"!=e&&"contentSize"!=e&&"size"!=e&&"fontPath"!=e&&Object.defineProperty(this,e,{get:function(){return this.__nativeObj[e]},set:function(t){this.__nativeObj[e]=t}})},this),Object.defineProperty(C.prototype,"fontPath",{get:function(){return this.__nativeObj.fontPath},set:function(t){BK.FileUtil.isFileExist(t)&&(this.__nativeObj.fontPath=t)},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"contentSize",{get:function(){return this.__nativeObj.contentSize},set:function(t){this.__nativeObj.contentSize=t,this.__nativeObj.resetCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"size",{get:function(){return this.__nativeObj.size},set:function(t){this.__nativeObj.size=t,this.__nativeObj.resetCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"textBaseline",{get:function(){return this._textBaseLine},set:function(t){switch(t){case 0:case 1:case 2:this._textBaseLine=t;break;case"bottom":case"Bottom":this._textBaseLine=0;break;case"Middle":case"middle":this._textBaseLine=1;break;case"Top":case"top":this._textBaseLine=2}},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"textAlign",{get:function(){return this._textAlign},set:function(t){switch(t){case 0:case 1:case 2:this._textAlign=t;break;case"left":this._textAlign=0;break;case"center":this._textAlign=1;break;case"right":this._textAlign=2}this.__nativeObj.setTextAlign(this._textAlign)},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"lineWidth",{get:function(){return this.__nativeObj.lineWidth},set:function(t){this.__nativeObj.lineWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"globalAlpha",{get:function(){return this.__nativeObj.globalAlpha},set:function(t){t=Math.min(1,t),t=Math.max(0,t),this.__nativeObj.globalAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"fillColor",{get:function(){return this.__nativeObj.fillColor},set:function(t){this.__nativeObj.fillColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"strokeColor",{get:function(){return this.__nativeObj.strokeColor},set:function(t){this.__nativeObj.strokeColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"lineCap",{get:function(){return this.__nativeObj.lineCap},set:function(t){this.__nativeObj.lineCap=t},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"lineJoin",{get:function(){return this.__nativeObj.lineJoin},set:function(t){this.__nativeObj.lineJoin=t},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"miterLimit",{get:function(){return this.__nativeObj.miterLimit},set:function(t){this.__nativeObj.miterLimit=t},enumerable:!0,configurable:!0}))}function R(t,e,i,r,o,n){var s=t*r*1+i*n*0+o*e*0-o*r*0-i*e*1-t*n*0,a=-1*(1*e-0*n)/s,h=1*(0*e-0*r)/s,c=-1*(1*i-0*o)/s,u=-1*(0*t-0*i)/s,l=1*(i*n-o*r)/s,d=-1*(t*n-o*e)/s,f=c;c=a,a=f;f=l;l=h,h=f;f=u;return u=d,d=f,[1*(1*r-0*n)/s,c,a,1*(1*t-0*o)/s,h,u]}if(BK.SpriteSheetCache||(BK.SpriteSheetCache=new T),BK.Sprite9||(BK.Sprite9=E),function(t,e){"object"==typeof t&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.AnimatedSprite=e())}(BK,function(){return function(){function t(t){this.paused=!1,this.delayUnits=1/30,this.tmpPlayingIdx=0,this.previousTs=-1,this.playedCount=0,this.size={width:0,height:0},this.readyTextureInfo(t),this.onInit(this.size.width,this.size.height),this.displayFrame(0),this.paused=!0,BK.Director.ticker.add(function(t,e,i){i.update(t,e)},this)}return t.prototype.onInit=function(t,e){this.createSprites(t,e),Object.getOwnPropertyNames(this.__nativeObj).forEach(function(t){var e=t;Object.defineProperty(this,e,{get:function(){return this.__nativeObj[e]},set:function(t){this.__nativeObj[e]=t}})},this),Object.defineProperty(this,"size",{get:function(){return this.__nativeObj.contentSize},set:function(t){this.__nativeObj.contentSize=t,this.displayFrame(this.currDisplayIdx)}}),Object.defineProperty(this,"anchor",{get:function(){return this.__nativeObj.localAnchor},set:function(t){this.__nativeObj.localAnchor=t,this.displayFrame(this.currDisplayIdx)}})},t.prototype.setTexture=function(t){this.__nativeObj.setTexture(t)},t.prototype.dispose=function(){BK.Director.ticker.remove(this),this.__nativeObj.dispose()},t.prototype.removeChild=function(t){return this.__nativeObj.removeChild(t)},t.prototype.removeChildById=function(t,e){return this.__nativeObj.removeChildById(t,e)},t.prototype.removeChildByName=function(t,e){return this.__nativeObj.removeChildByName(t,e)},t.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},t.prototype.addChild=function(t,e){return this.__nativeObj.addChild(t,e)},t.prototype.hittest=function(t){return this.__nativeObj.hittest(t)},t.prototype.convertToWorldSpace=function(t){return this.__nativeObj.convertToWorldSpace(t)},t.prototype.convertToNodeSpace=function(t){return this.__nativeObj.convertToNodeSpace(t)},t.prototype.createSprites=function(t,e){this.__nativeObj=new BK.SpriteNode(t,e,{},0,1,1,1),this.contentSprite=new BK.SpriteNode(t,e,{},0,1,1,1),this.__nativeObj.addChild(this.contentSprite)},t.prototype.readyTextureInfo=function(t){var e=this;this.textureInfoArr=[],t.forEach(function(t){t.texturePath&&(t.texture=new BK.Texture(t.texturePath),e.textureInfoArr.push(t),e.size={width:t.frameInfo.sourceSize.w,height:t.frameInfo.sourceSize.h})})},t.prototype.displayFrame=function(t){if(0<this.textureInfoArr.length){var e=this.textureInfoArr[t];if(e){this.currDisplayIdx=t;var i=e.texture,r=e.frameInfo;if(1==e.frameInfo.trimmed){var o=e.frameInfo.spriteSourceSize.x,n=e.frameInfo.spriteSourceSize.y,s=e.frameInfo.spriteSourceSize.w,a=e.frameInfo.spriteSourceSize.h,h=e.frameInfo.sourceSize,c=this.__nativeObj.contentSize;o=c.width*o/h.w,n=c.height*n/h.h,s=c.width*s/h.w,a=c.height*a/h.h,this.contentSprite.position={x:o,y:n},this.contentSprite.contentSize={width:s,height:a}}else this.contentSprite.contentSize=this.__nativeObj.contentSize;this.currTexturePath&&this.currTexturePath==e.texturePath||(BK.Script.log(1,-1,"this.currTexture != tex"),this.currTexturePath=e.texturePath,this.contentSprite.setTexture(i)),this.contentSprite.adjustTexturePosition(r.frame.x,r.frame.y,r.frame.w,r.frame.h,r.rotated)}else BK.Script.log(1,-1,"displayFrame failed! textureInfo is null. index is "+t)}else BK.Script.log(1,-1,"displayFrame failed! textureInfoArr.length is 0")},t.prototype.render=function(){this.tmpPlayingIdx>this.textureInfoArr.length-1&&(this.tmpPlayingIdx=0),this.displayFrame(this.tmpPlayingIdx),this.tmpPlayingIdx++,this.currDisplaySum++,this.updateCallback()},t.prototype.update=function(t,e){0==this.paused&&(this.previousTs<0?(this.previousTs=t,this.render()):t-this.previousTs>1e3*this.delayUnits&&(this.previousTs=t,this.render()))},t.prototype.play=function(t,e){void 0===t&&(t=0),void 0===e&&(e=-1),t>this.textureInfoArr.length-1?this.tmpPlayingIdx=0:this.tmpPlayingIdx=t,this.paused=!1,this.repeatCount=e,this.currDisplaySum=0,this.playedCount=0},t.prototype.stop=function(t){void 0===t&&(t=-1),this.paused=!0,-1<t&&this.displayFrame(t)},t.prototype.updateCallback=function(){var t=this.textureInfoArr.length;this.currDisplaySum%t==0&&(this.playedCount=parseInt(String(this.currDisplaySum/t)),this.completeCallback&&this.completeCallback(this,this.playedCount),0<this.repeatCount&&this.repeatCount<=this.playedCount&&(this.endCallback&&this.endCallback(this,this.playedCount),this.stop()))},t.prototype.setCompleteCallback=function(t){this.completeCallback=t},t.prototype.setEndCallback=function(t){this.endCallback=t},t}()}),C.prototype.setImagePath=function(t){if(t){this.imagePath=t;var e=new BK.Texture(t);this.__nativeObj.setTexture(e)}},C.prototype.getImagePath=function(){return this.imagePath},C.prototype.setTexture=function(t){this.__nativeObj.setTexture(t)},C.prototype.setFlipXY=function(t,e){this.__nativeObj.setUVFlip(t,e)},C.prototype.setUVFlip=function(t,e){this.__nativeObj.setUVFlip(t,e)},C.prototype.setUVWrap=function(t,e){this.__nativeObj.setUVWrap(t,e)},C.prototype.setXYStretch=function(t,e){this.__nativeObj.setXYStretch(t,e)},C.prototype.adjustTexturePosition=function(t,e,i,r,o){this.__nativeObj.adjustTexturePosition(t,e,i,r,o)},C.prototype.addChild=function(t){return this.__nativeObj.addChild(t)},C.prototype.dispose=function(){return this.__nativeObj.dispose()},C.prototype.removeChild=function(t){return this.__nativeObj.removeChild(t)},C.prototype.removeChildById=function(t){return this.__nativeObj.removeChildById(t)},C.prototype.removeChildByName=function(t){return this.__nativeObj.removeChildByName(t)},C.prototype.removeChildByTag=function(t){return this.__nativeObj.removeChildByTag(t)},C.prototype.queryChildAtIndex=function(t){return this.__nativeObj.queryChildAtIndex(t)},C.prototype.queryChildById=function(t){return this.__nativeObj.queryChildById(t)},C.prototype.queryChildByName=function(t){return this.__nativeObj.queryChildByName(t)},C.prototype.queryChildByTag=function(t){return this.__nativeObj.queryChildByTag(t)},C.prototype.getChildCount=function(){return this.__nativeObj.getChildCount()},C.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},C.prototype.attachComponent=function(t){return this.__nativeObj.attachComponent(t)},C.prototype.detachComponent=function(t){return this.__nativeObj.detachComponent(t)},C.prototype.queryComponent=function(t){return this.__nativeObj.queryComponent(t)},C.prototype.queryComponentList=function(t){return this.__nativeObj.queryComponentList(t)},C.prototype.hittest=function(t){return this.__nativeObj.hittest(t)},C.prototype.isEqual=function(t){return this.__nativeObj.isEqual(t)},C.prototype.convertToWorldSpace=function(t){return this.__nativeObj.convertToWorldSpace(t)},C.prototype.convertToNodeSpace=function(t){return this.__nativeObj.convertToNodeSpace(t)},C.prototype.setAtlas=function(t,e){if(this.__nativeObj){BK.CanvasSheetCache.loadSheet(t);var i=BK.CanvasSheetCache.getTexturePathByFilename(e),r=new BK.Texture(i);this.__nativeObj.setTexture(r);var o=BK.CanvasSheetCache.getFrameInfoByFilename(e);this.__nativeObj.adjustTexturePosition(o.frame.x,o.frame.y,o.frame.w,o.frame.h,o.rotated)}return 0},C.prototype.useH5Mode=function(){return this.__nativeObj?(this._useH5Mode=1)==arguments.length?(this._useH5Mode=arguments[0],this.__nativeObj.useH5Mode(arguments[0])):this.__nativeObj.useH5Mode():0},C.prototype.drawCircle=function(){return this.__nativeObj?this.__nativeObj.drawCircle(arguments[0],arguments[1],arguments[2]):0},C.prototype.drawEllipse=function(){return this.__nativeObj?this.__nativeObj.drawEllipse(arguments[0],arguments[1],arguments[2],arguments[3]):0},C.prototype.drawImage=function(){if(this.__nativeObj){var t=arguments.length;if(9==t)this.__nativeObj.drawImage(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);else if(5==t)this.__nativeObj.drawImage(arguments[0],0,0,0,0,arguments[1],arguments[2],arguments[3],arguments[4]);else{if(3!=t)return;this.__nativeObj.drawImage(arguments[0],0,0,0,0,arguments[1],arguments[2],0,0)}this._innerSetTransform()}return 0},C.prototype.fill=function(){return this.__nativeObj?this.__nativeObj.fill():0},C.prototype.stroke=function(){return this.__nativeObj?this.__nativeObj.stroke():0},C.prototype.rect=function(){return this.__nativeObj?this.__nativeObj.rect(arguments[0],arguments[1],arguments[2],arguments[3]):0},C.prototype.fillRect=function(){return this.__nativeObj?this.__nativeObj.fillRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},C.prototype.strokeRect=function(){return this.__nativeObj?this.__nativeObj.strokeRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},C.prototype.clearRect=function(){return this.__nativeObj?this.__nativeObj.clearRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},C.prototype.beginPath=function(){return this.__nativeObj?this.__nativeObj.beginPath():0},C.prototype.closePath=function(){return this.__nativeObj?this.__nativeObj.closePath():0},C.prototype.moveTo=function(){return this.__nativeObj?this.__nativeObj.moveTo(arguments[0],arguments[1]):0},C.prototype.lineTo=function(){return this.__nativeObj?this.__nativeObj.lineTo(arguments[0],arguments[1]):0},C.prototype.arcTo=function(){return this.__nativeObj?this.__nativeObj.arcTo(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]):0},C.prototype.arc=function(){if(this.__nativeObj){var t=arguments.length;if(5==t)return this.__nativeObj.arc(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);if(6==t)return this.__nativeObj.arc(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}return 0},C.prototype.quadraticCurveTo=function(){return this.__nativeObj?this.__nativeObj.quadraticCurveTo(arguments[0],arguments[1],arguments[2],arguments[3]):0},C.prototype.bezierCurveTo=function(){return this.__nativeObj?this.__nativeObj.bezierCurveTo(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]):0},C.prototype.save=function(){return this.__nativeObj?this.__nativeObj.save():0},C.prototype.restore=function(){return this.__nativeObj?this.__nativeObj.restore():0},C.prototype.fillText=function(){if(3==arguments.length){var t=this.measureText(arguments[0],2048,1024),e=arguments[1],i=arguments[2];switch(1==this._useH5Mode?2-this._textBaseLine:this._textBaseLine){case 1:i-=.5*t.height;break;case 2:i-=1*t.height}switch(this._textAlign){case 1:e-=.5*t.width;break;case 2:e-=1*t.width}this.__nativeObj.fillText(arguments[0],e,i,Math.min(2048,t.width),Math.min(1024,t.height)),this._innerSetTransform()}return 0},C.prototype.clip=function(){return this.__nativeObj?this.__nativeObj.clip():0},C.prototype.isPointInPath=function(){if(this.__nativeObj)return this.__nativeObj.isPointInPath(arguments[0],arguments[1])},C.prototype.createImageData=function(){var t=arguments.length;if(this.__nativeObj&&2==t){var e=new BK.Buffer(arguments[0]*arguments[1]*4);return e.__inner_image_width=arguments[0],e.__inner_image_height=arguments[1],e}},C.prototype.getImageData=function(){var t=arguments.length;if(this.__nativeObj&&4==t){var e=this.__nativeObj.getImageData(arguments[0],arguments[1],arguments[2],arguments[3]);return e.__inner_image_width=arguments[2],e.__inner_image_height=arguments[3],e}},C.prototype.putImageData=function(){var t=arguments.length;if(this.__nativeObj&&3==t){var e=arguments[0],i=arguments[1],r=arguments[2];e instanceof ArrayBuffer&&(e=BK.Util.Buffer.typedArrayToBKBuffer(new Uint8Array(e)),arguments[0]=e);var o=e.__inner_image_width,n=e.__inner_image_height;return this.__nativeObj.putImageData(arguments[0],i,r,o,n)}},C.prototype.scale=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. scale  :"+arguments[0]+" , "+arguments[1]),this.__nativeObj.scales(arguments[0],arguments[1])},C.prototype.scales=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. scales  :"+arguments[0]+" , "+arguments[1]),this.__nativeObj.scales(arguments[0],arguments[1])},C.prototype.rotate=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. rotate  :"+arguments[0]),this.__nativeObj.rotate(arguments[0])},C.prototype.translate=function(){if(this.__nativeObj){var t=GameStatusInfo.QQVer.split(".");7==Number(t[0])&&Number(7==t[1]&&Number(t[2])<=5)?(this._tx=arguments[0],this._ty=arguments[1],this._innerSetTransform()):this.__nativeObj.translate(arguments[0],arguments[1])}},C.prototype.transform=function(){if(this.__nativeObj)return this.__nativeObj.transforms(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},C.prototype.transforms=function(){return this.setTransform(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},C.prototype.setTransform=function(){if(this.__nativeObj){var t=GameStatusInfo.QQVer.split(".");if(Number(t[0])<7||7==Number(t[0])&&Number(t[1])<7){if("ios"==GameStatusInfo.platform){var e=R(this._a,this._b,this._c,this._d,this._tx,this._ty);this.__nativeObj.transforms(e[0],e[1],e[2],e[3],e[4],e[5])}return this._a=arguments[0],this._b=arguments[1],this._c=arguments[2],this._d=arguments[3],this._tx=arguments[4],this._ty=arguments[5],this.__nativeObj.transforms(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}return this._a=arguments[0],this._b=arguments[1],this._c=arguments[2],this._d=arguments[3],this._tx=arguments[4],this._ty=arguments[5],this.__nativeObj.setTransform(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}},C.prototype._innerSetTransform=function(){if(this.__nativeObj){var t=GameStatusInfo.QQVer.split(".");if(7==Number(t[0])&&Number(7==t[1]&&Number(t[2])<=5))return this.__nativeObj.setTransform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},C.prototype.shadowColor=function(){if(this._shadowColor=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},C.prototype.shadowRadius=function(){if(this._shadowRadius=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},C.prototype.shadowOffsetX=function(){if(this._shadowOffset.x=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},C.prototype.shadowOffsetY=function(){if(this._shadowOffset.y=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},C.prototype.clear=function(){if(this.__nativeObj)return this.__nativeObj.clear()},C.prototype.getTexture=function(){return this.__nativeObj?this.__nativeObj.getTexture():null},C.prototype.drawText=function(){return this.__nativeObj&&(this.__nativeObj.drawText(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),this._innerSetTransform()),null},C.prototype.setTextSize=function(){return this.__nativeObj?this.__nativeObj.setTextSize(arguments[0]):null},C.prototype.setTextAlign=function(){if(this.__nativeObj){switch(arguments[0]){case 0:case 1:case 2:this._textAlign=arguments[0];break;case"left":this._textAlign=0;break;case"center":this._textAlign=1;break;case"right":this._textAlign=2}return this.__nativeObj.setTextAlign(this._textAlign)}return null},C.prototype.setTextBold=function(){return this.__nativeObj?this.__nativeObj.setTextBold(arguments[0]):null},C.prototype.setTextItalic=function(){return this.__nativeObj?this.__nativeObj.setTextItalic(arguments[0]):null},C.prototype.measureText=function(){return this.__nativeObj?this.__nativeObj.measureText(arguments[0],arguments[1],arguments[2]):null},C.prototype.updateCanvasTexture=function(){return this.__nativeObj?this.__nativeObj.updateCanvasTexture():null},C.prototype.saveTo=function(){var t=arguments.length;return this.__nativeObj&&1==t&&this.__nativeObj.saveTo(arguments[0]),null},C.prototype.toDataURL=function(){if(this.__nativeObj){var t="GameSandBox://cmdataUrltest.png";this.__nativeObj.saveTo(t);var e=BK.FileUtil.readFile(t);BK.FileUtil.deleteFile(t);var i=BK.Misc.encodeBase64FromBuffer(e);return i&&(i="data:image/png;base64,"+i),i}return""},BK.Canvas=C,BK.Script.log(0,0,"Load Canvas.js succeed."),BK.Sprite.__proto__.setImagePath=function(t){if(t){this.imagePath=t;var e=new BK.Texture(t);this.setTexture(e)}},BK.Sprite.__proto__.getImagePath=function(){return this.imagePath},BK.Sprite.__proto__.setAtlas=function(t,e){BK.SpriteSheetCache.loadSheet(t);var i=BK.SpriteSheetCache.getTexturePathByFilename(e),r=new BK.Texture(i);this.setTexture(r);var o=BK.SpriteSheetCache.getFrameInfoByFilename(e);return this.adjustTexturePosition(o.frame.x,o.frame.y,o.frame.w,o.frame.h,o.rotated),0},BK.Script.log(0,0,"Load Sprite.js succeed."),BK.ScreenShot=function(){if(this.origin={x:0,y:0},this.size={width:0,height:0},GameStatusInfo){var r;function B(t){if(Object.prototype.hasOwnProperty.call(t,"__rawBKData"))return t.__rawBKData;if(Object.prototype.hasOwnProperty.call(t,"__nativeObj"))return t.__nativeObj;if(0==function(){if(null==r){"android"==GameStatusInfo.platform&&(r=!0);var t=BK.Director.queryDeviceInfo(),e=t.version.split(".");r="ios"==t.platform&&10<=Number(e[0])||"android"==t.platform||(BK.Script.log(1,0,"Current Device dont supoort TypedArray.[info = "+JSON.stringify(t)+"]"),!1)}return r}()){if(t instanceof Uint16Array==1){for(var e=new BK.Buffer(t.byteLength,!1),i=0;i<t.length;i++)e.writeUint16Buffer(t[i]);return e}if(t instanceof Float32Array==1){for(e=new BK.Buffer(t.byteLength,!1),i=0;i<t.length;i++)e.writeFloatBuffer(t[i]);return e}}return t}if(BK.Misc.compQQVersion||(BK.Misc.compQQVersion=function(t,e){for(var i=t.split("."),r=e.split("."),o=Math.min(3,Math.min(i.length,r.length)),n=0;n<o;n++)if(i[n]!=r[n])return i[n]<r[n];return!0}),b||((b=new BK.WebGL).DEPTH_BUFFER_BIT=256,b.STENCIL_BUFFER_BIT=1024,b.COLOR_BUFFER_BIT=16384,b.TRIANGLES=4,b.TEXTURE_BINDING_2D=32873,b.ARRAY_BUFFER=34962,b.ARRAY_BUFFER_BINDING=34964,b.ELEMENT_ARRAY_BUFFER=34963,b.ELEMENT_ARRAY_BUFFER_BINDING=34965,b.STATIC_DRAW=35044,b.UNSIGNED_BYTE=5121,b.UNSIGNED_SHORT=5123,b.FLOAT=5126,b.RGBA=6408,b.FRAGMENT_SHADER=35632,b.VERTEX_SHADER=35633,b.LINK_STATUS=35714,b.CURRENT_PROGRAM=35725,b.NEAREST=9728,b.LINEAR=9729,b.TEXTURE_MAG_FILTER=10240,b.TEXTURE_MIN_FILTER=10241,b.TEXTURE_WRAP_S=10242,b.TEXTURE_WRAP_T=10243,b.TEXTURE_2D=3553,b.TEXTURE0=33984,b.TEXTURE1=33985,b.ACTIVE_TEXTURE=34016,b.REPEAT=10497,b.CLAMP_TO_EDGE=33071,b.MIRRORED_REPEAT=33648,b.FRAMEBUFFER=36160,b.RENDERBUFFER=36161,b.COLOR_ATTACHMENT0=36064,b.DEPTH_ATTACHMENT=36096,b.STENCIL_ATTACHMENT=36128,b.NONE=0,b.FRAMEBUFFER_COMPLETE=36053,b.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,b.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,b.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,b.FRAMEBUFFER_UNSUPPORTED=36061,b.FRAMEBUFFER_BINDING=36006,b.RENDERBUFFER_BINDING=36007,b.INVALID_FRAMEBUFFER_OPERATION=1286),BK.Misc.compQQVersion(GameStatusInfo.QQVer,"7.6.1")){this.doImage_rotate180=function(t){var e=function(){var t=b.glCreateShader(b.VERTEX_SHADER);0!=t&&(b.glShaderSource(t,"attribute vec2 pos; attribute vec2 inUVs; varying lowp vec2 outUVs; void main() { gl_Position = vec4(pos, 0, 1); outUVs = inUVs; }"),b.glCompileShader(t));var e=b.glCreateShader(b.FRAGMENT_SHADER);0!=e&&(b.glShaderSource(e,"varying lowp vec2 outUVs; uniform sampler2D uSampler; void main() { gl_FragColor = texture2D(uSampler, outUVs); }"),b.glCompileShader(e));var i=b.glCreateProgram();return b.glAttachShader(i,t),b.glAttachShader(i,e),b.glLinkProgram(i),b.glDeleteShader(t),b.glDeleteShader(e),i}();b.glUseProgram(e);var i=b.glGetAttribLocation(e,"pos"),r=b.glGetAttribLocation(e,"inUVs"),o=b.glGetUniformLocation(e,"uSampler");b.glActiveTexture(b.TEXTURE0);var n=b.glCreateTexture(),s=b.glGetParameterInt(b.TEXTURE_BINDING_2D,1);b.glBindTexture(b.TEXTURE_2D,n),b.glTexParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.glTexParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.glTexParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.glTexParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.glTexImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,t),b.glUniform1i(o,0);var a=b.glGetParameterInt(b.ARRAY_BUFFER_BINDING,1),h=b.glGetParameterInt(b.ELEMENT_ARRAY_BUFFER_BINDING,1),c=new Float32Array([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,1,0,0]),u=b.glCreateBuffer();b.glBindBuffer(b.ARRAY_BUFFER,u),b.glEnableVertexAttribArray(i),b.glVertexAttribPointer(i,2,b.FLOAT,!1,16,0),b.glVertexAttribPointer(r,2,b.FLOAT,!1,16,8),b.glBufferData(b.ARRAY_BUFFER,B(c),b.STATIC_DRAW);var l=new Uint16Array([0,1,2,0,2,3]),d=b.glCreateBuffer();b.glBindBuffer(b.ELEMENT_ARRAY_BUFFER,d),b.glBufferData(b.ELEMENT_ARRAY_BUFFER,B(l),b.STATIC_DRAW);var f=new BK.Buffer(t.width*t.height*4),_=b.glGetParameterInt(b.FRAMEBUFFER_BINDING,1),p=function(t,e){b.glActiveTexture(b.TEXTURE1);var i=b.glCreateTexture(),r=b.glGetParameterInt(b.TEXTURE_BINDING_2D,1);b.glBindTexture(b.TEXTURE_2D,i),b.glTexParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.glTexParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.glTexParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.glTexParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.glTexImage2D(b.TEXTURE_2D,0,b.RGBA,t,e,0,b.RGBA,b.UNSIGNED_BYTE,null);var o=b.glCreateFramebuffer();b.glBindFramebuffer(b.FRAMEBUFFER,o),b.glFramebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,i,0);var n=b.glCheckFramebufferStatus(b.FRAMEBUFFER);return n!=b.FRAMEBUFFER_COMPLETE&&BK.Script.log(1,-1,"_createFramebuffer!failed, status = "+n),b.glActiveTexture(b.TEXTURE1),b.glBindTexture(b.TEXTURE_2D,r),{tex:i,fbo:o}}(t.width,t.height);b.glClearColor(1,1,1,1),b.glClear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT|b.STENCIL_BUFFER_BIT),b.glDrawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0),b.glReadPixels(0,0,t.width,t.height,b.RGBA,b.UNSIGNED_BYTE,f),b.glBindFramebuffer(b.FRAMEBUFFER,_);for(var m=0,g=1;g<=10;g++){b.glUseProgram(g);var v=b.glGetAttribLocation(g,"Position"),S=b.glGetAttribLocation(g,"SourceColor"),y=b.glGetAttribLocation(g,"TexCoordIn");if(-1!=v&&-1!=S&&-1!=y){m=1;break}}return b.glBindBuffer(b.ARRAY_BUFFER,a),1==m?(b.glEnableVertexAttribArray(v),b.glEnableVertexAttribArray(S),b.glEnableVertexAttribArray(y),b.glVertexAttribPointer(v,3,b.FLOAT,!1,36,0),b.glVertexAttribPointer(S,4,b.FLOAT,!1,36,12),b.glVertexAttribPointer(y,2,b.FLOAT,!1,36,28)):(b.glEnableVertexAttribArray(0),b.glEnableVertexAttribArray(1),b.glEnableVertexAttribArray(2),b.glVertexAttribPointer(0,3,b.FLOAT,!1,36,0),b.glVertexAttribPointer(1,4,b.FLOAT,!1,36,12),b.glVertexAttribPointer(2,2,b.FLOAT,!1,36,28)),b.glBindBuffer(b.ELEMENT_ARRAY_BUFFER,h),b.glActiveTexture(b.TEXTURE0),b.glBindTexture(b.TEXTURE_2D,s),b.glDeleteProgram(e),b.glDeleteTexture(n),b.glDeleteTexture(p.tex),b.glDeleteFramebuffer(p.fbo),f}}BK.Misc.compQQVersion(GameStatusInfo.QQVer,"7.6.1")&&(this.bufferFromScreenShot_760=function(t,e,i,r,o){var n=b.glCreateTexture();b.glActiveTexture(b.TEXTURE1),b.glBindTexture(b.TEXTURE_2D,n),b.glTexParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.glTexParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.glTexParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.glTexParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.glTexImage2D(b.TEXTURE_2D,0,b.RGBA,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height,0,b.RGBA,b.UNSIGNED_BYTE,null);var s=b.glGetParameterInt(b.FRAMEBUFFER_BINDING,1),a=b.glGetParameterInt(b.RENDERBUFFER_BINDING,1),h=b.glCreateRenderbuffer();b.glBindRenderbuffer(b.RENDERBUFFER,h),b.glRenderbufferStorage(b.RENDERBUFFER,35056,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height),b.glBindRenderbuffer(b.RENDERBUFFER,a);var c,u=b.glCreateFramebuffer();b.glBindFramebuffer(b.FRAMEBUFFER,u),b.glFramebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,n,0),b.glFramebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,h),b.glFramebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,h);var l=b.glCheckFramebufferStatus(b.FRAMEBUFFER);return l==b.FRAMEBUFFER_COMPLETE?(BK.Render.render(t,0),c=new BK.Buffer(r*o*4),b.glReadPixels(e,i,r,o,b.RGBA,b.UNSIGNED_BYTE,c)):BK.Script.log(1,-1,"bufferFromScreenShot_760!framebuffer failed, code = "+l),b.glBindFramebuffer(b.FRAMEBUFFER,s),b.glDeleteTexture(n),b.glDeleteRenderbuffer(h),b.glDeleteFramebuffer(u),c})}this.isInScreen=function(){(null==this.origin.x||this.origin.x<0||this.origin.x>BK.Director.screenPixelSize.width)&&(this.origin.x=0),(null==this.origin.y||this.origin.y<0||this.origin.y>BK.Director.screenPixelSize.height)&&(this.origin.y=0),(null==this.size.width||this.size.width<=0||this.size.width>BK.Director.screenPixelSize.width-this.origin.x)&&(this.origin.x=0,this.size.width=BK.Director.screenPixelSize.width),(null==this.size.height||this.size.height<=0||this.size.height>BK.Director.screenPixelSize.height-this.origin.y)&&(this.origin.y=0,this.size.height=BK.Director.screenPixelSize.height)},this.isInNode=function(t){(null==this.origin.x||this.origin.x<0||this.origin.x>t.contentSize.width)&&(this.origin.x=0),(null==this.origin.y||this.origin.y<0||this.origin.y>t.contentSize.height)&&(this.origin.y=0),(null==this.size.width||this.size.width<=0)&&(this.size.width=t.contentSize.width),(null==this.size.height||this.size.height<=0)&&(this.size.height=t.contentSize.height)},this.saveImage=function(t,e,i){GameStatusInfo&&BK.Misc.compQQVersion(GameStatusInfo.QQVer,"7.6.1")?(t=this.doImage_rotate180({buffer:t,width:this.size.width,height:this.size.height}),BK.Image.saveImage(t,this.size.width,this.size.height,e,i)):BK.Image.saveImage(t,this.size.width,this.size.height,e,i,1)},this.shotToFile=function(t,e){this.isInScreen();var i="";if(this.bufferFromScreenShot_760){var r=this.bufferFromScreenShot_760(BK.Director.root,this.origin.x,this.origin.y,this.size.width,this.size.height);null!=r&&(i="GameSandBox://"+t,this.saveImage(r,i,e))}else{i="GameSandBox://"+t+"."+e;var o=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);BK.Render.renderToTexture(BK.Director.root,o),o.writeToDiskWithXY(i,this.origin.x,this.origin.y,this.size.width,this.size.height)}return i},this.shotToBuff=function(){if(this.isInScreen(),this.bufferFromScreenShot_760)return this.bufferFromScreenShot_760(BK.Director.root,this.origin.x,this.origin.y,this.size.width,this.size.height);var t=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);return BK.Render.renderToTexture(BK.Director.root,t),t.readPixels(this.origin.x,this.origin.y,this.size.width,this.size.height)},this.shotToFileFromNode=function(t,e,i){this.isInNode(t);var r="";if(this.bufferFromScreenShot_760){var o=this.bufferFromScreenShot_760(t,this.origin.x+t.position.x,this.origin.y+t.position.y,this.size.width,this.size.height);null!=o&&(r="GameSandBox://"+e,this.saveImage(o,r,i))}else{r="GameSandBox://"+e+"."+i;var n=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);BK.Render.renderToTexture(t,n),n.writeToDiskWithXY(r,this.origin.x+t.position.x,this.origin.y+t.position.y,this.size.width,this.size.height)}return r},this.shotToBuffFromNode=function(t){if(this.isInNode(t),this.bufferFromScreenShot_760)return this.bufferFromScreenShot_760(t,this.origin.x+t.position.x,this.origin.y+t.position.y,this.size.width,this.size.height);var e=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);return BK.Render.renderToTexture(t,e),e.readPixels(this.origin.x+t.position.x,this.origin.y+t.position.y,this.size.width,this.size.height)},this.shotToFileFromGL=function(t,r,o,n){BK.Notification.on("frame_final",this,function(){this.isInScreen();var t=new BK.WebGL,e="GameSandBox://"+r,i=new BK.Buffer(this.size.height*this.size.width*4);t.glReadPixels(this.origin.x,this.origin.y,this.size.width,this.size.height,6408,5121,i),this.saveImage(i,e,o),n&&n(e+"."+o)}.bind(this),!0)},this.shotToBuffFromGL=function(t,e){BK.Notification.on("frame_final",this,function(){this.isInScreen();var t=new BK.Buffer(this.size.height*this.size.width*4);(new BK.WebGL).glReadPixels(this.origin.x,this.origin.y,this.size.width,this.size.height,6408,5121,t),e&&e(t)}.bind(this),!0)}},function(t,e){"object"==typeof t&&(t.MQQ.Webview.openTransparent=e().openTransparent,t.MQQ.Webview.closeTransparent=e().closeTransparent,t.MQQ.Webview.sendMessageToWebView=e().sendMessageToWebView,t.MQQ.Webview.onMessageHandle=e().onMessageHandle)}(BK,function(){return{openTransparent:function(t,e,i){void 0===e&&(e=1);var r="cs.openWebViewWithoutUrl.local",o={url:t,gameOrientation:e,businessType:2};GameStatusInfo.devPlatform&&BK.Script.log(0,0,"BK.MQQ.Webview.openTransparent rely QQ.Call Failed!"),i&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,i)),BK.MQQ.SsoRequest.send(o,r)},closeTransparent:function(t){var e={taskId:t};BK.MQQ.SsoRequest.send(e,"cs.closeWebview.local")},sendMessageToWebView:function(t,e){var i={taskId:t,msg:e};BK.MQQ.SsoRequest.send(i,"cs.apolloGameTargetWebMessage.local")},onMessageHandle:function(r){BK.MQQ.SsoRequest.addListener("sc.web_callback_game.local",null,function(t,e,i){r&&r(e,i)})}}}),function(t,e){"object"==typeof t&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Audio=e())}(BK,function(){var o=BK.Audio,t=function(){function n(t,e,i){this.__nativeObj=new o(t,e,i),this._type=t,this.path=e,this._loopCount=i}return Object.defineProperty(n.prototype,"type",{set:function(t){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.setAudioParam("type",t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"musicPath",{set:function(t){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.setAudioParam("musicPath",t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loopCount",{set:function(t){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.setAudioParam("loopCount",t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentTime",{get:function(){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5"))return this.__nativeObj.currentTime},set:function(t){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.setAudioParam("currentTime",t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"volume",{get:function(){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5"))return this.__nativeObj.volume},set:function(t){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.setAudioParam("volume",t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"audioType",{set:function(t){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.setAudioParam("audioType",t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5"))return this.__nativeObj.duration},enumerable:!0,configurable:!0}),n.pauseAllBackground=function(){if(this.playingBackgrounds)for(var t=0;t<this.playingBackgrounds.length;t++){var e=this.playingBackgrounds[t];"string"!=typeof e.music&&e.music.pauseMusic()}},n.resumeAllBackground=function(){if(this.playingBackgrounds)for(var t=0;t<this.playingBackgrounds.length;t++){var e=this.playingBackgrounds[t];"string"!=typeof e.music?(e.music.resumeMusic(),BK.Script.log(0,0," music.resumeMusic not string")):(BK.Script.log(0,0," music.resumeMusic "+typeof e.music),o.playMusic(e.type,e.music,e.loop))}},n.removeBackgrounFromArray=function(t){if(this.playingBackgrounds){for(var e=0;e<n.playingBackgrounds.length;e++){n.playingBackgrounds[e].music}0}},n.addBackgroundToArray=function(t,e,i){var r={music:t,type:e,loop:i};void 0===this.playingBackgrounds&&(this.playingBackgrounds=[]);for(var o=0;o<n.playingBackgrounds.length;o++){n.playingBackgrounds[o].music}this.playingBackgrounds.push(r)},n.playMusic=function(t,e,i){var r=new o(t,e,i);r.startMusic(function(){}),0==t&&n.addBackgroundToArray(r,t,i)},n.prototype.startMusic=function(t){"ios"===GameStatusInfo.platform&&-1<GameStatusInfo.QQVer.indexOf("7.5.8")?o.playMusic(this._type,this.path,this._loopCount):(null!=t&&null!=t?this.__nativeObj.startMusic(t):this.__nativeObj.startMusic(),0==this._type&&n.addBackgroundToArray(this.__nativeObj,this._type,this._loopCount))},n.prototype.pauseMusic=function(){"ios"===GameStatusInfo.platform&&-1<GameStatusInfo.QQVer.indexOf("7.5.8")||(this.__nativeObj.pauseMusic(),0==this._type&&n.removeBackgrounFromArray(this.__nativeObj))},n.prototype.resumeMusic=function(){"ios"===GameStatusInfo.platform&&-1<GameStatusInfo.QQVer.indexOf("7.5.8")||(this.__nativeObj.resumeMusic(),0==this._type&&n.addBackgroundToArray(this.__nativeObj,this._type,this._loopCount))},n.prototype.stopMusic=function(){"ios"===GameStatusInfo.platform&&-1<GameStatusInfo.QQVer.indexOf("7.5.8")||(0==this._type&&n.removeBackgrounFromArray(this.__nativeObj),this.__nativeObj.stopMusic())},n.prototype.seekTo=function(t){1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")&&this.__nativeObj.seekTo(t)},n}();return Object.defineProperty(t,"switch",{get:function(){return o.switch},set:function(t){o.switch=t},enumerable:!0,configurable:!0}),t}),BK.MQQ&&BK.MQQ.Account){var I="GameSandBox://_head/";BK.FileUtil.isFileExist(I)||BK.FileUtil.makeDir(I),BK.MQQ.Account.getHeadEx||(BK.MQQ.Account.getHeadEx=function(n,s){BK.MQQ.Account.getHead(n,function(t,e){if(e&&e.buffer&&e.width&&e.height)if(BK.Image.saveImage)BK.Image.saveImage(e.buffer,e.width,e.height,I+t,"jpg"),s(t,I+t+".jpg");else{var i=new BK.Texture(e.buffer,e.width,e.height),r=new BK.Sprite(e.width,e.height,i,0,0,1,1),o=new BK.RenderTexture(e.width,e.height);BK.Render.renderToTexture(r.__nativeObj?r.__nativeObj:r,o),o.saveTo(I+t),s(n,I+t)}else s(n,"")})}),BK.MQQ.Account.getUserInfo=function(r){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")){var t="cs.get_user_info.local";r&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,e,i){r(t,i)}),BK.MQQ.SsoRequest.send(null,t))}else r(-1,null)},BK.MQQ.Account.getFriends=function(r){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")){var t="cs.get_app_friends.local";r&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,e,i){r(t,i)}),BK.MQQ.SsoRequest.send(null,t))}else r(-1,null)},BK.MQQ.Account.getLocation=function(r){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")){var t="cs.get_location.local";r&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,e,i){r(t,i)}),BK.MQQ.SsoRequest.send(null,t))}else r(-1,null)},BK.MQQ.Account.getCity=function(r){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")){var t="cs.get_city.local";r&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,e,i){r(t,i)}),BK.MQQ.SsoRequest.send(null,t))}else r(-1,null)},BK.MQQ.Account.preloadUserInfoList=function(t,r){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")){var e="cs.preload_userInfoList.local";if(r){var i={openIdList:t};BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,function(t,e,i){r(t)}),BK.MQQ.SsoRequest.send(i,e)}}else r(-1)},BK.MQQ.Account.queryNick=function(t,e,i,r,o){var n=new BK.QQNickCanvas(t,e,i,r,function(t,e){o(n.__nativeObj,e)})},BK.MQQ.Account.queryHead=function(t,e,i,r,o){var n=new BK.QQAvatarCanvas(t,e,i,r,null,function(t,e){o(n.__nativeObj,e)})},BK.MQQ.Account.login=function(r){if(1!=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")){var t="cs.xy_login.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,e,i){i&&i.type&&("complete"==i.type&&r&&r.complete&&r.complete(i),"unauthorized"==i.type&&r&&r.fail&&r.fail(i),"failure"==i.type&&r&&r.fail&&r.fail(i),"success"==i.type&&r&&r.success&&r.success(i))}),BK.MQQ.SsoRequest.send(null,t)}else r&&r.fail&&r.fail({ret:1,type:"verionErr"})}}BK.Misc.compQQVersion||(BK.Misc.compQQVersion=function(t,e){for(var i=t.split("."),r=e.split("."),o=Math.min(3,Math.min(i.length,r.length)),n=0;n<o;n++)if(i[n]!=r[n])return i[n]<r[n];return!0},BK.Misc.qqVerLessthan=function(t,e){for(var i=t.split("."),r=e.split("."),o=Math.min(3,Math.min(i.length,r.length)),n=0;n<o;n++){if(i[n]<r[n])return!0;if(i[n]>r[n])return!1}return!1}),function(t,e){var i,r,o;"object"==typeof t&&(t.TouchEventDispatch=(i=BK.TouchEvent.getAllTouchEvent,r=BK.TouchEvent.getTouchEvent,o=BK.TouchEvent.updateTouchStatus,{TouchEventDispatch:function(){function t(){}return t.listenAllTouch=function(t,e){void 0===this.listenerInfos&&(this.listenerInfos=[]);var i={obj:t,callback:e};this.listenerInfos.push(i)},t.remove=function(t){for(var e=-1,i=this.listenerInfos.length,r=0;r<i;r++){var o=this.listenerInfos[r];o.obj==t&&(e=r)}-1!=e&&this.listenerInfos.splice(e,1)},t.dispatch=function(e){e&&this.listenerInfos.forEach(function(t){t.callback(e)})},t.getTouchEvent=function(){var t=r();return t&&this.dispatch([t]),t},t.getAllTouchEvent=function(){var t=i();return t&&this.dispatch(t),t},t.updateTouchStatus=function(){o()},t.listenerInfos=[],t}()}).TouchEventDispatch)}(BK),BK.TouchEvent=function(){function t(){}return t.getTouchEvent=function(){return BK.TouchEventDispatch.getTouchEvent()},t.getAllTouchEvent=function(){return BK.TouchEventDispatch.getAllTouchEvent()},t.updateTouchStatus=function(){BK.TouchEventDispatch.updateTouchStatus()},t}(),function(i,t){var r=!1,o=function(){};BK.Notification=new BK.Emitter;var n=i._tickerCallback_;i._tickerCallback_=function(t,e){try{i.gl&&0==r&&(r=!0,function(){this.__gl=bkWebGLGetInstance(),this.__oldGlCommit=this.__gl.glCommit,this.__gl.glCommit=o,this.__gl.__oldGlCommit=this.__oldGlCommit,o.bind(this.__gl)}()),n(t,e),i.gl&&i.gl.__oldGlCommit()}catch(t){}BK.Notification.emitAll("frame_final",{})}}(this),function(e,t){var i=void 0;function r(t){i&&i(t.message?t.message:t,t.stack),e.Script&&e.Script.onerror&&e.Script.onerror(t)}t.Script.setErrorObserver=function(t){i=t},e._globalErrorCallback_=r,t.MQQ.SsoRequest.addListener("cs.xy_error_info.local",this,function(t,e,i){r(i.data)})}(this,BK),function(t,r){if(GameStatusInfo&&"xcode"!==GameStatusInfo.devPlatform){var e=GameStatusInfo.QQVer.split(".");if(Number(e[0])<7||7==Number(e[0])&&Number(e[1])<7||7==Number(e[0])&&7==Number(e[1])&&Number(e[2])<5)r.Script.log(1,0,"775 \u4ee5\u4e0b\u624bq \u7248\u672c");else{var i=r.FileUtil.readFile("GameRes://gameConfig.json");if(i){var a=JSON.parse(i.readAsString(!0));a&&a.subpackages&&(r.Script.innerLoadLib=r.Script.loadlib,r.Script.loadlib=function(i){var t=function(t){var e="GameRes://";if(!(t.indexOf(e)<0)){var i=t.substring(e.length,t.length),r=i.indexOf("/");if(!(r<0)){var o=i.substring(0,r);if(o&&""!=o)for(var n in a.subpackages){var s=a.subpackages[n];if(s&&s.root&&s.root===o&&s.name)return s.name}}}}(i);t?r.QQ.checkPakcage(t,function(t,e){0==e?r.Script.innerLoadLib(i):r.Script.log(1,1,"\u7ec8\u7aef\u6821\u9a8c\u5b50\u5305\u5b8c\u6574\u6027\u5931\u8d25 pack:"+t+"  code:"+e)}):r.Script.innerLoadLib(i)})}}}else r.Script.log(1,0,"Xcode \u73af\u5883")}(0,BK),function(t,e){if(BK.Notification){BK.MQQ.SsoRequest.addListener("sc.game_enter_background.local",null,function(){BK.Notification.emitAll("game_enter_background",{})}.bind(this)),BK.MQQ.SsoRequest.addListener("sc.game_enter_foreground.local",null,function(){BK.Notification.emitAll("game_enter_foreground",{})}.bind(this)),BK.MQQ.SsoRequest.addListener("sc.game_maximize.local",null,function(){BK.Notification.emitAll("game_maximize",{})}.bind(this)),BK.MQQ.SsoRequest.addListener("sc.game_minimize.local",null,function(){BK.Notification.emitAll("game_minimize",{})}.bind(this)),BK.MQQ.SsoRequest.addListener("sc.game_shell_pack_up.local",null,function(){BK.Notification.emitAll("game_pack_up",{})}.bind(this)),BK.MQQ.SsoRequest.addListener("sc.game_shell_close.local",null,function(){BK.Notification.emitAll("game_close",{}),o?BK.MQQ.SsoRequest.sendTo({},"cs.close_room.local"):BK.MQQ.SsoRequest.send({},"cs.close_room.local")}.bind(this)),BK.MQQ.SsoRequest.addListener("sc.network_change.local",null,function(t,e,i){void 0===i.type?BK.Script.log(1,1,"net work change .data is worng!"):BK.Notification.emitAll("game_network_change",i.type)}.bind(this))}}(),BK.FileUtil.upload=function(){function h(t,e,i){for(var r=1024<t.length?1024:t.length,o=new Uint8Array(r),n=0;n<r/2;n++)o[n]=t.readUint8Buffer();t.jumpBytes(t.length-r);for(var n=r/2;n<r;n++)o[n]=t.readUint8Buffer();t.rewind();var s=new Date,a=s.getFullYear()+(s.getMonth()+1<10?0+(s.getMonth()+1):s.getMonth()+1)+s.getDate(),h=e.signTime,c=e.tmpSecretId,u=e.sessionToken,l="/"+GameStatusInfo.gameId+"_"+BK.Crypt.bin2hex(BK.Crypt.core_md5(o,r))+GameStatusInfo.gameId+"_"+a+".png",d=e.upLoadPrefUrl.replace(new RegExp("http://","gm"),""),f=e.downloadUrl,_=e.signature,p="put\n"+l+"\n\nhost="+d+"&x-cos-storage-class=nearline\n",m="sha1\n"+h+"\n"+BK.Crypt.hex_sha1(p)+"\n",g=BK.Crypt.hex_hmac_sha1(_,m),v="q-sign-algorithm=sha1&q-ak="+c+"&q-sign-time="+h+"&q-key-time="+h+"&q-header-list=host;x-cos-storage-class&q-url-param-list=&q-signature="+g,S=new BK.HttpUtil("https://"+d+l);S.setHttpMethod("put"),S.setHttpHeader("host",d),S.setHttpHeader("x-cos-storage-class","nearline"),S.setHttpHeader("x-cos-security-token",u),S.setHttpHeader("authorization",v),S.setBodyCompatible(!1),S.setHttpRawBody(t),S.requestAsync(function(t,e){i(e,f+l)})}return BK.FileUtil.uploadFromFile=function(t,e){var i=BK.FileUtil.readFile(t);i&&0<i.length?BK.FileUtil.uploadFromBuff(i,e):(BK.Script.log(1,1,"uploadFromFile failed.file is empty!"),e(-1,""))},BK.FileUtil.uploadFromBuff=function(i,r){BK.QQ.queryCloudSignature(function(t,e){h(i,e,r)})},BK.FileUtil.uploadFromNode=function(t,i){var e=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);BK.Render.renderToTexture(t,e),e.writeToDiskWithXY("GameSandBox://temp.png",t.position.x,t.position.y,t.contentSize.width,t.contentSize.height);var r=BK.FileUtil.readFile("GameSandBox://temp.png");BK.QQ.queryCloudSignature(function(t,e){h(r,e,i)})},BK.FileUtil.uploadNode=function(t,e,i,r,o,n){var s=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);BK.Render.renderToTexture(t,s),s.writeToDiskWithXY("GameSandBox://temp.png",e,i,r,o);var a=BK.FileUtil.readFile("GameSandBox://temp.png");BK.QQ.queryCloudSignature(function(t,e){h(a,e,n)})},h}(),BK.QQ.shareToArkFromFile=function(i,r,o,t){BK.FileUtil.uploadFromFile(t,function(t,e){BK.QQ.shareToArk(i,r,e,!0,o)})},BK.QQ.shareToArkFromBuff=function(i,r,o,t){BK.FileUtil.uploadFromBuff(t,function(t,e){200==t&&BK.QQ.shareToArk(i,r,e,!0,o)})},BK.QQ.shareToArkFromNode=function(i,r,o,t){BK.FileUtil.uploadFromNode(t,function(t,e){200==t&&BK.QQ.shareToArk(i,r,e,!0,o)})},BK.QQ.shareToArkFromGLShot=function(i,r,o,t){var e=new BK.ScreenShot;e.origin={x:t.x,y:t.y},e.size={width:t.width,height:t.height};var n="GameSandBox://"+BK.Time.timestamp;e.shotToFileFromGL(void 0,n,"png",function(t){BK.FileUtil.uploadFromFile(t,function(t,e){200==t&&BK.QQ.shareToArk(i,r,e,!0,o),BK.FileUtil.isFileExist(n)&&BK.FileUtil.deleteFile(n)})})},function(t,e){"object"==typeof t&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.UIEventHandler=e())}(this,function(){return new function(){this.eveFuncTb=[],this._eventMap={1:[],2:[],3:[]},this.rootNode=BK.Director.root,this.nodeTreeHittest=function(t,e){if(1==t.canUserInteract&&0==t.hidden){if(t.children)for(var i=t.children,r=i.length-1;0<=r;r--){var o=i[r],n=this.nodeTreeHittest(o,e);if(null!=n)return n}return 1==t.hittest(e)?t:void 0}},this.treeHittest=function(t){return this.nodeTreeHittest(this.rootNode,t)},this.setRootNode=function(t){this.rootNode=t},this.addNodeEvent=function(t,e,i){var r={};r.obj=t,r.func=i;for(var o=!1,n=0;n<this._eventMap[e].length;n++)this._eventMap[e][n].obj==t&&(o=!0);0==o?this._eventMap[e].push(r):BK.Script.log(1,0,"Add Same Node Event has added Event Before.")},this.removeNodeEvent=function(t,e){for(var i=-1,r=0;r<this._eventMap[e].length;r++)this._eventMap[e][r].obj==t&&(i=r);0<=i&&(this._eventMap[e].splice(i,1),BK.Script.log(1,0,"Remove Node Event Succeed!"))},this.triggerEvent=function(t,e,i,r){for(var o=0;o<this._eventMap[e].length;o++){var n=this._eventMap[e][o];if(t&&n.obj==t){var s=n.func;s&&s(t,e,i,r)}}},this.triggerAllNodeEvent=function(t){for(var e=0;e<this._eventMap[t].length;e++){var i=this._eventMap[t][e],r=i.func,o=i.obj;r&&r(o,t)}},this.isFirstTouchDown=-1,this.currentNode=void 0,this.touchUpdate=function(t){if(null!=t)for(var e=0;e<t.length;e++)for(var i=t[e],r=0;r<i.length;r++){var o=i[r].x,n=i[r].y;if(2==i[r].status)if(-1==this.isFirstTouchDown){this.isFirstTouchDown=i[r].id;var s=this.treeHittest({x:o,y:n});s?(this.currentNode=s,this.triggerEvent(this.currentNode,1,o,n)):this.currentNode=void 0}else BK.Script.log(0,0,"detectGesture begin not first id:"+i[r].id+" x:"+o+" y:"+n);else 3==i[r].status?-1!=this.isFirstTouchDown&&i[r].id==this.isFirstTouchDown?this.currentNode&&this.triggerEvent(this.currentNode,2,o,n):BK.Script.log(0,0,"detectGesture moved! Failed touchArr[i].id = "+i[r].id):1==i[r].status&&(-1!=this.isFirstTouchDown&&i[r].id==this.isFirstTouchDown?(this.isFirstTouchDown=-1,this.currentNode&&(this.triggerEvent(this.currentNode,3,o,n),this.currentNode=void 0)):BK.Script.log(0,0,"detectGesture end!!!Failed!!! touchArr[i].id= "+i[r].id+" this.isFirstTouchDown:"+this.isFirstTouchDown))}},this.detectGesture=function(){var t=BK.TouchEvent.getAllTouchEvent();this.touchUpdate(t),BK.TouchEvent.updateTouchStatus()},"function"==typeof BK.TouchEventDispatch?BK.TouchEventDispatch.listenAllTouch(this,this.touchUpdate.bind(this)):BK.Director.ticker.add(function(t,e){this&&this.detectGesture()}.bind(this))}}),function(t,e){"object"==typeof t&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Button=e())}(BK,function(){function t(t,e,i,r){this.touchStatus=0,this.normalTexture=void 0,this.pressTexture=void 0,this.disableTexture=void 0,this.normalTextureOffset={frame:{x:0,y:0,w:0,h:0},rotated:!1},this.pressTextureOffset={frame:{x:0,y:0,w:0,h:0},rotated:!1},this.disableTextureOffset={frame:{x:0,y:0,w:0,h:0},rotated:!1},this.touchInsideCallback=void 0,i?(this.normalTexture=new BK.Texture(i),this.normalTexture&&(this.normalTextureOffset.frame.x=0,this.normalTextureOffset.frame.y=0,this.normalTextureOffset.frame.w=this.normalTexture.size.width,this.normalTextureOffset.frame.h=this.normalTexture.size.height,this.normalTextureOffset.rotated=!1)):this.normalTexture={},r&&(this.touchInsideCallback=r),this.__nativeObj=new BK.Sprite(t,e,this.normalTexture,0,1,1,1);try{Object.getOwnPropertyNames(this.__nativeObj).forEach(function(t){var e=t;Object.defineProperty(this,e,{get:function(){return this.__nativeObj[e]},set:function(t){this.__nativeObj[e]=t}})},this)}catch(t){BK.Script.log(1,1," error :"+t)}this.enable=!0,Object.defineProperty(this,"disable",{get:function(){return!this.enable},set:function(t){1==t?this.updateTexture(2):this.updateTexture(0),this.enable=!t}}),this.updateTexture=function(t){if(0==t){if(this.normalTexture){this.__nativeObj.setTexture(this.normalTexture);var e=this.normalTextureOffset;this.__nativeObj.adjustTexturePosition(e.frame.x,e.frame.y,e.frame.w,e.frame.h,e.rotated)}}else if(1==t){if(this.pressTexture){this.__nativeObj.setTexture(this.pressTexture);e=this.pressTextureOffset;this.__nativeObj.adjustTexturePosition(e.frame.x,e.frame.y,e.frame.w,e.frame.h,e.rotated)}}else if(2==t&&this.disableTexture){this.__nativeObj.setTexture(this.disableTexture);e=this.disableTextureOffset;this.__nativeObj.adjustTexturePosition(e.frame.x,e.frame.y,e.frame.w,e.frame.h,e.rotated)}},this.changeStatus=function(t){this.touchStatus=t,this.updateTexture(this.touchStatus)},this.updateStatus=function(){this.updateTexture(this.touchStatus)},this.changeStatus(0),this.isCancelClick=void 0,UIEventHandler.addNodeEvent(this,1,function(t,e,i,r){t.isCancelClick=!1,t.enable?t.changeStatus(1):t.changeStatus(2)}),UIEventHandler.addNodeEvent(this,2,function(t,e,i,r){var o={x:i,y:r};0==t.hittest(o)&&(t.isCancelClick=!0)}),UIEventHandler.addNodeEvent(this,3,function(t,e,i,r){t.enable?t.changeStatus(0):t.changeStatus(2),0==t.isCancelClick&&t.touchInsideCallback&&t.touchInsideCallback(t)}),this.canUserInteract=!0}return t.prototype.setTouchInsideCallback=function(t){this.touchInsideCallback=t},t.prototype.setNormalTexturePath=function(t){var e=new BK.Texture(t);e&&this.setNormalTexture(e)},t.prototype.setPressTexturePath=function(t){var e=new BK.Texture(t);e&&this.setPressTexture(e)},t.prototype.setDisableTexturePath=function(t){var e=new BK.Texture(t);e&&this.setDisableTexture(e)},t.prototype.setNormalTexture=function(t){this.normalTexture=t,this.normalTexture&&(this.normalTextureOffset.frame.x=0,this.normalTextureOffset.frame.y=0,this.normalTextureOffset.frame.w=this.normalTexture.size.width,this.normalTextureOffset.frame.h=this.normalTexture.size.height,this.normalTextureOffset.rotated=!1),this.updateStatus()},t.prototype.setPressTexture=function(t){this.pressTexture=t,this.pressTexture&&(this.pressTextureOffset.frame.x=0,this.pressTextureOffset.frame.y=0,this.pressTextureOffset.frame.w=this.pressTexture.size.width,this.pressTextureOffset.frame.h=this.pressTexture.size.height,this.pressTextureOffset.rotated=!1),this.updateStatus()},t.prototype.setDisableTexture=function(t){this.disableTexture=t,this.disableTexture&&(this.disableTextureOffset.frame.x=0,this.disableTextureOffset.frame.y=0,this.disableTextureOffset.frame.w=this.disableTexture.size.width,this.disableTextureOffset.frame.h=this.disableTexture.size.height,this.disableTextureOffset.rotated=!1),this.updateStatus()},t.prototype.setNormalTextureFromSheetInfo=function(t){if(t){var e=new BK.Texture(t.texturePath);e?(this.normalTexture=e,this.normalTextureOffset=t.frameInfo,this.updateStatus()):BK.Script.log(0,0,"setNormalTextureFromSheetInfo error! Create texture failed.")}else BK.Script.log(0,0,"setNormalTextureFromSheetInfo error! textureFrameInfo is null or undefined")},t.prototype.setPressTextureFromSheetInfo=function(t){if(t){var e=new BK.Texture(t.texturePath);e?(this.pressTexture=e,this.pressTextureOffset=t.frameInfo,this.updateStatus()):BK.Script.log(0,0,"setPressTextureFromSheetInfo error! Create texture failed.")}else BK.Script.log(0,0,"setPressTextureFromSheetInfo error! textureFrameInfo is null or undefined")},t.prototype.setDisableTextureFromSheetInfo=function(t){if(t){var e=new BK.Texture(t.texturePath);e?(this.disableTexture=e,this.disableTextureOffset=t.frameInfo,this.updateStatus()):BK.Script.log(0,0,"setDisableTextureFromSheetInfo error! Create texture failed.")}else BK.Script.log(0,0,"setDisableTextureFromSheetInfo error! textureFrameInfo is null or undefined")},t.prototype.hittest=function(t){return this.__nativeObj.hittest(t)},t.prototype.addChild=function(t){this.__nativeObj.addChild(t)},t.prototype.attach=function(t){this.__nativeObj.attach(t)},t.prototype.dispose=function(){this.__nativeObj.dispose()},t.prototype.setTexture=function(t){this.__nativeObj.setTexture(t)},t.prototype.removeFromParent=function(){this.__nativeObj.removeFromParent()},t.prototype.setNormalTextureFromUrl=function(t,o){this.normalUrl=t,new BK.HttpUtil(this.normalUrl).requestAsync(function(t,e){if(200==e){var i="GameSandBox://btntmp/"+this.normalUrl;BK.FileUtil.writeBufferToFile(i,t);var r=new BK.Texture(i);this.setNormalTexture(r)}else BK.Script.log(1,1,"Fetch advertisemSent image failed.");o&&o(this,e)}.bind(this))},t.prototype.setPressTextureFromUrl=function(t,o){this.pressUrl=t,new BK.HttpUtil(this.pressUrl).requestAsync(function(t,e){if(200==e){var i="GameSandBox://btntmp/"+this.pressUrl;BK.FileUtil.writeBufferToFile(i,t);var r=new BK.Texture(i);this.setPressTexture(r)}else BK.Script.log(1,1,"Fetch advertisement image failed.");o&&o(this,e)}.bind(this))},t.prototype.setDisableTextureFromUrl=function(t,o){this.disableUrl=t,new BK.HttpUtil(this.disableUrl).requestAsync(function(t,e){if(200==e){var i="GameSandBox://btntmp/"+this.disableUrl;BK.FileUtil.writeBufferToFile(i,t);var r=new BK.Texture(i);this.setDisableTexture(r)}else BK.Script.log(1,1,"Fetch advertisement image failed.");o&&o(this,e)}.bind(this))},t}),function(t,e){if("object"==typeof t){var i=function(){function _(t){return.01745329251994*t}return{Matrix:function(){function f(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.data=new Float32Array(16),arguments.length){if(1==arguments.length){if(arguments[0]instanceof f==1)for(var i=0;i<16;i++)this.data[i]=arguments[0].data[i]}else if(16==arguments.length)for(var i=0;i<16;i++)this.data[i]=arguments[i]}else this.data[0]=1,this.data[5]=1,this.data[10]=1,this.data[15]=1}return f.prototype.clone=function(){return new f(this)},f.prototype.mul=function(t){var e=this.data[0],i=this.data[1],r=this.data[2],o=this.data[3],n=this.data[4],s=this.data[5],a=this.data[6],h=this.data[7],c=this.data[8],u=this.data[9],l=this.data[10],d=this.data[11],f=this.data[12],_=this.data[13],p=this.data[14],m=this.data[15],g=t.data[0],v=t.data[1],S=t.data[2],y=t.data[3],B=t.data[4],b=t.data[5],T=t.data[6],E=t.data[7],C=t.data[8],R=t.data[9],I=t.data[10],A=t.data[11],O=t.data[12],x=t.data[13],M=t.data[14],w=t.data[15];return this.data[0]=e*g+n*v+c*S+f*y,this.data[1]=i*g+s*v+u*S+_*y,this.data[2]=r*g+a*v+l*S+p*y,this.data[3]=o*g+h*v+d*S+m*y,this.data[4]=e*B+n*b+c*T+f*E,this.data[5]=i*B+s*b+u*T+_*E,this.data[6]=r*B+a*b+l*T+p*E,this.data[7]=o*B+h*b+d*T+m*E,this.data[8]=e*C+n*R+c*I+f*A,this.data[9]=i*C+s*R+u*I+_*A,this.data[10]=r*C+a*R+l*I+p*A,this.data[11]=o*C+h*R+d*I+m*A,this.data[12]=e*O+n*x+c*M+f*w,this.data[13]=i*O+s*x+u*M+_*w,this.data[14]=r*O+a*x+l*M+p*w,this.data[15]=o*O+h*x+d*M+m*w,this},f.prototype.mulPoint=function(t){var e=this.data[0],i=this.data[1],r=this.data[2],o=this.data[3],n=this.data[4],s=this.data[5],a=this.data[6],h=this.data[7],c=this.data[8],u=this.data[9],l=this.data[10],d=this.data[11],f=this.data[12],_=this.data[13],p=this.data[14],m=this.data[15];void 0===t.z&&(t.z=0);var g={x:0,y:0,z:0};g.x=e*t.x+n*t.y+c*t.z+f,g.y=i*t.x+s*t.y+u*t.z+_,g.z=r*t.x+a*t.y+l*t.z+p;t.x,t.y,t.z;return g},f.prototype.inverse=function(){var t=this.data[10]*this.data[15]-this.data[14]*this.data[11],e=this.data[6]*this.data[15]-this.data[14]*this.data[7],i=this.data[6]*this.data[11]-this.data[10]*this.data[7],r=this.data[2]*this.data[15]-this.data[14]*this.data[3],o=this.data[2]*this.data[11]-this.data[10]*this.data[3],n=this.data[2]*this.data[7]-this.data[6]*this.data[3],s=this.data[9]*this.data[15]-this.data[13]*this.data[11],a=this.data[5]*this.data[15]-this.data[13]*this.data[7],h=this.data[5]*this.data[11]-this.data[9]*this.data[7],c=this.data[1]*this.data[15]-this.data[13]*this.data[3],u=this.data[1]*this.data[11]-this.data[9]*this.data[3],l=this.data[1]*this.data[7]-this.data[5]*this.data[3],d=this.data[9]*this.data[14]-this.data[13]*this.data[10],f=this.data[5]*this.data[14]-this.data[13]*this.data[6],_=this.data[5]*this.data[10]-this.data[9]*this.data[6],p=this.data[1]*this.data[14]-this.data[13]*this.data[2],m=this.data[1]*this.data[10]-this.data[9]*this.data[2],g=this.data[1]*this.data[6]-this.data[5]*this.data[2],v=this.data[5]*t-this.data[9]*e+this.data[13]*i,S=this.data[9]*r-this.data[1]*t-this.data[13]*o,y=this.data[1]*e-this.data[5]*r+this.data[13]*n,B=this.data[5]*o-this.data[1]*i-this.data[9]*n,b=this.data[8]*e-this.data[4]*t-this.data[12]*i,T=this.data[0]*t-this.data[8]*r+this.data[12]*o,E=this.data[4]*r-this.data[0]*e-this.data[12]*n,C=this.data[0]*i-this.data[4]*o+this.data[8]*n,R=this.data[4]*s-this.data[8]*a+this.data[12]*h,I=this.data[8]*c-this.data[0]*s-this.data[12]*u,A=this.data[0]*a-this.data[4]*c+this.data[12]*l,O=this.data[4]*u-this.data[0]*h-this.data[8]*l,x=this.data[8]*f-this.data[4]*d-this.data[12]*_,M=this.data[0]*d-this.data[8]*p+this.data[12]*m,w=this.data[4]*p-this.data[0]*f-this.data[12]*g,K=this.data[0]*_-this.data[4]*m+this.data[8]*g,P=this.data[0]*v+this.data[1]*b+this.data[2]*R+this.data[3]*x;return 0!=P&&(this.data[0]=v/P,this.data[4]=b/P,this.data[8]=R/P,this.data[12]=x/P,this.data[1]=S/P,this.data[5]=T/P,this.data[9]=I/P,this.data[13]=M/P,this.data[2]=y/P,this.data[6]=E/P,this.data[10]=A/P,this.data[14]=w/P,this.data[3]=B/P,this.data[7]=C/P,this.data[11]=O/P,this.data[15]=K/P),this},f.prototype.scale=function(t,e,i){var r=f.fromScale(t,e,i);return this.mul(r)},f.prototype.rotate=function(t,e,i){var r=f.fromEulerAngle(t,e,i);return this.mul(r)},f.prototype.translate=function(t,e,i){var r=f.fromTranslate(t,e,i);return this.mul(r)},f.prototype.transform=function(t,e,i){var r=t*this.data[0]+e*this.data[4]+i*this.data[8]+1*this.data[12],o=t*this.data[1]+e*this.data[5]+i*this.data[9]+1*this.data[13],n=t*this.data[2]+e*this.data[6]+i*this.data[10]+1*this.data[14];return{x:r,y:o,z:n}},f.prototype.toEulerAngle=function(){var t=0,e=0,i=0,r=this.data[0],o=this.data[4],n=this.data[8],s=this.data[5],a=this.data[2],h=this.data[6],c=this.data[10],u=-h;e=u<=-1?-1.570796:1<=u?1.570796:Math.asin(u),.9999<Math.abs(u)?(i=0,t=Math.atan2(-n,r)):(t=Math.atan2(a,c),i=Math.atan2(o,s));var l=new Float32Array(3);return l[0]=e,l[1]=t,l[2]=i,l},f.fromScale=function(t,e,i){var r=new f;return r.data[0]=t,r.data[5]=e,r.data[10]=i,r},f.fromTranslate=function(t,e,i){var r=new f;return r.data[12]=t,r.data[13]=e,r.data[14]=i,r},f.fromEulerAngle=function(t,e,i){var r=-_(t),o=-_(e),n=-_(i),s=Math.cos(r),a=Math.sin(r),h=Math.cos(o),c=Math.sin(o),u=Math.cos(n),l=Math.sin(n),d=new f(s*u+a*c*l,-s*l+a*c*u,a*h,0,l*h,u*h,-c,0,-a*u+s*c*l,l*a+s*c*u,s*h,0,0,0,0,1);return d},f.fromViewport=function(t,e,i,r,o,n){var s=new f;return s.data[0]=(e-t)/2,s.data[5]=(r-i)/2,s.data[10]=(n-o)/2,s.data[12]=(t+e)/2,s.data[13]=(r+i)/2,s.data[14]=(o+n)/2,s.data[15]=1,s},f.fromOrthographic=function(t,e,i,r,o,n){var s=new f;return s.data[0]=2/(e-t),s.data[5]=2/(r-i),s.data[10]=2/(o-n),s.data[12]=(t+e)/(t-e),s.data[13]=(r+i)/(i-r),s.data[14]=(o+n)/(o-n),s.data[15]=1,s},f}()}}();t.JSMatrix=i.Matrix}}(BK),function(t,e){"object"==typeof t&&(t.JSTransform=function(){function i(t){if(null==t)this.transform=new Float32Array(19),this.transform[2]=1,this.transform[3]=1,this.transform[4]=1,this._localAnchorOrPivot=void 0,this._parentAnchorOrPivot=void 0,this._needUpdate=!0;else{if(t instanceof i!=1)throw new Error("BK.Transform.constructor!paramater error");this.transform=new Float32Array(19),this._localAnchorOrPivot=t._localAnchorOrPivot,this._parentAnchorOrPivot=t._parentAnchorOrPivot,this._needUpdate=t._needUpdate;for(var e=0;e<19;e++)this.transform[e]=t.transform[e]}this.matrix={get:function(){return null},set:function(t,e,i,r,o,n){this._needUpdate=!0,this.transform[2]=t,this.transform[3]=r,this.transform[4]=1,this.transform[5]=i,this.transform[6]=e,this.transform[7]=0,this.transform[8]=o,this.transform[9]=n,this.transform[10]=0}}}return Object.defineProperty(i.prototype,"needUpdate",{get:function(){return this._needUpdate},set:function(t){this._needUpdate=t},enumerable:!0,configurable:!0}),i.prototype.getNeedUpdate=function(){return this._needUpdate},i.prototype.setNeedUpdate=function(t){this._needUpdate=t},Object.defineProperty(i.prototype,"scale",{get:function(){return{x:this.transform[2],y:this.transform[3],z:this.transform[4]}},set:function(t){this.transform[2]==t.x&&this.transform[3]==t.y&&this.transform[4]==t.z||(this._needUpdate=!0,this.transform[2]=null==t.x?1:t.x,this.transform[3]=null==t.y?1:t.y,this.transform[4]=null==t.z?1:t.z)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return{x:this.transform[5],y:this.transform[6],z:this.transform[7]}},set:function(t){this.transform[5]==t.x&&this.transform[6]==t.y&&this.transform[7]==t.z||(this._needUpdate=!0,this.transform[5]=null==t.x?0:t.x,this.transform[6]=null==t.y?0:t.y,this.transform[7]=null==t.z?0:t.z)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return{x:this.transform[8],y:this.transform[9],z:this.transform[10]}},set:function(t){this.transform[8]==t.x&&this.transform[9]==t.y&&this.transform[10]==t.z||(this._needUpdate=!0,this.transform[8]=null==t.x?0:t.x,this.transform[9]=null==t.y?0:t.y,this.transform[10]=null==t.z?0:t.z)},enumerable:!0,configurable:!0}),i.prototype.getPosition=function(){return{x:this.transform[8],y:this.transform[9],z:this.transform[10]}},i.prototype.setPosition=function(t,e,i){this.transform[8]==t&&this.transform[9]==e&&this.transform[10]==i||(this._needUpdate=!0,this.transform[8]=null==t?0:t,this.transform[9]=null==e?0:e,this.transform[10]=null==i?0:i)},Object.defineProperty(i.prototype,"localPivot",{get:function(){if(null!=this._localAnchorOrPivot&&0!=this._localAnchorOrPivot)throw new Error("BK.Transform.localPivot!current mode is localAnchor!!");return this._localAnchorOrPivot=0,{x:this.transform[11],y:this.transform[12]}},set:function(t){0==this._localAnchorOrPivot&&this.transform[11]==t.x&&this.transform[12]==t.y||(this._needUpdate=!0,this._localAnchorOrPivot=0,this.transform[11]=null==t.x?0:t.x,this.transform[12]=null==t.y?0:t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"localAnchor",{get:function(){if(null!=this._localAnchorOrPivot&&1!=this._localAnchorOrPivot)throw new Error("BK.Transform.localAnchor!current mode is localPivot!!");return this._localAnchorOrPivot=1,{x:this.transform[13],y:this.transform[14]}},set:function(t){1==this._localAnchorOrPivot&&this.transform[13]==t.x&&this.transform[14]==t.y||(this._needUpdate=!0,this._localAnchorOrPivot=1,this.transform[13]=null==t.x?0:t.x,this.transform[14]=null==t.y?0:t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pivotParent",{get:function(){if(null!=this._parentAnchorOrPivot&&0!=this._parentAnchorOrPivot)throw new Error("BK.Transform.pivotParent!current mode is anchorParent!!");return this._parentAnchorOrPivot=0,{x:this.transform[15],y:this.transform[16]}},set:function(t){0==this._parentAnchorOrPivot&&this.transform[15]==t.x&&this.transform[16]==t.y||(this._needUpdate=!0,this._parentAnchorOrPivot=0,this.transform[15]=null==t.x?0:t.x,this.transform[16]=null==t.y?0:t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"anchorParent",{get:function(){if(null!=this._parentAnchorOrPivot&&1!=this._parentAnchorOrPivot)throw new Error("BK.Transform.anchorParent!current mode is pivotParent!!");return this._parentAnchorOrPivot=1,{x:this.transform[17],y:this.transform[18]}},set:function(t){1==this._parentAnchorOrPivot&&this.transform[17]==t.x&&this.transform[18]==t.y||(this._needUpdate=!0,this._parentAnchorOrPivot=1,this.transform[17]=null==t.x?0:t.x,this.transform[18]=null==t.y?0:t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"contentSize",{get:function(){return{width:this.transform[0],height:this.transform[1]}},set:function(t){this.transform[0]==t.width&&this.transform[1]==t.height||(this._needUpdate=!0,this.transform[0]=null==t.width?0:t.width,this.transform[1]=null==t.height?0:t.height)},enumerable:!0,configurable:!0}),i.prototype.getContentSize=function(){return{width:this.transform[0],height:this.transform[1]}},i.prototype.setContentSize=function(t,e){this.transform[0]==t&&this.transform[1]==e||(this._needUpdate=!0,this.transform[0]=null==t?0:t,this.transform[1]=null==e?0:e)},i.prototype.update=function(t,e){return 1==this._needUpdate&&(1==this._localAnchorOrPivot&&(this.transform[11]=this.transform[13]*this.transform[0],this.transform[12]=this.transform[14]*this.transform[1]),1==this._parentAnchorOrPivot&&(this.transform[15]=this.transform[17]*t,this.transform[16]=this.transform[18]*e),this._needUpdate=!1),this.transform},i}())}(BK);y=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(t,e){if("object"==typeof t){var i=(r=function(){function t(){this.getTypeSize=function(t){return this._gl.BYTE==t?1:this._gl.UNSIGNED_BYTE==t?1:this._gl.SHORT==t?2:this._gl.UNSIGNED_SHORT==t?2:this._gl.INT==t?4:this._gl.UNSIGNED_INT==t?4:this._gl.FLOAT==t?4:void 0},this._ibo=0,this._vbo=0,this._program=0,this._hasLoadShader=!1,this._gl=bkWebGLGetInstance()}return t.__hookGlCommit=function(){var t=bkWebGLGetInstance();BK.GLRenderContext.__updataCallback(t),t.oldGlCommit()},t.hookGLCommit=function(t){this.__updataCallback=t,this.__gl=bkWebGLGetInstance(),this.__oldGlCommit=this.__gl.glCommit,this.__gl.glCommit=this.__hookGlCommit,this.__gl.oldGlCommit=this.__oldGlCommit,this.__hookGlCommit.bind(this.__gl)},t.exit=function(){this.__gl=bkWebGLGetInstance(),this.__oldGlCommit&&(this.__gl.glCommit=this.__oldGlCommit)},Object.defineProperty(t.prototype,"gl",{get:function(){return this._gl},enumerable:!0,configurable:!0}),t.prototype.__loadShader=function(t,e){var i,r=t||"uniform mat4 worldMat; uniform mat4 projMat; attribute vec2 pos; attribute vec2 inUVs; varying lowp vec2 outUVs;                       void main() { gl_Position = projMat * worldMat * vec4(pos, 0, 1); outUVs = inUVs; }",o=e||"varying lowp vec2 outUVs; uniform sampler2D uSampler; void main() { gl_FragColor = texture2D(uSampler, outUVs); }",n=this._gl.createShader(this._gl.VERTEX_SHADER);t&&(this._gl.enable(this._gl.BLEND),this._gl.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA)),0!=n&&(this._gl.shaderSource(n,r),this._gl.compileShader(n));var s=this._gl.createShader(this._gl.FRAGMENT_SHADER);0!=s&&(this._gl.shaderSource(s,o),this._gl.compileShader(s));var a=this._gl.createProgram();return this._gl.attachShader(a,n),this._gl.attachShader(a,s),this._gl.linkProgram(a),this._gl.deleteShader(n),this._gl.deleteShader(s),this._gl.getError()==this._gl.NO_ERROR?(this._program=a,this._gl.useProgram(this._program)):(i=this._gl.getProgramInfoLog(a),BK.Script.log(1,-1,"link program fail, err = "+i)),this.calculateProjection(),this._program},t.prototype.getProgram=function(){return this._program},t.prototype.__loadArrayBuffer=function(){var t=this._gl.getAttribLocation(this._program,"pos"),e=this._gl.getAttribLocation(this._program,"inUVs");0==this._vbo&&(this._vbo=this._gl.createBuffer()),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._vbo),this._gl.enableVertexAttribArray(t),this._gl.enableVertexAttribArray(e),this._gl.glVertexAttribPointer(t,2,this._gl.FLOAT,!1,16,0,!0),this._gl.glVertexAttribPointer(e,2,this._gl.FLOAT,!1,16,8,!0),0==this._ibo&&(this._ibo=this._gl.createBuffer())},t.prototype.dispose=function(){0!=this._vbo&&this._gl.deleteBuffer(this._vbo),0!=this._ibo&&this._gl.deleteBuffer(this._ibo),0!=this._program&&this._gl.deleteProgram(this._program),this._gl=null},t.prototype.save=function(){this._prevVP=this._gl.glGetParameterInt(this._gl.VIEWPORT,4),this._prevVBO=this._gl.glGetParameterInt(this._gl.ARRAY_BUFFER_BINDING,1),this._prevIBO=this._gl.glGetParameterInt(this._gl.ELEMENT_ARRAY_BUFFER_BINDING,1),this._prevProgram=this._gl.glGetParameterInt(this._gl.CURRENT_PROGRAM,1),this._prevTextureID=this._gl.glGetParameterInt(this._gl.TEXTURE_BINDING_2D,1),this._prevTextureUnit=this._gl.glGetParameterInt(this._gl.ACTIVE_TEXTURE,1),this._prevFrameBuffer=this._gl.glGetParameterInt(this._gl.FRAMEBUFFER_BINDING,1),this._prevRenderBuffer=this._gl.glGetParameterInt(this._gl.RENDERBUFFER_BINDING,1),this._activeAttribusInfo=[];for(var t=this._gl.glGetProgramParameter(this._prevProgram,b.ACTIVE_ATTRIBUTES),e=0;e<t;++e){var i=this._gl.getActiveAttrib(this._prevProgram,e),r=i.name,o=this._gl.getAttribLocation(this._prevProgram,r),n=this._gl.getVertexAttrib(o,this._gl.VERTEX_ATTRIB_ARRAY_SIZE),s=this._gl.getVertexAttrib(o,this._gl.VERTEX_ATTRIB_ARRAY_TYPE),a=this._gl.getVertexAttrib(o,this._gl.VERTEX_ATTRIB_ARRAY_NORMALIZED),h=this._gl.getVertexAttrib(o,this._gl.VERTEX_ATTRIB_ARRAY_STRIDE),c=this._gl.getVertexAttribOffset(o,b.VERTEX_ATTRIB_ARRAY_POINTER);if(i.name=r,i.index=o,i.size=n,i.type=s,i.normalized=a,i.stride=h,i.offset=c,void 0!==this._gl.recordVertexAttribPointer)for(var u=0;u<this._gl.recordVertexAttribPointer.length;u++){var l=this._gl.recordVertexAttribPointer[u];if(i.index==l.index&&i.type==l.type&&i.stride==l.stride&&i.offset==l.offset){i.index=l.index,i.size=l.size,i.type=l.type,i.normalized=l.normalized,i.stride=l.stride,i.offset=l.offset;break}}this.debugLog("save name:"+i.name+" index:"+i.index+" size:"+i.size+" type:"+i.type+" normalized:"+i.normalized+" stride:"+i.stride+" offset:"+i.offset),this._activeAttribusInfo.push(i)}},t.prototype.restore=function(){if(this._gl.viewport(this._prevVP[0],this._prevVP[1],this._prevVP[2],this._prevVP[3]),this._gl.useProgram(this._prevProgram),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._prevVBO),0<this._activeAttribusInfo.length){this._activeAttribusInfo[0].stride;for(var t=0;t<this._activeAttribusInfo.length;t++){var e=this._activeAttribusInfo[t],i=(e.name,e.index),r=e.size,o=e.type,n=e.normalized,s=e.offset,a=e.stride,h=0!=n;this.debugLog("restore name:"+e.name+" index:"+i+" size:"+r+" type:"+o+" normalized:"+n+" stride:"+a+" offset:"+s),this._gl.vertexAttribPointer(i,r,o,h,a,s,!0)}}this._activeAttribusInfo=[],this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._prevIBO),this._gl.activeTexture(this._prevTextureUnit),this._gl.bindTexture(this._gl.TEXTURE_2D,this._prevTextureID),this._gl.glBindFramebuffer(this._gl.FRAMEBUFFER,this._prevFrameBuffer),this._gl.glBindRenderbuffer(this._gl.RENDERBUFFER,this._prevRenderBuffer)},t.prototype.setViewport=function(t,e,i,r){this._gl.viewport(t,e,i,r)},t.prototype.setProjection=function(t){this._projMat=t},t.prototype.calculateProjection=function(){var t=this._projMat,e=t.data;this._gl.useProgram(this._program);var i=this._gl.getUniformLocation(this._program,"projMat");this._gl.uniformMatrix4fv(i,!1,e);var r=this._gl.getUniformLocation(this._program,"uSampler");this._gl.uniform1i(r,0);this._gl.getError()},t.prototype.debugLog=function(t){},t.prototype.getProjection=function(){return this._projMat},t.prototype.drawMesh=function(t,e,i,r,o){this._program=o,this._gl.useProgram(this._program),this.__loadArrayBuffer();var n=this._gl.getUniformLocation(this._program,"worldMat");this._gl.uniformMatrix4fv(n,!1,i.data),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,r),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._vbo),this._gl.bufferData(this._gl.ARRAY_BUFFER,t,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._ibo),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._gl.drawElements(this._gl.TRIANGLES,e.length,this._gl.UNSIGNED_SHORT,0)},t}(),{GLRenderNode:function(){function t(t,e){this._context=t,this._parent=null,this._childrens=new Array,this._textureID=0,this._localMatrix=new BK.JSMatrix,this._worldMatrix=new BK.JSMatrix,this._localTransform=new BK.JSTransform,this._zOrder=0,this._needSort=!1,this._needUpdate=!0,this._needUpdateWorldMatrix=!0,this.canUserInteract=!1,this.hidden=!1,this._hasDispose=!1,this.program=void 0,this._vs=e&&e.vs?e.vs:null,this._fs=e&&e.fs?e.fs:null}return Object.defineProperty(t.prototype,"path",{set:function(t){this._path!=t&&(this._path=t,0!=this._textureID&&(this._context.gl.deleteTexture(this._textureID),this._textureID=0))},enumerable:!0,configurable:!0}),t.prototype.setUrlPath=function(r,o){var t=new BK.HttpUtil(r);t.requestAsync(function(t,e){if(1!=this._hasDispose){if(200==e){var i="GameSandBox://ad/"+r;BK.FileUtil.writeBufferToFile(i,t),this.path=i}else BK.Script.log(1,1,"Fetch advertisement Sent image failed.");o&&o(this,e)}else BK.Script.log(1,1,"node hasn been disposed.response ignore")}.bind(this))},Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(t){this._parent=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zOrder",{get:function(){return this._zOrder},set:function(t){this._zOrder!=t&&(this._needSort=!0,this._zOrder=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this._localTransform.scale},set:function(t){var e=this._localTransform.scale;e.x==t.x&&e.y==t.y&&e.z==t.z||(this._needUpdate=!0,this._localTransform.scale=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._localTransform.rotation},set:function(t){var e=this._localTransform.rotation;e.x==t.x&&e.y==t.y&&e.z==t.z||(this._localTransform.rotation=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._localTransform.position},set:function(t){var e=this._localTransform.position;e.x==t.x&&e.y==t.y&&e.z==t.z||(this._localTransform.position=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentSize",{get:function(){return this._localTransform.getContentSize()},set:function(t){var e=this._localTransform.contentSize;e.width==t.width&&e.height==t.height||(this._needUpdate=!0,this._localTransform.contentSize=t)},enumerable:!0,configurable:!0}),t.prototype.getContentSize=function(){return this._localTransform.getContentSize()},t.prototype.setContentSize=function(t,e){this._localTransform.setContentSize(t,e)},Object.defineProperty(t.prototype,"localPivot",{get:function(){return this._localTransform.localPivot},set:function(t){var e=this._localTransform.localPivot;e.x==t.x&&e.y==t.y||(this._localTransform.localPivot=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localAnchor",{get:function(){return this._localTransform.localAnchor},set:function(t){var e=this._localTransform.localAnchor;e.x==t.x&&e.y==t.y||(this._localTransform.localAnchor=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pivotParent",{get:function(){return this._localTransform.pivotParent},set:function(t){var e=this._localTransform.pivotParent;e.x==t.x&&e.y==t.y||(this._localTransform.pivotParent=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchorParent",{get:function(){return this._localTransform.anchorParent},set:function(t){var e=this._localTransform.anchorParent;e.x==t.x&&e.y==t.y||(this._localTransform.anchorParent=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"worldMatrix",{get:function(){if(0==this.__needUpdateTransform())return this._worldMatrix.clone();var t=this.matrixFromLocal(),e=null!=this._parent?this._parent.worldMatrix:new BK.JSMatrix;return this.__updateWorldMatrix(e.mul(t)),this._worldMatrix.clone()},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){if(this.children)for(var t=0;t<this.children.length;t++){var e=this.children[t];e.dispose()}this._context.gl.deleteTexture(this._textureID),this._hasDispose=!0},t.prototype.addChild=function(t){for(var e=0;e<this._childrens.length;e++)if(this._childrens[e]==t||null!=t.parent)return BK.Script.log(0,0,"BK.Node.addChild!node has been in node tree"),!1;return(t.parent=this)._needSort=!0,this._childrens.push(t),!0},Object.defineProperty(t.prototype,"children",{get:function(){return this._childrens},enumerable:!0,configurable:!0}),t.prototype.__needUpdateTransform=function(){return 1==this._needUpdateWorldMatrix||1==this._localTransform.getNeedUpdate()||null!=this._parent&&(this._needUpdateWorldMatrix=this._parent.__needUpdateTransform(),this._needUpdateWorldMatrix)},t.prototype.__updateWorldMatrix=function(t){this._worldMatrix=t,this._needUpdateWorldMatrix=!1,this._childrens.forEach(function(t){t._needUpdateWorldMatrix=!0})},t.prototype.matrixFromLocal=function(){if(0==this._localTransform.getNeedUpdate())return this._localMatrix.clone();var t;t=null!=this._parent?this._localTransform.update(this._parent._localTransform.transform[0],this._parent._localTransform.transform[1]):this._localTransform.update(0,0);var e=new BK.JSMatrix;e.translate(t[8],t[9],t[10]),e.rotate(t[5],t[6],t[7]),e.scale(t[2],t[3],t[4]);var i=new BK.JSMatrix;if(i.data[12]=-t[11],i.data[13]=-t[12],this._localMatrix=e.mul(i),null!=this._parent){var r=new BK.JSMatrix;r.data[12]=t[15],r.data[13]=t[16],this._localMatrix=r.mul(e)}return this._localMatrix.clone()},t.prototype.loadTexture=function(){if(0!=this._textureID)return this._textureID;if(this._path){var t=BK.Image.loadImage(this._path);if(!t)return 0;var e=this._context.gl;this._textureID=e.createTexture(),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._textureID),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.glTexParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.glTexParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t)}return 1},t.prototype.render=function(){if(1!=this.hidden){1==this._needSort&&(this._needSort=!1,this._childrens.sort(function(t,e){return t._zOrder<e._zOrder?1:0}));var t=this._localTransform.transform[0],e=this._localTransform.transform[1],i=new Uint16Array([0,1,2,0,2,3]),r=new Float32Array([0,0,0,1,t,0,1,1,t,e,1,0,0,e,0,0]),o=this.loadTexture();0!=o&&(this.program||(this.program=this._context.__loadShader(this._vs,this._fs)),this._context.drawMesh(r,i,this.worldMatrix,o,this.program));for(var n=0;n<this._childrens.length;n++)this._childrens[n].render()}},t.prototype.__log=function(t){BK.Script.log(1,1,"GLRenderNode:"+t)},t.prototype.hittest=function(t){this._context.getProjection();var e=this.worldMatrix,i={x:0,y:0},r={x:i.x+this.contentSize.width,y:i.y+this.contentSize.height},o=e.mulPoint(i),n=e.mulPoint(r);return t.x>=o.x&&t.x<=n.x&&t.y>=o.y&&t.y<=n.y},t}(),GLRenderContext:r});t.GLRenderNode=i.GLRenderNode,t.GLRenderContext=i.GLRenderContext}var r}(BK),function(t,e){"object"==typeof t&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.GLRenderButton=e())}(BK,function(){return function(o){function t(t,e,i){var r=o.call(this,t)||this;return r.updateTexture=function(t){},r.__nativeObj=new BK.GLRenderNode(t),r.contentSize={width:e,height:i},r.isCancelClick=void 0,r.touchStatus=0,r.canUserInteract=!0,r.enable=!0,r.canClick=!0,r.addTouchListener(),r}return y(t,o),t.prototype.addTouchListener=function(){"undefined"!=typeof UIEventHandler?(UIEventHandler.addNodeEvent(this,1,function(t,e,i,r){t.isCancelClick=!1,t.enable?t.changeStatus(1):t.changeStatus(2)}.bind(this)),UIEventHandler.addNodeEvent(this,2,function(t,e,i,r){var o={x:i,y:r};0==t.hittest(o)&&(t.isCancelClick=!0)}.bind(this)),UIEventHandler.addNodeEvent(this,3,function(t,e,i,r){t.enable?t.changeStatus(0):t.changeStatus(2),0==t.isCancelClick&&t.touchInsideCallback&&1==this.canClick&&t.touchInsideCallback(t)}.bind(this))):BK.Script.log(1,1,"UIEventHandler is undefined")},t.prototype.dispose=function(){UIEventHandler.removeNodeEvent(this,1),UIEventHandler.removeNodeEvent(this,2),UIEventHandler.removeNodeEvent(this,3),o.prototype.dispose.call(this)},t.prototype.changeStatus=function(t){this.touchStatus=t,this.updateTexture(t)},t.prototype.setTouchInsideCallback=function(t){this.touchInsideCallback=t},t}(BK.GLRenderNode)}),function(t,e){"object"==typeof t&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=void 0:"function"==typeof define&&define.amd?define(e):t.PlusTips=void 0)}(BK,function(){}),function(t,e){if("object"==typeof t){var i=(r="attribute vec3 Position;    attribute vec2 TexCoordIn;    attribute vec4 SourceColor;    uniform mat4 ModelView;    uniform mat4 Projection;    varying vec4 DestColor;    varying vec2 TexCoordOut;    void main()    {        mat4 gWVP = Projection * ModelView;        gl_Position = gWVP * vec4(Position, 1);        DestColor = SourceColor;        TexCoordOut = TexCoordIn;    }",o="varying lowp vec2 TexCoordOut;    uniform int formatYUV;    uniform sampler2D samplerY;    uniform sampler2D samplerU;    uniform sampler2D samplerV;    uniform sampler2D samplerUV;    const lowp vec3 defyuv = vec3(-0.0/255.0, -128.0/255.0, -128.0/255.0);    void main(void)    {        lowp vec3 yuv = vec3(0.0);        if (formatYUV == 0) {            yuv.x = texture2D(samplerY, TexCoordOut).r;            yuv.y = texture2D(samplerU, TexCoordOut).r;            yuv.z = texture2D(samplerV, TexCoordOut).r;            yuv += defyuv;        } else if (formatYUV == 1) {            yuv.x = texture2D(samplerY, TexCoordOut).r;            yuv.y = texture2D(samplerUV, TexCoordOut).a;            yuv.z = texture2D(samplerUV, TexCoordOut).r;            yuv += defyuv;        } else if (formatYUV == 3) {            yuv.x = texture2D(samplerY, TexCoordOut).r;            yuv.y = texture2D(samplerUV, TexCoordOut).r;            yuv.z = texture2D(samplerUV, TexCoordOut).a;            yuv += defyuv;        }        lowp vec3 rgb = mat3(1.0, 1.0, 1.0,                            0.0, -.34414, 1.772,                            1.402, -.71414, 0.0) * yuv;        gl_FragColor = vec4(rgb, 1.0);    }",a=function(){function t(){this.videoViews=new Array,void 0!==BK.Director.setQAVDelegate&&BK.Director.setQAVDelegate(this)}return t.prototype.addView=function(e){var t=this.videoViews.filter(function(t){return e==t});return t.length||this.videoViews.push(e),0==t.length},t.prototype.delView=function(e){var t=this.videoViews.length;return this.videoViews=this.videoViews.filter(function(t){return e!=t}),t!=this.videoViews.length},t.prototype.onRemoveVideoPreview=function(e){this.videoViews.forEach(function(t){t.identifier==e.identifier&&t.render(e)})},t.prototype.onLocalVideoPreview=function(r){this.videoViews.forEach(function(t){if(t.identifier==r.identifier){var e=r,i=t;i.onPrePreview&&(e=i.onPrePreview.call(i,r)),t.render(e)}})},t.prototype.onLocalVideoPreProcess=function(i){this.videoViews.forEach(function(t){if(t.identifier==i.identifier){var e=t;e.onPreProcess&&e.onPreProcess.call(e,i)}})},t.Instance=new t,t}(),n=function(){function t(t,e,i,r,o,n,s){this.identifier=t,this.__nativeObj=new BK.Sprite(e,i,null,0,0,1,1),this._innerBindMethods4NativeObj(),null!=r&&null!=r||(r=!0),n&&(this.position=n),o?o.addChild(this):BK.Director.root.addChild(this),s&&(this.zOrder=s),1==r&&a.Instance.addView(this)}return t.prototype._innerBindMethods4NativeObj=function(o){var n=this,t=Object.getOwnPropertyNames(this.__nativeObj);t.forEach(function(t,e,i){var r=t;o&&-1!=o.indexOf(r)||Object.defineProperty(n,r,{get:function(){return this.__nativeObj[r]},set:function(t){this.__nativeObj[r]=t},enumerable:!0,configurable:!0})})},t.prototype.addChild=function(t){this.__nativeObj&&this.__nativeObj.addChild(t)},t.prototype._restartRenderTimer=function(){this.__renderTimeoutCallback&&0<this.__renderTimeoutThreshold&&(BK.Director.ticker.removeTimeout(this),BK.Director.ticker.setTimeout(function(t,e,i){this.__renderTimeoutCallback&&this.__renderTimeoutCallback.call(this)},this.__renderTimeoutThreshold,this))},t.prototype._innerUseRGBA=function(t,e){if(this.__bitmap){var i=this.__bitmap.size;i.width==t&&i.height==e||(BK.Script.log(0,0,"BK.QAVView.useRGBA!size change, ow = "+i.width+", oh = "+i.height+", nw = "+t+", nh = "+e),this.__bitmap=BK.Texture.createBitmapTexture(t,e),this.__nativeObj.setTexture(this.__bitmap))}else this.__bitmap=BK.Texture.createBitmapTexture(t,e),this.__nativeObj.setTexture(this.__bitmap)},t.prototype._innerUseYUVMaterial_I420=function(t,e){if(this.__yuvMaterial||(this.__yuvMaterial=new BK.Render.Material(r,o,!0),this.__nativeObj.attachComponent(this.__yuvMaterial),this.__yuvMaterial.uniforms.samplerY=0,this.__yuvMaterial.uniforms.samplerU=1,this.__yuvMaterial.uniforms.samplerV=2,this.__yuvMaterial.uniforms.samplerUV=3),this.__bitmapY){var i=this.__bitmapY.size;i.width==t&&i.height==e||(BK.Script.log(0,0,"BK.QAVView.useYUVMaterial_I420!Y size change, ow = "+i.width+", oh = "+i.height+", nw = "+t+", nh = "+e),this.__bitmapY=BK.Texture.createBitmapTexture(t,e,7),this.__yuvMaterial.setTexture(0,this.__bitmapY))}else this.__bitmapY=BK.Texture.createBitmapTexture(t,e,7),this.__yuvMaterial.setTexture(0,this.__bitmapY);if(this.__bitmapU){var i=this.__bitmapU.size;i.width==t/2&&i.height==e/2||(BK.Script.log(0,0,"BK.QAVView.useYUVMaterial_I420!U size change, ow = "+i.width+", oh = "+i.height+", nw = "+t+", nh = "+e),this.__bitmapU=BK.Texture.createBitmapTexture(t/2,e/2,7),this.__yuvMaterial.setTexture(1,this.__bitmapU))}else this.__bitmapU=BK.Texture.createBitmapTexture(t/2,e/2,7),this.__yuvMaterial.setTexture(1,this.__bitmapU);if(this.__bitmapV){var i=this.__bitmapV.size;i.width==t/2&&i.height==e/2||(BK.Script.log(0,0,"BK.QAVView.useYUVMaterial_I420!V size change, ow = "+i.width+", oh = "+i.height+", nw = "+t+", nh = "+e),this.__bitmapV=BK.Texture.createBitmapTexture(t/2,e/2,7),this.__yuvMaterial.setTexture(2,this.__bitmapV))}else this.__bitmapV=BK.Texture.createBitmapTexture(t/2,e/2,7),this.__yuvMaterial.setTexture(2,this.__bitmapV)},t.prototype._innerUseYUVMaterial_NVxx=function(t,e){if(this.__yuvMaterial||(this.__yuvMaterial=new BK.Render.Material(r,o,!0),this.__nativeObj.attachComponent(this.__yuvMaterial),this.__yuvMaterial.uniforms.samplerY=0,this.__yuvMaterial.uniforms.samplerU=1,this.__yuvMaterial.uniforms.samplerV=2,this.__yuvMaterial.uniforms.samplerUV=3),this.__bitmapY){var i=this.__bitmapY.size;i.width==t&&i.height==e||(BK.Script.log(0,0,"BK.QAVView.useYUVMaterial_NVxx!Y size change, ow = "+i.width+", oh = "+i.height+", nw = "+t+", nh = "+e),this.__bitmapY=BK.Texture.createBitmapTexture(t,e,7),this.__yuvMaterial.setTexture(0,this.__bitmapY))}else this.__bitmapY=BK.Texture.createBitmapTexture(t,e,7),this.__yuvMaterial.setTexture(0,this.__bitmapY);if(this.__bitmapUV){var i=this.__bitmapUV.size;i.width==t/2&&i.height==e/2||(BK.Script.log(0,0,"BK.QAVView.useYUVMaterial_NVxx!UV size change, ow = "+i.width+", oh = "+i.height+", nw = "+t+", nh = "+e),this.__bitmapUV=BK.Texture.createBitmapTexture(t/2,e/2,2),this.__yuvMaterial.setTexture(3,this.__bitmapUV))}else this.__bitmapUV=BK.Texture.createBitmapTexture(t/2,e/2,2),this.__yuvMaterial.setTexture(3,this.__bitmapUV)},t.prototype.render=function(t){var e=t.frameDesc.width,i=t.frameDesc.height;if(this.__nativeObj){switch(this._restartRenderTimer(),t.frameDesc.rotate){case 0:this.cameraPos&&1==this.cameraPos?this.__nativeObj.setUVFlip(1,0):this.__nativeObj.setUVFlip(1,1);break;case 1:case 2:this.cameraPos&&1==this.cameraPos?this.__nativeObj.setUVFlip(0,1):this.__nativeObj.setUVFlip(0,0),this.__nativeObj.setUVRotate(1);break;case 3:this.cameraPos&&1==this.cameraPos?this.__nativeObj.setUVFlip(0,1):this.__nativeObj.setUVFlip(0,0),this.__nativeObj.setUVRotate(3)}switch(t.frameDesc.colorFormat){case 10:this._innerUseRGBA(e,i),this.__bitmap.uploadSubData(0,0,e,i,t.extraData.buffer);break;case 0:this._innerUseYUVMaterial_I420(e,i),this.__yuvMaterial.uniforms.formatYUV=t.frameDesc.colorFormat,this.__bitmapY.uploadSubData(0,0,e,i,t.extraData.Y),this.__bitmapU.uploadSubData(0,0,e/2,i/2,t.extraData.U),this.__bitmapV.uploadSubData(0,0,e/2,i/2,t.extraData.V);break;case 3:case 1:this._innerUseYUVMaterial_NVxx(e,i),this.__yuvMaterial.uniforms.formatYUV=t.frameDesc.colorFormat,this.__bitmapY.uploadSubData(0,0,e,i,t.extraData.Y),this.__bitmapUV.uploadSubData(0,0,e/2,i/2,t.extraData.UV);break;default:BK.Script.log(1,-1,"BK.QAVView.render!unknown format = "+t.frameDesc.colorFormat)}}},t.prototype.renderAsCache=function(t,e,i,r,o,n,s,a){switch(n){case 0:this._innerUseYUVMaterial_I420(t,e),this.__yuvMaterial.uniforms.formatYUV=n,this.__bitmapY.uploadSubData(0,0,t,e,a.Y),this.__bitmapU.uploadSubData(0,0,t/2,e/2,a.U),this.__bitmapV.uploadSubData(0,0,t/2,e/2,a.V);break;case 3:case 1:this._innerUseYUVMaterial_NVxx(t,e),this.__yuvMaterial.uniforms.formatYUV=n,this.__bitmapY.uploadSubData(0,0,t,e,a.Y),this.__bitmapUV.uploadSubData(0,0,t/2,e/2,a.UV);break;default:return BK.Script.log(1,-1,"BK.QAVView.renderAsCache!unknown format = "+n),null}if(this.__graphic||(this.__graphic=new BK.Graphics),this.__cacheTexture){var h=this.__cacheTexture.size;h.width==i&&h.height==r||(BK.Script.log(0,0,"BK.QAVView.renderAsCache!cache tex size change, ow = "+h.width+", oh = "+h.height+", nw = "+i+", nh = "+r),this.__cacheTexture=new BK.RenderTexture(i,r,s))}else this.__cacheTexture=new BK.RenderTexture(i,r,s);if(this.__cacheSprite){var h=this.__cacheSprite.size;h.width==i&&h.height==r||(this.__cacheSprite.size={width:i,height:r})}else this.__cacheSprite=new BK.Sprite(i,r,null,0,0,1,1),this.__cacheSprite.attachComponent(this.__yuvMaterial);switch(o){case 0:this.__cacheSprite.setUVFlip(1,0),this.__cacheSprite.setUVRotate(0);break;case 1:this.__cacheSprite.setUVFlip(1,0),this.__cacheSprite.setUVRotate(1);break;case 2:this.__cacheSprite.setUVFlip(0,1),this.__cacheSprite.setUVRotate(0);break;case 3:this.__cacheSprite.setUVFlip(1,0),this.__cacheSprite.setUVRotate(4)}var c=this;this.__graphic.drawRenderTexture(this.__cacheTexture,function(){this.drawSprite(c.__cacheSprite)});var u=this.__cacheTexture.readPixels(0,0,i,r,s);return u},t.prototype.renderAsTexture=function(){var t=new BK.RenderTexture(this.__nativeObj.size.width,this.__nativeObj.size.height,6);return BK.Render.renderToTexture(this.__nativeObj,t),t},t.prototype.hittest=function(t){return this.__nativeObj.hittest(t)},t.prototype.removeFromParent=function(){this.__nativeObj&&this.__nativeObj.removeFromParent()},t.prototype.setRenderTimeout=function(t,e){this.__renderTimeoutCallback=e,this.__renderTimeoutThreshold=t,0<this.__renderTimeoutThreshold&&this._restartRenderTimer()},t}(),s=function(){function t(){this.skipNum=-1}return t.prototype.start=function(t){var e=t.identifier?t.identifier:"";if(t.width&&t.height){BK.Script.log(1,0,"BK.Camera!options = "+JSON.stringify(t)),this.options=t,this.identifier=e,this.view=new n(e,t.width,t.height,!1,t.parent,t.position),a.Instance.addView(this),this.options.needFaceTracker&&(this.detector=new BK.AI.FaceDetector(!0,!0));return BK.MQQ.SsoRequest.addListener("cs.audioRoom_camera_switch.local",this,function(t,e,r){if(BK.Script.log(0,0,"BK.Camera.switchCameraEvent222!data = "+JSON.stringify(r)),0==t){BK.Script.log(0,0,"BK.Camera.switchCameraEvent!data = "+JSON.stringify(r));var o=this;BK.Director.ticker.removeTimeout(this),BK.Director.ticker.setTimeout(function(t,e,i){o.view.cameraPos=r.cameraPos,o=null},160,this)}}.bind(this)),this.isStart=!1,this}},t.prototype.configCamera=function(t){if(t&&(BK.Script.log(0,0,"configCamera"),BK.Script.log(0,0,"configCamera BK.Room ok1"),t.beauty&&(BK.Script.log(0,0,"configCamera BK.Room audioRoomSetBeauty1"),this.setBeauty(t.beauty)),t.cameraPos)){BK.Script.log(0,0,"configCamera BK.Room cameraPos");t.onSwitchCamera&&t.onSwitchCamera.bind(this);this.switchCamera(t.cameraPos,function(t,e,i){BK.Script.log(0,0,"configCamera BK.Room cameraPos errCode:"+t+" cmd:"+e+" data:"+i),this.options.onSwitchCamera&&this.options.onSwitchCamera(t,e,i)})}},t.prototype.switchCamera=function(t,e){var i={cameraPos:t},r="cs.audioRoom_cameraswitch.local";BK.MQQ.SsoRequest.addListener(r,this,e.bind(this)),BK.MQQ.SsoRequest.send(i,r)},t.prototype.setBeauty=function(t){var e={beauty:t};BK.MQQ.SsoRequest.send(e,"cs.audioRoom_set_beauty.local")},t.prototype.setSpeaker=function(t){var e={speaker:t};BK.MQQ.SsoRequest.send(e,"cs.audioRoom_set_speaker.local")},t.prototype.close=function(){},t.prototype._innerConvertRGBA=function(t){var e=this.options.scaleSample?this.options.scaleSample:1,i=t.frameDesc.width,r=t.frameDesc.height,o=function(t,e,i){var r={width:t,height:e};switch(i){case 1:case 3:r.width=e,r.height=t}return r}(t.frameDesc.width,t.frameDesc.height,t.frameDesc.rotate),n={frameDesc:{},extraData:{}};return n.frameDesc.width=o.width*e,n.frameDesc.height=o.height*e,n.frameDesc.rotate=0,n.frameDesc.colorFormat=10,n.frameDesc.videoSrcType=t.frameDesc.videoSrcType,n.extraData.buffer=this.view.renderAsCache(i,r,o.width*e,o.height*e,t.frameDesc.rotate,t.frameDesc.colorFormat,6,t.extraData),n},t.prototype.onPrePreview=function(t){if(this.options.onPrePreview){var e=t;if(this.detector){e=this._innerConvertRGBA(t);var i=this._innerExtractBitmap(e);(this.hasFace||-1==this.skipNum)&&(this.skipNum=0,e.faceFeatures=this.detector.detectForBitmapSync(i)),null==e.faceFeatures||e.faceFeatures.length<=0?(this.hasFace=!1,this.skipNum=this.skipNum+1,(this.skipNum>this.options.skipFaceTrackerNum||this.skipNum==this.options.skipFaceTrackerNum)&&(e.faceFeatures=this.detector.detectForBitmapSync(i),this.skipNum=0,e.faceFeatures&&(this.hasFace=!0))):this.hasFace=!0}this.options.onPrePreview.call(this,e)}return 0==this.isStart&&(this.configCamera(this.options),this.isStart=!0),t},t.prototype.onPreProcess=function(t){return this.options.onPreProcess?this.options.onPreProcess.call(this,t):t},t.prototype.render=function(t){this.view&&this.view.render(t)},t.prototype.renderAsTexture=function(){return this.view?this.view.renderAsTexture():null},t.prototype._innerExtractBitmap=function(t){var e={};switch(e.width=t.frameDesc.width,e.height=t.frameDesc.height,e.format=t.frameDesc.colorFormat,t.frameDesc.colorFormat){case 7:e.format=3;break;case 10:e.buffer=t.extraData.buffer,e.format=6;break;default:BK.Script.log(1,-1,"BK.QAVCamera.extractBitmap!unknown format = "+t.frameDesc.colorFormat)}switch(t.frameDesc.rotate){case 0:e.oreintation=0;break;case 1:e.oreintation=1;break;case 2:e.oreintation=5;break;case 3:e.oreintation=6}return e},t.Instance=new t,t}(),{QAVView:n,QAVCamera:new s});t.QAVView=i.QAVView,t.AVCamera=i.QAVCamera}var r,o,a,n,s}(BK),"object"==typeof BK&&(BK.QQAVManager=new(function(){function t(){this._hasInitFlag=!1,this._hasSuccEnter=!1,this._iosHasInitFlag=!1,this._isFrontCamera=!1,this._hasStartQAVRoomFlag=!1,this._callbackQueue=[],BK.MQQ.SsoRequest.addListener("cs.audioRoom_disconnect.local",this,this.__handleRoomDisconnect.bind(this)),BK.MQQ.SsoRequest.addListener("cs.audioRoom_update_userinfo.local",this,this.__handleUserUpdate.bind(this))}return t.prototype.log=function(t){BK.Script.log(0,0,"QQAVManager:"+t)},t.prototype.errorLog=function(t){BK.Script.log(1,1,"QQAVManager Error:"+t)},t.prototype.setQAVCfg=function(t){this.qavCfg=t},t.prototype.setUpdateUserInfoCallback=function(t){var e="cs.audioRoom_update_userinfo.local";BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,t)},t.prototype.setEventCallbackConfig=function(t){this.eventCallbackConfig=t},t.prototype.initQAV=function(t,e){this.setQAVCfg(t),this.__startQAVRoom(e)},t.prototype.setMic=function(r,o){this.__enterQAVRoomIfNeed(function(t){if(0==t){var e={switch:r},i="cs.audioRoom_set_mic.local";BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,o),BK.MQQ.SsoRequest.send(e,i)}else this.errorLog("setMic failed!start qav room failed")}.bind(this))},t.prototype.setSpeaker=function(r,o){this.__enterQAVRoomIfNeed(function(t){if(0==t){var e={switch:r},i="cs.audioRoom_set_speaker.local";BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,o),BK.MQQ.SsoRequest.send(e,i)}else this.errorLog("setSpeaker failed!start qav room failed")}.bind(this))},t.prototype.switchCamera=function(r,o){this.__enterQAVRoomIfNeed(function(t){if(0==t){var e={cameraPos:r},i="cs.audioRoom_camera_switch.local";BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(t,e,i){0==t&&(this._isFrontCamera=0==r),o(t,e,i)}.bind(this)),BK.MQQ.SsoRequest.send(e,i)}else this.errorLog("switchCamera failed!start qav room failed")}.bind(this))},t.prototype.enableCamera=function(r,o){this.__enterQAVRoomIfNeed(function(t){if(0==t){var e={switch:r},i="cs.audioRoom_camera_enable.local";this._isFrontCamera=!0,BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,o),BK.MQQ.SsoRequest.send(e,i)}else this.errorLog("enableCamera failed!start qav room failed")}.bind(this))},t.prototype.setBeauty=function(i){this.__enterQAVRoomIfNeed(function(t){if(0==t){var e={beauty:i};BK.MQQ.SsoRequest.send(e,"cs.audioRoom_set_beauty.local")}else this.errorLog("setBeauty failed!start qav room failed")}.bind(this))},t.prototype.setLocalVideo=function(i){this.__enterQAVRoomIfNeed(function(t){if(0==t){var e={switch:i};BK.MQQ.SsoRequest.send(e,"cs.audioRoom_set_local_video.local")}else this.errorLog("setLocalVideo failed!start qav room failed")}.bind(this))},t.prototype.watchRemoteVideo=function(i){this.__enterQAVRoomIfNeed(function(t){if(0==t){this.log("watchRemoteVideo ok1");var e={openIdList:i};BK.MQQ.SsoRequest.send(e,"cs.audioRoom_watch_remote_video.local"),this.log("watchRemoteVideo ok2")}else this.errorLog("watchRemoteVideo failed!start qav room failed")}.bind(this))},t.prototype.setRemoteVideo=function(i){this.__enterQAVRoomIfNeed(function(t){if(0==t){var e={switch:i};BK.MQQ.SsoRequest.send(e,"cs.audioRoom_set_remote_video.local")}else this.errorLog("setMic failed!start qav room failed")}.bind(this))},t.prototype.exitRoom=function(r){this._hasInitFlag=!1,this.__exitQAVRoom(function(t,e,i){this.log("exit qav room errCode:"+t),r(t,e,i)}.bind(this))},t.prototype.getEndpointList=function(t){var e="cs.audioRoom_get_endpointList.local";t&&(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,t)),BK.MQQ.SsoRequest.send({},e)},t.prototype.isFrontCamera=function(){return this._isFrontCamera},t.prototype.getFluidCtrlCfg=function(t,e){var i="cs.audioRoom_get_fluid_ctrl_cfg.local";e&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,e)),BK.MQQ.SsoRequest.send(t,i)},t.prototype.changeAudioCategory=function(t,e){var i="cs.audioRoom_change_audio_category.local",r={category:t};e&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,e)),BK.MQQ.SsoRequest.send(r,i)},t.prototype.changeQAVRole=function(t,e){var i="cs.audioRoom_change_qav_role.local",r={role:t};e&&(BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,e)),BK.MQQ.SsoRequest.send(r,i)},t.prototype.__enterQAVRoomIfNeed=function(t){this._hasSuccEnter?t(0):(this.log("__enterQAVRoomIfNeed entering qav room."),this._callbackQueue.push(t),0==this._hasStartQAVRoomFlag&&(this._hasStartQAVRoomFlag=!0,this.__startQAVRoom(function(t,e,i){for(var r=0;r<this._callbackQueue.length;r++){var o=this._callbackQueue[r];o(t)}this._callbackQueue.splice(0,this._callbackQueue.length)}.bind(this))))},t.prototype.initQAVRoom=function(t,r){var e="cs.audioRoom_init.local";if("ios"==GameStatusInfo.platform&&1==this._iosHasInitFlag)return this.log("ios init once "),void r(0,e,this._initData);1!=this._hasInitFlag?(BK.MQQ.SsoRequest.removeListener(e,this),BK.MQQ.SsoRequest.addListener(e,this,function(t,e,i){this.log("cmd:"+e+" errCode:"+t+" data:"+JSON.stringify(i)),0==t&&(this._hasInitFlag=!0,this._initData=i,"ios"==GameStatusInfo.platform&&(this._iosHasInitFlag=!0,this.log("_iosHasInitFlag"))),r(t,e,i)}.bind(this)),BK.MQQ.SsoRequest.send(t,e)):this.log("AVRoom has been init .can't init Room twice !!")},t.prototype.enterQAVRoom=function(t,r){var e=t.gameRoomId,i=t.avRoomId,o=t.avRoleName,n=t.avKey,s={avRoomId:i,gameRoomId:e,avRoleName:o,avKey:n};this.avRoomId=i,this.gameRoomId=e,this.avRoleName=o;var a="cs.audioRoom_enter.local";BK.MQQ.SsoRequest.removeListener(a,this),BK.MQQ.SsoRequest.addListener(a,this,function(t,e,i){this.log("cmd:"+e+" errCode:"+t+" data:"+JSON.stringify(i)),r(t,e,i)}.bind(this)),BK.MQQ.SsoRequest.send(s,a),BK.MQQ.SsoRequest.removeListener("cs.close_room.local",this),BK.MQQ.SsoRequest.addListener("cs.close_room.local",this,function(t,e,i){this.log("BK.QAVManager.closeGame!exitQAVRoom, avRoomId = "+this.avRoomId),this.__exitQAVRoom()}.bind(this)),BK.MQQ.SsoRequest.removeListener("cs.audioRoom_req_audio_session.local",this),BK.MQQ.SsoRequest.addListener("cs.audioRoom_req_audio_session.local",this,function(t,e,i){this.log("BK.QAVManager.reqAudioSession!result = "+JSON.stringify(i))}.bind(this))},t.prototype.__exitQAVRoom=function(t){var e={avRoomId:this.avRoomId},i="cs.audioRoom_exit.local";BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,t),BK.MQQ.SsoRequest.send(e,i)},t.prototype.__checkGameStatusInfoParam=function(){if(!GameStatusInfo.avAppId)return this.log("GameStatusInfo.avAppId is null"),null;if(!GameStatusInfo.avAccountType)return this.log("GameStatusInfo.avAccountType is null"),null;if(!GameStatusInfo.avRoomId)return this.log("GameStatusInfo.avRoomId is null"),null;if(!GameStatusInfo.roomId)return this.log("GameStatusInfo.roomId is null"),null;var t={sdkAppId:GameStatusInfo.avAppId,accountType:GameStatusInfo.avAccountType,avRoomId:GameStatusInfo.avRoomId,gameRoomId:GameStatusInfo.roomId};return t},t.prototype.__addQAVCfg=function(t){if(this.qavCfg)for(var e in this.qavCfg)if(this.qavCfg.hasOwnProperty(e)){var i=this.qavCfg[e];t[e]=i}return t},t.prototype.__startQAVRoom=function(r){if(GameStatusInfo.devPlatform){var t={sdkAppId:1400035750,accountType:14181,avRoomId:122333,gameRoomId:54321,selfOpenId:GameStatusInfo.openId};t=this.__addQAVCfg(t),this.initAndEnterRoom(t,r)}else{var t=this.__checkGameStatusInfoParam();t?(t=this.__addQAVCfg(t),this.initAndEnterRoom(t,function(t,e,i){r(t,e,i)}.bind(this))):BK.QQ.addSSOJoinRoomCallBack(function(t,e,i){i.gameRoomId&&i.avRoomId&&i.sdkAppId&&i.accountType?(i=this.__addQAVCfg(i),this.initAndEnterRoom(i,r)):BK.Script.log(0,0,"addSSOJoinRoomCallBack data is incorrect.")}.bind(this))}},t.prototype.initAndEnterRoom=function(r,o){null!=r.sdkAppId?null!=r.accountType?null!=r.avRoomId?null!=r.gameRoomId?(this.setQAVCfg(r),this.log("initAndEnterRoom step1 initRoom cfg:"+JSON.stringify(r)),this.initQAVRoom(r,function(t,e,i){0==t?(this.log("initAndEnterRoom step2 enterRoom"),this.enterQAVRoom(r,function(t,e,i){0==t?(this.log("initAndEnterRoom step2 enterRoom succ!"),this._hasSuccEnter=!0):this._hasStartQAVRoomFlag=!1,o(t,e,i)}.bind(this))):(this.log("initAndEnterRoom failed cmd:"+e+" errCode:"+t+" data:"+JSON.stringify(i)),this._hasStartQAVRoomFlag=!1,o(t,e,i))}.bind(this))):this.log("initAndEnterRoom gameRoomId is null;"):this.log("initAndEnterRoom avRoomId is null;"):this.log("initAndEnterRoom accountType is null;"):this.log("initAndEnterRoom sdkAppId is null;")},t.prototype.__handleUserUpdate=function(t,e,i){i&&(this.log("handleUserUpdate data:"+JSON.stringify(i)),1==i.eventId?(this.log("\u8fdb\u5165\u623f\u95f4\u4e8b\u4ef6:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventEnterCallback&&this.eventCallbackConfig.eventEnterCallback(i.eventId,i)):2==i.eventId?(this.log("\u9000\u51fa\u623f\u95f4\u4e8b\u4ef6:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventExitCallback&&this.eventCallbackConfig.eventExitCallback(i.eventId,i)):3==i.eventId?(this.log("\u6709\u53d1\u6444\u50cf\u5934\u89c6\u9891\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventHasCameraVideoCallback&&this.eventCallbackConfig.eventHasCameraVideoCallback(i.eventId,i)):4==i.eventId?(this.log("\u65e0\u53d1\u6444\u50cf\u5934\u89c6\u9891\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventNoCameraVideoCallback&&this.eventCallbackConfig.eventNoCameraVideoCallback(i.eventId,i)):5==i.eventId?(this.log("\u6709\u53d1\u8bed\u97f3\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventHasAudioCallback&&this.eventCallbackConfig.eventHasAudioCallback(i.eventId,i)):6==i.eventId?(this.log("\u65e0\u53d1\u8bed\u97f3\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventNoAudioCallback&&this.eventCallbackConfig.eventNoAudioCallback(i.eventId,i)):7==i.eventId?(this.log("\u6709\u53d1\u5c4f\u5e55\u89c6\u9891\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventHasScreenVideoCallback&&this.eventCallbackConfig.eventHasScreenVideoCallback(i.eventId,i)):8==i.eventId?(this.log("\u65e0\u53d1\u5c4f\u5e55\u89c6\u9891\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventNoScreenVideoCallback&&this.eventCallbackConfig.eventNoScreenVideoCallback(i.eventId,i)):9==i.eventId?(this.log("\u6709\u53d1\u6587\u4ef6\u89c6\u9891\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventHasMediaFileCallback&&this.eventCallbackConfig.eventHasMediaFileCallback(i.eventId,i)):10==i.eventId?(this.log("\u65e0\u53d1\u6587\u4ef6\u89c6\u9891\u4e8b\u4ef6\u3002:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventNoMediaFileCallback&&this.eventCallbackConfig.eventNoMediaFileCallback(i.eventId,i)):42==i.eventId?(this.log("\u65b0\u6210\u5458\u8bf4\u8bdd:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventNewSpeakCallback&&this.eventCallbackConfig.eventNewSpeakCallback(i.eventId,i)):43==i.eventId&&(this.log("\u65e7\u6210\u5458\u505c\u6b62\u8bf4\u8bdd:"+JSON.stringify(i.userInfo)),this.eventCallbackConfig&&this.eventCallbackConfig.eventOldStopSpeakCallback&&this.eventCallbackConfig.eventOldStopSpeakCallback(i.eventId,i)))},t.prototype.__handleRoomDisconnect=function(t,e,i){this.eventCallbackConfig&&this.eventCallbackConfig.eventRoomDisconnectCallback&&this.eventCallbackConfig.eventRoomDisconnectCallback(i)},t}())),function(t,e){"object"==typeof t&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.QRCode=e())}(BK,function(){function i(t){this.mode=n.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,i=this.data.length;e<i;e++){var r=[],o=this.data.charCodeAt(e);65536<o?(r[0]=240|(1835008&o)>>>18,r[1]=128|(258048&o)>>>12,r[2]=128|(4032&o)>>>6,r[3]=128|63&o):2048<o?(r[0]=224|(61440&o)>>>12,r[1]=128|(4032&o)>>>6,r[2]=128|63&o):128<o?(r[0]=192|(1984&o)>>>6,r[1]=128|63&o):r[0]=o,this.parsedData.push(r)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function h(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}i.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,i=this.parsedData.length;e<i;e++)t.put(this.parsedData[e],8)}},h.prototype={addData:function(t){var e=new i(t);this.dataList.push(e),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,e){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++){this.modules[i]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[i][r]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,e),7<=this.typeNumber&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=h.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,e)},setupPositionProbePattern:function(t,e){for(var i=-1;i<=7;i++)if(!(t+i<=-1||this.moduleCount<=t+i))for(var r=-1;r<=7;r++)e+r<=-1||this.moduleCount<=e+r||(this.modules[t+i][e+r]=0<=i&&i<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==i||6==i)||2<=i&&i<=4&&2<=r&&r<=4)},getBestMaskPattern:function(){for(var t=0,e=0,i=0;i<8;i++){this.makeImpl(!0,i);var r=g.getLostPoint(this);(0==i||r<t)&&(t=r,e=i)}return e},createMovieClip:function(t,e,i){var r=t.createEmptyMovieClip(e,i);this.make();for(var o=0;o<this.modules.length;o++)for(var n=1*o,s=0;s<this.modules[o].length;s++){var a=1*s;this.modules[o][s]&&(r.beginFill(0,100),r.moveTo(a,n),r.lineTo(a+1,n),r.lineTo(a+1,n+1),r.lineTo(a,n+1),r.endFill())}return r},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=g.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var i=0;i<t.length;i++){var r=t[e],o=t[i];if(null==this.modules[r][o])for(var n=-2;n<=2;n++)for(var s=-2;s<=2;s++)this.modules[r+n][o+s]=-2==n||2==n||-2==s||2==s||0==n&&0==s}},setupTypeNumber:function(t){for(var e=g.getBCHTypeNumber(this.typeNumber),i=0;i<18;i++){var r=!t&&1==(e>>i&1);this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=r}for(i=0;i<18;i++){r=!t&&1==(e>>i&1);this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=r}},setupTypeInfo:function(t,e){for(var i=this.errorCorrectLevel<<3|e,r=g.getBCHTypeInfo(i),o=0;o<15;o++){var n=!t&&1==(r>>o&1);o<6?this.modules[o][8]=n:o<8?this.modules[o+1][8]=n:this.modules[this.moduleCount-15+o][8]=n}for(o=0;o<15;o++){n=!t&&1==(r>>o&1);o<8?this.modules[8][this.moduleCount-o-1]=n:o<9?this.modules[8][15-o-1+1]=n:this.modules[8][15-o-1]=n}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var i=-1,r=this.moduleCount-1,o=7,n=0,s=this.moduleCount-1;0<s;s-=2)for(6==s&&s--;;){for(var a=0;a<2;a++)if(null==this.modules[r][s-a]){var h=!1;n<t.length&&(h=1==(t[n]>>>o&1)),g.getMask(e,r,s-a)&&(h=!h),this.modules[r][s-a]=h,-1==--o&&(n++,o=7)}if((r+=i)<0||this.moduleCount<=r){r-=i,i=-i;break}}}},h.PAD0=236,h.PAD1=17,h.createData=function(t,e,i){for(var r=y.getRSBlocks(t,e),o=new B,n=0;n<i.length;n++){var s=i[n];o.put(s.mode,4),o.put(s.getLength(),g.getLengthInBits(s.mode,t)),s.write(o)}var a=0;for(n=0;n<r.length;n++)a+=r[n].dataCount;if(o.getLengthInBits()>8*a)throw new Error("code length overflow. ("+o.getLengthInBits()+">"+8*a+")");for(o.getLengthInBits()+4<=8*a&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(!1);for(;!(o.getLengthInBits()>=8*a||(o.put(h.PAD0,8),o.getLengthInBits()>=8*a));)o.put(h.PAD1,8);return h.createBytes(o,r)},h.createBytes=function(t,e){for(var i=0,r=0,o=0,n=new Array(e.length),s=new Array(e.length),a=0;a<e.length;a++){var h=e[a].dataCount,c=e[a].totalCount-h;r=Math.max(r,h),o=Math.max(o,c),n[a]=new Array(h);for(var u=0;u<n[a].length;u++)n[a][u]=255&t.buffer[u+i];i+=h;var l=g.getErrorCorrectPolynomial(c),d=new S(n[a],l.getLength()-1).mod(l);s[a]=new Array(l.getLength()-1);for(u=0;u<s[a].length;u++){var f=u+d.getLength()-s[a].length;s[a][u]=0<=f?d.get(f):0}}var _=0;for(u=0;u<e.length;u++)_+=e[u].totalCount;var p=new Array(_),m=0;for(u=0;u<r;u++)for(a=0;a<e.length;a++)u<n[a].length&&(p[m++]=n[a][u]);for(u=0;u<o;u++)for(a=0;a<e.length;a++)u<s[a].length&&(p[m++]=s[a][u]);return p};for(var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},c=1,u=0,l=3,d=2,r=0,o=1,s=2,a=3,f=4,_=5,p=6,m=7,g={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;0<=g.getBCHDigit(e)-g.getBCHDigit(g.G15);)e^=g.G15<<g.getBCHDigit(e)-g.getBCHDigit(g.G15);return(t<<10|e)^g.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;0<=g.getBCHDigit(e)-g.getBCHDigit(g.G18);)e^=g.G18<<g.getBCHDigit(e)-g.getBCHDigit(g.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return g.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,i){switch(t){case r:return(e+i)%2==0;case o:return e%2==0;case s:return i%3==0;case a:return(e+i)%3==0;case f:return(Math.floor(e/2)+Math.floor(i/3))%2==0;case _:return e*i%2+e*i%3==0;case p:return(e*i%2+e*i%3)%2==0;case m:return(e*i%3+(e+i)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new S([1],0),i=0;i<t;i++)e=e.multiply(new S([1,v.gexp(i)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:case n.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),i=0,r=0;r<e;r++)for(var o=0;o<e;o++){for(var n=0,s=t.isDark(r,o),a=-1;a<=1;a++)if(!(r+a<0||e<=r+a))for(var h=-1;h<=1;h++)o+h<0||e<=o+h||0==a&&0==h||s==t.isDark(r+a,o+h)&&n++;5<n&&(i+=3+n-5)}for(r=0;r<e-1;r++)for(o=0;o<e-1;o++){var c=0;t.isDark(r,o)&&c++,t.isDark(r+1,o)&&c++,t.isDark(r,o+1)&&c++,t.isDark(r+1,o+1)&&c++,0!=c&&4!=c||(i+=3)}for(r=0;r<e;r++)for(o=0;o<e-6;o++)t.isDark(r,o)&&!t.isDark(r,o+1)&&t.isDark(r,o+2)&&t.isDark(r,o+3)&&t.isDark(r,o+4)&&!t.isDark(r,o+5)&&t.isDark(r,o+6)&&(i+=40);for(o=0;o<e;o++)for(r=0;r<e-6;r++)t.isDark(r,o)&&!t.isDark(r+1,o)&&t.isDark(r+2,o)&&t.isDark(r+3,o)&&t.isDark(r+4,o)&&!t.isDark(r+5,o)&&t.isDark(r+6,o)&&(i+=40);var u=0;for(o=0;o<e;o++)for(r=0;r<e;r++)t.isDark(r,o)&&u++;return i+=10*(Math.abs(100*u/e/e-50)/5)}},v={glog:function(t){if(t<1)throw new Error("glog("+t+")");return v.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;256<=t;)t-=255;return v.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},t=0;t<8;t++)v.EXP_TABLE[t]=1<<t;for(t=8;t<256;t++)v.EXP_TABLE[t]=v.EXP_TABLE[t-4]^v.EXP_TABLE[t-5]^v.EXP_TABLE[t-6]^v.EXP_TABLE[t-8];for(t=0;t<255;t++)v.LOG_TABLE[v.EXP_TABLE[t]]=t;function S(t,e){if(null==t.length)throw new Error(t.length+"/"+e);for(var i=0;i<t.length&&0==t[i];)i++;this.num=new Array(t.length-i+e);for(var r=0;r<t.length-i;r++)this.num[r]=t[r+i]}function y(t,e){this.totalCount=t,this.dataCount=e}function B(){this.buffer=[],this.length=0}S.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),i=0;i<this.getLength();i++)for(var r=0;r<t.getLength();r++)e[i+r]^=v.gexp(v.glog(this.get(i))+v.glog(t.get(r)));return new S(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=v.glog(this.get(0))-v.glog(t.get(0)),i=new Array(this.getLength()),r=0;r<this.getLength();r++)i[r]=this.get(r);for(r=0;r<t.getLength();r++)i[r]^=v.gexp(v.glog(t.get(r))+e);return new S(i,0).mod(t)}},y.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],y.getRSBlocks=function(t,e){var i=y.getRsBlockTable(t,e);if(null==i)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var r=i.length/3,o=[],n=0;n<r;n++)for(var s=i[3*n+0],a=i[3*n+1],h=i[3*n+2],c=0;c<s;c++)o.push(new y(a,h));return o},y.getRsBlockTable=function(t,e){switch(e){case c:return y.RS_BLOCK_TABLE[4*(t-1)+0];case u:return y.RS_BLOCK_TABLE[4*(t-1)+1];case l:return y.RS_BLOCK_TABLE[4*(t-1)+2];case d:return y.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},B.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var i=0;i<e;i++)this.putBit(1==(t>>>e-i-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var b=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function T(t,e){for(var i,r,o=1,n=(i=t,(r=encodeURI(i).toString().replace(/\%[0-9a-fA-F]{2}/g,"a")).length+(r.length!=i?3:0)),s=0,a=b.length;s<=a;s++){var h=0;switch(e){case c:h=b[s][0];break;case u:h=b[s][1];break;case l:h=b[s][2];break;case d:h=b[s][3]}if(n<=h)break;o++}if(b.length<o)throw new Error("Too long data");return o}var E=function(){};return E.createQRModel=function(t,e){var i,r=new h(T(t,(i=void 0===e?{width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:2}:e).correctLevel),i.correctLevel);return r.addData(t),r.make(),r},E.createQRCodeNode=function(t,e){var i;i=void 0===e?{width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:2}:e;for(var r=new BK.Canvas(i.width,i.height),o=E.createQRModel(t,e),n=o.getModuleCount(),s=i.width/n,a=i.height/n,h=Math.round(s),c=Math.round(a),u=0;u<n;u++)for(var l=0;l<n;l++){var d=o.isDark(u,l),f=l*s,_=u*a;r.lineWidth=1,r.fillColor=d?i.colorDark:i.colorLight,r.drawStyle=0,r.fillRect(f,_,s,a),r.strokeColor=d?i.colorDark:i.colorLight,r.strokeRect(Math.ceil(f)-.5,Math.ceil(_)-.5,h,c),r.strokeRect(Math.ceil(f)+.5,Math.ceil(_)+.5,h,c)}return r},E.createQRCodeToFile=function(t,e,i){var r=E.createQRCodeNode(e,i);return r.saveTo(t),r.dispose(),!0},E.compose=function(t,e,i,r){var o=BK.Director.screenPixelSize.width,n=BK.Director.screenPixelSize.height,s=new BK.Canvas(o,n);s.drawImage(t,0,0),s.drawImage(e,0,0),s.saveTo("GameSandBox://compose.png"),s.dispose()},E}),function(t,e){var i={setAccessoryAsync:function(t,u){this.loadJsonAtlasArray(t,function(t,e){for(var i=0;i<e.length;i++){var r=e[i],o=r.jsonInfo,n=r.atlasInfo,s=o.data,a=n.data,h=o.path,c=n.path;this.loadAccessory(s,h,a,c)}u(t,e)}.bind(this))},loadJsonAtlas:function(t,e,a){BK.fileSystem.readFile({file:[{path:t},{path:e}],success:function(t){var e,i;BK.Script.log(1,0,"res = "+JSON.stringify(t));for(var r=0;r<t.length;r++){var o=t[r],n=o.path,s=n.substring(n.lastIndexOf("."));".json"==s?e=o:".atlas"==s&&(i=o)}a(0,e,i)}})},loadSkeletonAsync:function(u,l){var t=[u];this.loadJsonAtlasArray(t,function(t,e){if(0==t){var i=e[0],r=i.jsonInfo,o=i.atlasInfo,n=r.data,s=o.data,a=r.path,h=o.path,c=this.load(n,a,s,h);l(c,u)}else l(-1,null)}.bind(this))},setAccessoryAnimationAsync:function(u,l,d){var t=[u];this.loadJsonAtlasArray(t,function(t,e){if(0==t){var i=e[0],r=i.jsonInfo,o=i.atlasInfo,n=r.data,s=o.data,a=r.path,h=o.path,c=this.loadAccessoryAnimation(n,a,s,h,l);d(c,l,u)}else d(-1,l,null)}.bind(this))},loadJsonAtlasArray:function(u,l){for(var t=[],e=0;e<u.length;e++){var i=u[e],r={path:i.json},o={path:i.atlas};t.push(r),t.push(o)}BK.fileSystem.readFile({file:t,success:function(t){BK.Script.log(1,0,"res = "+JSON.stringify(t));for(var e=0;e<t.length;e++){var i=t[e],r=i.path,o=r.substring(r.lastIndexOf(".")),n=!1;".json"==o?n=!0:".atlas"==o&&(n=!1);for(var s=0;s<u.length;s++){var a=u[s],h=null;if(n){var c=(h=a.json).substring(h.indexOf("://")+3,h.length);0<r.indexOf(c)&&(u[s].jsonInfo=i)}else{var c=(h=a.atlas).substring(h.indexOf("://")+3,h.length);0<r.indexOf(c)&&(u[s].atlasInfo=i)}}}l(0,u)}})}};t.SkeletonAnimation.__proto__.setAccessoryAsync=i.setAccessoryAsync,t.SkeletonAnimation.__proto__.loadJsonAtlas=i.loadJsonAtlas,t.SkeletonAnimation.__proto__.loadSkeletonAsync=i.loadSkeletonAsync,t.SkeletonAnimation.__proto__.setAccessoryAnimationAsync=i.setAccessoryAnimationAsync,t.SkeletonAnimation.__proto__.loadJsonAtlasArray=i.loadJsonAtlasArray}(BK),function(t,e){"object"==typeof t&&(t.AdBannerHandler=function(){function t(t,e){this.closeUrl="https://i.hudongcdn.com/game_cdn/ad_close.png",this.adIconUrl="https://i.hudongcdn.com/game_cdn/ad_icon.png",this.pos_id=t,this.event={},this.adInfo=e,this.sizeW=.78*BK.Director.screenPixelSize.width;var i=BK.Director.screenPixelSize.width,r=BK.Director.screenPixelSize.height;r<i&&(this.sizeW=.44*i),this.sizeH=166*this.sizeW/582,this.closeBtnW=46*this.sizeW/582,this.clsoeBtnH=46*this.sizeH/166,this.btnSpace=14*this.sizeH/166,BK.Script.log(1,1," constructor: "+this.btnSpace),this.adIconW=74*this.sizeW/582,this.adIconH=46*this.sizeH/166}return t.prototype.isUseWebGL=function(){return void 0!==b},t.prototype.onClickContent=function(t){this.event.onClickContent=t},t.prototype.onClickClose=function(t){this.event.onClickClose=t},t.prototype.show=function(t){this.isUseWebGL()?this.showWebGLNode(t):this.showBKNode(t)},t.prototype._onLoadBackgroundCallback=function(t,e,i){200==e?(this.exposeureReport(),i(0,"OK",this)):(i(-1,"load image failed!",this),this.close())},t.prototype._jumpToDestPage=function(){BK.MQQ.Webview.open(this.adInfo.report_info.click_url)},t.prototype._emmitClickEvent=function(){this.event.onClickContent&&this.event.onClickContent()},t.prototype._onClickContentBtn=function(){this._emmitClickEvent(),this._jumpToDestPage()},t.prototype._reportClick=function(){this.clickReport(),this.cmshowReport(3)},t.prototype._onClickCloseBtn=function(){this.event.onClickClose&&this.event.onClickClose(),this.closeReport(),this.close()},t.prototype.showBKNode=function(i){this.rootNode=new BK.Node,this.rootNode.canUserInteract=!0,this.backgound=new BK.Button(this.sizeW,this.sizeH),this.backgound.setNormalTextureFromUrl(this.adInfo.display_info.basic_info.img,function(t,e){this._onLoadBackgroundCallback(t,e,i)}.bind(this)),this.rootNode.addChild(this.backgound),this.closeBtn=new BK.Button(this.closeBtnW,this.clsoeBtnH),this.closeBtn.position={x:this.sizeW-this.closeBtnW-this.btnSpace,y:this.sizeH-this.clsoeBtnH-this.btnSpace},this.closeBtn.setNormalTextureFromUrl(this.closeUrl,function(t,e){}.bind(this)),this.rootNode.addChild(this.closeBtn),this.adIconBtn=new BK.Button(this.adIconW,this.adIconH),this.adIconBtn.position={x:this.btnSpace,y:this.btnSpace},this.adIconBtn.setNormalTextureFromUrl(this.adIconUrl,function(t,e){200!=e&&BK.Script.log(1,1,"")}.bind(this)),this.rootNode.addChild(this.adIconBtn),this.backgound.setTouchInsideCallback(function(t){this._onClickContentBtn()}.bind(this)),this.closeBtn.setTouchInsideCallback(function(t){this._onClickCloseBtn()}.bind(this)),this.renderBKNode()},t.prototype.renderBKNode=function(){var t=BK.Director.screenPixelSize.width/BK.Director.root.scale.x,e=this.sizeW*(1/BK.Director.root.scale.x);this.rootNode.position={x:(t-e)/2,y:0},this.rootNode.scale={x:1/BK.Director.root.scale.x,y:1/BK.Director.root.scale.y},BK.Director.root.addChild(this.rootNode)},t.prototype.closeBKNode=function(){this.rootNode.removeFromParent()},t.prototype.showWebGLNode=function(i){this.context=new BK.GLRenderContext;var t=BK.JSMatrix.fromOrthographic(0,BK.Director.screenPixelSize.width,0,BK.Director.screenPixelSize.height,-1,1);this.context.setProjection(t);var e=BK.Director.screenPixelSize.width;BK.Director.screenPixelSize.height,this.glRootNode=new BK.GLRenderButton(this.context,this.sizeW,this.sizeH),this.glRootNode.canUserInteract=!0,this.glRootNode.canClick=!1,this.glRootNode.setUrlPath(this.adInfo.display_info.basic_info.img,function(t,e){this.glRootNode.canClick=!0,this._onLoadBackgroundCallback(t,e,i)}.bind(this)),this.glRootNode.position={x:(e-this.sizeW)/2,y:0},this.glCloseBtn=new BK.GLRenderButton(this.context,this.closeBtnW,this.clsoeBtnH),this.glCloseBtn.setUrlPath(this.closeUrl),this.glCloseBtn.position={x:this.sizeW-this.closeBtnW-this.btnSpace,y:this.sizeH-this.clsoeBtnH-this.btnSpace},this.glRootNode.addChild(this.glCloseBtn),this.glAdIconBtn=new BK.GLRenderButton(this.context,this.adIconW,this.adIconH),this.glAdIconBtn.setUrlPath(this.adIconUrl),this.glAdIconBtn.position={x:this.btnSpace,y:this.btnSpace},this.glRootNode.addChild(this.glAdIconBtn),this.glRootNode.setTouchInsideCallback(function(t){this._onClickContentBtn(),this._reportClick()}.bind(this)),this.glCloseBtn.setTouchInsideCallback(function(t){this._onClickCloseBtn()}.bind(this)),this.renderWebGLNode()},t.prototype.renderWebGLNode=function(){UIEventHandler.setRootNode(this.glRootNode),BK.GLRenderContext.hookGLCommit(function(t){if(this.context&&this.glRootNode){if(0==t.methodWorking)return;this.context.save(),t.viewport(0,0,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height),t.disable(t.DEPTH_TEST),t.useProgram(this.context.getProgram()),this.glRootNode.render(),this.context.restore()}}.bind(this))},t.prototype.closeWebGLNode=function(){this.glRootNode&&this.glRootNode.dispose(),this.context&&this.context.dispose(),this.glRootNode=null,this.context=null,BK.GLRenderContext.exit()},t.prototype.close=function(){this.isUseWebGL()?this.closeWebGLNode():this.closeBKNode()},t.prototype.exposeureReport=function(t,e,i){if(this.adInfo.report_info&&this.adInfo.report_info.exposure_url){var r=this.adInfo.report_info.exposure_url,o=new BK.HttpUtil(r);BK.Script.log(0,0,"exposeureReport param:"+t+" exposure_url:"+r),o.requestAsync(function(t,e){200==e?BK.Script.log(1,1,"exposeureReport succ."):BK.Script.log(1,1,"exposeureReport failed.statuscode:"+e)}.bind(this)),this.cmshowReport(0,t,e,i)}else BK.Script.log(1,1,"exposeureReport failed. no report_info ")},t.prototype.clickReport=function(){},t.prototype.closeReport=function(t,e,i){if(this.adInfo.report_info&&this.adInfo.report_info.negative_feedback_url){var r=this.adInfo.report_info.negative_feedback_url;r=r.replace("__ACT_TYPE__","2001");var o=new BK.HttpUtil(r);o.requestAsync(function(t,e){200==e?BK.Script.log(1,1,"negative_feedback succ."):BK.Script.log(1,1,"negative_feedback failed.statuscode:"+e)}.bind(this)),this.cmshowReport(3,t,e,i)}else BK.Script.log(1,1,"closeReport failed.can not find the negative_feedback_url")},t.prototype.cmshowReport=function(t,e,i,r){var o=this.pos_id,n=t.toString(),s="",a="",h="";e&&(s=e),i&&(a=i),r&&(h=r),BK.QQ.uploadData("banner_SPA",o,n,s,a,h)},t.prototype.reportParamToString=function(){var t=this.adInfo.report_info.trace_info,e="";if("object"==typeof t){for(var i in t)e=e+i+"="+t[i]+"&";e=e.substring(0,e.length-1)}return e},t}())}(BK),function(t,e){"object"==typeof t&&(t.AdAnimateBanner=function(){AD_BANNER_TYPE_DYNAMIC_193_582_166=0,AD_BANNER_TYPE_DYNAMIC_194_147_147=1,AD_BANNER_TYPE_DYNAMIC_184_240_180=2,AD_BANNER_TYPE_DYNAMIC_285_240_180_3=3,AD_BANNER_TYPE_DYNAMIC_210_640_288=4,AD_BANNER_TYPE_DYNAMIC_65_1000_560=5,AD_BANNER_TYPE_STATIC_193_582_166=6,AD_BANNER_TYPE_STATIC_194_147_147=7,AD_BANNER_TYPE_STATIC_184_240_180=8,AD_BANNER_TYPE_STATIC_285_240_180_3=9,AD_BANNER_TYPE_STATIC_210_640_288=10,AD_BANNER_TYPE_STATIC_65_1000_560=11,AD_BANNER_TYPE_RESERVED_0=12,AD_BANNER_TYPE_RESERVED_1_1=13,AD_BANNER_TYPE_RESERVED_1_2=14,AD_BANNER_TYPE_RESERVED_2_1=15,AD_BANNER_TYPE_RESERVED_2_2=16,AD_BANNER_TYPE_RESERVED_3=17,AD_BANNER_TYPE_RESERVED_CLIP_RECT=18,AD_DESIGN_SIZE=[{width:490,height:140},{width:147,height:147},{width:193,height:145},{width:147,height:110},{width:322,height:145},{width:263,height:147},{width:582,height:166},{width:166,height:166},{width:221,height:166},{width:179,height:132},{width:368,height:166},{width:297,height:166},{width:114,height:87},{width:530,height:166},{width:581,height:166},{width:530,height:38},{width:60,height:30},{width:115,height:115},{width:730,height:166}],IPHONE_X_WIDTH=375,IPHONE_X_HEIGHT=812;var t=BK.Director.queryDeviceInfo();"ios"===t.platform&&t.screenWidth===IPHONE_X_WIDTH&&t.screenHeight===IPHONE_X_HEIGHT?IS_IPHONE_X=!0:IS_IPHONE_X=!1;function c(){return IS_IPHONE_X}function m(){return!!c()}function u(){return c()?BK.Director.screenPixelSize.height>BK.Director.screenPixelSize.width?.015*BK.Director.screenPixelSize.height:.035*BK.Director.screenPixelSize.height:0}function d(t,e,i,r,o,n,s,a,h,c,u,l,d,f,_,p){this._data=void 0!==t?[t,e,i,r,o,n,s,a,h,c,u,l,d,f,_,p]:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function f(t){return.01745329251994*t}function i(t,e){var i=(this._gl=t).createShader(t.VERTEX_SHADER);t.shaderSource(i,e.vs_source),t.compileShader(i);var r=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(r,e.fs_source),t.compileShader(r),this._shader_program=t.createProgram(),t.attachShader(this._shader_program,i),t.attachShader(this._shader_program,r),t.linkProgram(this._shader_program),this._attributes=[];for(var o=0;o<e.attributes.length;++o){var n=e.attributes[o],s=t.getAttribLocation(this._shader_program,n.name);this._attributes.push({name:n.name,size:n.size,location:s})}this._uniforms=[];for(var o=0;o<e.uniforms.length;++o){var a=e.uniforms[o];this._uniforms.push({name:a.name,type:a.type,location:t.getUniformLocation(this._shader_program,a.name),value:a.default_value})}}function g(){this._parent=null,this._children=[],this._rotation_matrix=new d,this._scalar_matrix=new d,this._local_matrix=new d,this._world_matrix=new d,this._canUserInteract=!1,this._dirty_flags=0,this._need_update_flag=!1,this._position={x:0,y:0,z:0},this._hidden=!1,Object.defineProperty(this,"canUserInteract",{configurable:!0,get:function(){return this._canUserInteract},set:function(t){this._canUserInteract=t}}),Object.defineProperty(this,"children",{configurable:!0,get:function(){return this._children}}),Object.defineProperty(this,"hidden",{configurable:!0,get:function(){return this._hidden},set:function(t){this._hidden=t}}),Object.defineProperty(this,"position",{configurable:!0,get:function(){return this._position},set:function(t){this._position.x=void 0!==t.x?t.x:this._position.x,this._position.y=void 0!==t.y?t.y:this._position.y,this._position.z=void 0!==t.z?t.z:this._position.z,this._need_update_flag=!0,this._dirty_flags|=DIRTY_TRANSLATION|DIRTY_WORLD_MATRIX}}),this._scale={x:1,y:1,z:1},Object.defineProperty(this,"scale",{configurable:!0,get:function(){return this._scale},set:function(t){this._scale.x=void 0!==t.x?t.x:this._scale.x,this._scale.y=void 0!==t.y?t.y:this._scale.y,this._scale.z=void 0!==t.z?t.z:this._scale.z,this._need_update_flag=!0,this._dirty_flags|=DIRTY_SCALE|DIRTY_WORLD_MATRIX}}),this._rotation={x:0,y:0,z:0},Object.defineProperty(this,"rotation",{configurable:!0,get:function(){return this._rotation},set:function(t){this._rotation.x=void 0!==t.x?t.x:this._rotation.x,this._rotation.y=void 0!==t.y?t.y:this._rotation.y,this._rotation.z=void 0!==t.z?t.z:this._rotation.z,this._need_update_flag=!0,this._dirty_flags|=DIRTY_ROTATION|DIRTY_WORLD_MATRIX}}),this._visible=!0,Object.defineProperty(this,"visible",{configurable:!0,get:function(){return this._visible},set:function(t){this._visible=t}})}function _(t,e,i,r,o,n,s){g.call(this),this._color={r:1,g:1,b:1,a:1},Object.defineProperty(this,"color",{configurable:!0,get:function(){return this._color},set:function(t){this._color.r=void 0!==t.r?t.r:this._color.r,this._color.g=void 0!==t.g?t.g:this._color.g,this._color.b=void 0!==t.b?t.b:this._color.b,this._color.a=void 0!==t.a?t.a:this._color.a,this._dirty_flags|=DIRTY_COLOR}}),this._anchor={x:.5,y:.5},Object.defineProperty(this,"anchor",{configurable:!0,get:function(){return this._anchor},set:function(t){this._anchor.x=void 0!==t.x?t.x:this._anchor.x,this._anchor.y=void 0!==t.y?t.y:this._anchor.y,this._dirty_flags|=DIRTY_ANCHOR}}),this.setTexture(i),this._uv_rotate=BK_SPRITE_UV_ROTATE_NONE,this._origin_tex_uv=[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],this._flip_u=void 0!==r&&r,this._flip_v=void 0!==o&&o,this._stretch_x=void 0!==n&&n,this._stretch_y=void 0!==s&&s,this._blend_mode=BK_BLEND_MODE_MULTIPLY,this._content_size={width:t,height:e},Object.defineProperty(this,"size",{configurable:!0,get:function(){return this._content_size},set:function(t){this._content_size=t,this._dirty_flags|=DIRTY_CONTENT_SIZE}});var a=.5*this._content_size.width,h=.5*this._content_size.height;this._vertices=new Float32Array([-a,h,0,1,1,1,1,0,0,a,h,0,1,1,1,1,1,0,a,-h,0,1,1,1,1,1,1,-a,-h,0,1,1,1,1,0,1]),this._vbo=null,this._ibo=null}function n(t,e,i,r,o,n,s){_.call(this,t,e,i,r,o,n,s),this.contentSize={width:t,height:e},this.isCancelClick=void 0,this.touchStatus=0,this.canUserInteract=!0,this.enable=!0,this.canClick=!0,this.touchInsideCallback=void 0,this.addTouchListener()}function p(t){var e=Math.floor(255*t.a);return e<<=8,e|=Math.floor(255*t.r),e<<=8,e|=Math.floor(255*t.g),e<<=8,(e|=Math.floor(255*t.b))>>>0}function e(t){this._ad_final_size=[],this._clickInsideCallback=void 0;for(var e=0;e<AD_DESIGN_SIZE.length;++e)this._ad_final_size.push({width:Math.ceil(AD_DESIGN_SIZE[e].width*STANDARD_SCALE),height:Math.ceil(AD_DESIGN_SIZE[e].height*STANDARD_SCALE)});this._is_webgl=void 0!==b,this._is_webgl&&this.webGL_init();var i="GameRes://res/bg_left.png",r="GameRes://res/bg_bg_1.png",o="GameRes://res/bg_bg_2.png",n="GameRes://res/bg_fg_1.png",s="GameRes://res/bg_fg_2.png",a="GameRes://res/bg_right.png";t&&(i=t.bg_left_path,a=t.bg_right_path,r=t.bg_bg_1_path,o=t.bg_bg_2_path,n=t.bg_fg_1_path,s=t.bg_fg_2_path),this._tex_bg_left=this.create_texture(i,!1),this._tex_bg_bg_1=this.create_texture(r,!1),this._tex_bg_bg_2=this.create_texture(o,!1),this._tex_bg_fg_1=this.create_texture(n,!1),this._tex_bg_fg_2=this.create_texture(s,!1),this._tex_bg_right=this.create_texture(a,!1),this._root_node=this.create_node(),this._root_node.canUserInteract=!0,this._mv_node=this.create_clip_node(this._root_node,{x:.5*-this._ad_final_size[AD_BANNER_TYPE_RESERVED_CLIP_RECT].width,y:c()?2*STANDARD_SCALE:0,width:this._ad_final_size[AD_BANNER_TYPE_RESERVED_CLIP_RECT].width,height:this._ad_final_size[AD_BANNER_TYPE_RESERVED_CLIP_RECT].height}),this._mv_node.canUserInteract=!0,m()?this._mv_node.position={x:.5*BK.Director.screenPixelSize.width,y:u()}:this._mv_node.position={x:.5*BK.Director.screenPixelSize.width,y:0},this._node_1=this.node_extend(this.create_button(this._mv_node,this._tex_bg_left,this._ad_final_size[AD_BANNER_TYPE_RESERVED_0],this._onTouchInside.bind(this))),this._node_2=this.node_extend(this.create_node(this._mv_node)),this._node_2.canUserInteract=!0,this._node_2_1=this.create_button(this._node_2,this._tex_bg_bg_1,this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1],this._onTouchInside.bind(this)),this._content_node=this.create_node(this._node_2),this._real_content_node=void 0,this._node_2_2=this.create_sprite_with_texture(this._node_2,this._tex_bg_fg_1,this._ad_final_size[AD_BANNER_TYPE_RESERVED_2_1]),this._node_3=this.node_extend(this.create_button(this._mv_node,this._tex_bg_right,this._ad_final_size[AD_BANNER_TYPE_RESERVED_3],this._onTouchInside.bind(this)));var h=new BK.Ticker;h.interval=.033,h.setTickerCallBack(function(t,e){this.update(e)}.bind(this))}return STANDARD_HEIGHT=c()?BK.Director.screenPixelSize.height>BK.Director.screenPixelSize.width?.1*BK.Director.screenPixelSize.height:.2*BK.Director.screenPixelSize.height:BK.Director.screenPixelSize.height*(BK.Director.screenPixelSize.height>BK.Director.screenPixelSize.width?.12:.22),STANDARD_SCALE=STANDARD_HEIGHT/AD_DESIGN_SIZE[AD_BANNER_TYPE_RESERVED_1_1].height,NODE_TWEEN_ATTR_TYPE_NONE=0,NODE_TWEEN_ATTR_TYPE_SCALE=1,NODE_TWEEN_ATTR_TYPE_SCALE_X=2,NODE_TWEEN_ATTR_TYPE_SCALE_Y=3,NODE_TWEEN_ATTR_TYPE_POSITION_X=4,NODE_TWEEN_ATTR_TYPE_POSITION_Y=5,NODE_TWEEN_ATTR_TYPE_OPACITY=6,NODE_TWEEN_ATTR_TYPE_ROTATION_X=7,NODE_TWEEN_ATTR_TYPE_ROTATION_Y=8,NODE_TWEEN_ATTR_TYPE_ROTATION_Z=9,d.prototype={constructor:d,is_identity:function(){return 1===this._data[0]&&0===this._data[1]&&0===this._data[2]&&0===this._data[3]&&0===this._data[4]&&1===this._data[5]&&0===this._data[6]&&0===this._data[7]&&0===this._data[8]&&0===this._data[9]&&1===this._data[10]&&0===this._data[11]&&0===this._data[12]&&0===this._data[13]&&0===this._data[14]&&1===this._data[15]},set_translation:function(t,e,i){this._data[12]=t,this._data[13]=e,this._data[14]=i},set_scale:function(t,e,i){this._data[0]=t,this._data[5]=e,this._data[10]=i},set:function(t,e,i,r,o,n,s,a,h,c,u,l,d,f,_,p){this._data[0]=t,this._data[1]=e,this._data[2]=i,this._data[3]=r,this._data[4]=o,this._data[5]=n,this._data[6]=s,this._data[7]=a,this._data[8]=h,this._data[9]=c,this._data[10]=u,this._data[11]=l,this._data[12]=d,this._data[13]=f,this._data[14]=_,this._data[15]=p},setTo:function(t){return this._data=t._data.slice(0),this},multiply:function(t){if(this.is_identity())return this.setTo(t);if(t.is_identity())return this;var e=this._data[0]*t._data[0]+this._data[4]*t._data[1]+this._data[8]*t._data[2]+this._data[12]*t._data[3],i=this._data[1]*t._data[0]+this._data[5]*t._data[1]+this._data[9]*t._data[2]+this._data[13]*t._data[3],r=this._data[2]*t._data[0]+this._data[6]*t._data[1]+this._data[10]*t._data[2]+this._data[14]*t._data[3],o=this._data[3]*t._data[0]+this._data[7]*t._data[1]+this._data[11]*t._data[2]+this._data[15]*t._data[3],n=this._data[0]*t._data[4]+this._data[4]*t._data[5]+this._data[8]*t._data[6]+this._data[12]*t._data[7],s=this._data[1]*t._data[4]+this._data[5]*t._data[5]+this._data[9]*t._data[6]+this._data[13]*t._data[7],a=this._data[2]*t._data[4]+this._data[6]*t._data[5]+this._data[10]*t._data[6]+this._data[14]*t._data[7],h=this._data[3]*t._data[4]+this._data[7]*t._data[5]+this._data[11]*t._data[6]+this._data[15]*t._data[7],c=this._data[0]*t._data[8]+this._data[4]*t._data[9]+this._data[8]*t._data[10]+this._data[12]*t._data[11],u=this._data[1]*t._data[8]+this._data[5]*t._data[9]+this._data[9]*t._data[10]+this._data[13]*t._data[11],l=this._data[2]*t._data[8]+this._data[6]*t._data[9]+this._data[10]*t._data[10]+this._data[14]*t._data[11],d=this._data[3]*t._data[8]+this._data[7]*t._data[9]+this._data[11]*t._data[10]+this._data[15]*t._data[11],f=this._data[0]*t._data[12]+this._data[4]*t._data[13]+this._data[8]*t._data[14]+this._data[12]*t._data[15],_=this._data[1]*t._data[12]+this._data[5]*t._data[13]+this._data[9]*t._data[14]+this._data[13]*t._data[15],p=this._data[2]*t._data[12]+this._data[6]*t._data[13]+this._data[10]*t._data[14]+this._data[14]*t._data[15],m=this._data[3]*t._data[12]+this._data[7]*t._data[13]+this._data[11]*t._data[14]+this._data[15]*t._data[15];return this.set(e,i,r,o,n,s,a,h,c,u,l,d,f,_,p,m),this},multiplyXY:function(t){return{x:t.x*this._data[0]+t.y*this._data[4]+this._data[12],y:t.x*this._data[1]+t.y*this._data[5]+this._data[13]}}},SHADER_UNIFORM_TYPE_FLOAT1=1,SHADER_UNIFORM_TYPE_FLOAT2=2,SHADER_UNIFORM_TYPE_FLOAT3=3,SHADER_UNIFORM_TYPE_FLOAT4=4,SHADER_UNIFORM_TYPE_INT1=5,SHADER_UNIFORM_TYPE_INT2=6,SHADER_UNIFORM_TYPE_INT3=7,SHADER_UNIFORM_TYPE_INT4=8,SHADER_UNIFORM_TYPE_FLOATV1=9,SHADER_UNIFORM_TYPE_FLOATV2=10,SHADER_UNIFORM_TYPE_FLOATV3=11,SHADER_UNIFORM_TYPE_FLOATV4=12,SHADER_UNIFORM_TYPE_INTV1=13,SHADER_UNIFORM_TYPE_INTV2=14,SHADER_UNIFORM_TYPE_INTV3=15,SHADER_UNIFORM_TYPE_INTV4=16,SHADER_UNIFORM_TYPE_MATRIX2=17,SHADER_UNIFORM_TYPE_MATRIX3=18,SHADER_UNIFORM_TYPE_MATRIX4=19,SHADER_UNIFORM_TYPE_TEXTURE0=20,SHADER_UNIFORM_TYPE_TEXTURE1=21,SHADER_UNIFORM_TYPE_TEXTURE2=22,SHADER_UNIFORM_TYPE_TEXTURE3=23,SHADER_UNIFORM_TYPE_TEXTURE4=24,SHADER_UNIFORM_TYPE_TEXTURE5=25,SHADER_UNIFORM_TYPE_TEXTURE6=26,SHADER_UNIFORM_TYPE_TEXTURE7=27,i.prototype={set_uniform:function(t,e,i){for(var r=0;r<this._uniforms.length;++r)this._uniforms[r].name===t&&(this._uniforms[r].value=e,i&&this.update_uniform(this._uniforms[r]))},bind:function(){this._gl.useProgram(this._shader_program);for(var t=0;t<this._uniforms.length;++t)this.update_uniform(this._uniforms[t]);var e=0;for(t=0;t<this._attributes.length;++t){var i=this._attributes[t];this._gl.vertexAttribPointer(i.location,i.size,this._gl.FLOAT,!1,36,e),this._gl.enableVertexAttribArray(i.location),e+=4*i.size}},update_uniform:function(t){var e=this._gl;switch(t.type){case SHADER_UNIFORM_TYPE_FLOAT1:e.uniform1f(t.location,t.value);break;case SHADER_UNIFORM_TYPE_FLOAT2:e.uniform2f(t.location,t.value.x,t.value.y);break;case SHADER_UNIFORM_TYPE_FLOAT3:e.uniform3f(t.location,t.value.x,t.value.y,t.value.z);break;case SHADER_UNIFORM_TYPE_FLOAT4:e.uniform4f(t.location,t.value.x,t.value.y,t.value.z,t.value.w);break;case SHADER_UNIFORM_TYPE_INT1:e.uniform1i(t.location,t.value);break;case SHADER_UNIFORM_TYPE_INT2:e.uniform2i(t.location,t.value.x,t.value.y);break;case SHADER_UNIFORM_TYPE_INT3:e.uniform3i(t.location,t.value.x,t.value.y,t.value.z);break;case SHADER_UNIFORM_TYPE_INT4:e.uniform4i(t.location,t.value.x,t.value.y,t.value.z,t.value.w);break;case SHADER_UNIFORM_TYPE_FLOATV1:e.uniform1fv(t.location,t.value);break;case SHADER_UNIFORM_TYPE_FLOATV2:e.uniform2fv(t.location,t.value);break;case SHADER_UNIFORM_TYPE_FLOATV3:e.uniform3fv(t.location,t.value);break;case SHADER_UNIFORM_TYPE_FLOATV4:e.uniform4fv(t.location,t.value);break;case SHADER_UNIFORM_TYPE_INTV1:e.uniform1iv(t.location,t.value);break;case SHADER_UNIFORM_TYPE_INTV2:e.uniform2iv(t.location,t.value);break;case SHADER_UNIFORM_TYPE_INTV3:e.uniform3iv(t.location,t.value);break;case SHADER_UNIFORM_TYPE_INTV4:e.uniform4iv(t.location,t.value);break;case SHADER_UNIFORM_TYPE_MATRIX2:e.uniformMatrix2fv(t.location,!1,t.value._data);break;case SHADER_UNIFORM_TYPE_MATRIX3:e.uniformMatrix3fv(t.location,!1,t.value._data);break;case SHADER_UNIFORM_TYPE_MATRIX4:e.uniformMatrix4fv(t.location,!1,t.value._data);break;case SHADER_UNIFORM_TYPE_TEXTURE0:e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.value);break;case SHADER_UNIFORM_TYPE_TEXTURE1:e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t.value);break;case SHADER_UNIFORM_TYPE_TEXTURE2:e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,t.value);break;case SHADER_UNIFORM_TYPE_TEXTURE3:e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,t.value);break;case SHADER_UNIFORM_TYPE_TEXTURE4:e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,t.value);break;case SHADER_UNIFORM_TYPE_TEXTURE5:e.activeTexture(e.TEXTURE5),e.bindTexture(e.TEXTURE_2D,t.value);break;case SHADER_UNIFORM_TYPE_TEXTURE6:e.activeTexture(e.TEXTURE6),e.bindTexture(e.TEXTURE_2D,t.value);break;case SHADER_UNIFORM_TYPE_TEXTURE7:e.activeTexture(e.TEXTURE7),e.bindTexture(e.TEXTURE_2D,t.value)}}},DIRTY_TRANSLATION=1,DIRTY_SCALE=2,DIRTY_ROTATION=4,DIRTY_UV=8,DIRTY_CONTENT_SIZE=16,DIRTY_COLOR=32,DIRTY_WORLD_MATRIX=64,DIRTY_ANCHOR=128,g.prototype={constructor:g,dispose:function(){for(var t=0;t<this._children.length;++t)this._children[t].dispose()},addChild:function(t){t._parent!==this&&(t._parent&&t._parent.removeChild(t),this._children.push(t),t._parent=this)},removeChild:function(t){if(t._parent===this)for(var e=0;e<this._children.length;++e)this._children[e]===t&&(this._children.splice(e,1),t._parent=null,t.dispose())},getLocalMatrix:function(){var t,e,i,r,o,n,s,a,h,c,u,l;return this._local_matrix=new d(1,0,0,0,0,1,0,0,0,0,1,0,(t=this.position).x,t.y,t.z,1),0===this.rotation.x&&0===this.rotation.y&&0===this.rotation.z||(this._rotation_matrix=(e=this.rotation,i=f(-e.y),r=f(-e.x),o=f(-e.z),n=Math.cos(i),s=Math.sin(i),a=Math.cos(r),h=Math.sin(r),c=Math.cos(o),u=Math.sin(o),new d(n*c+s*h*u,-n*u+s*h*c,s*a,0,u*a,c*a,-h,0,-s*c+n*h*u,u*s+n*h*c,n*a,0,0,0,0,1)),this._local_matrix.multiply(this._rotation_matrix)),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||(this._scalar_matrix=new d((l=this.scale).x,0,0,0,0,l.y,0,0,0,0,1,0,0,0,0,1),this._local_matrix.multiply(this._scalar_matrix)),this._dirty_flags&=~(DIRTY_TRANSLATION|DIRTY_SCALE|DIRTY_ROTATION),this._local_matrix},getWorldMatrix:function(t){return(t||this._dirty_flags&DIRTY_WORLD_MATRIX)&&(this._parent?(this._world_matrix.setTo(this._parent.getWorldMatrix()),this._world_matrix.multiply(this.getLocalMatrix())):this._world_matrix.setTo(this.getLocalMatrix()),this._dirty_flags&=~DIRTY_WORLD_MATRIX),this._world_matrix},render:function(t,e,i){if(this.visible){i&&this.getWorldMatrix(i);for(var r=0;r<this._children.length;++r)this._children[r].render(t,e,this._need_update_flag||i);this._need_update_flag=!1}},hittest:function(t){return!1}},BK_SPRITE_UV_ROTATE_NONE=0,BK_SPRITE_UV_ROTATE_CW_90=1,BK_SPRITE_UV_ROTATE_CW_180=2,BK_SPRITE_UV_ROTATE_CW_270=3,BK_SPRITE_UV_ROTATE_CCW_90=4,BK_SPRITE_UV_ROTATE_CCW_180=5,BK_SPRITE_UV_ROTATE_CCW_270=6,BK_BLEND_MODE_ADDITIVE=0,BK_BLEND_MODE_MULTIPLY=1,BK_BLEND_MODE_INTERPOLATIVE=2,BK_BLEND_MODE_SCREEN=3,((_.prototype=Object.create(g.prototype)).constructor=_).prototype.dispose=function(){var t=bkWebGLGetInstance();this._tex&&this._tex.need_delete&&(t.deleteTexture(this._tex.texture),this._tex=null),this._vbo&&(t.deleteBuffer(this._vbo),t.deleteBuffer(this._ibo),this._vbo=null,this._ibo=null),g.prototype.dispose.call(this)},_.prototype.setTexture=function(t){void 0!==this._tex&&this._tex.need_delete&&bkWebGLGetInstance().deleteTexture(this._tex.texture),this._tex=t,this._tex_height=t?(this._tex_width=t.width,t.height):this._tex_width=0},_.prototype.adjustTexturePosition=function(t,e,i,r,o){this._origin_tex_uv[3].y=o?(this._origin_tex_uv[0].x=(t+r)/this._tex_width,this._origin_tex_uv[0].y=(e+i)/this._tex_height,this._origin_tex_uv[1].x=(t+r)/this._tex_width,this._origin_tex_uv[1].y=e/this._tex_height,this._origin_tex_uv[2].x=t/this._tex_width,this._origin_tex_uv[2].y=e/this._tex_height,this._origin_tex_uv[3].x=t/this._tex_width,(e+i)/this._tex_height):(this._origin_tex_uv[0].x=t/this._tex_width,this._origin_tex_uv[0].y=e/this._tex_height,this._origin_tex_uv[1].x=(t+i)/this._tex_width,this._origin_tex_uv[1].y=e/this._tex_height,this._origin_tex_uv[2].x=(t+i)/this._tex_width,this._origin_tex_uv[2].y=(e+r)/this._tex_height,this._origin_tex_uv[3].x=t/this._tex_width,(e+r)/this._tex_height),this.dirty(DIRTY_UV)},_.prototype.render=function(t,e,i){if(this.visible){if(i&&this.getWorldMatrix(i),this._vbo||(this._vbo=t.createBuffer(),this._ibo=t.createBuffer(),this._indices=new Uint16Array([0,3,1,1,3,2]),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._ibo),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)),this._dirty_flags&DIRTY_UV){var r=1;this._stretch_x||0===this._content_size.width||0===this._tex_width||(r=this._content_size.width/this._tex_width);var o=1;this._stretch_y||0===this._content_size.height||0===this._tex_height||(o=this._content_size.height/this._tex_height);var n=this._origin_tex_uv.slice(0);this.flip_u&&(n=[n[1],n[0],n[3],n[2]]),this.flip_v&&(n=[n[3],n[2],n[1],n[0]]),this._uv_rotate===BK_SPRITE_UV_ROTATE_CW_90||this._uv_rotate===BK_SPRITE_UV_ROTATE_CCW_270?n=[n[3],n[0],n[1],n[2]]:this._uv_rotate===BK_SPRITE_UV_ROTATE_CW_270||this._uv_rotate===BK_SPRITE_UV_ROTATE_CW_270?n=[n[1],n[2],n[3],n[0]]:this._uv_rotate!==BK_SPRITE_UV_ROTATE_CW_180&&this._uv_rotate!==BK_SPRITE_UV_ROTATE_CCW_180||(n=[n[2],n[3],n[0],n[1]]),this._vertices[7]=r*n[0].x,this._vertices[8]=o*n[0].y,this._vertices[16]=r*n[1].x,this._vertices[17]=o*n[1].y,this._vertices[25]=r*n[2].x,this._vertices[26]=o*n[2].y,this._vertices[34]=r*n[3].x,this._vertices[35]=o*n[3].y,this._dirty_flags&=~DIRTY_UV}if(i||this._dirty_flags&(DIRTY_CONTENT_SIZE|DIRTY_WORLD_MATRIX|DIRTY_ANCHOR)){var s=this.getWorldMatrix(i),h={x:-this._content_size.width*this._anchor.x,y:this._content_size.height*(1-this._anchor.y)},c={x:this._content_size.width*(1-this._anchor.x),y:this._content_size.height*(1-this._anchor.y)},u={x:-this._content_size.width*this._anchor.x,y:-this._content_size.height*this._anchor.y},l={x:this._content_size.width*(1-this._anchor.x),y:-this._content_size.height*this._anchor.y};h=s.multiplyXY(h),c=s.multiplyXY(c),u=s.multiplyXY(u),l=s.multiplyXY(l),this._vertices[0]=h.x,this._vertices[1]=h.y,this._vertices[9]=c.x,this._vertices[10]=c.y,this._vertices[18]=l.x,this._vertices[19]=l.y,this._vertices[27]=u.x,this._vertices[28]=u.y,this._dirty_flags&=~(DIRTY_CONTENT_SIZE|DIRTY_ANCHOR)}if(this._dirty_flags&DIRTY_COLOR){var d=this.color.a,f=this.color.r*d,_=this.color.g*d,p=this.color.b*d;this._vertices[3]=f,this._vertices[4]=_,this._vertices[5]=p,this._vertices[6]=a,this._vertices[12]=f,this._vertices[13]=_,this._vertices[14]=p,this._vertices[15]=a,this._vertices[21]=f,this._vertices[22]=_,this._vertices[23]=p,this._vertices[24]=a,this._vertices[30]=f,this._vertices[31]=_,this._vertices[32]=p,this._vertices[33]=a,this._dirty_flags&=~DIRTY_COLOR}t.bindBuffer(t.ARRAY_BUFFER,this._vbo),t.bufferData(t.ARRAY_BUFFER,this._vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._ibo),e.set_uniform("Texture",this._tex.texture),e.bind(),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),g.prototype.render.call(this,t,e,i)}},_.prototype.hittest=function(t){var e=this.getWorldMatrix(),i=e.multiplyXY({x:-this._content_size.width*this._anchor.x,y:-this._content_size.height*this._anchor.y}),r=e.multiplyXY({x:this._content_size.width*(1-this._anchor.x),y:this._content_size.height*(1-this._anchor.y)});return t.x>=i.x&&t.x<=r.x&&t.y>=i.y&&t.y<=r.y},((n.prototype=Object.create(_.prototype)).constructor=n).prototype.addTouchListener=function(){"undefined"!=typeof UIEventHandler?(UIEventHandler.addNodeEvent(this,1,function(t,e,i,r){t.isCancelClick=!1,t.enable?t.changeStatus(1):t.changeStatus(2)}.bind(this)),UIEventHandler.addNodeEvent(this,2,function(t,e,i,r){var o={x:i,y:r};0==t.hittest(o)&&(t.isCancelClick=!0)}.bind(this)),UIEventHandler.addNodeEvent(this,3,function(t,e,i,r){t.enable?t.changeStatus(0):t.changeStatus(2),0==t.isCancelClick&&t.touchInsideCallback&&1==this.canClick&&t.touchInsideCallback(t)}.bind(this))):BK.Script.log(1,1,"UIEventHandler is undefined")},n.prototype.setTouchInsideCallback=function(t){this.touchInsideCallback=t},n.prototype.dispose=function(){UIEventHandler.removeNodeEvent(this,1),UIEventHandler.removeNodeEvent(this,2),UIEventHandler.removeNodeEvent(this,3),_.prototype.dispose.call(this)},n.prototype.changeStatus=function(t){this.touchStatus=t,this.updateTexture(t)},n.prototype.updateTexture=function(t){},e.prototype={constructor:e,setHidden:function(t){this._root_node?this._root_node.hidden=t:BK.Script.log(1,1,"set hidden error.root_node is null")},dispose:function(){this._is_webgl?(this._root_node.dispose(),this._root_node=void 0,this.webGL_exit()):this._root_node.removeFromParent()},_onTouchInside:function(){BK.Script.log(1,1,"_onTouchInside"),this._clickInsideCallback&&this._clickInsideCallback()},setClickContentCallback:function(t){this._clickInsideCallback=t},create_texture:function(t,e){if(this._is_webgl){var i=this._gl,r=i.RGBA,o=i.RGBA,n=i.UNSIGNED_BYTE,s=BK.Image.loadImage(t,6),a=i.createTexture();return i.bindTexture(i.TEXTURE_2D,a),i.texImage2D(i.TEXTURE_2D,0,r,o,n,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),{width:s.width,height:s.height,texture:a,tex_file:t,need_delete:e}}return new BK.Texture(t)},create_clip_node:function(t,e){if(this._is_webgl){m()&&(e.x+=.5*BK.Director.screenPixelSize.width,e.y=u());var i=new g;return this._clip_rect=e,t.addChild(i),i}return(i=new BK.ClipRectNode(e.x,e.y,e.width,e.height)).enableClip=!0,t.addChild(i),i},create_node:function(t){if(this._is_webgl){var e=new g;return void 0!==t?t.addChild(e):this._gl_root_node.addChild(e),e}return e=new BK.Node,void 0!==t?t.addChild(e):BK.Director.root.addChild(e),e},create_sprite:function(t,e,i,r){var o=this.create_texture(e,r);return this.create_sprite_with_texture(t,o,i)},create_button:function(t,e,i,r){if(this._is_webgl){var o=new n(i.width,i.height,e,0,1,1,1);return r&&o.setTouchInsideCallback(r),void 0!==t?t.addChild(o):this._gl_root_node.addChild(o),o}return(o=new BK.Button(i.width,i.height)).setNormalTexture(e),o.updateTexture=function(){},r&&o.setTouchInsideCallback(r),void 0!==t?t.addChild(o):BK.Director.root.addChild(o),o},create_sprite_with_texture:function(t,e,i){if(this._is_webgl){var r=new _(i.width,i.height,e,0,1,1,1);return void 0!==t?t.addChild(r):this._gl_root_node.addChild(r),r}return r=new BK.Sprite(i.width,i.height,e,0,1,1,1),void 0!==t?t.addChild(r):BK.Director.root.addChild(r),r},create_text:function(t,e){if(this._is_webgl){var i=new BK.CanvasNode(t.maxWidth,t.maxHeight);i.fillColor=t.textColor,i.strokeColor=t.strokeColor,i.setTextAlign(t.textAlign),i.setTextSize(t.fontSize),i.setTextItalic(t.italic),i.setTextBold(t.bold),i.setTextShadow(t.shadowDx,t.shadowDy,t.shadowRadius,t.shadowColor);var r=i.measureText(e,t.maxWidth,t.maxHeight);i.drawText(e,0,0,r.width,r.height);var o=i.getBitmap(),n=this._gl,s=n.RGBA,a=n.RGBA,h=n.UNSIGNED_BYTE,c=n.createTexture();n.bindTexture(n.TEXTURE_2D,c),n.texImage2D(n.TEXTURE_2D,0,s,a,h,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR);var u={width:o.width,height:o.height,texture:c,tex_file:e,need_delete:!0},l=new _(o.width,o.height,u,0,1,1,1);return l.anchor={x:0,y:0},l.width=r.width,l.height=r.height,l}return t.textColor=p(t.textColor),t.strokeColor=p(t.strokeColor),t.shadowColor=p(t.shadowColor),new BK.TextNode(t,e)},show:function(t){if(!this._is_webgl){var e=BK.Director.root.scale;this._root_node.scale={x:1/e.x,y:1/e.y,z:1/e.z},this._root_node.enableClip=m()}void 0!==this._real_content_node&&this._content_node.removeChild(this._real_content_node),this._real_content_node=this.create_node(this._content_node),void 0!==t.content&&20<t.content.length&&(t.content=t.content.substring(0,20),t.content=t.content+"...");var i=this._ad_final_size[t.ad_type];switch(t.ad_type){case AD_BANNER_TYPE_DYNAMIC_193_582_166:case AD_BANNER_TYPE_STATIC_193_582_166:this.create_sprite(this._real_content_node,t.tex_files[0],i,!0).anchor={x:0,y:1};break;case AD_BANNER_TYPE_DYNAMIC_194_147_147:case AD_BANNER_TYPE_STATIC_194_147_147:this.create_sprite(this._real_content_node,t.tex_files[0],i,!0).anchor={x:0,y:1};var r=15*STANDARD_SCALE,o=0;o=t.ad_type===AD_BANNER_TYPE_DYNAMIC_194_147_147?this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width-i.width-80*STANDARD_SCALE-r:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width-i.width-2*r;var n=26,s=this.create_text({fontSize:n*STANDARD_SCALE,textColor:{r:.2,g:.2,b:.2,a:1},maxWidth:o,maxHeight:30*STANDARD_SCALE,width:o,height:30*STANDARD_SCALE,textAlign:0,bold:1,italic:0,strokeColor:{r:1,g:1,b:1,a:1},strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:{r:1,g:1,b:1,a:1}},t.title);s.position={x:i.width+r,y:-50*STANDARD_SCALE},this._real_content_node.addChild(s),(_=this.create_text({fontSize:n*STANDARD_SCALE,textColor:{r:.4,g:.4,b:.4,a:1},maxWidth:o,maxHeight:60*STANDARD_SCALE,width:o,height:60*STANDARD_SCALE,textAlign:0,bold:0,italic:0,strokeColor:{r:1,g:1,b:1,a:1},strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:{r:1,g:1,b:1,a:1}},t.content)).anchor={x:0,y:1},_.position={x:i.width+r,y:-65*STANDARD_SCALE},this._real_content_node.addChild(_);break;case AD_BANNER_TYPE_DYNAMIC_184_240_180:case AD_BANNER_TYPE_STATIC_184_240_180:this.create_sprite(this._real_content_node,t.tex_files[0],i,!0).anchor={x:0,y:1},r=15*STANDARD_SCALE,o=0,o=t.ad_type===AD_BANNER_TYPE_DYNAMIC_184_240_180?this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width-i.width-60*STANDARD_SCALE-r:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width-i.width-2*r,n=26,(_=this.create_text({fontSize:n*STANDARD_SCALE,textColor:{r:.2,g:.2,b:.2,a:1},maxWidth:o,maxHeight:60*STANDARD_SCALE,width:o,height:60*STANDARD_SCALE,textAlign:0,bold:0,italic:0,strokeColor:{r:1,g:1,b:1,a:1},strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:{r:1,g:1,b:1,a:1}},t.content)).anchor={x:0,y:1},_.position={x:i.width+r,y:.5*(_.height-i.height)},this._real_content_node.addChild(_);break;case AD_BANNER_TYPE_DYNAMIC_285_240_180_3:case AD_BANNER_TYPE_STATIC_285_240_180_3:var a=23*STANDARD_SCALE,h=0,c=0,u=3*STANDARD_SCALE;t.ad_type===AD_BANNER_TYPE_STATIC_285_240_180_3&&(a=11*STANDARD_SCALE,h=11*STANDARD_SCALE,c=-6*STANDARD_SCALE,u=4*STANDARD_SCALE);var l=this.create_sprite(this._real_content_node,t.tex_files[0],i,!0);l.anchor={x:0,y:1},l.position={x:h,y:c};var d=this.create_sprite(this._real_content_node,t.tex_files[1],i,!0);d.anchor={x:0,y:1},d.position={x:h+i.width+a,y:c};var f=this.create_sprite(this._real_content_node,t.tex_files[2],i,!0);f.anchor={x:0,y:1},f.position={x:h+2*(i.width+a),y:c},o=0,o=t.ad_type===AD_BANNER_TYPE_DYNAMIC_285_240_180_3?this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width-40*STANDARD_SCALE:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width-40*STANDARD_SCALE,n=24,(_=this.create_text({fontSize:n*STANDARD_SCALE,textColor:{r:.2,g:.2,b:.2,a:1},maxWidth:o,maxHeight:30*STANDARD_SCALE,width:o,height:30*STANDARD_SCALE,textAlign:1,bold:0,italic:0,strokeColor:{r:1,g:1,b:1,a:1},strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:{r:1,g:1,b:1,a:1}},t.content)).anchor={x:.5,y:1},_.position={x:.5*o,y:-i.height-u},this._real_content_node.addChild(_);break;case AD_BANNER_TYPE_DYNAMIC_210_640_288:case AD_BANNER_TYPE_STATIC_210_640_288:this.create_sprite(this._real_content_node,t.tex_files[0],i,!0).anchor={x:0,y:1},r=10*STANDARD_SCALE,o=0,o=t.ad_type===AD_BANNER_TYPE_DYNAMIC_210_640_288?this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width-i.width-50*STANDARD_SCALE-r:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width-i.width-2*r,n=24,(_=this.create_text({fontSize:n*STANDARD_SCALE,textColor:{r:.2,g:.2,b:.2,a:1},maxWidth:o,maxHeight:120*STANDARD_SCALE,width:o,height:120*STANDARD_SCALE,textAlign:0,bold:0,italic:0,strokeColor:{r:1,g:1,b:1,a:1},strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:{r:1,g:1,b:1,a:1}},t.content)).anchor={x:0,y:.5},_.position={x:i.width+r,y:.5*-i.height},this._real_content_node.addChild(_);break;case AD_BANNER_TYPE_DYNAMIC_65_1000_560:case AD_BANNER_TYPE_STATIC_65_1000_560:var _;this.create_sprite(this._real_content_node,t.tex_files[0],i,!0).anchor={x:0,y:1},r=10*STANDARD_SCALE,o=0,o=t.ad_type===AD_BANNER_TYPE_DYNAMIC_65_1000_560?this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width-i.width-50*STANDARD_SCALE-r:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width-i.width-2*r,n=26,(_=this.create_text({fontSize:n*STANDARD_SCALE,textColor:{r:.2,g:.2,b:.2,a:1},maxWidth:o,maxHeight:120*STANDARD_SCALE,width:o,height:120*STANDARD_SCALE,textAlign:0,bold:0,italic:0,strokeColor:{r:1,g:1,b:1,a:1},strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:{r:1,g:1,b:1,a:1}},t.content)).anchor={x:0,y:.5},_.position={x:i.width+r,y:.5*-i.height},this._real_content_node.addChild(_)}var p=t.ad_type>=AD_BANNER_TYPE_DYNAMIC_193_582_166&&t.ad_type<=AD_BANNER_TYPE_DYNAMIC_65_1000_560;this.anim_node_1(p),this.anim_node_2(p,t.ad_type===AD_BANNER_TYPE_STATIC_285_240_180_3?11*STANDARD_SCALE:0,t.ad_type===AD_BANNER_TYPE_STATIC_285_240_180_3?25*STANDARD_SCALE:0),this.anim_node_3(p)},update:function(t){this._node_1.update_tweens(t),this._node_2.update_tweens(t),this._node_3.update_tweens(t)},node_extend:function(t){return t._next_tween_handler=0,t._all_tween_data=[],t.tween_from_to=function(t,e,i,r,o,n,s){var a=this._next_tween_handler;return this._next_tween_handler+=1,this._all_tween_data.push({attr_type:t,duration:e,delay:i,interval:r,from:o,to:n,loop_count:s,pass_time:-i,handler:a,is_stop:!1}),a},t.remove_tween=function(t){for(;0<this._all_tween_data.length;)if(this._all_tween_data[0].handler===t)return void(this._all_tween_data[0].is_stop=!0)},t.update_tweens=function(t){for(var e=0;e<this._all_tween_data.length;){var i=this._all_tween_data[e];if(i.is_stop)this._all_tween_data.splice(e,1);else{if(i.pass_time+=t,i.pass_time>=i.duration)i.pass_time-=i.duration,-1===i.loop_count?(i.pass_time-=i.interval,this.update_tween_value(i,i.to)):(i.loop_count-=1,0<=i.loop_count?(i.pass_time-=i.interval,this.update_tween_value(i,i.to)):(this.update_tween_value(i,i.to),i.is_stop=!0));else if(0<i.pass_time){var r=(i.to-i.from)*(i.pass_time/i.duration)+i.from;this.update_tween_value(i,r)}++e}}},t.update_tween_value=function(t,e){switch(t.attr_type){case NODE_TWEEN_ATTR_TYPE_SCALE:this.scale={x:e,y:e};break;case NODE_TWEEN_ATTR_TYPE_SCALE_X:this.scale={x:e,y:this.scale.y};break;case NODE_TWEEN_ATTR_TYPE_SCALE_Y:this.scale={x:this.scale.x,y:e};break;case NODE_TWEEN_ATTR_TYPE_POSITION_X:this.position={x:e,y:this.position.y};break;case NODE_TWEEN_ATTR_TYPE_POSITION_Y:this.position={x:this.position.x,y:e};break;case NODE_TWEEN_ATTR_TYPE_OPACITY:this.opacity=e;break;case NODE_TWEEN_ATTR_TYPE_ROTATION_X:this.rotation={x:e,y:this.rotation.y,z:this.rotation.z};break;case NODE_TWEEN_ATTR_TYPE_ROTATION_Y:this.rotation={x:this.rotation.x,y:e,z:this.rotation.z};break;case NODE_TWEEN_ATTR_TYPE_ROTATION_Z:this.rotation={x:this.rotation.x,y:this.rotation.y,z:e}}},t},anim_node_1:function(t){if(t){var e=.5*-this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width+.4*this._ad_final_size[AD_BANNER_TYPE_RESERVED_0].width,i=0-.7*this._ad_final_size[AD_BANNER_TYPE_RESERVED_0].height;this._node_1.anchor={x:.8,y:.2},this._node_1.visible=!0,this._node_1.position={x:e,y:i},this._node_1.rotation={x:0,y:0,z:120},this._node_1.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_Y,.1,.2,0,i,0,0),this._node_1.tween_from_to(NODE_TWEEN_ATTR_TYPE_ROTATION_Z,.3,.2,0,120,10,0)}else this._node_1.visible=!1},anim_node_2:function(t,e,i){var r=.8,o=(t?this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width)*(r-.5);this._node_2.position={x:o,y:0},this._node_2_2.position=t?(this._node_2.rotation={x:0,y:0,z:120},this._node_2.tween_from_to(NODE_TWEEN_ATTR_TYPE_ROTATION_Z,.3,0,0,120,0,0),this._node_2_1.anchor={x:.5,y:.5},this._node_2_1.size=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1],this._node_2_1.setTexture(this._tex_bg_bg_1),this._node_2_1.position={x:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width*(.5-r),y:.5*this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].height},this._content_node.position={x:20*STANDARD_SCALE-this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width*r,y:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].height-6*STANDARD_SCALE},this._node_2_2.anchor={x:.5,y:.5},this._node_2_2.setTexture(this._tex_bg_fg_1),this._node_2_2.size=this._ad_final_size[AD_BANNER_TYPE_RESERVED_2_1],{x:this._ad_final_size[AD_BANNER_TYPE_RESERVED_2_1].width*(.5-r),y:.5*this._ad_final_size[AD_BANNER_TYPE_RESERVED_2_1].height}):(this._node_2.rotation={x:0,y:0,z:0},this._node_2_1.anchor={x:.5,y:.5},this._node_2_1.size=this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2],this._node_2_1.setTexture(this._tex_bg_bg_2),this._node_2_1.position={x:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width*(.5-r),y:.5*this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].height},this._content_node.position={x:-this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width*r,y:this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].height},this._node_2_2.anchor={x:0,y:0},this._node_2_2.size=this._ad_final_size[AD_BANNER_TYPE_RESERVED_2_2],this._node_2_2.setTexture(this._tex_bg_fg_2),{x:5*STANDARD_SCALE+this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_2].width*-r+e,y:5*STANDARD_SCALE+i})},anim_node_3:function(t){if(t){var e=.5*this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width+.15*this._ad_final_size[AD_BANNER_TYPE_RESERVED_3].width,i=.5*this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].height-.1*this._ad_final_size[AD_BANNER_TYPE_RESERVED_3].height,r=.3*this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].width,o=-this._ad_final_size[AD_BANNER_TYPE_RESERVED_1_1].height,n=Math.sqrt((e-r)*(e-r)+(i-o)*(i-o)),s=(e-r)/n,a=(i-o)/n,h=e+this._ad_final_size[AD_BANNER_TYPE_RESERVED_3].width*s*.2,c=i+this._ad_final_size[AD_BANNER_TYPE_RESERVED_3].height*a*.2,u=e-this._ad_final_size[AD_BANNER_TYPE_RESERVED_3].width*s*.1,l=i-this._ad_final_size[AD_BANNER_TYPE_RESERVED_3].height*a*.1;this._node_3.anchor={x:.5,y:.5},this._node_3.visible=!0,this._node_3.position={x:r,y:o},this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_X,.3,.1,0,r,h,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_Y,.3,.1,0,o,c,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_X,.15,.4,0,h,u,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_Y,.15,.4,0,c,l,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_ROTATION_Z,.15,.4,0,0,5,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_X,.08,.55,0,u,e,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_POSITION_Y,.08,.55,0,l,i,0),this._node_3.tween_from_to(NODE_TWEEN_ATTR_TYPE_ROTATION_Z,.08,.55,0,5,0,0)}else this._node_3.visible=!1},gl_commit:function(t){var e=t._gl;UIEventHandler&&UIEventHandler.setRootNode(t._root_node),t.webGL_save(),e.viewport(0,0,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height),e.disable(e.DEPTH_TEST),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);var i,r,o,n,s,a,h=(i=0,r=BK.Director.screenPixelSize.width,o=0,n=BK.Director.screenPixelSize.height,new d(2/(r-i),0,0,0,0,2/(n-o),0,0,0,0,2/((s=-1)-(a=1)),0,(i+r)/(i-r),(n+o)/(o-n),(s+a)/(s-a),1));t._webgl_shader.set_uniform("Projection",h);var c=new d;t._webgl_shader.set_uniform("ModelView",c),t._gl_root_node.render(e,t._webgl_shader,!0),t.webGL_restore(),e.superGLCommit()},webGL_init:function(){this._gl=bkWebGLGetInstance(),this._gl_root_node=new g,this._webgl_shader=this.webGL_load_shader(),this._gl.superGLCommit=this._gl.glCommit,this._gl.glCommit=this.gl_commit.bind(this._gl,this)},webGL_load_shader:function(){var t=new d,e={vs_source:"attribute vec3 Position;attribute vec4 SourceColor;varying vec4 DestinationColor;uniform mat4 Projection;uniform mat4 ModelView;attribute vec2 TexCoordIn;varying vec2 TexCoordOut;void main(void) {    DestinationColor = SourceColor;    mat4 mp = Projection * ModelView;    gl_Position = mp * vec4(Position, 1.0);    TexCoordOut = TexCoordIn;}",fs_source:"varying lowp vec4 DestinationColor;varying lowp vec2 TexCoordOut;uniform sampler2D Texture;void main(void) {    lowp vec4 tc = texture2D(Texture, TexCoordOut);    gl_FragColor = DestinationColor * tc;}",attributes:[{name:"Position",size:3},{name:"SourceColor",size:4},{name:"TexCoordIn",size:2}],uniforms:[{name:"Projection",type:SHADER_UNIFORM_TYPE_MATRIX4,default_value:t},{name:"ModelView",type:SHADER_UNIFORM_TYPE_MATRIX4,default_value:t},{name:"Texture",type:SHADER_UNIFORM_TYPE_TEXTURE0,default_value:0}]};return new i(this._gl,e)},webGL_exit:function(){void 0!==this._gl.superGLCommit&&(this._gl.glCommit=this._gl.superGLCommit,this._gl.superGLCommit=void 0),this._tex_bg_left&&(this._gl.deleteTexture(this._tex_bg_left.texture),this._gl.deleteTexture(this._tex_bg_bg_1.texture),this._gl.deleteTexture(this._tex_bg_bg_2.texture),this._gl.deleteTexture(this._tex_bg_fg_1.texture),this._gl.deleteTexture(this._tex_bg_fg_2.texture),this._gl.deleteTexture(this._tex_bg_right.texture))},webGL_save:function(){m()&&(this._is_clip_enabled=this._gl.glIsEnabled(this._gl.SCISSOR_TEST),this._is_clip_enabled?this._old_scissor=this._gl.glGetParameterInt(this._gl.SCISSOR_BOX,4):this._gl.glEnable(this._gl.SCISSOR_TEST),this._gl.glScissor(this._clip_rect.x,this._clip_rect.y,this._clip_rect.width,this._clip_rect.height)),this._is_enable_blend=this._gl.glIsEnabled(this._gl.BLEND),this._is_enable_blend&&(this._blend_color=this._gl.glGetParameterFloat(this._gl.BLEND_COLOR,4),this._blend_equation_rgb=this._gl.getParameter(this._gl.BLEND_EQUATION_RGB),this._blend_equation_alpha=this._gl.getParameter(this._gl.BLEND_EQUATION_ALPHA),this._blend_src_rgb=this._gl.getParameter(this._gl.BLEND_SRC_RGB),this._blend_src_alpha=this._gl.getParameter(this._gl.BLEND_SRC_ALPHA),this._blend_dst_rgb=this._gl.getParameter(this._gl.BLEND_DST_RGB),this._blend_dst_alpha=this._gl.getParameter(this._gl.BLEND_DST_ALPHA)),this._prevVP=this._gl.glGetParameterInt(this._gl.VIEWPORT,4),this._prevVBO=this._gl.glGetParameterInt(this._gl.ARRAY_BUFFER_BINDING,1),this._prevIBO=this._gl.glGetParameterInt(this._gl.ELEMENT_ARRAY_BUFFER_BINDING,1),this._prevProgram=this._gl.glGetParameterInt(this._gl.CURRENT_PROGRAM,1),this._prevTextureID=this._gl.glGetParameterInt(this._gl.TEXTURE_BINDING_2D,1),this._prevTextureUnit=this._gl.glGetParameterInt(this._gl.ACTIVE_TEXTURE,1),this._prevFrameBuffer=this._gl.glGetParameterInt(this._gl.FRAMEBUFFER_BINDING,1),this._prevRenderBuffer=this._gl.glGetParameterInt(this._gl.RENDERBUFFER_BINDING,1),this._activeAttribusInfo=[];for(var t=this._gl.glGetProgramParameter(this._prevProgram,b.ACTIVE_ATTRIBUTES),e=0;e<t;++e){var i=this._gl.getActiveAttrib(this._prevProgram,e),r=i.name,o=this._gl.getAttribLocation(this._prevProgram,r),n=this._gl.getVertexAttrib(o,this._gl.VERTEX_ATTRIB_ARRAY_SIZE),s=this._gl.getVertexAttrib(o,this._gl.VERTEX_ATTRIB_ARRAY_TYPE),a=this._gl.getVertexAttrib(o,this._gl.VERTEX_ATTRIB_ARRAY_NORMALIZED),h=this._gl.getVertexAttrib(o,this._gl.VERTEX_ATTRIB_ARRAY_STRIDE),c=this._gl.getVertexAttribOffset(o,b.VERTEX_ATTRIB_ARRAY_POINTER);if(i.name=r,i.index=o,i.size=n,i.type=s,i.normalized=a,i.stride=h,i.offset=c,void 0!==this._gl.recordVertexAttribPointer)for(var u=0;u<this._gl.recordVertexAttribPointer.length;u++){var l=this._gl.recordVertexAttribPointer[u];if(i.index==l.index&&i.type==l.type&&i.stride==l.stride&&i.offset==l.offset){i.index=l.index,i.size=l.size,i.type=l.type,i.normalized=l.normalized,i.stride=l.stride,i.offset=l.offset;break}}this._activeAttribusInfo.push(i)}},webGL_restore:function(){if(this._is_enable_blend?(this._gl.glEnable(this._gl.BLEND),this._gl.blendColor(this._blend_color[0],this._blend_color[1],this._blend_color[2],this._blend_color[3]),this._gl.blendEquationSeparate(this._blend_equation_rgb,this._blend_equation_alpha),this._gl.blendFuncSeparate(this._blend_src_rgb,this._blend_dst_rgb,this._blend_src_alpha,this._blend_dst_alpha)):this._gl.glDisable(this._gl.BLEND),this._gl.viewport(this._prevVP[0],this._prevVP[1],this._prevVP[2],this._prevVP[3]),this._gl.useProgram(this._prevProgram),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._prevVBO),0<this._activeAttribusInfo.length){this._activeAttribusInfo[0].stride;for(var t=0;t<this._activeAttribusInfo.length;t++){var e=this._activeAttribusInfo[t],i=(e.name,e.index),r=e.size,o=e.type,n=e.normalized,s=e.offset,a=e.stride,h=0!=n;this._gl.vertexAttribPointer(i,r,o,h,a,s,!0)}}this._activeAttribusInfo=[],this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._prevIBO),this._gl.activeTexture(this._prevTextureUnit),this._gl.bindTexture(this._gl.TEXTURE_2D,this._prevTextureID),this._gl.glBindFramebuffer(this._gl.FRAMEBUFFER,this._prevFrameBuffer),this._gl.glBindRenderbuffer(this._gl.RENDERBUFFER,this._prevRenderBuffer),m()&&(this._is_clip_enabled?this._gl.glScissor(this._old_scissor[0],this._old_scissor[1],this._old_scissor[2],this._old_scissor[3]):this._gl.glDisable(this._gl.SCISSOR_TEST))}},{AdAnimateBanner:e}}().AdAnimateBanner)}(BK);y=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(t,e){var o,n;"object"==typeof t&&(t.AdAnimateBannerHandler=(o=function(){function t(t,e){this.info=t,this.download(e)}return t.prototype.download=function(r){var o="GameSandBox://__bkDownloadCache/"+BK.Crypt.hex_md5(this.info.url);this.info.savePath&&(o=this.info.savePath);var t=!!this.info.useCache&&this.info.useCache,e=!0;if(1==t&&1==BK.FileUtil.isFileExist(o)){e=!1;var i={url:this.info.url,statueCode:200,savePath:o};r(i)}if(1==e){var n=new BK.HttpUtil(this.info.url);n.requestAsync(function(t,e){200==e?BK.FileUtil.writeBufferToFile(o,t):BK.Script.log(1,1,"Fetch banner image failed.url:"+this.info.url);var i={url:this.info.url,statueCode:e,savePath:o};r(i)}.bind(this))}},t}(),n=function(){function t(){}return t.download=function(t,e){this.completeTasks=[],this.reqTasks=t;for(var i=0;i<t.length;i++){var r=t[i];new o(r,function(t){this.completeTasks.push(t),this.check()&&e(this.completeTasks)}.bind(this))}BK.Director.ticker.setTimeout(function(){this.fillUncomplete(),e(this.completeTasks)}.bind(this),3e4,this)},t.cancelTimeOut=function(){BK.Director.ticker.removeTimeout(this)},t.fillUncomplete=function(){for(var t=0;t<this.reqTasks.length;t++){for(var e=this.reqTasks[t],i=!1,r=0;r<this.completeTasks.length;r++){var o=this.completeTasks[r];e.url==o.url&&(i=!0)}if(0==i){var n={url:e.url,statueCode:-1,savePath:e.savePath};this.completeTasks.push(n)}}},t.check=function(){return this.completeTasks.length==this.reqTasks.length&&(this.cancelTimeOut(),!0)},t}(),{AdAnimateBannerHandler:function(r){function t(t,e){var i=r.call(this,t,e)||this;return i.bannerContentInfo=i.parseInfo(i.adInfo),i.banner=null,i}return y(t,r),t.prototype.setHidden=function(t){this.banner?this.banner.setHidden(t):BK.Script.log(1,1,"set hidden fail ,this.banner is null")},t.prototype.show=function(o){this.bannerType=1,this._show(function(t,e,i){if(0==t)if(void 0!==this.bannerContentInfo.staticBannerType){this.banner=new BK.AdAnimateBanner(e),this.bannerContentInfo.ad_type=this.bannerContentInfo,this.bannerContentInfo.tex_files=i;var r={ad_type:this.bannerContentInfo.staticBannerType,tex_files:i,title:this.bannerContentInfo.title,content:this.bannerContentInfo.content};this.banner.setClickContentCallback(this._onClickContentCallback.bind(this)),this.banner.show(r),this._onShowCallback(),o(t,"show ok",this)}else o(-1,"show failed",null);else o(t,"show _show failed",null)}.bind(this))},t.prototype.showAnimate=function(o){this.bannerType=2,this._show(function(t,e,i){if(0==t)if(void 0!==this.bannerContentInfo.dynamicBannerType){this.banner=new BK.AdAnimateBanner(e),this.bannerContentInfo.ad_type=this.bannerContentInfo,this.bannerContentInfo.tex_files=i;var r={ad_type:this.bannerContentInfo.dynamicBannerType,tex_files:i,title:this.bannerContentInfo.title,content:this.bannerContentInfo.content};this.banner.setClickContentCallback(this._onClickContentCallback.bind(this)),this.banner.show(r),this._onShowCallback(),o(t,"showAnimate ok",this)}else o(-1,"fshowAnimate ailed",null);else o(t,"showAnimate _show failed",null)}.bind(this))},t.prototype._onShowCallback=function(){this.cmshowReport(1,"","",this.bannerType.toString()),this.exposeureReport()},t.prototype._jumpToGDTDestPage=function(){var t=this.adInfo;BK.MQQ.SsoRequest.send(t,"cs.xy_ad_banner_jump.local")},t.prototype._onClickContentCallback=function(){this.cmshowReport(3,"","",this.bannerType.toString()),this.clickReport(),1==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")||"android"===GameStatusInfo.platform&&1==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")?this._onClickContentBtn():(this._emmitClickEvent(),this._jumpToGDTDestPage())},t.prototype._show=function(r){if(!this.bannerContentInfo)return BK.Script.log(1,1,"show failed.ad info is illegal!"),void r(-2,null,null);this.loadRes(function(t,i){0==t?this.loadImage(function(t,e){r(t,i,e)}.bind(this)):r(-1,null,null)}.bind(this))},t.prototype.close=function(){this.banner?(this.banner.dispose(),this.banner=null):BK.Script.log(1,1,"close banner failed. banner has not been inited!")},t.prototype.loadImage=function(a){for(var h=[],t=0;t<this.bannerContentInfo.image.length;t++){var e=this.bannerContentInfo.image[t],i={url:e};h.push(i)}n.download(h,function(t){for(var e=!0,i=[],r=0;r<h.length;r++)for(var o=h[r],n=0;n<t.length;n++){var s=t[n];o.url==s.url&&(200!=s.statueCode?(BK.Script.log(1,1,"banner load image failed.url:"+s.url),e=!1):i.push(s.savePath))}a(1==e?0:-1,i)}.bind(this))},t.prototype.loadRes=function(u){n.download([{url:"https://qzonestyle.gtimg.cn/aoi/sola/20180713161350_Jwn4D4m83k.png",savePath:"GameSandBox://_bkAd/bg_left.png",useCache:!0},{url:"https://qzonestyle.gtimg.cn/aoi/sola/20180713161350_A8Q8Sow7O2.png",savePath:"GameSandBox://_bkAd/bg_right.png",useCache:!0},{url:"https://qzonestyle.gtimg.cn/aoi/sola/20180713161350_ufpiWlVIBh.png",savePath:"GameSandBox://_bkAd/bg_bg_2.png",useCache:!0},{url:"https://qzonestyle.gtimg.cn/aoi/sola/20180713161350_bb7MoaVYPP.png",savePath:"GameSandBox://_bkAd/bg_fg_2.png",useCache:!0},{url:"https://qzonestyle.gtimg.cn/aoi/sola/20180713161349_490ORk1ziJ.png",savePath:"GameSandBox://_bkAd/bg_fg_1.png",useCache:!0},{url:"https://qzonestyle.gtimg.cn/aoi/sola/20180713161349_I3ZMMhw8al.png",savePath:"GameSandBox://_bkAd/bg_bg_1.png",useCache:!0}],function(t){for(var e="",i="",r="",o="",n="",s="",a=!0,h=0;h<t.length;h++){var c=t[h];200!=c.statueCode&&(a=!1),0<c.savePath.indexOf("bg_bg_1")?r=c.savePath:0<c.savePath.indexOf("bg_bg_2")?o=c.savePath:0<c.savePath.indexOf("bg_fg_1")?n=c.savePath:0<c.savePath.indexOf("bg_fg_2")?s=c.savePath:0<c.savePath.indexOf("bg_left")?e=c.savePath:0<c.savePath.indexOf("bg_right")&&(i=c.savePath)}u(1==a?0:-1,{bg_left_path:e,bg_right_path:i,bg_bg_1_path:r,bg_bg_2_path:o,bg_fg_1_path:n,bg_fg_2_path:s})}.bind(this))},t.prototype.parseInfo=function(t){var e=t.display_info.creative_size,i={creative_size:this.creativeSize=e,content:"",title:""};switch(e){case 193:i.image=[t.display_info.basic_info.img],i.staticBannerType=6,i.dynamicBannerType=0;break;case 194:i.image=[t.display_info.basic_info.img],i.title=t.display_info.basic_info.txt,i.content=t.display_info.basic_info.desc,i.staticBannerType=7,i.dynamicBannerType=1;break;case 285:i.image=t.display_info.muti_pic_text_info.image,i.content=t.display_info.basic_info.txt,i.staticBannerType=9,i.dynamicBannerType=3;break;case 184:i.image=[t.display_info.basic_info.img],i.content=t.display_info.basic_info.txt,i.staticBannerType=8,i.dynamicBannerType=2;break;case 210:i.image=[t.display_info.basic_info.img],i.content=t.display_info.basic_info.txt,i.staticBannerType=10,i.dynamicBannerType=4;break;case 65:i.image=[t.display_info.basic_info.img],i.content=t.display_info.basic_info.txt,i.staticBannerType=11,i.dynamicBannerType=5;break;default:return BK.Script.log(1,1,"parseInfo failed."),null}return i},t}(BK.AdBannerHandler)}).AdAnimateBannerHandler)}(BK)}BK.Crypt=function(){function t(){this.hexcase=0,this.b64pad="",this.chrsz=8}return t.prototype.hex_md5=function(t){return this.bin2hex(this.core_md5(this.str2bin(t),t.length*this.chrsz))},t.prototype.b64_md5=function(t){return this.bin2b64(this.core_md5(this.str2bin(t),t.length*this.chrsz))},t.prototype.str_md5=function(t){return this.bin2str(this.core_md5(this.str2bin(t),t.length*this.chrsz))},t.prototype.hex_hmac_md5=function(t,e){return this.bin2hex(this.core_hmac_md5(t,e))},t.prototype.b64_hmac_md5=function(t,e){return this.bin2b64(this.core_hmac_md5(t,e))},t.prototype.str_hmac_md5=function(t,e){return this.bin2str(this.core_hmac_md5(t,e))},t.prototype.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc")},t.prototype.core_md5=function(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var i=1732584193,r=-271733879,o=-1732584194,n=271733878,s=0;s<t.length;s+=16){var a=i,h=r,c=o,u=n;i=this.md5_ff(i,r,o,n,t[s+0],7,-680876936),n=this.md5_ff(n,i,r,o,t[s+1],12,-389564586),o=this.md5_ff(o,n,i,r,t[s+2],17,606105819),r=this.md5_ff(r,o,n,i,t[s+3],22,-1044525330),i=this.md5_ff(i,r,o,n,t[s+4],7,-176418897),n=this.md5_ff(n,i,r,o,t[s+5],12,1200080426),o=this.md5_ff(o,n,i,r,t[s+6],17,-1473231341),r=this.md5_ff(r,o,n,i,t[s+7],22,-45705983),i=this.md5_ff(i,r,o,n,t[s+8],7,1770035416),n=this.md5_ff(n,i,r,o,t[s+9],12,-1958414417),o=this.md5_ff(o,n,i,r,t[s+10],17,-42063),r=this.md5_ff(r,o,n,i,t[s+11],22,-1990404162),i=this.md5_ff(i,r,o,n,t[s+12],7,1804603682),n=this.md5_ff(n,i,r,o,t[s+13],12,-40341101),o=this.md5_ff(o,n,i,r,t[s+14],17,-1502002290),r=this.md5_ff(r,o,n,i,t[s+15],22,1236535329),i=this.md5_gg(i,r,o,n,t[s+1],5,-165796510),n=this.md5_gg(n,i,r,o,t[s+6],9,-1069501632),o=this.md5_gg(o,n,i,r,t[s+11],14,643717713),r=this.md5_gg(r,o,n,i,t[s+0],20,-373897302),i=this.md5_gg(i,r,o,n,t[s+5],5,-701558691),n=this.md5_gg(n,i,r,o,t[s+10],9,38016083),o=this.md5_gg(o,n,i,r,t[s+15],14,-660478335),r=this.md5_gg(r,o,n,i,t[s+4],20,-405537848),i=this.md5_gg(i,r,o,n,t[s+9],5,568446438),n=this.md5_gg(n,i,r,o,t[s+14],9,-1019803690),o=this.md5_gg(o,n,i,r,t[s+3],14,-187363961),r=this.md5_gg(r,o,n,i,t[s+8],20,1163531501),i=this.md5_gg(i,r,o,n,t[s+13],5,-1444681467),n=this.md5_gg(n,i,r,o,t[s+2],9,-51403784),o=this.md5_gg(o,n,i,r,t[s+7],14,1735328473),r=this.md5_gg(r,o,n,i,t[s+12],20,-1926607734),i=this.md5_hh(i,r,o,n,t[s+5],4,-378558),n=this.md5_hh(n,i,r,o,t[s+8],11,-2022574463),o=this.md5_hh(o,n,i,r,t[s+11],16,1839030562),r=this.md5_hh(r,o,n,i,t[s+14],23,-35309556),i=this.md5_hh(i,r,o,n,t[s+1],4,-1530992060),n=this.md5_hh(n,i,r,o,t[s+4],11,1272893353),o=this.md5_hh(o,n,i,r,t[s+7],16,-155497632),r=this.md5_hh(r,o,n,i,t[s+10],23,-1094730640),i=this.md5_hh(i,r,o,n,t[s+13],4,681279174),n=this.md5_hh(n,i,r,o,t[s+0],11,-358537222),o=this.md5_hh(o,n,i,r,t[s+3],16,-722521979),r=this.md5_hh(r,o,n,i,t[s+6],23,76029189),i=this.md5_hh(i,r,o,n,t[s+9],4,-640364487),n=this.md5_hh(n,i,r,o,t[s+12],11,-421815835),o=this.md5_hh(o,n,i,r,t[s+15],16,530742520),r=this.md5_hh(r,o,n,i,t[s+2],23,-995338651),i=this.md5_ii(i,r,o,n,t[s+0],6,-198630844),n=this.md5_ii(n,i,r,o,t[s+7],10,1126891415),o=this.md5_ii(o,n,i,r,t[s+14],15,-1416354905),r=this.md5_ii(r,o,n,i,t[s+5],21,-57434055),i=this.md5_ii(i,r,o,n,t[s+12],6,1700485571),n=this.md5_ii(n,i,r,o,t[s+3],10,-1894986606),o=this.md5_ii(o,n,i,r,t[s+10],15,-1051523),r=this.md5_ii(r,o,n,i,t[s+1],21,-2054922799),i=this.md5_ii(i,r,o,n,t[s+8],6,1873313359),n=this.md5_ii(n,i,r,o,t[s+15],10,-30611744),o=this.md5_ii(o,n,i,r,t[s+6],15,-1560198380),r=this.md5_ii(r,o,n,i,t[s+13],21,1309151649),i=this.md5_ii(i,r,o,n,t[s+4],6,-145523070),n=this.md5_ii(n,i,r,o,t[s+11],10,-1120210379),o=this.md5_ii(o,n,i,r,t[s+2],15,718787259),r=this.md5_ii(r,o,n,i,t[s+9],21,-343485551),i=this.safe_add(i,a),r=this.safe_add(r,h),o=this.safe_add(o,c),n=this.safe_add(n,u)}return Array(i,r,o,n)},t.prototype.md5_cmn=function(t,e,i,r,o,n){return this.safe_add(this.rol(this.safe_add(this.safe_add(e,t),this.safe_add(r,n)),o),i)},t.prototype.md5_ff=function(t,e,i,r,o,n,s){return this.md5_cmn(e&i|~e&r,t,e,o,n,s)},t.prototype.md5_gg=function(t,e,i,r,o,n,s){return this.md5_cmn(e&r|i&~r,t,e,o,n,s)},t.prototype.md5_hh=function(t,e,i,r,o,n,s){return this.md5_cmn(e^i^r,t,e,o,n,s)},t.prototype.md5_ii=function(t,e,i,r,o,n,s){return this.md5_cmn(i^(e|~r),t,e,o,n,s)},t.prototype.core_hmac_md5=function(t,e){var i=this.str2bin(t);16<i.length&&(i=this.core_md5(i,t.length*this.chrsz));for(var r=Array(16),o=Array(16),n=0;n<16;n++)r[n]=909522486^i[n],o[n]=1549556828^i[n];var s=this.core_md5(r.concat(this.str2bin(e)),512+e.length*this.chrsz);return this.core_md5(o.concat(s),640)},t.prototype.hex_sha1=function(t){return this.bin2hex(this.core_sha1(this.str2bin(t),t.length*this.chrsz))},t.prototype.b64_sha1=function(t){return this.bin2b64(this.core_sha1(this.str2bin(t),t.length*this.chrsz))},t.prototype.str_sha1=function(t){return this.bin2str(this.core_sha1(this.str2bin(t),t.length*this.chrsz))},t.prototype.hex_hmac_sha1=function(t,e){return this.bin2hex(this.core_hmac_sha1(t,e))},t.prototype.b64_hmac_sha1=function(t,e){return this.bin2b64(this.core_hmac_sha1(t,e))},t.prototype.str_hmac_sha1=function(t,e){return this.bin2str(this.core_hmac_sha1(t,e))},t.prototype.sha1_vm_test=function(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==this.hex_sha1("abc")},t.prototype.core_sha1=function(t,e){t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e;for(var i=Array(80),r=1732584193,o=-271733879,n=-1732584194,s=271733878,a=-1009589776,h=0;h<t.length;h+=16){for(var c=r,u=o,l=n,d=s,f=a,_=0;_<80;_++){i[_]=_<16?t[h+_]:this.rol(i[_-3]^i[_-8]^i[_-14]^i[_-16],1);var p=this.safe_add(this.safe_add(this.rol(r,5),this.sha1_ft(_,o,n,s)),this.safe_add(this.safe_add(a,i[_]),this.sha1_kt(_)));a=s,s=n,n=this.rol(o,30),o=r,r=p}r=this.safe_add(r,c),o=this.safe_add(o,u),n=this.safe_add(n,l),s=this.safe_add(s,d),a=this.safe_add(a,f)}return Array(r,o,n,s,a)},t.prototype.sha1_ft=function(t,e,i,r){return t<20?e&i|~e&r:t<40?e^i^r:t<60?e&i|e&r|i&r:e^i^r},t.prototype.sha1_kt=function(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514},t.prototype.core_hmac_sha1=function(t,e){var i=this.str2bin(t);16<i.length&&(i=this.core_sha1(i,t.length*this.chrsz));for(var r=Array(16),o=Array(16),n=0;n<16;n++)r[n]=909522486^i[n],o[n]=1549556828^i[n];var s=this.core_sha1(r.concat(this.str2bin(e)),512+e.length*this.chrsz);return this.core_sha1(o.concat(s),672)},t.prototype.safe_add=function(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i},t.prototype.rol=function(t,e){return t<<e|t>>>32-e},t.prototype.str2bin=function(t){for(var e=Array(),i=(1<<this.chrsz)-1,r=0;r<t.length*this.chrsz;r+=this.chrsz)e[r>>5]|=(t.charCodeAt(r/this.chrsz)&i)<<24-r%32;return e},t.prototype.bin2str=function(t){for(var e="",i=(1<<this.chrsz)-1,r=0;r<32*t.length;r+=this.chrsz)e+=String.fromCharCode(t[r>>5]>>>24-r%32&i);return e},t.prototype.bin2hex=function(t){for(var e=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",i="",r=0;r<4*t.length;r++)i+=e.charAt(t[r>>2]>>8*(3-r%4)+4&15)+e.charAt(t[r>>2]>>8*(3-r%4)&15);return i},t.prototype.bin2b64=function(t){for(var e="",i=0;i<4*t.length;i+=3)for(var r=(t[i>>2]>>8*(3-i%4)&255)<<16|(t[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|t[i+2>>2]>>8*(3-(i+2)%4)&255,o=0;o<4;o++)8*i+6*o>32*t.length?e+=this.b64pad:e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>6*(3-o)&63);return e},new t}();y=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();function A(){var t=arguments.length;(this._shadowColor={r:0,g:0,b:0,a:0},this._shadowOffset={x:0,y:0},this._shadowRadius=0,this._textBaseLine=0,this._textAlign=0,this._useH5Mode=0,this._a=1,this._b=0,this._c=0,this._d=1,this._tx=0,this._ty=0,2==t)&&(this.__nativeObj=new BK.SandBoxCanvasNode(arguments[0],arguments[1]),this.setFlipXY(0,1),Object.getOwnPropertyNames(this.__nativeObj).forEach(function(t){var e=t;"scale"!=e&&"transform"!=e&&"contentSize"!=e&&"size"!=e&&"fontPath"!=e&&Object.defineProperty(this,e,{get:function(){return this.__nativeObj[e]},set:function(t){this.__nativeObj[e]=t}})},this),Object.defineProperty(A.prototype,"fontPath",{get:function(){return this.__nativeObj.fontPath},set:function(t){BK.FileUtil.isFileExist(t)&&(this.__nativeObj.fontPath=t)},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"contentSize",{get:function(){return this.__nativeObj.contentSize},set:function(t){this.__nativeObj.contentSize=t,this.__nativeObj.resetCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"size",{get:function(){return this.__nativeObj.size},set:function(t){this.__nativeObj.size=t,this.__nativeObj.resetCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"textBaseline",{get:function(){return this._textBaseLine},set:function(t){switch(t){case 0:case 1:case 2:this._textBaseLine=t;break;case"bottom":case"Bottom":this._textBaseLine=0;break;case"Middle":case"middle":this._textBaseLine=1;break;case"Top":case"top":this._textBaseLine=2}},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"textAlign",{get:function(){return this._textAlign},set:function(t){switch(t){case 0:case 1:case 2:this._textAlign=t;break;case"left":this._textAlign=0;break;case"center":this._textAlign=1;break;case"right":this._textAlign=2}this.__nativeObj.setTextAlign(this._textAlign)},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"lineWidth",{get:function(){return this.__nativeObj.lineWidth},set:function(t){this.__nativeObj.lineWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"globalAlpha",{get:function(){return this.__nativeObj.globalAlpha},set:function(t){t=Math.min(1,t),t=Math.max(0,t),this.__nativeObj.globalAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"fillColor",{get:function(){return this.__nativeObj.fillColor},set:function(t){this.__nativeObj.fillColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"strokeColor",{get:function(){return this.__nativeObj.strokeColor},set:function(t){this.__nativeObj.strokeColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"lineCap",{get:function(){return this.__nativeObj.lineCap},set:function(t){this.__nativeObj.lineCap=t},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"lineJoin",{get:function(){return this.__nativeObj.lineJoin},set:function(t){this.__nativeObj.lineJoin=t},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"miterLimit",{get:function(){return this.__nativeObj.miterLimit},set:function(t){this.__nativeObj.miterLimit=t},enumerable:!0,configurable:!0}))}if(function(t,e){"object"==typeof t&&(t.AdVideoHandler=e().AdVideoHandler,t.AdVideoHandlerNative=e().AdVideoHandlerNative)}(BK,function(){var t=function(){function t(t,e,i,r){this._onStartPlay=function(t){this.event&&this.event.onStartPlay?this.event.onStartPlay(t.code,t.msg):this.log("lack of onStartPlay callback"),this.log("_onStartPlay")},this.hasJump=!1,this.videoType=t;var o="";i.display_info&&i.display_info.button_info&&0<i.display_info.button_info.length&&(o=i.display_info.button_info[0].txt);i.display_info.advertiser_info.corporation_name,i.display_info.advertiser_info.corporate_image_name,i.display_info.advertiser_info.corporate_logo;var n=0;if(0<i.display_info.button_info.length)for(var s=i.display_info.button_info,a=0;a<s.length;a++){var h=s[a];if(null!=typeof h.pos){n=h.pos;break}}this.adVideoInfo={pos_id:e,tencent_video_id:i.display_info.video_info.tencent_video_id,creative_size:i.display_info.creative_size,dest_info:i.dest_info,buttonInfo_txt:o,buttonInfo_pos:n,corporation_name:i.display_info.advertiser_info.corporation_name,corporate_image_name:i.display_info.advertiser_info.corporate_image_name,corporate_logo:i.display_info.advertiser_info.corporate_logo,base_info:i.display_info.basic_info.txt,product_type:i.product_type,video_preview_url:i.display_info.basic_info.img,pkg_download_schema:i.app_info.pkg_download_schema},this.adFullVideoInfo=i,this.adVideoInfo.dksjs=Math.random().toString(),this.gameOrientation=r}return t.prototype._onEnterForeground=function(){this.log("_onEnterForeground"),void 0!==this.envType?this._resumeAllMusic():BK.Audio.switch=!1},t.prototype._removeListener=function(){BK.MQQ.SsoRequest.removeListener("sc.game_enter_foreground.local",this),BK.MQQ.SsoRequest.removeListener("sc.apolloGameWebMessage.local",this)},t.prototype._addListener=function(){BK.MQQ.SsoRequest.addListener("sc.game_enter_foreground.local",this,this._onEnterForeground.bind(this))},t.prototype.jump=function(){if(1!=this.hasJump){this.hasJump=!0,this._addListener(),BK.Advertisement.videoCMReport(this.videoType,3),this._pauseAllMusic();var t=this.gameOrientation,e=this.adVideoInfo,i="https://cmshow.qq.com/apollo/html/game-platform/game-ad.html?_wv=4099&_fv=0&";i=(i=(i=i+"gameOrientation="+(void 0===t?1:t)+"&")+"gameId="+GameStatusInfo.gameId+"&")+"adInfo="+encodeURI(JSON.stringify(e));var r={gameOrientation:t,transparent:1,businessType:2,openId:GameStatusInfo.openId,url:i};BK.MQQ.SsoRequest.addListener("sc.apolloGameWebMessage.local",this,function(t,e,i){0==t&&i.op&&("apolloGamePlatform.endAdVideo"==i.op?i.data?this._onEndAdVideo(i.data):(this._onEndAdVideo(null),BK.Script.log(1,1,"video ad end failed. data.data is null")):"apolloGamePlatform.closeGame"==i.op?i.data?this._onCloseGame(i.data):(this._onCloseGame(null),BK.Script.log(1,1,"video ad close failed. data.data is null")):"apolloGamePlatform.miniGame"==i.op?"number"==typeof i.ggspd&&(BK.Advertisement.ggspd=i.ggspd):"apolloGamePlatform.closeWv"==i.op?(this._onCloseWebView(i.data),this.log("closeWv:"+JSON.stringify(i))):"apolloGamePlatform.startAdVideo"==i.op?(this._onStartPlay(i.data),this.log("startAdVideo:"+JSON.stringify(i))):"apolloGamePlatform.report"==i.op?this._onWebViewReport(i.data):"apolloGamePlatform.openUrl"==i.op&&this._onWebViewOpenUrl(i.data))}.bind(this)),BK.MQQ.SsoRequest.send(r,"cs.openWebViewWithoutUrl.local")}else this.log("jump failed!Can't call jump twice!")},t.prototype._isEmptyObject=function(t){for(var e in t)return!1;return!0},t.prototype._formatUrl=function(t){var e="";return"exposure_url"==t.type?e=this.adFullVideoInfo.report_info.exposure_url:"click_url"==t.type&&(e=this.adFullVideoInfo.report_info.click_url),delete t.type,0==this._isEmptyObject(t)&&(e=e+"&video="+encodeURIComponent(JSON.stringify(t))),e},t.prototype._onWebViewReport=function(t){var e=this._formatUrl(t);BK.Script.log(1,1,"_onWebViewReport req url:"+e),new BK.HttpUtil(e).requestAsync(function(t,e){BK.Script.log(1,1,"_onWebViewReport resp code:"+e)})},t.prototype._onWebViewOpenUrl=function(t){var e=this._formatUrl(t);BK.Script.log(1,1,"_onWebViewOpenUrl url:"+e),BK.MQQ.Webview.open(e)},t.prototype._onCloseWebView=function(t){var e=0;void 0!==t.type&&(0==(e=t.type)?(this._resumeAllMusic(),this._removeListener()):1==e&&(this.envType=1),this.log("_onCloseWebView "+e)),this.event&&this.event.onCloseVideo?this.event.onCloseVideo(t.code,t.msg):this.log("lack of onCloseWebView callback"),this.event.onCloseVideo=null},t.prototype._onMini=function(){},t.prototype._onCloseGame=function(t){t?this.event&&this.event.onCloseGame?t&&t.code?this.event.onCloseGame(t.code,t.msg):this.event.onCloseGame(0,""):this.log("lack of onClose callback"):this.event.onCloseGame(-1,"_onCloseGame failed data is null"),BK.QQ.notifyCloseGame(),this.event.onCloseGame=null},t.prototype._onEndAdVideo=function(t){t?this.event&&this.event.onEndVideo?t.dksjs==this.adVideoInfo.dksjs?this.event.onEndVideo(t.code,t.msg):(BK.Script.log(1,1,"data.dksjs:"+t.dksjs+" this.adInfo[dksjs]:"+this.adVideoInfo.dksjs),this.event.onEndVideo(-1,"end video failed! illegal end viedo")):this.log("lack of onEnd callback"):this.event.onEndVideo(-1,"_onEndAdVideo failed.data is null"),this.event.onEndVideo=void 0},t.prototype._pauseAllMusic=function(){void 0===BK.isBrowser&&BK.Audio.pauseAllBackground()},t.prototype._resumeAllMusic=function(){void 0===BK.isBrowser&&BK.Audio.resumeAllBackground()},t.prototype.setEventCallack=function(t,e,i,r){void 0===this.event?this.event={onCloseGame:t,onEndVideo:e,onCloseVideo:i,onStartPlay:r}:(this.event.onCloseGame=t,this.event.onEndVideo=e,this.event.onCloseVideo=i,this.event.onStartPlay=r)},t.prototype.setEventCallback=function(t,e,i,r){this.setEventCallack(t,e,i,r)},t.prototype.log=function(t){BK.Script.log(1,1,"AdVideoHandler:"+t)},t.prototype.debugLog=function(t){BK.Script.log(0,0,"AdVideoHandler Debug:"+t)},t.prototype.errorLog=function(t){BK.Script.log(1,1,"AdVideoHandler Error:"+t)},t}();return{AdVideoHandler:t,AdVideoHandlerNative:function(n){function t(t,e,i,r){var o=n.call(this,t,e,i,r)||this;return o.CMSHOW_SC_CMD_AD_VIDEO_START="sc.game_ad_video_start.local",o.CMSHOW_SC_CMD_AD_VIDEO_END="sc.game_ad_video_end.local",o.CMSHOW_SC_CMD_AD_VIDEO_CLOSE="sc.game_ad_video_view_close.local",o.CMSHOW_SC_CMD_SHELL_CLOSE="sc.game_shell_close.local",o.CMSHOW_CS_CMD_AD_VIDEO_JUMP="cs.game_ad_video_jump.local",o.CMSHOW_CS_CMD_AD_VIDEO_CLOSE="cs.game_ad_video_close.local",o.posid=e,o.adInfo=i,o}return y(t,n),t.prototype.jump=function(){this.addNativeListener(),BK.Advertisement.videoCMReport(this.videoType,3),this._pauseAllMusic(),BK.MQQ.SsoRequest.send(this.adInfo,this.CMSHOW_CS_CMD_AD_VIDEO_JUMP)},t.prototype.close=function(){BK.MQQ.SsoRequest.send({},this.CMSHOW_CS_CMD_AD_VIDEO_CLOSE)},t.prototype.setEventCallack=function(t,e,i,r){void 0===this.event?this.event={onCloseGame:t,onEndVideo:e,onCloseVideo:i,onStartPlay:r}:(this.event.onCloseGame=t,this.event.onEndVideo=e,this.event.onCloseVideo=i,this.event.onStartPlay=r)},t.prototype._startVideo=function(t,e,i){this.event&&this.event.onStartPlay?this.event.onStartPlay(t,""):this.log("lack of onStartPlay callback"),this.log("_onStartPlay")},t.prototype._endVideo=function(t,e,i){this.event&&this.event.onEndVideo?this.event.onEndVideo(t,""):this.log("lack of onEnd callback"),this.log("_endVideo")},t.prototype._closeVideo=function(t,e,i){this._resumeAllMusic(),this.event&&this.event.onCloseVideo?this.event.onCloseVideo(t,""):this.log("lack of onEnd callback"),this.log("_closeVideo"),this.removeNativeListener()},t.prototype._closeGame=function(t,e,i){this.event&&this.event.onCloseGame?this.event.onCloseGame(t,""):this.log("lack of onClose callback"),this.event.onCloseGame=null},t.prototype.removeNativeListener=function(){BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_AD_VIDEO_START,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_AD_VIDEO_END,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_AD_VIDEO_CLOSE,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this)},t.prototype.addNativeListener=function(){BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_AD_VIDEO_START,this,this._startVideo.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_AD_VIDEO_END,this,this._endVideo.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_AD_VIDEO_CLOSE,this,this._closeVideo.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this,this._closeGame.bind(this))},t}(t)}}),function(t,e){"object"==typeof t&&(t.Advertisement=function(){function t(){}return t.fetch=function(t,r){if(this.forbiden(t))r(-1,"ad not found.Current posid is forbidden.",null);else if(GameStatusInfo.devPlatform){var e=this.getDebugRetData();this.parseQQAdGetRsp(e,r)}else{var i="apollo_router_game.game_ad_linkcmd_get_ad";BK.MQQ.SsoRequest.removeListener(i,this),BK.MQQ.SsoRequest.addListener(i,this,function(t,e,i){0==t?this.parseQQAdGetRsp(i,r):r(t,"sso respose not 0.",null)}.bind(this));var o={game_id:GameStatusInfo.gameId,posid:t};BK.isBrowser?BK.MQQ.SsoRequest.sendSSO(o,i):BK.MQQ.SsoRequest.send(o,i)}},t.forbiden=function(t){if(t&&GameStatusInfo.adForbitPosId){var e=GameStatusInfo.adForbitPosId.split(";");if(!e)return!1;for(var i=0;i<e.length;i++){var r=e[i];if(r===t)return BK.Script.log(1,1,"current game"),!0}}return!1},t.videoCMReport=function(t,e){var i=t.toString(),r=e.toString(),o=GameStatusInfo.openId;BK.QQ.uploadData("enter_SPA",i,r,o,"","")},t.parseQQAdGetRsp=function(t,e){if(0==t.ret)if(0<t.pos_ads_info.length){var i=t.pos_ads_info[0];if(0==i.ret){BK.Script.log(1,1,"fetch ad \u5e7f\u544a\u4f4did:"+i.pos_id);var r=i.ads_info;if(0<r.length){var o=r[0];e(0,"OK",o)}}else BK.Script.log(1,1,"\u5e7f\u544a\u4f4d\u4fe1\u606f\u8fd4\u56de\u5931\u8d25\u4e3a\u7a7a ret:"+i.ret+" msg:"+i.msg),e(-1,"posAdInfo.ret not succeed 0. Detail:"+JSON.stringify(t),null)}else BK.Script.log(1,1,"fetch ad \u5e7f\u544a\u4fe1\u606f\u4e3a\u7a7a"),e(-1,"pos_ads_info.length is 0.Detail:"+JSON.stringify(t),null);else BK.Script.log(1,1,"fetch ad failed.ret:"+t.ret+" msg:"+t.msg),e(-1,"fetch ad failed. Detail:"+JSON.stringify(t),null)},t.canReqBanner=function(){var t=!0;if(null==this.lastBannerReqTs)return this.lastBannerReqTs=BK.Time.timestamp,t;var e=BK.Time.timestamp,i=e-this.lastBannerReqTs;return 1<i?(t=!0,this.lastBannerReqTs=BK.Time.timestamp):t=!1,t},t.fetchBannerAd=function(n){if(0!=this.canReqBanner()){var s="6060137618613664";this.fetch(s,function(t,e,i){if(0==t){var r=this.bannerCreativeSizeFilter(i);if(0==r)return void n(-1,"ad data is creative is illegal.",null);this.currentAdBannerHandle&&(this.currentAdBannerHandle.close(),this.currentAdBannerHandle=void 0);var o=new BK.AdAnimateBannerHandler(s,i);this.currentAdBannerHandle=o,n(t,e,o)}else n(t,e,null)}.bind(this))}else n(-1,"frequency is limited",null)},t.videoCreativeSizeFilter=function(t){var e=[];return e=BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.5")?[185,585]:[185,585,564,565],this.createSizeFilter(e,t)},t.bannerCreativeSizeFilter=function(t){return this.createSizeFilter([193,65,184,194,210,285],t)},t.createSizeFilter=function(t,e){var i=-1;if(e&&e.display_info&&e.display_info.creative_size){i=e.display_info.creative_size;for(var r=0;r<t.length;r++){var o=t[r];if(BK.Script.log(1,1,"createSizeFilter:"+o),Math.abs(i-o)<.01)return BK.Script.log(1,1,"compare found:"+i),!0}return BK.Script.log(1,1,"data is error!creative size is not illegal! current:"+i),!1}return BK.Script.log(1,1,"data is error!creative size is not found!"),!1},t.fetchVideoAd=function(u,l){var d="2090532727455152";this.videoCMReport(u,4),this.fetch(d,function(t,e,i){if(i){var r=this.videoCreativeSizeFilter(i);if(0!=r){var o=1;i&&i.display_info&&i.display_info.creative_size?185==i.display_info.creative_size?o=3:585==i.display_info.creative_size&&(o=1):BK.Script.log(1,1,"fetch ad has problem.lack of display_info.creative_size property.");var n=1,s=this.getGameConfig();s&&void 0!==s.viewMode&&(n=s.viewMode);var a=!0,h="";if(i.display_info&&i.display_info.video_info&&i.display_info.video_info.tencent_video_id&&"string"==typeof i.display_info.video_info.tencent_video_id&&0<i.display_info.video_info.tencent_video_id.length?a=!0:(a=!1,h="can not find video id"),1==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.0")&&(3!=n&&2!=n||1!=o||(a=!1,h="device oriation compare failed.device :"+n.toString()+" ad:"+o.toString())),1==a)if(0==t){this.videoCMReport(u,5);var c=void 0;c=1==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.7.0")?new BK.AdVideoHandler(u,d,i,n):new BK.AdVideoHandlerNative(u,d,i,n),l(t,e,c)}else l(t,e,null);else l(-1,"no ads found."+h,null)}else l(-1,"ad data is creative is illegal.",null)}else l(-1,"ad data is undefined or null",null)}.bind(this))},t.getGameConfig=function(){if(!BK.isBrowser){var t=BK.FileUtil.readFile("GameRes://gameConfig.json");if(t&&0<t.length){var e=t.readAsString(),i=JSON.parse(e);return i}}},t.getDebugRetData=function(){var t=BK.FileUtil.readFile("GameRes://script/demo/data/adBanner285.json");if(t&&0<t.length){var e=t.readAsString(),i=JSON.parse(e);return i}var r={product_type:1,display_info:{pattern_type:1,creative_size:1,animation_effect:1,basic_info:{img:"http://mat1.gtimg.com/ipad/qq_time/imgs/20180505_lixia_base.jpg",img_s:"http://mat1.gtimg.com/ipad/images/time/timelogo.jpg",txt:"\u5e7f\u544a\u7d20\u6750\u7684\u6807\u9898",desc:"\u5e7f\u544a\u7684\u8be6\u7ec6\u63cf\u8ff0"},button_info:[{txt:"\u6309\u94ae",url:"http://www.qq.com",pos:1}],muti_pic_text_info:{txt:["txt1","txt2"],image:["http://txt2.png","http://txt2.png"],url:["http://txt2.png","http://txt2.png"]},advertiser_info:{corporation_name:"string",corporate_image_name:"string",corporate_logo:"string"},video_info:{video_url:"string",media_duration:30}},report_info:void 0,dest_info:{dest_url_display_type:1,landing_page:"https://www.qq.com",canvas_json:"string",dest_type:1},app_info:void 0},o={ret:0,msg:"string",pos_id:"string",ads_info:[r]},n={ret:0,msg:"s",pos_ads_info:[o],gdt_cookie:"string",busi_cookie:"string"};return n},t.openAdVideo=function(t,e){var i="https://cmshow.qq.com/apollo/html/game-platform/game-ad.html";i=(i=(i=i+"?gameOrientation="+(void 0===e?1:e)+"&")+"gameId="+GameStatusInfo.gameId+"&")+"adInfo="+JSON.stringify(t);var r={gameOrientation:e,transparent:1,businessType:2,openId:GameStatusInfo.openId,url:i};BK.MQQ.SsoRequest.send(r,"cs.openWebViewWithoutUrl.local")},t.lastBannerReqTs=void 0,t}())}(BK),A.prototype.setImagePath=function(t){if(t){this.imagePath=t;var e=new BK.Texture(t);this.__nativeObj.setTexture(e)}},A.prototype.getImagePath=function(){return this.imagePath},A.prototype.setTexture=function(t){this.__nativeObj.setTexture(t)},A.prototype.setFlipXY=function(t,e){this.__nativeObj.setUVFlip(t,e)},A.prototype.setUVFlip=function(t,e){this.__nativeObj.setUVFlip(t,e)},A.prototype.setUVWrap=function(t,e){this.__nativeObj.setUVWrap(t,e)},A.prototype.setXYStretch=function(t,e){this.__nativeObj.setXYStretch(t,e)},A.prototype.adjustTexturePosition=function(t,e,i,r,o){this.__nativeObj.adjustTexturePosition(t,e,i,r,o)},A.prototype.addChild=function(t){return this.__nativeObj.addChild(t)},A.prototype.dispose=function(){return this.__nativeObj.dispose()},A.prototype.removeChild=function(t){return this.__nativeObj.removeChild(t)},A.prototype.removeChildById=function(t){return this.__nativeObj.removeChildById(t)},A.prototype.removeChildByName=function(t){return this.__nativeObj.removeChildByName(t)},A.prototype.removeChildByTag=function(t){return this.__nativeObj.removeChildByTag(t)},A.prototype.queryChildAtIndex=function(t){return this.__nativeObj.queryChildAtIndex(t)},A.prototype.queryChildById=function(t){return this.__nativeObj.queryChildById(t)},A.prototype.queryChildByName=function(t){return this.__nativeObj.queryChildByName(t)},A.prototype.queryChildByTag=function(t){return this.__nativeObj.queryChildByTag(t)},A.prototype.getChildCount=function(){return this.__nativeObj.getChildCount()},A.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},A.prototype.attachComponent=function(t){return this.__nativeObj.attachComponent(t)},A.prototype.detachComponent=function(t){return this.__nativeObj.detachComponent(t)},A.prototype.queryComponent=function(t){return this.__nativeObj.queryComponent(t)},A.prototype.queryComponentList=function(t){return this.__nativeObj.queryComponentList(t)},A.prototype.hittest=function(t){return this.__nativeObj.hittest(t)},A.prototype.isEqual=function(t){return this.__nativeObj.isEqual(t)},A.prototype.convertToWorldSpace=function(t){return this.__nativeObj.convertToWorldSpace(t)},A.prototype.convertToNodeSpace=function(t){return this.__nativeObj.convertToNodeSpace(t)},A.prototype.setAtlas=function(t,e){if(this.__nativeObj){BK.CanvasSheetCache.loadSheet(t);var i=BK.CanvasSheetCache.getTexturePathByFilename(e),r=new BK.Texture(i);this.__nativeObj.setTexture(r);var o=BK.CanvasSheetCache.getFrameInfoByFilename(e);this.__nativeObj.adjustTexturePosition(o.frame.x,o.frame.y,o.frame.w,o.frame.h,o.rotated)}return 0},A.prototype.useH5Mode=function(){return this.__nativeObj?(this._useH5Mode=1)==arguments.length?(this._useH5Mode=arguments[0],this.__nativeObj.useH5Mode(arguments[0])):this.__nativeObj.useH5Mode():0},A.prototype.drawCircle=function(){return this.__nativeObj?this.__nativeObj.drawCircle(arguments[0],arguments[1],arguments[2]):0},A.prototype.drawEllipse=function(){return this.__nativeObj?this.__nativeObj.drawEllipse(arguments[0],arguments[1],arguments[2],arguments[3]):0},A.prototype.drawImage=function(){if(this.__nativeObj){var t=arguments.length;if(9==t)this.__nativeObj.drawImage(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);else if(5==t)this.__nativeObj.drawImage(arguments[0],0,0,0,0,arguments[1],arguments[2],arguments[3],arguments[4]);else{if(3!=t)return;this.__nativeObj.drawImage(arguments[0],0,0,0,0,arguments[1],arguments[2],0,0)}this._innerSetTransform()}return 0},A.prototype.fill=function(){return this.__nativeObj?this.__nativeObj.fill():0},A.prototype.stroke=function(){return this.__nativeObj?this.__nativeObj.stroke():0},A.prototype.rect=function(){return this.__nativeObj?this.__nativeObj.rect(arguments[0],arguments[1],arguments[2],arguments[3]):0},A.prototype.fillRect=function(){return this.__nativeObj?this.__nativeObj.fillRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},A.prototype.strokeRect=function(){return this.__nativeObj?this.__nativeObj.strokeRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},A.prototype.clearRect=function(){return this.__nativeObj?this.__nativeObj.clearRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},A.prototype.beginPath=function(){return this.__nativeObj?this.__nativeObj.beginPath():0},A.prototype.closePath=function(){return this.__nativeObj?this.__nativeObj.closePath():0},A.prototype.moveTo=function(){return this.__nativeObj?this.__nativeObj.moveTo(arguments[0],arguments[1]):0},A.prototype.lineTo=function(){return this.__nativeObj?this.__nativeObj.lineTo(arguments[0],arguments[1]):0},A.prototype.arcTo=function(){return this.__nativeObj?this.__nativeObj.arcTo(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]):0},A.prototype.arc=function(){if(this.__nativeObj){var t=arguments.length;if(5==t)return this.__nativeObj.arc(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);if(6==t)return this.__nativeObj.arc(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}return 0},A.prototype.quadraticCurveTo=function(){return this.__nativeObj?this.__nativeObj.quadraticCurveTo(arguments[0],arguments[1],arguments[2],arguments[3]):0},A.prototype.bezierCurveTo=function(){return this.__nativeObj?this.__nativeObj.bezierCurveTo(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]):0},A.prototype.save=function(){return this.__nativeObj?this.__nativeObj.save():0},A.prototype.restore=function(){return this.__nativeObj?this.__nativeObj.restore():0},A.prototype.fillTextWithSize=function(t,e,i,r,o,n,s){if(7!=arguments.length)return 0;switch(1==o?2-n:n){case 1:e-=.5*r;break;case 2:e-=1*r}switch(s){case 1:t-=.5*i;break;case 2:t-=1*i}var a=new Object;return a.x=t,a.y=e,a.width=Math.min(2048,i),a.height=Math.min(1024,r),a},A.prototype.fillText=function(){if(3==arguments.length){var t=this.measureText(arguments[0],2048,1024),e=arguments[1],i=arguments[2];switch(1==this._useH5Mode?2-this._textBaseLine:this._textBaseLine){case 1:i-=.5*t.height;break;case 2:i-=1*t.height}switch(this._textAlign){case 1:e-=.5*t.width;break;case 2:e-=1*t.width}this.__nativeObj.fillText(arguments[0],e,i,Math.min(2048,t.width),Math.min(1024,t.height)),this._innerSetTransform()}return 0},A.prototype.clip=function(){return this.__nativeObj?this.__nativeObj.clip():0},A.prototype.isPointInPath=function(){if(this.__nativeObj)return this.__nativeObj.isPointInPath(arguments[0],arguments[1])},A.prototype.createImageData=function(){var t=arguments.length;if(this.__nativeObj&&2==t){var e=new BK.Buffer(arguments[0]*arguments[1]*4);return e.__inner_image_width=arguments[0],e.__inner_image_height=arguments[1],e}},A.prototype.getImageData=function(){},A.prototype.putImageData=function(){var t=arguments.length;if(this.__nativeObj&&3==t){var e=arguments[0],i=arguments[1],r=arguments[2],o=e.__inner_image_width,n=e.__inner_image_height;return this.__nativeObj.putImageData(arguments[0],i,r,o,n)}},A.prototype.scale=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. scale  :"+arguments[0]+" , "+arguments[1]),this.__nativeObj.scales(arguments[0],arguments[1])},A.prototype.scales=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. scales  :"+arguments[0]+" , "+arguments[1]),this.__nativeObj.scales(arguments[0],arguments[1])},A.prototype.rotate=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. rotate  :"+arguments[0]),this.__nativeObj.rotate(arguments[0])},A.prototype.translate=function(){if(this.__nativeObj){var t=GameStatusInfo.QQVer.split(".");7==Number(t[0])&&Number(7==t[1]&&Number(t[2])<=5)?(this._tx=arguments[0],this._ty=arguments[1],this._innerSetTransform()):this.__nativeObj.translate(arguments[0],arguments[1])}},A.prototype.transform=function(){if(this.__nativeObj)return this.__nativeObj.transforms(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},A.prototype.transforms=function(){var t=GameStatusInfo.QQVer.split(".");return Number(t[0])<7||7==Number(t[0])&&Number(t[1])<7?this.__nativeObj.transforms(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]):this.setTransform(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},A.prototype.setTransform=function(){if(this.__nativeObj)return this._a=arguments[0],this._b=arguments[1],this._c=arguments[2],this._d=arguments[3],this._tx=arguments[4],this._ty=arguments[5],this.__nativeObj.setTransform(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},A.prototype._innerSetTransform=function(){if(this.__nativeObj){var t=GameStatusInfo.QQVer.split(".");if(7==Number(t[0])&&Number(7==t[1]&&Number(t[2])<=5))return this.__nativeObj.setTransform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},A.prototype.shadowColor=function(){if(this._shadowColor=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},A.prototype.shadowRadius=function(){if(this._shadowRadius=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},A.prototype.shadowOffsetX=function(){if(this._shadowOffset.x=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},A.prototype.shadowOffsetY=function(){if(this._shadowOffset.y=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},A.prototype.clear=function(){if(this.__nativeObj)return this.__nativeObj.clear()},A.prototype.getTexture=function(){return null},A.prototype.drawText=function(){return this.__nativeObj&&(this.__nativeObj.drawText(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),this._innerSetTransform()),null},A.prototype.setTextSize=function(){return this.__nativeObj?this.__nativeObj.setTextSize(arguments[0]):null},A.prototype.setTextAlign=function(){if(this.__nativeObj){switch(arguments[0]){case 0:case 1:case 2:this._textAlign=arguments[0];break;case"left":this._textAlign=0;break;case"center":this._textAlign=1;break;case"right":this._textAlign=2}return this.__nativeObj.setTextAlign(this._textAlign)}return null},A.prototype.setTextBold=function(){return this.__nativeObj?this.__nativeObj.setTextBold(arguments[0]):null},A.prototype.setTextItalic=function(){return this.__nativeObj?this.__nativeObj.setTextItalic(arguments[0]):null},A.prototype.measureText=function(){return this.__nativeObj?this.__nativeObj.measureText(arguments[0],arguments[1],arguments[2]):null},A.prototype.updateCanvasTexture=function(){return this.__nativeObj?this.__nativeObj.updateCanvasTexture():null},A.prototype.saveTo=function(){return null},A.prototype.drawHead=function(){var t=arguments.length;return this.__nativeObj&&4==t&&this.__nativeObj.drawHead(arguments[0],arguments[1],arguments[2],arguments[3]),null},BK.SandBoxCanvas=A,BK.Script.log(0,0,"Load SandBoxCanvas.js succeed."),function(t,e){"object"==typeof t&&(t.QQNickCanvas=function(){function t(t,e,i,r,o){this.__nativeObj=new BK.SandBoxCanvas(e,i),this.maxHeight=2048,this.maxWidth=1024;var n=0,s=0;1==r.useH5Mode&&this.__nativeObj.useH5Mode(),r.x&&(n=r.x),r.y&&(s=r.y),r.fontSize&&this.__nativeObj.setTextSize(r.fontSize),r.textColor&&(this.__nativeObj.fillColor=r.textColor),r.textAlign&&(this.__nativeObj.textAlign=r.textAlign),r.textBaseLine&&(this.__nativeObj.textBaseLine=r.textBaseLine),r.bold&&this.__nativeObj.setTextBold(r.bold),r.italic&&this.__nativeObj.setTextItalic(r.italic),r.strokeColor&&this.__nativeObj.setStrokeColor(r.strokeColor),r.shadowColor&&this.__nativeObj.shadowColor(r.shadowColor),r.shadowRadius&&this.__nativeObj.shadowRadius(r.shadowColor),r.shadowOffsetX&&this.__nativeObj.shadowOffsetX(r.shadowOffsetX),r.shadowOffsetY&&this.__nativeObj.shadowOffsetY(r.shadowOffsetY),r.fontPath&&(this.__nativeObj.fontPath=r.fontPath),this.callback=o,BK.MQQ.Account.drawNick(this.__nativeObj.__nativeObj,t,n,s,this.maxHeight,this.maxWidth,this.__nativeObj._useH5Mode,this.__nativeObj.textBaseLine,this.__nativeObj.textAlign,this.__nativeObj.fillTextWithSize,function(t,e){this.callback(t,e)}.bind(this))}return t.prototype.getNode=function(){return this.__nativeObj},t}())}(BK),function(t,e){"object"==typeof t&&(t.QQAvatarCanvas=function(t,e,i,r,o,n){this.openid=t,this.__nativeObj=new BK.SandBoxCanvas(e,i),this.post=n,r.isRound&&(this.__nativeObj.beginPath(),this.__nativeObj.arc(e/2,e/2,e/2,0,2*Math.PI),this.__nativeObj.closePath(),this.__nativeObj.clip()),o&&o(),BK.MQQ.Account.drawHead(this.__nativeObj.__nativeObj,t,e,i,function(t,e,i,r){this.post&&this.post(t,e)}.bind(this))})}(BK),o){var O={};function x(i,r,o){BK.Script.log(0,0,"__dispatchEvent err:"+i+" cmd:"+r+" data:"+o),Array.isArray(O.listenerInfos)&&O.listenerInfos.length<=0&&"sc.init_global_var.local"==r&&(GameStatusInfo=JSON.parse(o)),O.listenerInfos.forEach(function(t){if(t.cmd==r){var e=t.callback;try{e(i,r,JSON.parse(o))}catch(t){console.log(t),BK.Script.log(0,0,"JSON parse error:"+t+" data: "+o)}}},this),BK.MQQ.SsoRequest.listenerInfos.forEach(function(t){if(t.cmd==r){var e=t.callback;try{e(i,r,"cs.get_file_data.local"==r?o:JSON.parse(o))}catch(t){console.log(t),BK.Script.log(0,0,"JSON parse error:"+t+" data: "+o)}}},this)}BK.MQQ.SsoRequest.listenerInfos=[],BK.MQQ.SsoRequest.addListener=function(e,i,r){var t={cmd:e,target:i,callback:r};BK.MQQ.SsoRequest.listenerInfos.forEach(function(t){t.cmd==e&&t.target==i&&(t.callback=r)},this),BK.MQQ.SsoRequest.listenerInfos.push(t)},BK.MQQ.SsoRequest.removeListener=function(t,e){for(var i=BK.MQQ.SsoRequest.listenerInfos.length,r=-1,o=0;o<i;o++){var n=BK.MQQ.SsoRequest.listenerInfos[o];n.cmd==t&&n.target==e&&(r=o)}-1!=r&&BK.MQQ.SsoRequest.listenerInfos.splice(r,1)},O.listenerInfos=[],O.addListener=function(e,i,r){var t={cmd:e,target:i,callback:r},o=!1;O.listenerInfos.forEach(function(t){t.cmd==e&&t.target==i&&(t.callback=r,o=!0)},this),0==o&&O.listenerInfos.push(t)},O.removeListener=function(t,e){for(var i=O.listenerInfos.length,r=-1,o=0;o<i;o++){var n=O.listenerInfos[o];n.cmd==t&&n.target==e&&(r=o)}-1!=r&&O.listenerInfos.splice(r,1)}}function M(){var t="sc.init_global_var.local";BK.isBrowser?(BK.Script.log(1,0,"set listener for notifyJSEVent redpackage h5"),BK.MQQ.SsoRequest.addListener(t,this,function(){BK.Script.log(1,0,"on onGameLoad  for redpackage "+localStorage.loadRedpackage),"1"!==localStorage.loadRedpackage&&(localStorage.loadRedpackage="1",BK.QQ.isOpenActivityPage()&&BK.QQ.showRedPackageActivityPage())}),BK.MQQ.SsoRequest.addListener("sc.game_enter_foreground.local",this,function(){BK.Script.log(1,0,"on onGameForeground for redpackage "+localStorage.loadRedpackage),localStorage.loadRedpackage="0"})):(BK.Script.log(1,0,"set listener for notifyJSEVent redpackage not h5"),BK.MQQ.SsoRequest.addListener(t,this,function(){BK.Script.log(1,0,"on onGameLoad  for redpackage not H5"),BK.QQ.isOpenActivityPage()&&BK.QQ.showRedPackageActivityPage()})),BK.MQQ.SsoRequest.addListener("apollo_router_light.apollo_activity_linkcmd_query_new_redpacket",BK.QQ,BK.QQ.onNewRedPackage.bind(BK.QQ))}!function(t,e){"object"==typeof t&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Game=e())}(1==o?window:BK,function(){var t,e,i,r;return(e=t||(t={}))[e.load=0]="load",e[e.min=1]="min",e[e.max=2]="max",e[e.share=3]="share",e[e.enterBackground=4]="enterBackground",e[e.enterForeground=5]="enterForeground",(r=i||(i={}))[r.native=0]="native",r[r.browser=1]="browser",function(){function t(t){this.CMSHOW_CS_CMD_CLOSE_WND="cs.close_room.local",this.CMSHOW_CS_CMD_SHARE_INFO="cs.game_shell_share_callback.local",this.CMSHOW_SC_CMD_SHELL_PACK_UP="sc.game_shell_pack_up.local",this.CMSHOW_SC_CMD_SHELL_SHARE="sc.game_shell_share.local",this.CMSHOW_SC_CMD_SHELL_SHARE_COMPLETE="sc.share_game_to_friend_result.local",this.CMSHOW_SC_CMD_SHELL_CLOSE="sc.game_shell_close.local",this.CMD_CMSHOW_GAME_ENTER_BACKGROUND="sc.game_enter_background.local",this.CMD_CMSHOW_GAME_ENTER_FORGROUND="sc.game_enter_foreground.local",this.CMD_CMSHOW_GAME_MAXIMIZE="sc.game_maximize.local",this.CMD_CMSHOW_GAME_MINIMIZE="sc.game_minimize.local",this.CMD_CMSHOW_GAME_INIT_GLOBAL_VAR="sc.init_global_var.local",this.CMD_CMSHOW_GAME_NETWORK_CHANGE="sc.network_change.local",this.CMD_CMSHOW_GAME_WEBMESSAGE_HANDLE="sc.web_callback_game.local",this.cfg=t,this.addAllListener(),this.cfg.onLoad&&(!o||o&&"undefined"!=typeof GameStatusInfo)&&(this.formatInfo(),this.cfg.onLoad(this,GameStatusInfo.src,GameStatusInfo.roomId))}return t.prototype.formatInfo=function(){GameStatusInfo.gameId&&(GameStatusInfo.gameId=Number(GameStatusInfo.gameId)),GameStatusInfo.isMaster&&(GameStatusInfo.isMaster=Number(GameStatusInfo.isMaster)),GameStatusInfo.roomId&&(GameStatusInfo.roomId=Number(GameStatusInfo.roomId)),GameStatusInfo.gameVersion&&(GameStatusInfo.gameVersion=String(GameStatusInfo.gameVersion)),GameStatusInfo.platform&&(GameStatusInfo.platform=String(GameStatusInfo.platform)),GameStatusInfo.openId&&(GameStatusInfo.openId=String(GameStatusInfo.openId)),GameStatusInfo.QQVer&&(GameStatusInfo.QQVer=String(GameStatusInfo.QQVer)),GameStatusInfo.networkType&&(GameStatusInfo.networkType=Number(GameStatusInfo.networkType)),GameStatusInfo.src&&(GameStatusInfo.src=Number(GameStatusInfo.src))},t.prototype.log=function(t){BK.Script.log(0,0,"Game:"+t)},t.prototype.errorMessage=function(){return this.err.message},t.prototype.errorStacktrace=function(){return this.err.stacktrace},t.prototype.__isBrowser=function(){return o},t.prototype.platform=function(){return this.__isBrowser()?i.browser:i.native},t.prototype.addAllListener=function(){this.platform()==i.native?(BK.Script.setErrorObserver(function(t,e){this.cfg.onException&&(this.err={message:t,stacktrace:e},this.cfg.onException(this))}.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMD_CMSHOW_GAME_ENTER_BACKGROUND,this,this._onEnterBackground.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMD_CMSHOW_GAME_ENTER_FORGROUND,this,this._onEnterForeground.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMD_CMSHOW_GAME_MAXIMIZE,this,this._onMax.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMD_CMSHOW_GAME_MINIMIZE,this,this._onMin.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_SHELL_SHARE,this,this._onShare.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_SHELL_SHARE_COMPLETE,this,this._onShareComplete.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this,this._onClose.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMD_CMSHOW_GAME_NETWORK_CHANGE,this,this._onNetworkChange.bind(this))):(O.addListener(this.CMD_CMSHOW_GAME_ENTER_BACKGROUND,this,this._onEnterBackground.bind(this)),O.addListener(this.CMD_CMSHOW_GAME_ENTER_FORGROUND,this,this._onEnterForeground.bind(this)),O.addListener(this.CMD_CMSHOW_GAME_MINIMIZE,this,this._onMin.bind(this)),O.addListener(this.CMD_CMSHOW_GAME_MAXIMIZE,this,this._onMax.bind(this)),O.addListener(this.CMSHOW_SC_CMD_SHELL_SHARE,this,this._onShare.bind(this)),O.addListener(this.CMSHOW_SC_CMD_SHELL_SHARE_COMPLETE,this,this._onShareComplete.bind(this)),O.addListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this,this._onClose.bind(this)),O.addListener(this.CMD_CMSHOW_GAME_INIT_GLOBAL_VAR,this,this._onInitGlobalVar.bind(this)),O.addListener(this.CMD_CMSHOW_GAME_NETWORK_CHANGE,this,this._onNetworkChange.bind(this)),O.addListener(this.CMD_CMSHOW_GAME_WEBMESSAGE_HANDLE,this,this._onWebMessageHandle.bind(this)))},t.prototype.removeAllListener=function(){this.platform()==i.native?(BK.Script.setErrorObserver(void 0),BK.MQQ.SsoRequest.removeListener(this.CMD_CMSHOW_GAME_ENTER_BACKGROUND,this),BK.MQQ.SsoRequest.removeListener(this.CMD_CMSHOW_GAME_ENTER_FORGROUND,this),BK.MQQ.SsoRequest.removeListener(this.CMD_CMSHOW_GAME_MAXIMIZE,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_SHELL_PACK_UP,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_SHELL_SHARE,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this),BK.MQQ.SsoRequest.removeListener(this.CMD_CMSHOW_GAME_NETWORK_CHANGE,this)):(O.removeListener(this.CMD_CMSHOW_GAME_ENTER_BACKGROUND,this),O.removeListener(this.CMD_CMSHOW_GAME_ENTER_FORGROUND,this),O.removeListener(this.CMD_CMSHOW_GAME_MAXIMIZE,this),O.removeListener(this.CMSHOW_SC_CMD_SHELL_PACK_UP,this),O.removeListener(this.CMSHOW_SC_CMD_SHELL_SHARE,this),O.removeListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this),O.removeListener(this.CMD_CMSHOW_GAME_INIT_GLOBAL_VAR,this),O.removeListener(this.CMD_CMSHOW_GAME_NETWORK_CHANGE,this),O.removeListener(this.CMD_CMSHOW_GAME_WEBMESSAGE_HANDLE,this))},t.prototype._onEnterBackground=function(){this.cfg.onEnterBackground&&this.cfg.onEnterBackground(this)},t.prototype._onEnterForeground=function(){this.cfg.onEnterForeground&&this.cfg.onEnterForeground(this)},t.prototype._onMax=function(){this.cfg.onMaximize&&this.cfg.onMaximize(this)},t.prototype._onMin=function(){this.cfg.onMinimize&&this.cfg.onMinimize(this)},t.prototype._generatedefaultSharePic=function(){var t="GameSandBox://qrcode.png",e="http://cmshow.qq.com/apollo/html/game-platform/scan-game.html?gameId="+GameStatusInfo.gameId.toString()+"&src=203";return BK.QRCode.createQRCodeToFile(t,e,{width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:2}),t},t.prototype._onShare=function(){var r=void 0;if(this.cfg.onShare&&(r=this.cfg.onShare(this)),r||(r={}),void 0===r.localPicPath){var t=r.gameName,e=r.summary;BK.QQ.defaultSharePic(t,e,function(t,e,i){3==e&&(r.localPicPath=i),this.confirmShare(r)}.bind(this))}else this.confirmShare(r)},t.prototype._onShareComplete=function(t,e,i){if(this.cfg.onShareComplete)if(0==i.reqCode){var r=i.ret,o=0==i.isFirstTimeShare,n=i.shareTo;this.cfg.onShareComplete(this,r,n,o)}else this.cfg.onShareComplete(this,t,-1,!1)},t.prototype._onClose=function(){this.cfg.onClose&&this.cfg.onClose(this)},t.prototype.confirmShare=function(t){var e=t||{};e.reqCode=0,this.platform()==i.native?BK.MQQ.SsoRequest.send(e,this.CMSHOW_CS_CMD_SHARE_INFO):BK.MQQ.SsoRequest.sendTo(e,this.CMSHOW_CS_CMD_SHARE_INFO)},t.prototype._onInitGlobalVar=function(t,e,i){void 0!==i.uin&&delete i.uin,GameStatusInfo=i,this.cfg.onLoad&&(this.formatInfo(),this.cfg.onLoad(this,GameStatusInfo.src,GameStatusInfo.roomId))},t.prototype._onNetworkChange=function(t,e,i){this.cfg.onNetworkChange&&(void 0===i.type?BK.Script.log(1,1,"net work change .data is worng!"):this.cfg.onNetworkChange(this,i.type))},t.prototype._onWebMessageHandle=function(t,e,i){this.cfg.onWebMessageHandle&&(void 0===e||void 0===i?BK.Script.log(1,1,"WebMessageHandle data is worng!"):this.cfg.onWebMessageHandle(this,e,i))},t}()}),M(),function(i){BK.buildInfo={debug:!0,buildPath:"/trunk/master",version:"5783",creator:"nkchen",buildTime:"Tue Nov 06 2018 17:05:34 GMT+0800 (GMT+08:00)"};var r={};function o(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=i,o.c=r,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s="./webpack/pack.ts")}({"./src/basics/Storage/StorageEventListener.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i("./src/common/emitter.ts"),o=function(){function t(){this.storageEmitter=new r}return t.prototype.addEventListener=function(t,e){this.storageEmitter.on(t,e)},t.prototype.removeEventListener=function(t,e){this.storageEmitter.off(t,e)},t.prototype.dispatchEvent=function(t,e){this.storageEmitter.emit(t,e)},t}();e.BKStorageEventLisener=o,t.exports=new o},"./src/basics/device/device.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this.isKeepScreenOnInit=!1,BK.Director.isKeepScreenOn=!1}return t.prototype.innerSetKeepScreenOn=function(t){e.device.isKeepScreenOnInit?(GameStatusInfo.src&&BK.QQ.uploadData("call_screen_on",GameStatusInfo.src.toString(),t?"1":"0","","",""),BK.Director.isKeepScreenOn=t):BK.Script.log(1,1,"user unset keepScreenOn,ignore the value")},t.prototype.keepScreenOn=function(t){if(void 0===t)throw Error("param can not be undefined!");e.device.userSetDeviceScreenValue=t.isKeepOn,e.device.isKeepScreenOnInit=!0,e.device.innerSetKeepScreenOn(t.isKeepOn)},t}();e.device=new r,BK.onEnterBackground(function(){BK.Script.log(1,1,"keepScreenOn CMD_CMSHOW_GAME_ENTER_BACKGROUND "),e.device.innerSetKeepScreenOn(!1)}),BK.onEnterForeground(function(){BK.Script.log(1,1,"keepScreenOn CMD_CMSHOW_GAME_ENTER_FORGROUND "),e.device.isKeepScreenOnInit?e.device.innerSetKeepScreenOn(e.device.userSetDeviceScreenValue):e.device.innerSetKeepScreenOn(!1)}),BK.onMaximize(function(){BK.Script.log(1,1,"keepScreenOn CMD_CMSHOW_GAME_MAXIMIZE "),e.device.isKeepScreenOnInit?e.device.innerSetKeepScreenOn(e.device.userSetDeviceScreenValue):e.device.innerSetKeepScreenOn(!1)}),BK.onMinimize(function(){BK.Script.log(1,1,"keepScreenOn CMD_CMSHOW_GAME_MINIMIZE "),e.device.innerSetKeepScreenOn(!1)}),BK.SsoRequest.on("sc.force_stop_game.local",function(t){BK.Script.log(1,1,"keepScreenOn CMSHOW_SC_CMD_STOP_GAME "),e.device.innerSetKeepScreenOn(!1)}),t.exports=e.device},"./src/basics/lifecycle/lifecycle.ts":function(t,e,B){"use strict";var i;!function(t){var e,o="sc.game_shell_share.local",n="sc.share_game_to_friend_result.local",s="sc.game_shell_close.local",a="sc.game_enter_background.local",h="sc.game_enter_foreground.local",c="sc.game_maximize.local",u="sc.game_minimize.local",l="sc.network_change.local";(e=t.NetworkState||(t.NetworkState={}))[e.NoneToMobileNetwork=1]="NoneToMobileNetwork",e[e.NoneToWifi=2]="NoneToWifi",e[e.MobileNetworkToWifi=3]="MobileNetworkToWifi",e[e.MobileNetworkToNone=4]="MobileNetworkToNone",e[e.WifiToNone=5]="WifiToNone",e[e.WifiToMobileNetwork=6]="WifiToMobileNetwork";var d=new(B("./src/common/emitter.ts")),f="foreground",_="background",p="maximize",m="minimize",g="share",v="shareComplete",S="networkChange",y="close";function i(t){var e=t.cmd,i=t.data;switch(e){case h:d.emit(f);break;case a:d.emit(_);break;case c:d.emit(p);break;case u:d.emit(m);break;case s:d.emit(y);break;case o:d.emit(g);break;case n:if(0==i.reqCode){var r={retCode:i.ret,isFirstShare:0==i.isFirstTimeShare,shareDest:i.shareTo};d.emit(v,r)}break;case l:if(void 0===i.type)BK.Script.log(1,1,"net work change .data is worng!");else{r={state:i.type};d.emit(S,r)}}}function r(t){if(void 0===t)throw new Error("callback can't be undefined!")}BK.SsoRequest.on(h,i),BK.SsoRequest.on(a,i),BK.SsoRequest.on(c,i),BK.SsoRequest.on(u,i),BK.SsoRequest.on(s,i),BK.SsoRequest.on(o,i),BK.SsoRequest.on(n,i),BK.SsoRequest.on(l,i),t.onEnterBackground=function(t){r(t),d.on(_,t)},t.offEnterBackground=function(t){r(t),d.off(_,t)},t.onEnterForeground=function(t){r(t),d.on(f,t)},t.offEnterForeground=function(t){r(t),d.off(f,t)},t.onGameClose=function(t){r(t),d.on(y,t)},t.offGameClose=function(t){r(t),d.off(y,t)},t.onGameShare=function(t){r(t),d.on(g,t)},t.offGameShare=function(t){r(t),d.off(g,t)},t.onGameShareComplete=function(t){r(t),d.on(v,t)},t.offGameShareComplete=function(t){r(t),d.off(v,t)},t.onNetworkChange=function(t){r(t),d.on(S,t)},t.offNetworkChange=function(t){r(t),d.off(S,t)},t.onMaximize=function(t){r(t),d.on(p,t)},t.offMaximize=function(t){r(t),d.off(p,t)},t.onMinimize=function(t){r(t),d.on(m,t)},t.offMinimize=function(t){r(t),d.off(m,t)}}(i||(i={})),BK.NetworkState=i.NetworkState,t.exports=i},"./src/basics/storage/Storage.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/basics/storage/StorageEvent.ts"),r=function(){function t(t){if(this._storageType=t,this._kv={},this._bytes=2,this._url="default",(this.length=0)===this._storageType&&BK.getStorageData){var e=BK.getStorageData(GameStatusInfo.gameId);if(!e)return;try{this._bytes=e.length,this._kv=JSON.parse(e),this.length=Object.keys(this._kv).length}catch(t){throw BK.Script.log(1,1,"parse string failed, storage load failed!"),this.flush(),Error("Storage setItem failed, item bytes is too large")}}}return t.prototype.key=function(t){return t>=this.length?null:Object.keys(this._kv)[t]},t.prototype.getItem=function(t){return this._kv[t]},t.prototype.setItem=function(t,e){var i,r=e.length,o=0;if(this._kv[t]&&(o=JSON.stringify(this._kv[t]).length),!((i=r-o)<0||i+this._bytes<4194304))throw BK.Script.log(1,1,"Storage setItem failed, item bytes is too large!"),Error("Storage setItem failed, item bytes is too large");var n=this._kv[t];this._kv[t]=e,this.length=Object.keys(this._kv).length,this.flush(),BK.storageEventListener.dispatchEvent("storage",new s(t,n,e,this._url,this))},t.prototype.removeItem=function(t){delete this._kv[t],this.length=Object.keys(this._kv).length,this.flush()},t.prototype.clear=function(){this._kv={},this.length=Object.keys(this._kv).length,this.flush()},t.prototype.flush=function(){var t=JSON.stringify(this._kv);this._bytes=t.length,0===this._storageType&&BK.setStorageData&&BK.setStorageData(t,GameStatusInfo.gameId)},t.prototype.bindUrl=function(t){t!==this._url&&""!==t&&(this._url=t)},t}();function o(t,e){if(e){if("length"===(e=e.toString()))return t[e];if("_kv"===e||"_storageType"===e)return t.getItem(e);for(var i=["setItem","getItem","removeItem","key","clear"],r=0;r<i.length;r++)if(e===i[r])return t[e].bind(t);return t.getItem(e)}}function n(t,e,i){if(e&&i)if(e=e.toString(),i=i.toString(),"length"!==e)if("_kv"!==e&&"_storageType"!==e){for(var r=["setItem","getItem","removeItem","key","clear"],o=0;o<r.length;o++)if(e===r[o])return t[e].bind(t);t.setItem(e,i)}else t.setItem(e,i);else BK.Script.log(1,0,"property "+e+" readOnly")}e.BKStorage=r;var a={get:e.getProperty=o,set:e.setProperty=n,deleteProperty:function(t,e){BK.Script.log(1,1,"localStorage delete property : "+e)}};function h(t){if("android"===GameStatusInfo.platform)return BK.Script.log(1,0,"Proxy create "),new Proxy(new r(t),a);var e=GameStatusInfo.osVersion.split(".");return 0<e.length&&9<Number(e[0])?(BK.Script.log(1,0,"Proxy create "),new Proxy(new r(t),a)):BK.Proxy?(BK.Script.log(1,0,"BK.Proxy create "),new BK.Proxy(new r(t),n,o)):{}}t.exports={localStorage:h(0),sessionStorage:h(1)}},"./src/basics/storage/StorageEvent.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t,e,i,r,o){this.key=t,this.oldValue=e,this.newValue=i,this.url=r,this.storageArea=o};e.BKStorageEvent=r,t.exports=r},"./src/basics/subpackage/subpackage.ts":function(t,e,i){"use strict";var r,o,n,s,a,h=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});n=o||(o={}),s=new(function(e){function t(){var t=e.call(this)||this;return BK.SsoRequest.on("sc.load_percentage_nofity.local",t.onLoadPackagePercentage.bind(t)),t._subPackagesInfo=void 0,t}return h(t,e),t.prototype.setSubPackageInfo=function(t){this._subPackagesInfo=t},t.prototype.getEntryMainPath=function(t){this._subPackagesInfo||(this._subPackagesInfo=this.subPackageDataReadConfig());for(var e=0;e<this._subPackagesInfo.length;e++){var i=this._subPackagesInfo[e];if(i.name===t)return"GameRes://"+i.root+"/main.js"}},t.prototype.subPackageDataReadConfig=function(){if(this._subPackagesInfo)return this._subPackagesInfo;var t=BK.FileUtil.readFile("GameRes://gameConfig.json");if(t){var e=JSON.parse(t.readAsString(!0));return e&&e.subpackages?(this._subPackagesInfo=e.subpackages,e.subpackages):void 0}},t.prototype.checkPackage=function(r){var t={xyId:GameStatusInfo.gameId,packName:r.packageName};BK.SsoRequest.request({data:t,reqCmd:"cs.file_correctness_check.local",success:function(t){t.code,t.cmd;var e=t.data;r.success&&r.success(e)},fail:function(t){var e=t.code;t.cmd,t.data;if(r.fail){var i={name:r.packageName,code:e,msg:"failed"};r.fail(i)}},complete:function(){r.complete&&r.complete()}})},t.prototype.downloadPackage=function(i){var t={xyId:GameStatusInfo.gameId,packName:i};BK.SsoRequest.request({data:t,reqCmd:"cs.load_subpackage.local",success:function(t){if(t.data.packName){var e="download_finish_"+t.data.packName;this.emit(e,t.data.result)}}.bind(this),fail:function(t){if(t.data.packName){var e="download_finish_"+t.data.packName;this.emit(e,t.code)}else{e=i;this.emit(e,t.code)}},complete:function(){}})},t.prototype._innserLoadLibFunc=function(t){return t.Script.loadlib},t.prototype.loadPackage=function(t){var e=this.getEntryMainPath(t);return!!e&&(!!BK.fileSystem.accessSync(e)&&(this._innserLoadLibFunc(BK)(e),!0))},t.prototype.onLoadPackagePercentage=function(t){if(t.data.packName){var e="percentage_"+t.data.packName;this.emit(e,t.data.percentage)}},t.prototype.onLoadPackageFinish=function(t,e,i){if(i.packName){var r="download_finish_"+i.packName;this.emit(r,i.result)}},t}(i("./src/common/emitter.ts"))),a=function(){function t(t){this.packName=t}return t.prototype.onProgressUpdate=function(t){s.on("percentage_"+this.packName,t)},t}(),n.loadSubpackage=function(e){var t=new a(e.name);if(!GameStatusInfo||"xcode"===GameStatusInfo.devPlatform){var i={name:e.name,code:-1,msg:"develop environment no support!"};return e.complete&&e.complete(),e.fail&&e.fail(i),BK.Script.log(1,1,"bk.qq.loadpackage xcode demo."),t}var r=GameStatusInfo.QQVer.split(".");return Number(r[0])<7||7==Number(r[0])&&Number(r[1])<7||7==Number(r[0])&&7==Number(r[1])&&Number(r[2])<5?(BK.Script.log(1,0,"775 \u4ee5\u4e0b\u624bq \u7248\u672c"),i={name:e.name,code:-2,msg:"current qq no support subpackage feature!Upgrade to QQ 7.7.5"},e.complete&&e.complete(),e.fail&&e.fail(i)):s.subPackageDataReadConfig()?(e.complete&&e.complete(),s.downloadPackage(e.name),s.on("download_finish_"+e.name,function(t){s.checkPackage({packageName:e.name,success:function(){if(s.loadPackage(e.name),e.success)try{e.success({name:e.name})}catch(t){BK.Console.log("ERROR:"+t)}},fail:function(){var t={name:e.name,code:-4,msg:"load subpackge failed.correctness failed"};if(e.fail)try{e.fail(t)}catch(t){BK.Console.log("ERROR:"+t)}}})})):(i={name:e.name,code:-3,msg:"gameConfig.json can not find configure!"},e.complete&&e.complete(),e.fail&&e.fail(i)),t},t.exports=o.loadSubpackage},"./src/basics/system/system.ts":function(t,e,i){"use strict";t.exports={getSystemInfoSync:function(){return GameStatusInfo}}},"./src/common/crypt.ts":function(t,e,i){"use strict";var r=function(){function r(){this.hexcase=0,this.b64pad="",this.chrsz=8,this.cryptQueue=Array(),this.safe_add=function(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i},this.rol=function(t,e){return t<<e|t>>>32-e};var o=this;"undefined"!=typeof BK&&BK.Director.ticker.add(function(t,e){if(0<o.cryptQueue.length){var i=o.cryptQueue[0];o.cryptQueue.splice(0,1);var r=void 0;try{r=i.doCrypt.call(o,i.param)}catch(t){if(!i.param.fail)throw t;i.param.fail({msg:t.message})}r&&i.param.success&&i.param.success({data:r}),i.param.complete&&i.param.complete()}}.bind(o))}return r.prototype.checkParam=function(t){if(!t)throw new Error("param can not be undefined");if("object"!=typeof t)throw new Error("param must be a object,can not be "+typeof t)},r.prototype.checkType=function(t,e){if(!("number"==typeof t||"string"==typeof t||t instanceof Array))throw Error(e+" must be string or binary array!")},r.md5ToHex=function(t){r.crypt.checkParam(t),r.crypt.checkType(t.data,"data"),r.crypt.cryptQueue.push({param:t,doCrypt:r.md5ToHexSync})},r.md5ToHexSync=function(t){r.crypt.checkParam(t);var e=t.data;return r.crypt.checkType(e,"data"),r.crypt.bin2hexLittle(r.crypt.core_md5(r.crypt.str2binLittle(e),e.length*r.crypt.chrsz))},r.md5ToBase64=function(t){r.crypt.checkParam(t),r.crypt.checkType(t.data,"data"),r.crypt.cryptQueue.push({param:t,doCrypt:r.md5ToBase64Sync})},r.md5ToBase64Sync=function(t){r.crypt.checkParam(t);var e=t.data;return r.crypt.checkType(e,"data"),r.crypt.bin2b64Little(r.crypt.core_md5(r.crypt.str2binLittle(e),e.length*r.crypt.chrsz))},r.hmacMd5ToHex=function(t){r.crypt.checkParam(t),r.crypt.checkType(t.data,"data"),r.crypt.checkType(t.key,"key"),r.crypt.cryptQueue.push({param:t,doCrypt:r.hmacMd5ToHexSync})},r.hmacMd5ToHexSync=function(t){r.crypt.checkParam(t);var e=t.key,i=t.data;return r.crypt.checkType(i,"data"),r.crypt.checkType(e,"key"),r.crypt.bin2hexLittle(r.crypt.core_hmac_md5(e,i))},r.hmacMd5ToBase64=function(t){r.crypt.checkParam(t),r.crypt.checkType(t.data,"data"),r.crypt.checkType(t.key,"key"),r.crypt.cryptQueue.push({param:t,doCrypt:r.hmacMd5ToBase64Sync})},r.hmacMd5ToBase64Sync=function(t){r.crypt.checkParam(t);var e=t.key,i=t.data;return r.crypt.checkType(i,"data"),r.crypt.checkType(e,"key"),r.crypt.bin2b64Little(r.crypt.core_hmac_md5(e,i))},r.prototype.core_md5=function(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var i=1732584193,r=-271733879,o=-1732584194,n=271733878,s=0;s<t.length;s+=16){var a=i,h=r,c=o,u=n;i=this.md5_ff(i,r,o,n,t[s+0],7,-680876936),n=this.md5_ff(n,i,r,o,t[s+1],12,-389564586),o=this.md5_ff(o,n,i,r,t[s+2],17,606105819),r=this.md5_ff(r,o,n,i,t[s+3],22,-1044525330),i=this.md5_ff(i,r,o,n,t[s+4],7,-176418897),n=this.md5_ff(n,i,r,o,t[s+5],12,1200080426),o=this.md5_ff(o,n,i,r,t[s+6],17,-1473231341),r=this.md5_ff(r,o,n,i,t[s+7],22,-45705983),i=this.md5_ff(i,r,o,n,t[s+8],7,1770035416),n=this.md5_ff(n,i,r,o,t[s+9],12,-1958414417),o=this.md5_ff(o,n,i,r,t[s+10],17,-42063),r=this.md5_ff(r,o,n,i,t[s+11],22,-1990404162),i=this.md5_ff(i,r,o,n,t[s+12],7,1804603682),n=this.md5_ff(n,i,r,o,t[s+13],12,-40341101),o=this.md5_ff(o,n,i,r,t[s+14],17,-1502002290),r=this.md5_ff(r,o,n,i,t[s+15],22,1236535329),i=this.md5_gg(i,r,o,n,t[s+1],5,-165796510),n=this.md5_gg(n,i,r,o,t[s+6],9,-1069501632),o=this.md5_gg(o,n,i,r,t[s+11],14,643717713),r=this.md5_gg(r,o,n,i,t[s+0],20,-373897302),i=this.md5_gg(i,r,o,n,t[s+5],5,-701558691),n=this.md5_gg(n,i,r,o,t[s+10],9,38016083),o=this.md5_gg(o,n,i,r,t[s+15],14,-660478335),r=this.md5_gg(r,o,n,i,t[s+4],20,-405537848),i=this.md5_gg(i,r,o,n,t[s+9],5,568446438),n=this.md5_gg(n,i,r,o,t[s+14],9,-1019803690),o=this.md5_gg(o,n,i,r,t[s+3],14,-187363961),r=this.md5_gg(r,o,n,i,t[s+8],20,1163531501),i=this.md5_gg(i,r,o,n,t[s+13],5,-1444681467),n=this.md5_gg(n,i,r,o,t[s+2],9,-51403784),o=this.md5_gg(o,n,i,r,t[s+7],14,1735328473),r=this.md5_gg(r,o,n,i,t[s+12],20,-1926607734),i=this.md5_hh(i,r,o,n,t[s+5],4,-378558),n=this.md5_hh(n,i,r,o,t[s+8],11,-2022574463),o=this.md5_hh(o,n,i,r,t[s+11],16,1839030562),r=this.md5_hh(r,o,n,i,t[s+14],23,-35309556),i=this.md5_hh(i,r,o,n,t[s+1],4,-1530992060),n=this.md5_hh(n,i,r,o,t[s+4],11,1272893353),o=this.md5_hh(o,n,i,r,t[s+7],16,-155497632),r=this.md5_hh(r,o,n,i,t[s+10],23,-1094730640),i=this.md5_hh(i,r,o,n,t[s+13],4,681279174),n=this.md5_hh(n,i,r,o,t[s+0],11,-358537222),o=this.md5_hh(o,n,i,r,t[s+3],16,-722521979),r=this.md5_hh(r,o,n,i,t[s+6],23,76029189),i=this.md5_hh(i,r,o,n,t[s+9],4,-640364487),n=this.md5_hh(n,i,r,o,t[s+12],11,-421815835),o=this.md5_hh(o,n,i,r,t[s+15],16,530742520),r=this.md5_hh(r,o,n,i,t[s+2],23,-995338651),i=this.md5_ii(i,r,o,n,t[s+0],6,-198630844),n=this.md5_ii(n,i,r,o,t[s+7],10,1126891415),o=this.md5_ii(o,n,i,r,t[s+14],15,-1416354905),r=this.md5_ii(r,o,n,i,t[s+5],21,-57434055),i=this.md5_ii(i,r,o,n,t[s+12],6,1700485571),n=this.md5_ii(n,i,r,o,t[s+3],10,-1894986606),o=this.md5_ii(o,n,i,r,t[s+10],15,-1051523),r=this.md5_ii(r,o,n,i,t[s+1],21,-2054922799),i=this.md5_ii(i,r,o,n,t[s+8],6,1873313359),n=this.md5_ii(n,i,r,o,t[s+15],10,-30611744),o=this.md5_ii(o,n,i,r,t[s+6],15,-1560198380),r=this.md5_ii(r,o,n,i,t[s+13],21,1309151649),i=this.md5_ii(i,r,o,n,t[s+4],6,-145523070),n=this.md5_ii(n,i,r,o,t[s+11],10,-1120210379),o=this.md5_ii(o,n,i,r,t[s+2],15,718787259),r=this.md5_ii(r,o,n,i,t[s+9],21,-343485551),i=this.safe_add(i,a),r=this.safe_add(r,h),o=this.safe_add(o,c),n=this.safe_add(n,u)}return Array(i,r,o,n)},r.prototype.md5_cmn=function(t,e,i,r,o,n){return this.safe_add(this.rol(this.safe_add(this.safe_add(e,t),this.safe_add(r,n)),o),i)},r.prototype.md5_ff=function(t,e,i,r,o,n,s){return this.md5_cmn(e&i|~e&r,t,e,o,n,s)},r.prototype.md5_gg=function(t,e,i,r,o,n,s){return this.md5_cmn(e&r|i&~r,t,e,o,n,s)},r.prototype.md5_hh=function(t,e,i,r,o,n,s){return this.md5_cmn(e^i^r,t,e,o,n,s)},r.prototype.md5_ii=function(t,e,i,r,o,n,s){return this.md5_cmn(i^(e|~r),t,e,o,n,s)},r.prototype.core_hmac_md5=function(t,e){var i=this.str2binLittle(t);16<i.length&&(i=this.core_md5(i,t.length*this.chrsz));for(var r=Array(16),o=Array(16),n=0;n<16;n++)r[n]=909522486^i[n],o[n]=1549556828^i[n];var s=this.core_md5(r.concat(this.str2binLittle(e)),512+e.length*this.chrsz);return this.core_md5(o.concat(s),640)},r.sha1ToHex=function(t){r.crypt.checkParam(t),r.crypt.checkType(t.data,"data"),r.crypt.cryptQueue.push({param:t,doCrypt:r.sha1ToHexSync})},r.sha1ToHexSync=function(t){r.crypt.checkParam(t);var e=t.data;return r.crypt.checkType(e,"data"),r.crypt.bin2hex(r.crypt.core_sha1(r.crypt.str2bin(e),e.length*r.crypt.chrsz))},r.sha1ToBase64=function(t){r.crypt.checkParam(t),r.crypt.checkType(t.data,"data"),r.crypt.cryptQueue.push({param:t,doCrypt:r.sha1ToBase64Sync})},r.sha1ToBase64Sync=function(t){r.crypt.checkParam(t);var e=t.data;return r.crypt.checkType(e,"data"),r.crypt.bin2b64(r.crypt.core_sha1(r.crypt.str2bin(e),e.length*r.crypt.chrsz))},r.hmacSha1ToHex=function(t){r.crypt.checkParam(t),r.crypt.checkType(t.data,"data"),r.crypt.checkType(t.key,"key"),r.crypt.cryptQueue.push({param:t,doCrypt:r.hmacSha1ToHexSync})},r.hmacSha1ToHexSync=function(t){r.crypt.checkParam(t);var e=t.key,i=t.data;return r.crypt.checkType(i,"data"),r.crypt.checkType(e,"key"),r.crypt.bin2hex(r.crypt.core_hmac_sha1(e,i))},r.hmacSha1ToBase64=function(t){r.crypt.checkParam(t),r.crypt.checkType(t.data,"data"),r.crypt.checkType(t.key,"key"),r.crypt.cryptQueue.push({param:t,doCrypt:r.hmacSha1ToBase64Sync})},r.hmacSha1ToBase64Sync=function(t){r.crypt.checkParam(t);var e=t.key,i=t.data;return r.crypt.checkType(i,"data"),r.crypt.checkType(e,"key"),r.crypt.bin2b64(r.crypt.core_hmac_sha1(e,i))},r.prototype.core_sha1=function(t,e){t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e;for(var i=Array(80),r=1732584193,o=-271733879,n=-1732584194,s=271733878,a=-1009589776,h=0;h<t.length;h+=16){for(var c=r,u=o,l=n,d=s,f=a,_=0;_<80;_++){i[_]=_<16?t[h+_]:this.rol(i[_-3]^i[_-8]^i[_-14]^i[_-16],1);var p=this.safe_add(this.safe_add(this.rol(r,5),this.sha1_ft(_,o,n,s)),this.safe_add(this.safe_add(a,i[_]),this.sha1_kt(_)));a=s,s=n,n=this.rol(o,30),o=r,r=p}r=this.safe_add(r,c),o=this.safe_add(o,u),n=this.safe_add(n,l),s=this.safe_add(s,d),a=this.safe_add(a,f)}return Array(r,o,n,s,a)},r.prototype.sha1_ft=function(t,e,i,r){return t<20?e&i|~e&r:t<40?e^i^r:t<60?e&i|e&r|i&r:e^i^r},r.prototype.sha1_kt=function(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514},r.prototype.core_hmac_sha1=function(t,e){var i=this.str2bin(t);16<i.length&&(i=this.core_sha1(i,t.length*this.chrsz));for(var r=Array(16),o=Array(16),n=0;n<16;n++)r[n]=909522486^i[n],o[n]=1549556828^i[n];var s=this.core_sha1(r.concat(this.str2bin(e)),512+e.length*this.chrsz);return this.core_sha1(o.concat(s),672)},r.prototype.str2bin=function(t){var e=Array(),i=(1<<this.chrsz)-1;if("number"==typeof t&&(t=t.toString()),"string"==typeof t){for(var r=0;r<t.length*this.chrsz;r+=this.chrsz)e[r>>5]|=(t.charCodeAt(r/this.chrsz)&i)<<24-r%32;return e}for(var o=0;o<t.length*this.chrsz;o+=this.chrsz)e[o>>5]|=(t[o/this.chrsz]&i)<<24-o%32;return e},r.prototype.bin2str=function(t){for(var e="",i=(1<<this.chrsz)-1,r=0;r<32*t.length;r+=this.chrsz)e+=String.fromCharCode(t[r>>5]>>>24-r%32&i);return e},r.prototype.bin2hex=function(t){for(var e=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",i="",r=0;r<4*t.length;r++)i+=e.charAt(t[r>>2]>>8*(3-r%4)+4&15)+e.charAt(t[r>>2]>>8*(3-r%4)&15);return i},r.prototype.bin2b64=function(t){for(var e="",i=0;i<4*t.length;i+=3)for(var r=(t[i>>2]>>8*(3-i%4)&255)<<16|(t[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|t[i+2>>2]>>8*(3-(i+2)%4)&255,o=0;o<4;o++)8*i+6*o>32*t.length?e+=this.b64pad:e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>6*(3-o)&63);return e},r.prototype.bin2b64Little=function(t){for(var e=this.bin2strLittle(t),i="",r=e.length,o=0;o<r;o+=3)for(var n=e.charCodeAt(o)<<16|(o+1<r?e.charCodeAt(o+1)<<8:0)|(o+2<r?e.charCodeAt(o+2):0),s=0;s<4;s++)8*o+6*s>8*e.length?i+=this.b64pad:i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>6*(3-s)&63);return i},r.prototype.str2binLittle=function(t){"number"==typeof t&&(t=t.toString());var e=Array();if("string"==typeof t){for(var i=0;i<8*t.length;i+=8)e[i>>5]|=(255&t.charCodeAt(i/8))<<i%32;return e}for(i=0;i<8*t.length;i+=8)e[i>>5]|=(255&t[i/8])<<i%32;return e},r.prototype.bin2strLittle=function(t){for(var e="",i=0;i<32*t.length;i+=8)e+=String.fromCharCode(t[i>>5]>>>i%32&255);return e},r.prototype.bin2hexLittle=function(t){for(var e,i=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",r=this.bin2strLittle(t),o="",n=0;n<r.length;n++)e=r.charCodeAt(n),o+=i.charAt(e>>>4&15)+i.charAt(15&e);return o},r.crypt=new r,r}();BK.Crypt.md5ToHex=function(t){r.md5ToHex(t)},BK.Crypt.md5ToBase64=function(t){r.md5ToBase64(t)},BK.Crypt.hmacMd5ToHex=function(t){r.hmacMd5ToHex(t)},BK.Crypt.hmacMd5ToBase64=function(t){r.hmacMd5ToBase64(t)},BK.Crypt.sha1ToHex=function(t){r.sha1ToHex(t)},BK.Crypt.sha1ToBase64=function(t){r.sha1ToBase64(t)},BK.Crypt.hmacSha1ToHex=function(t){r.hmacSha1ToHex(t)},BK.Crypt.hmacSha1ToBase64=function(t){r.hmacSha1ToBase64(t)},BK.Crypt.md5ToHexSync=function(t){return r.md5ToHexSync(t)},BK.Crypt.md5ToBase64Sync=function(t){return r.md5ToBase64Sync(t)},BK.Crypt.hmacMd5ToHexSync=function(t){return r.hmacMd5ToHexSync(t)},BK.Crypt.hmacMd5ToBase64Sync=function(t){return r.hmacMd5ToBase64Sync(t)},BK.Crypt.sha1ToHexSync=function(t){return r.sha1ToHexSync(t)},BK.Crypt.sha1ToBase64Sync=function(t){return r.sha1ToBase64Sync(t)},BK.Crypt.hmacSha1ToHexSync=function(t){return r.hmacSha1ToHexSync(t)},BK.Crypt.hmacSha1ToBase64Sync=function(t){return r.hmacSha1ToBase64Sync(t)},t.exports=BK.Crypt},"./src/common/emitter.ts":function(t,e,i){"use strict";var o=function(t,e,i){this.event=t,this.listener=e,this.once=i},r=function(){function t(){this._emits={}}return t.prototype.__emit_get=function(t){return this._emits[t]||(this._emits[t]=new Array),this._emits[t]},t.prototype.__emit_exists=function(t){var e=this.__emit_get(t);return!!(e&&0<e.length)},t.prototype.__emit_put=function(t,e,i){var r=new o(t,e,i);return this.__emit_get(t).push(r),this},t.prototype.__emit_remove=function(t,e){if(1!=this.__emit_exists(t))return!1;for(var i=-1,r=this.__emit_get(t),o=r.length-1;0<=o;o--){if(e==r[o].listener){i=o;break}}return-1<i&&r.splice(i,1),!0},t.prototype.on=function(t,e){return this.__emit_put(t,e,!1),this},t.prototype.once=function(t,e){return this.__emit_put(t,e,!0),this},t.prototype.off=function(t,e){return this.__emit_remove(t,e),this},t.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(this.__emit_exists(t)){for(var r=[],o=this.__emit_get(t),n=o.length,s=0;s<n;s++){var a=o[s];a.listener.apply(a,e),a.once&&r.push(a)}for(s=0;s<r.length;s++){var h=r[s];this.__emit_remove(t,h.listener)}return!0}return!1},t}();t.exports=r},"./src/common/qrcode.ts":function(t,e,i){"use strict";var c=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],o=i("./src/common/qrcodeModel.ts").QRCodeModel,m=i("./src/common/qrcodeModel.ts").QRErrorCorrectLevel;function n(t,e){for(var i,r,o=1,n=(i=t,(r=encodeURI(i).toString().replace(/\%[0-9a-fA-F]{2}/g,"a")).length+(r.length!=i?3:0)),s=0,a=c.length;s<a;s++){var h=0;switch(e){case m.L:h=c[s][0];break;case m.M:h=c[s][1];break;case m.Q:h=c[s][2];break;case m.H:h=c[s][3]}if(n<=h)break;o++}if(c.length<o)throw new Error("Too long data");return o}var r=function(){function p(){BK.Director.ticker.add(function(t,e){if(0!==p.taskQueue.length){var i=p.taskQueue[0];p.taskQueue.splice(0,1);var r=!1;try{p.makeQRCodeToFileSync(i)}catch(t){if(r=!0,!i.fail)throw t;i.fail({msg:t.message})}r||i.success&&i.success({path:i.path}),i.complete&&i.complete()}})}return p.createQRModel=function(t,e){var i,r=new o(n(t,(i=void 0===e?{width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:2}:e).correctLevel),i.correctLevel);return r.addData(t),r.make(),r},p.createQRCodeNode=function(t,e){var i;i=void 0===e?{width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:m.H}:e;for(var r=new BK.Canvas(i.width,i.height),o=p.createQRModel(t,e),n=o.getModuleCount(),s=i.width/n,a=i.height/n,h=Math.round(s),c=Math.round(a),u=0;u<n;u++)for(var l=0;l<n;l++){var d=o.isDark(u,l),f=l*s,_=u*a;r.lineWidth=1,r.fillColor=d?i.colorDark:i.colorLight,r.drawStyle=0,r.fillRect(f,_,s,a),r.strokeColor=d?i.colorDark:i.colorLight,r.strokeRect(Math.ceil(f)-.5,Math.ceil(_)-.5,h,c),r.strokeRect(Math.ceil(f)+.5,Math.ceil(_)+.5,h,c)}return r},p.createQRCodeToFile=function(t,e,i){if(!t)throw new Error("path can not be undefined!");if(!e)throw new Error("content can not be undefined!");i||(i={});var r=i.width,o=void 0===r?256:r,n=i.height,s=void 0===n?256:n,a=i.colorDark,h=void 0===a?{r:0,g:0,b:0,a:1}:a,c=i.colorLight,u=void 0===c?{r:1,g:1,b:1,a:1}:c,l=i.correctLevel,d=void 0===l?m.H:l,f=p.createQRCodeNode(e,{width:o,height:s,colorDark:h,colorLight:u,correctLevel:d});f.saveTo(t),f.dispose()},p.makeQRCodeToFileSync=function(t){if(!t)throw new Error("param can not be undefined!");var e=t.path,i=t.content,r=t.config;if(!e)throw new Error("path can not be undefined!");if(0!==e.indexOf("GameSandBox://"))throw new Error("path must start with GameSandBox://");this.createQRCodeToFile(e,i,r)},p.makeQRCodeToFile=function(t){p.taskQueue.push(t)},p.compose=function(t,e){var i=BK.Director.screenPixelSize.width,r=BK.Director.screenPixelSize.height,o=new BK.Canvas(i,r);o.drawImage(t,0,0),o.drawImage(e,0,0),o.saveTo("GameSandBox://compose.png"),o.dispose()},p.taskQueue=new Array,p.instance=new p,p}();"undefined"!=typeof BK&&(BK.QRErrorCorrectLevel=m),t.exports=r},"./src/common/qrcodeModel.ts":function(t,e,i){"use strict";var n,r,o,s,a=function(){function t(t){this.mode=n.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,i=this.data.length;e<i;e++){var r=[],o=this.data.charCodeAt(e);65536<o?(r[0]=240|(1835008&o)>>>18,r[1]=128|(258048&o)>>>12,r[2]=128|(4032&o)>>>6,r[3]=128|63&o):2048<o?(r[0]=224|(61440&o)>>>12,r[1]=128|(4032&o)>>>6,r[2]=128|63&o):128<o?(r[0]=192|(1984&o)>>>6,r[1]=128|63&o):r[0]=o,this.parsedData.push(r)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}return t.prototype.getLength=function(t){return this.parsedData.length},t.prototype.write=function(t){for(var e=0;e<this.parsedData.length;e++)t.put(this.parsedData[e],8)},t}(),h=function(){function h(t,e){this.moduleCount=0,this.dataList=new Array,this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=new Array}return h.prototype.addData=function(t){var e=new a(t);this.dataList.push(e),this.dataCache=null},h.prototype.isDark=function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},h.prototype.getModuleCount=function(){return this.moduleCount},h.prototype.make=function(){this.makeImpl(!1,this.getBestMaskPattern())},h.prototype.makeImpl=function(t,e){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++){this.modules[i]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[i][r]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,e),7<=this.typeNumber&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=h.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,e)},h.prototype.setupPositionProbePattern=function(t,e){for(var i=-1;i<=7;i++)if(!(t+i<=-1||this.moduleCount<=t+i))for(var r=-1;r<=7;r++)e+r<=-1||this.moduleCount<=e+r||(this.modules[t+i][e+r]=0<=i&&i<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==i||6==i)||2<=i&&i<=4&&2<=r&&r<=4)},h.prototype.getBestMaskPattern=function(){for(var t=0,e=0,i=0;i<8;i++){this.makeImpl(!0,i);var r=g.getLostPoint(this);(0==i||r<t)&&(t=r,e=i)}return e},h.prototype.createMovieClip=function(t,e,i){var r=t.createEmptyMovieClip(e,i);this.make();for(var o=0;o<this.modules.length;o++)for(var n=1*o,s=0;s<this.modules[o].length;s++){var a=1*s;this.modules[o][s]&&(r.beginFill(0,100),r.moveTo(a,n),r.lineTo(a+1,n),r.lineTo(a+1,n+1),r.lineTo(a,n+1),r.endFill())}return r},h.prototype.setupTimingPattern=function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},h.prototype.setupPositionAdjustPattern=function(){for(var t=g.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var i=0;i<t.length;i++){var r=t[e],o=t[i];if(null==this.modules[r][o])for(var n=-2;n<=2;n++)for(var s=-2;s<=2;s++)this.modules[r+n][o+s]=-2==n||2==n||-2==s||2==s||0==n&&0==s}},h.prototype.setupTypeNumber=function(t){for(var e=g.getBCHTypeNumber(this.typeNumber),i=0;i<18;i++){var r=!t&&1==(e>>i&1);this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=r}for(i=0;i<18;i++){r=!t&&1==(e>>i&1);this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=r}},h.prototype.setupTypeInfo=function(t,e){for(var i=this.errorCorrectLevel<<3|e,r=g.getBCHTypeInfo(i),o=0;o<15;o++){var n=!t&&1==(r>>o&1);o<6?this.modules[o][8]=n:o<8?this.modules[o+1][8]=n:this.modules[this.moduleCount-15+o][8]=n}for(o=0;o<15;o++){n=!t&&1==(r>>o&1);o<8?this.modules[8][this.moduleCount-o-1]=n:o<9?this.modules[8][15-o-1+1]=n:this.modules[8][15-o-1]=n}this.modules[this.moduleCount-8][8]=!t},h.prototype.mapData=function(t,e){for(var i=-1,r=this.moduleCount-1,o=7,n=0,s=this.moduleCount-1;0<s;s-=2)for(6==s&&s--;;){for(var a=0;a<2;a++)if(null==this.modules[r][s-a]){var h=!1;n<t.length&&(h=1==(t[n]>>>o&1)),g.getMask(e,r,s-a)&&(h=!h),this.modules[r][s-a]=h,-1==--o&&(n++,o=7)}if((r+=i)<0||this.moduleCount<=r){r-=i,i=-i;break}}},h.createData=function(t,e,i){for(var r=B.getRSBlocks(t,e),o=new b,n=0;n<i.length;n++){var s=i[n];o.put(s.mode,4),o.put(s.getLength(),g.getLengthInBits(s.mode,t)),s.write(o)}var a=0;for(n=0;n<r.length;n++)a+=r[n].dataCount;if(o.getLengthInBits()>8*a)throw new Error("code length overflow. ("+o.getLengthInBits()+">"+8*a+")");for(o.getLengthInBits()+4<=8*a&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(!1);for(;!(o.getLengthInBits()>=8*a||(o.put(h.PAD0,8),o.getLengthInBits()>=8*a));)o.put(h.PAD1,8);return h.createBytes(o,r)},h.createBytes=function(t,e){for(var i=0,r=0,o=0,n=new Array(e.length),s=new Array(e.length),a=0;a<e.length;a++){var h=e[a].dataCount,c=e[a].totalCount-h;r=Math.max(r,h),o=Math.max(o,c),n[a]=new Array(h);for(var u=0;u<n[a].length;u++)n[a][u]=255&t.buffer[u+i];i+=h;var l=g.getErrorCorrectPolynomial(c),d=new y(n[a],l.getLength()-1).mod(l);s[a]=new Array(l.getLength()-1);for(u=0;u<s[a].length;u++){var f=u+d.getLength()-s[a].length;s[a][u]=0<=f?d.get(f):0}}var _=0;for(u=0;u<e.length;u++)_+=e[u].totalCount;var p=new Array(_),m=0;for(u=0;u<r;u++)for(a=0;a<e.length;a++)u<n[a].length&&(p[m++]=n[a][u]);for(u=0;u<o;u++)for(a=0;a<e.length;a++)u<s[a].length&&(p[m++]=s[a][u]);return p},h.PAD0=236,h.PAD1=17,h}();(r=n||(n={}))[r.MODE_NUMBER=1]="MODE_NUMBER",r[r.MODE_ALPHA_NUM=2]="MODE_ALPHA_NUM",r[r.MODE_8BIT_BYTE=4]="MODE_8BIT_BYTE",r[r.MODE_KANJI=8]="MODE_KANJI",(s=o||(o={}))[s.L=1]="L",s[s.M=0]="M",s[s.Q=3]="Q",s[s.H=2]="H";for(var c=0,u=1,l=2,d=3,f=4,_=5,p=6,m=7,g=function(){function i(){}return i.getBCHTypeInfo=function(t){for(var e=t<<10;0<=i.getBCHDigit(e)-i.getBCHDigit(i.G15);)e^=i.G15<<i.getBCHDigit(e)-i.getBCHDigit(i.G15);return(t<<10|e)^i.G15_MASK},i.getBCHTypeNumber=function(t){for(var e=t<<12;0<=i.getBCHDigit(e)-i.getBCHDigit(i.G18);)e^=i.G18<<i.getBCHDigit(e)-i.getBCHDigit(i.G18);return t<<12|e},i.getBCHDigit=function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},i.getPatternPosition=function(t){return i.PATTERN_POSITION_TABLE[t-1]},i.getMask=function(t,e,i){switch(t){case c:return(e+i)%2==0;case u:return e%2==0;case l:return i%3==0;case d:return(e+i)%3==0;case f:return(Math.floor(e/2)+Math.floor(i/3))%2==0;case _:return e*i%2+e*i%3==0;case p:return(e*i%2+e*i%3)%2==0;case m:return(e*i%3+(e+i)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},i.getErrorCorrectPolynomial=function(t){for(var e=new y([1],0),i=0;i<t;i++)e=e.multiply(new y([1,v.gexp(i)],0));return e},i.getLengthInBits=function(t,e){if(1<=e&&e<10)switch(t){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:case n.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},i.getLostPoint=function(t){for(var e=t.getModuleCount(),i=0,r=0;r<e;r++)for(var o=0;o<e;o++){for(var n=0,s=t.isDark(r,o),a=-1;a<=1;a++)if(!(r+a<0||e<=r+a))for(var h=-1;h<=1;h++)o+h<0||e<=o+h||0==a&&0==h||s==t.isDark(r+a,o+h)&&n++;5<n&&(i+=3+n-5)}for(r=0;r<e-1;r++)for(o=0;o<e-1;o++){var c=0;t.isDark(r,o)&&c++,t.isDark(r+1,o)&&c++,t.isDark(r,o+1)&&c++,t.isDark(r+1,o+1)&&c++,0!=c&&4!=c||(i+=3)}for(r=0;r<e;r++)for(o=0;o<e-6;o++)t.isDark(r,o)&&!t.isDark(r,o+1)&&t.isDark(r,o+2)&&t.isDark(r,o+3)&&t.isDark(r,o+4)&&!t.isDark(r,o+5)&&t.isDark(r,o+6)&&(i+=40);for(o=0;o<e;o++)for(r=0;r<e-6;r++)t.isDark(r,o)&&!t.isDark(r+1,o)&&t.isDark(r+2,o)&&t.isDark(r+3,o)&&t.isDark(r+4,o)&&!t.isDark(r+5,o)&&t.isDark(r+6,o)&&(i+=40);var u=0;for(o=0;o<e;o++)for(r=0;r<e;r++)t.isDark(r,o)&&u++;return i+=10*(Math.abs(100*u/e/e-50)/5)},i.PATTERN_POSITION_TABLE=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],i.G15=1335,i.G18=7973,i.G15_MASK=21522,i}(),v={glog:function(t){if(t<1)throw new Error("glog("+t+")");return v.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;256<=t;)t-=255;return v.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},S=0;S<8;S++)v.EXP_TABLE[S]=1<<S;for(S=8;S<256;S++)v.EXP_TABLE[S]=v.EXP_TABLE[S-4]^v.EXP_TABLE[S-5]^v.EXP_TABLE[S-6]^v.EXP_TABLE[S-8];for(S=0;S<255;S++)v.LOG_TABLE[v.EXP_TABLE[S]]=S;var y=function(){function o(t,e){if(null==t.length)throw new Error(t.length+"/"+e);for(var i=0;i<t.length&&0==t[i];)i++;this.num=new Array(t.length-i+e);for(var r=0;r<t.length-i;r++)this.num[r]=t[r+i]}return o.prototype.get=function(t){return this.num[t]},o.prototype.getLength=function(){return this.num.length},o.prototype.multiply=function(t){for(var e=new Array(this.getLength()+t.getLength()-1),i=0;i<this.getLength();i++)for(var r=0;r<t.getLength();r++)e[i+r]^=v.gexp(v.glog(this.get(i))+v.glog(t.get(r)));return new o(e,0)},o.prototype.mod=function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=v.glog(this.get(0))-v.glog(t.get(0)),i=new Array(this.getLength()),r=0;r<this.getLength();r++)i[r]=this.get(r);for(r=0;r<t.getLength();r++)i[r]^=v.gexp(v.glog(t.get(r))+e);return new o(i,0).mod(t)},o}(),B=function(){function u(t,e){this.totalCount=t,this.dataCount=e}return u.getRSBlocks=function(t,e){var i=u.getRsBlockTable(t,e);if(null==i)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var r=i.length/3,o=[],n=0;n<r;n++)for(var s=i[3*n+0],a=i[3*n+1],h=i[3*n+2],c=0;c<s;c++)o.push(new u(a,h));return o},u.getRsBlockTable=function(t,e){switch(e){case o.L:return u.RS_BLOCK_TABLE[4*(t-1)+0];case o.M:return u.RS_BLOCK_TABLE[4*(t-1)+1];case o.Q:return u.RS_BLOCK_TABLE[4*(t-1)+2];case o.H:return u.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},u.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],u}(),b=function(){function t(){this.buffer=new Array,this.length=0}return t.prototype.get=function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},t.prototype.put=function(t,e){for(var i=0;i<e;i++)this.putBit(1==(t>>>e-i-1&1))},t.prototype.getLengthInBits=function(){return this.length},t.prototype.putBit=function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++},t}();t.exports={QRCodeModel:h,QRErrorCorrectLevel:o}},"./src/deprecate/http-util.ts":function(t,e,i){"use strict";var o=BK.HttpUtil,r=function(){function t(t,e,i){this._headers={},this._isBodyCompatible=!1,this._url=t,this._method=e,"string"==typeof i?this._argu=i:i&&(this._body=i)}return t.prototype.setHttpHeader=function(t,e){this._headers[t]=e},t.prototype.setHttpRawBody=function(t){this._body=t},t.prototype.setHttpUploadProgressListener=function(t){this._uploadProgressListener=t},t.prototype.setHttpDownloadProgressListener=function(t){this._downloadProgressListener=t},t.prototype.sendRequest=function(i){var t=this._request=new o(this._url,this._method?this._method.toUpperCase():"GET");for(var e in this._headers)t.setHttpHeader(e,this._headers[e]);if(this._body)"string"==typeof this._body?((r=new BK.Buffer).writeAsString(this._body,!1),t.setHttpRawBody(r)):t.setHttpRawBody(this._body);else if(this._argu){var r;this._isBodyCompatible&&t.setHttpHeader("PostBody",this._argu),(r=new BK.Buffer).writeAsString(this._argu,!1),t.setHttpRawBody(r)}t.setHttpUploadProgressListener&&this._uploadProgressListener&&t.setHttpUploadProgressListener(this._uploadProgressListener),t.setHttpDownloadProgressListener&&this._downloadProgressListener&&t.setHttpDownloadProgressListener(this._downloadProgressListener),t.sendRequest?t.sendRequest(i):t.requestAsync(function(t,e){i(e,{},t)})},t.prototype.setHttpUrl=function(t){this._url=t},t.prototype.setHttpMethod=function(t){this._method=t},t.prototype.requestAsync=function(r){this.sendRequest(function(t,e,i){r(i,t)})},t.prototype.setHttpReferer=function(t){this.setHttpHeader("Referer",t)},t.prototype.setHttpCookie=function(t){this.setHttpHeader("Cookie",t)},t.prototype.setBodyCompatible=function(t){this._isBodyCompatible=t},t.prototype.setHttpPostData=function(t){this._argu=t},t.prototype.setHttpRawBodyFix=function(t){this.setHttpRawBody(t)},t}();t.exports=r},"./src/fileSystem/FileSystem.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=i("./src/util/buffer.ts"),c=function(){function r(){}return r.decode=function(t,e){if(t&&e){var i=t;switch(e){case"utf8":i=t.readAsString(!0);break;case"ascii":i=r.toASCII(t.readAsString(!0));break;case"binary":i=BK.Misc.BKBufferToArrayBuffer(t);break;case"base64":i=BK.Misc.encodeBase64FromBuffer(t)}return i}return BK.Console.error("invalid source or encode "+e),null},r.toASCII=function(t){return r.ESC.lastIndex=0,r.ESC.test(t)?t.replace(r.ESC,function(t){var e=r.META[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}):t},r.ESC=/[\\\"\x00-\x1f\x7f-\uffff]/g,r.META={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},r}(),r=function(){function t(){}return t.prototype.readFile=function(o){if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")){if(o&&o.file){for(var t=[],e=0;e<o.file.length;e++)null!=o.file[e].path&&("utf8"===o.file[e].encoding&&(o.file[e].encoding="utf-8"),t.push({path:o.file[e].path,encoding:null==o.file[e].encoding?"binary":o.file[e].encoding}));var i=BK.FileUtil.addReadIOTask(t);BK.taskManager.pushTask(i,t,function(t){for(var e=0;e<t.length;e++)if(t[e].data){var i=t[e].data;if(i)switch(t[e].encoding){case"ascii":var r={data:c.decode(BK.FileUtil.readFile(t[e].path),"ascii"),errcode:0,path:t[e].path,errmsg:t[e].errmsg,encoding:"ascii"};t[e]=r;break;case"binary":t[e].data=BK.Misc.BKBufferToArrayBuffer(i);break;default:"utf-8"===t[e].encoding&&(t[e].encoding="utf8"),t[e].data=i.readAsString(!0)}else BK.Console.error("raw is invalid")}o.success&&o.success(t),o.complete&&o.complete()})}}else{var r=[];if(o&&o.file)for(e=0;e<o.file.length;e++){var n=o.file[e];if(n.path){var s=BK.FileUtil.readFile(n.path),a=c.decode(s,n.encoding||"binary");r.push({errcode:a?0:-1,errmsg:a?"":"read failed!",path:n.path,data:a})}}o.success&&o.success(r),o.complete&&o.complete()}},t.prototype.writeFile=function(e){if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")){if(e&&e.file){for(var t=[],i=0;i<e.file.length;i++)null!=e.file[i].path&&e.file[i].data&&t.push({path:e.file[i].path,encoding:null==e.file[i].encoding?"binary":e.file[i].encoding,data:h.arrayBufferToBKBuffer(e.file[i].data)});var r=BK.FileUtil.addWriteIOTask(t);BK.taskManager.pushTask(r,t,function(t){e.success&&e.success(t),e.complete&&e.complete()})}}else{var o=[];if(e&&e.file)for(i=0;i<e.file.length;i++){var n=e.file[i];if(n.path){var s=h.arrayBufferToBKBuffer(n.data),a=BK.FileUtil.writeBufferToFile(n.path,s);o.push({errcode:a?0:-1,errmsg:a?"":"write failed!",path:n.path})}}e.success&&e.success(o),e.complete&&e.complete()}},t.prototype.zip=function(e){if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")){if(e&&e.file){for(var t=[],i=0;i<e.file.length;i++)e.file[i].path&&e.file[i].zipPath&&t.push({path:e.file[i].path,zipPath:e.file[i].zipPath});var r=BK.FileUtil.addZipIOTask(t);BK.taskManager.pushTask(r,t,function(t){e.success&&e.success(t),e.complete&&e.complete()})}}else{var o=[];if(e&&e.file)for(i=0;i<e.file.length;i++){var n=e.file[i];if(n.path&&n.zipPath){var s=BK.FileUtil.zip(n.path,n.zipPath);o.push({errcode:s?0:-1,errmsg:s?"":"zip failed!",path:n.path,zipPath:n.zipPath})}}e.success&&e.success(o),e.complete&&e.complete()}},t.prototype.unzip=function(e){if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")){if(e&&e.file){for(var t=[],i=0;i<e.file.length;i++)e.file[i].path&&e.file[i].zipPath&&t.push({path:e.file[i].path,zipPath:e.file[i].zipPath});var r=BK.FileUtil.addUnzipIOTask(t);BK.taskManager.pushTask(r,t,function(t){e.success&&e.success(t),e.complete&&e.complete()})}}else{var o=[];if(e&&e.file)for(i=0;i<e.file.length;i++){var n=e.file[i];if(n.path&&n.zipPath){var s=BK.FileUtil.unzip(n.zipPath,n.path);o.push({errcode:s?0:-1,errmsg:s?"":"unzip failed!",path:n.path,zipPath:n.zipPath})}}e.success&&e.success(o),e.complete&&e.complete()}},t.prototype.readFileSync=function(t,e){return c.decode(BK.FileUtil.readFile(t),e||"binary")},t.prototype.writeFileSync=function(t,e){if(e instanceof String||"string"==typeof e)BK.FileUtil.writeFile(t,e);else{var i=h.arrayBufferToBKBuffer(e);BK.FileUtil.writeBufferToFile(t,i)}},t.prototype.zipSync=function(t,e){BK.FileUtil.zip(t,e)},t.prototype.unzipSync=function(t,e){BK.FileUtil.unzip(t,e)},t.prototype.makeDirSync=function(t){BK.FileUtil.makeDir(t)},t.prototype.unlinkSync=function(t){return BK.FileUtil.deleteFile(t)},t.prototype.copyFileSync=function(t,e){if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0"))BK.FileUtil.copyFile(t,e);else{var i=BK.FileUtil.readFile(t);i&&BK.FileUtil.writeBufferToFile(e,i)}},t.prototype.accessSync=function(t){return BK.FileUtil.isFileExist(t)},t.prototype.isDirectory=function(t){return BK.FileUtil.isDirectory(t)},t.prototype.getFileInfoSync=function(t){return BK.FileUtil.getFileInfo(t)},t.prototype.readDir=function(i){return BK.FileUtil.getFileList(i,function(t,e){0==t?i.success&&i.success({files:e.files}):i.fail&&i.fail({msg:e.errMsg,errcode:t}),i.complete&&i.complete()})},t}();e.FileSystem=r,BK.FileUtil.readFileAsync=function(){return null},BK.FileUtil.removeFromCache=function(){return null},t.exports=r},"./src/gme/audio.ts":function(t,e,i){"use strict";var r,o,n,a,h,c,u,s,l,d,f,_=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),p=i("./src/common/emitter.ts");n=o||(o={}),a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},h={"Audio.play":"cs.audio_play.local","Audio.pause":"cs.audio_pause.local","Audio.load":"cs.audio_load.local","Audio.seek":"cs.audio_seek.local","Audio.destroy":"cs.audio_destroy.local","Audio.create":"cs.audio_create.local","Audio.onend":"cs.audio_onend.local","Audio.stop":"cs.audio_stop.local","Audio.resume":"cs.audio_effect_resume.local","NativeMethod.state":"cs.native_method_state.local","Audio.attribute.set":"cs.audio_attribute_set.local","Audio.attribute.get":"cs.audio_attribute_get.local","Audio.sys_event":"sc.audio_event.local"},c=function(){function s(t){this.callbackMap={},this.currentObjId=0,this.destroyed=!1,this.currentObjId=++s.OBJECT_ID,this.objContext=t;this.callAlive(s.NATIVE_INFO,function(t){t&&t.data&&t.data.message&&a("native method info:"+t.data.message)})}return s.prototype.getCurrentTime=function(){return Date.now()},s.prototype.setObjectId=function(t){this.currentObjId=t},s.prototype.call=function(t,e,i){this.releaseCallback();var r=this.getKey(t);this.callbackMap[this.getCallbackId()]={CALLBACK:i,LOCK:!0,CMD:h[r]},this.innerCall(h[r],e)},s.prototype.callAlive=function(t,r){var e=this.getKey(t);BK.MQQ.SsoRequest.addListener(h[e],this,function(t,e,i){r&&r({code:t,cmd:e,data:i})})},s.prototype.offAlive=function(t){var e=this.getKey(t);BK.MQQ.SsoRequest.removeListener(h[e],this.objContext)},s.prototype.callSync=function(t,e){this.releaseCallback();var i=this.getKey(t);return this.callbackMap[this.getCallbackId()]={CALLBACK:{},LOCK:!0,CMD:h[i]},this.innerCallSync(h[i],e)},s.prototype.callBack=function(t,e,i){var r=i;r.code=t;var o=r[s.N_REQUEST_SE],n=this.callbackMap[o];n?(n.CALLBACK&&"function"==typeof n.CALLBACK&&n.CALLBACK.call(this.objContext,r),n.LOCK=!1):a("no callback "+o),this.releaseCallback();a("receive callback # "+o+" # "+e+" # "+JSON.stringify(i)+" cost "+(this.getCurrentTime()-i[s.N_R_TIME])+" ms")},s.prototype.getKey=function(t){return t},s.prototype.getCallbackId=function(){return++s.CALLBACK_ID},s.prototype.innerCall=function(t,e){e[s.N_REQUEST_SE]=s.CALLBACK_ID,e[s.N_REQUEST_O]=this.currentObjId,e[s.N_R_TIME]=this.getCurrentTime(),a("send message "+s.CALLBACK_ID+" # "+t+" # "+JSON.stringify(e));var i=this;BK.MQQ.SsoRequest.removeListener(t,this.objContext),BK.MQQ.SsoRequest.addListener(t,this.objContext,function(){i.callBack.apply(i,arguments)}),BK.MQQ.SsoRequest.send(e,t)},s.prototype.innerCallSync=function(t,e){if(e[s.N_REQUEST_SE]=s.CALLBACK_ID,e[s.N_REQUEST_O]=this.currentObjId,e[s.N_R_SYNC]=!0,e[s.N_R_TIME]=this.getCurrentTime(),a("send message sync "+s.CALLBACK_ID+" # "+t+" # "+JSON.stringify(e)),BK.MQQ.Native.syncSend)return BK.MQQ.Native.syncSend(e,t)},s.prototype.releaseCallback=function(){for(var t in this.callbackMap)t&&!this.callbackMap[t].LOCK&&delete this.callbackMap[t]},s.N_REQUEST_SE="N_R_SE",s.N_REQUEST_O="N_R_OBJ",s.CALLER="CALLER",s.CALLBACK="CALLBACK",s.NATIVE_INFO="NativeMethod.state",s.N_R_SYNC="N_R_SYNC",s.N_R_ALIVE="N_R_ALIVE",s.N_R_T="N_R_T",s.N_R_TIME="N_R_TIME",s.CALLBACK_ID=0,s.OBJECT_ID=0,s}(),u={NAME_SPACE:"MediaEvent",abort:"abort",canplay:"canplay",canplaythrough:"canplaythrough",durationchange:"durationchange",emptied:"emptied",encrypted:"encrypted",ended:"ended",error:"error",interruptbegin:"interruptbegin",interruptend:"interruptend",loadeddata:"loadeddata",loadedmetadata:"loadedmetadata",loadstart:"loadstart",mozaudioavailable:"mozaudioavailable",pause:"pause",play:"play",playing:"playing",progress:"progress",ratechange:"ratechange",seeked:"seeked",seeking:"seeking",stalled:"stalled",suspend:"suspend",timeupdate:"timeupdate",volumechange:"volumechange",waiting:"waiting",created:"created",destroyed:"destroyed"},s=function(n){function s(t){var e=n.call(this)||this;e._src="",e._volume=1,e._muted=!1,e._loop=!1,e._autoplay=!1,e._buffered={},e._controls={},e._preload=!1,e._played={},e._duration=0,e._paused=!1,e._currenTime=0,e._playing=!1,e._loaded=!1,e._loading=!1,e._playerType="normal",e._streamId=0,e._lastLeftVolume=1,e._lastRightVolume=1,e._loopCound=0,e._destroyed=!1,e._$sn=s.SN_SEED++,e.HAVE_NOTHING=0,e.HAVE_METADATA=1,e.HAVE_CURRENT_DATA=2,e.HAVE_FUTURE_DATA=3,e.HAVE_ENOUGH_DATA=4,e.readyState=0,e.nativeMethod=new c(e);var i="normal",r="";t.src&&(r=t.src),t.type&&(i=i===t.type?i:"effect"),e.create(t);var o=e;return r?o.src=r:o._src="",e}return _(s,n),s.prototype.create=function(t,e){void 0===t&&(t={}),void 0===e&&(e=!1);var i=t.type;if(i||(i="normal",t.type=i),t.id=GameStatusInfo.gameId,this._playerType=i,!this.isIOSEffect()||e){this.nativeMethod.callSync("Audio.create",t);this.onCreate()}},s.prototype.onCanPlay=function(){this.emit("load"),this.emit("loadend"),this.emit("canplay"),this.emit("canplaythrough"),this.emit(u.loadeddata),this.emit(u.loadedmetadata),this.readyState=2},s.prototype.onPlay=function(){this.emit(u.play),this.emit(u.playing),this._playing=!0},s.prototype.onCreate=function(){this.emit(u.created)},s.prototype.onDestroy=function(){this.emit(u.destroyed),BK.Director.ticker.remove(this),this._destroyed=!0},s.prototype.onPause=function(){this.emit(u.pause),this._paused=!0,this._playing=!1},s.prototype.onEnded=function(){this.emit("ended"),this.readyState=4,this._playing=!1,BK.Director.ticker.remove(this)},s.prototype.onError=function(t){this.emit("error"),BK.Director.ticker.remove(this)},s.prototype.onSeeking=function(){this.emit(u.seeking)},s.prototype.onSeeked=function(){this.emit(u.seeked),this.emit(u.playing)},s.prototype.onTimeUpdate=function(t){this.emit(u.timeupdate,{currentTime:t})},s.prototype.onLoad=function(){this._loaded=!0,this._loading=!1,this.onCanPlay(),this.nativeMethod.callSync("Audio.duration",{})},s.prototype.onVolumeChange=function(){this.emit(u.volumechange)},s.prototype.load=function(){var e=this;this._loaded&&this.emit(u.emptied),this._loading=!0,this.emit(u.loadstart),this.nativeMethod.call("Audio.load",{},function(t){0===t.code?e.onLoad():e.onError(t.message)})},s.prototype.play=function(t){if(void 0===t&&(t={}),!this.destroyed){var r=this;if(this._playing=!0,this._paused=!1,"effect"!==this._playerType){this.autoplay=!0,this.nativeMethod.callSync("Audio.play",t),this.nativeMethod.call("Audio.onend",{},r.onEnded);var o=(new Date).getTime();BK.Director.ticker.remove(this),BK.Director.ticker.add(function(t,e){var i=(new Date).getTime();2e3<=i-o&&(r.getAttribute({currentTime:0}),o=i)},this)}else{if(this.isIOSEffect()){var e=--s.IOS_OBJ_ID;this.nativeMethod.setObjectId(e),this.create({type:this._playerType,src:this._src,loop:this._loop},!0),t.complete&&t.complete({id:s.IOS_OBJ_ID})}var i=t.loopCount,n={loop:i||(this._loop?-1:0),src:this._src,volume:this._volume,complete:t.complete?t.complete:function(t){t&&(r._streamId=t.id,0===t.code||r.onError(t.message))}};this.nativeMethod.call("Audio.play",n,n.complete)}return this.onPlay(),this._streamId}},s.prototype.pause=function(t){void 0===t&&(t={}),this.destroyed||("effect"===this._playerType&&(t.id=t.id,t.id&&0!==t.id||(delete t.id,t.auto=!0)),BK.Director.ticker.remove(this),this._paused=!0,this.nativeMethod.callSync("Audio.pause",t),this.onPause())},s.prototype.seek=function(t){var e=this;this.nativeMethod.call("Audio.seek",{seek:t},function(t){0===t.code?e.onSeeked():e.onError(t.message)}),this.onSeeking()},s.prototype.destroy=function(t){if(void 0===t&&(t={}),!this.destroyed){"effect"===this._playerType&&t.id&&(t.id=t.id),this.nativeMethod.callSync("Audio.destroy",{id:this._$sn}),BK.Director.ticker.remove(this),l.CURRENT_NUM--,l.removeAudio(this),this.onDestroy()}},s.prototype.canPlayType=function(t){return void 0===t&&(t=""),"string"!=typeof t?"":-1<"audio/mpeg".indexOf(t)||-1<"audio/mp4".indexOf(t)?"probably":""},s.prototype.stop=function(t){void 0===t&&(t={}),"effect"===this._playerType&&t.id&&(t.id=t.id),this.nativeMethod.callSync("Audio.stop",t)},s.prototype.resume=function(t){void 0===t&&(t={}),"effect"===this._playerType&&(t.id&&0!==t.id?this.isIOSEffect()&&this.nativeMethod.setObjectId(t.id):(delete t.id,t.audo=!0)),this.nativeMethod.callSync("Audio.resume",t)},s.prototype.setAttribute=function(t){this.nativeMethod.callSync("Audio.attribute.set",t)},s.prototype.getAttribute=function(t){void 0===t&&(t={});var e=this.nativeMethod.callSync("Audio.attribute.get",t);e&&!isNaN(e.duration)&&(this._duration=e.duration),e&&!isNaN(e.currentTime)&&(this._currenTime=e.currentTime,this.onTimeUpdate(e.currentTime)),e&&void 0!==e.paused&&(this._paused=e.paused)},Object.defineProperty(s.prototype,"currentTime",{get:function(){return this.getAttribute({currentTime:1}),this._currenTime},set:function(t){this.setAttribute({currentTime:t}),this.seek(t)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"duration",{get:function(){return this.getAttribute({duration:1}),this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"src",{get:function(){return this._src},set:function(t){t&&"android"===GameStatusInfo.platform&&(t=t.replace("GameSandBox://","GameRes://sandbox/")),"effect"!==this._playerType&&(this.setAttribute({src:t,autoPlay:this.autoplay,loop:this.loop}),this.load()),this._src=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"loop",{get:function(){return this._loop},set:function(t){"effect"!==this._playerType&&this.setAttribute({loop:t}),this._loop=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"autoplay",{get:function(){return this._autoplay},set:function(t){this.setAttribute({autoPlay:t}),this._autoplay=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"paused",{get:function(){return this.getAttribute({paused:!1}),this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"volume",{get:function(){return this._volume},set:function(t){this._muted||("effect"!==this._playerType&&(this.setAttribute({leftVolume:t,rightVolume:t,volume:t}),this.onVolumeChange()),this._lastLeftVolume=this.volume,this._lastRightVolume=this.volume,this._volume=t)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,"effect"!==this._playerType&&this.setAttribute({muted:t,leftVolume:this._lastLeftVolume,rightVolume:this._lastRightVolume})},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"buffered",{get:function(){return this._buffered},set:function(t){this._buffered=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"played",{get:function(){return this._played},set:function(t){this._played=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"preload",{get:function(){return this._preload},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"streamId",{get:function(){return this._streamId},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"type",{get:function(){return this._playerType},enumerable:!0,configurable:!0}),s.prototype.isIOSEffect=function(){return"effect"===this._playerType&&"ios"===GameStatusInfo.platform},Object.defineProperty(s.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"id",{get:function(){return this._$sn},enumerable:!0,configurable:!0}),s.SN_SEED=1,s.IOS_OBJ_ID=Math.pow(2,53)-1,s}(p),l=function(){function r(){}return r.createAudioContext=function(t){if(void 0===t&&(t={}),t.type&&"normal"!==t.type){if("effect"!==t.type)return a("invalid type "+t.type),new s({});return void 0===r.effect_instance||r.effect_instance.destroyed||(r.effect_instance.destroy(),r.removeAudio(r.effect_instance)),r.effect_instance=new s(t),r.audioMap.push(r.effect_instance),r.effect_instance}if(r.CURRENT_NUM<r.MAX_AUDIO_NUM){var e=new s(t);return r.CURRENT_NUM++,r.audioMap.push(e),e}return a("reach the max num of audio"),new s({})},r.getAudioList=function(){return r.audioMap},r.removeAudio=function(t){for(var e=-1,i=0;i<r.audioMap.length;i++)if(t.id==r.audioMap[i].id){e=i;break}-1!=e&&(r.audioMap=r.audioMap.slice(e,1))},r.MAX_AUDIO_NUM=8,r.MAX_EFFECT_NUM=3,r.CURRENT_NUM=0,r.audioMap=[],r.effectMap=[],r.CURRENT_EFFECT_NUM=0,r.effect_index=0,r}(),d=function(){function e(){this.nativeMethod=new c(this),this.nativeMethod.callAlive("Audio.sys_event",this.onEvent)}return e.prototype.onEvent=function(t){switch(void 0===t&&(t={}),(t.data||{}).event){case 1:e.AUDIO_INT_START&&"function"==typeof e.AUDIO_INT_START&&e.AUDIO_INT_START();break;case 2:e.AUDIO_INT_END&&"function"==typeof e.AUDIO_INT_END&&e.AUDIO_INT_END()}},e.newInstance=function(){e.INSTANCE||(e.INSTANCE=new e)},e.onAudioInterruptionStart=function(t){e.AUDIO_INT_START=t},e.onAudioInterruptionEnd=function(t){e.AUDIO_INT_END=t},e.pauseAllAudio=function(){for(var t=0,e=l.getAudioList();t<e.length;t++){var i=e[t];i&&!i.paused&&i.pause()}},e.resumeAllAudio=function(){for(var t=0,e=l.getAudioList();t<e.length;t++){var i=e[t];i&&("normal"===i.type?i.play():"effect"===i.type&&i.resume())}},e.destroyAllAudio=function(){for(var t=0,e=l.getAudioList();t<e.length;t++){var i=e[t];i&&i.destroy()}},e.INSTANCE=new e,e}(),f=function(){function r(t,e,i,r){void 0===i&&(i=1),void 0===r&&(r=!1),this._currentTime=0,this._volume=1,this._audioType=0,this._destroyAtComplete=!1,this._type=t,this._musicPath=e,this._loopCount=i,this._destroyAtComplete=r,BK.onEnterForeground(function(){d.resumeAllAudio()}),BK.onMaximize(function(){d.resumeAllAudio()})}return r.prototype.isEffect=function(){return 1===this._audioType},r.prototype.seekTo=function(t){this.audioObject&&this.audioObject.seek(t)},r.prototype.startMusic=function(t){if(void 0===t&&(t=function(){}),this.isEffect())(void 0===this.effectObject||this.effectObject.destroyed)&&(this.effectObject=l.createAudioContext({type:"effect",src:this._musicPath})||null),void 0!==this.effectObject&&(this.effectObject.loop=-1===this._loopCount,this.effectObject.muted=!r.switch,this.effectObject.src!==this._musicPath&&(this.effectObject.src=this._musicPath),this.effectObject.play({loopCount:this._loopCount}));else{(void 0===this.audioObject||this.audioObject.destroyed)&&(this.audioObject=l.createAudioContext({type:"normal",src:this._musicPath})||null);var e=this;void 0!==this.audioObject?(this.audioObject.muted=!r.switch,-1==this._loopCount?this._loopCount=Math.pow(2,53)-1:a("loo for "+this._loopCount),this.audioObject.on(u.loadeddata,function(){e.loopPlay(e._loopCount,t)})):a("create failed")}return this},r.prototype.loopPlay=function(t,e){if(void 0!==this.audioObject){var i=this;if(0<--t){var r=function(){void 0!==i.audioObject&&(i.audioObject.off(u.ended,r),i.loopPlay(t,e))};this.audioObject.on(u.ended,r)}if(t<=0){var o=function(){void 0!==i.audioObject&&(i.audioObject.off(u.ended,o),e&&e())};this.audioObject.on(u.ended,o)}this.audioObject.play()}},r.prototype.pauseMusic=function(){if(this.isEffect()){if(!this.effectObject)return void a("not init effect call play first");this.effectObject.pause()}else{if(!this.audioObject)return void a("not init audio call play first");this.audioObject.pause()}},r.prototype.resumeMusic=function(){if(this.isEffect()){if(!this.effectObject)return void a("not init effect call play first");this.effectObject.resume()}else{if(!this.audioObject)return void a("not init audio call play first");this.audioObject.play()}},r.prototype.stopMusic=function(){this.audioObject&&this.audioObject.destroy(),this.effectObject&&this.effectObject.destroy()},r.prototype.destroy=function(){this.audioObject&&this.audioObject.destroy(),this.effectObject&&this.effectObject.destroy()},Object.defineProperty(r.prototype,"volume",{set:function(t){this.audioObject?this.audioObject.volume=t:a("audio not init")},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"loopCount",{set:function(t){this.audioObject&&(this._loopCount=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"type",{set:function(t){this._type=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"musicPath",{set:function(t){this._musicPath=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"audioType",{get:function(){return this._audioType},set:function(t){this._audioType=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentTime",{get:function(){return this.audioObject?this.audioObject.currentTime:(a("audio not init"),0)},set:function(t){this.audioObject?this.audioObject.currentTime=t:a("audio not init")},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"duration",{get:function(){return this.audioObject?this.audioObject.duration:(a("audio not init"),0)},enumerable:!0,configurable:!0}),r.playMusic=function(t,e,i){1===t?(void 0===r.effectAudioInstance&&(r.effectAudioInstance=new r(t,e,i)),r.effectAudioInstance.musicPath=e,r.effectAudioInstance.loopCount=i,r.effectAudioInstance.startMusic()):new r(t,e,i).startMusic()},r.pauseAllBackground=function(){BK.AudioManager.pauseAllAudio()},r.resumeAllBackground=function(){BK.AudioManager.resumeAllAudio()},r.switch=!0,r}(),n.createContext=function(){return{MediaEvent:u,AudioFactory:l,NativeMethod:c,Audio2:f,AudioManager:d}},t.exports=o.createContext},"./src/mqq/advertisement/advertisement.ts":function(t,e,i){"use strict";var r,o,s=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),a=i("./src/common/emitter.ts");!function(t){var n=["succeed","internal error","frequency error","network error","invalid request","no ad fill","server error","formet mismatch","h5 game nonsupport"],e=function(i){function r(t){var e=i.call(this)||this;return e.ssoCMD={LOAD_REQ:"cs.game_ad_banner_load.local",LOAD_RESP:"sc.game_ad_banner_load.local",SHOW_REQ:"cs.game_ad_banner_show.local",HIDE_REQ:"cs.game_ad_banner_hide.local",RESIZE_REQ:"cs.game_ad_banner_resize.local",RESIZE_RESP:"sc.game_ad_banner_resize.local",CLOSE_REQ:"cs.game_ad_banner_close.local"},e.hasShow=!1,e.hasHide=!1,e.param=t,e.bannerId=r._bannerId(),e.param.viewId||(e.param.viewId=1001),e.eventCallBack={load:void 0,error:void 0},e.useNative=!1,e.param.viewId&&1003==e.param.viewId&&(e.useNative=!0),e.needAutoShow=!1,e.isLoadSucc=!1,e.fetch(function(t,e){if(BK.isBrowser&&"android"===GameStatusInfo.platform&&e.errCode&&(t=e.errCode),0==t)this.isLoadSucc=!0,this.emit("load"),1==this.needAutoShow&&this.show();else{var i="unknown error",r=t;e.errCode&&(r=e.errCode),r<n.length&&(i=n[r]);var o={msg:i,code:r};this.emit("error",o)}}.bind(e)),e}return s(r,i),r._bannerId=function(){return this.incBannerId||(this.incBannerId=0),this.incBannerId++,this.incBannerId},r.prototype.log=function(t){BK.Script.log(1,1,"BannerAd:"+t)},r.prototype.show=function(){this.hasShow?this.log("show error.can't show twice!"):1!=this.hasHide?1==this.isLoadSucc?(this.hasShow=!0,this.hasHide=!1,this.useNative?this._ssoShow():this._innerGameBanner?1001==this.param.viewId?this._innerGameBanner.show(function(t,e,i){BK.Script.log(1,1,"show static inner banner succCode"+t+" msg:"+e)}):1002==this.param.viewId&&this._innerGameBanner.showAnimate(function(t,e,i){BK.Script.log(1,1,"show animate banner succCode"+t+" msg:"+e)}):BK.Script.log(1,1,"show inner banner failed. handle is undefined")):this.needAutoShow=!0:this._setHidden(!1)},r.prototype.hide=function(){1!=this.hasHide?this._setHidden(!0):this.log("hide error.can't hide twice!")},r.prototype._setHidden=function(t){1==t?this.useNative?this._ssoHide():this._innerGameBanner?this._innerGameBanner.setHidden(!0):BK.Script.log(1,1,"hide inner banner failed. handle is undefined"):this.useNative?this._ssoShow():this._innerGameBanner?this._innerGameBanner.setHidden(!1):BK.Script.log(1,1,"hide inner banner failed. handle is undefined"),this.hasShow=!t,this.hasHide=t},r.prototype.destory=function(){this.useNative?this._ssoClose():this._innerGameBanner?this._innerGameBanner.close():BK.Script.log(1,1,"close inner banner failed. handle is undefined")},r.prototype.onError=function(t){this.on("error",t)},r.prototype.offError=function(t){this.off("error",t)},r.prototype.onLoad=function(t){this.on("load",t)},r.prototype.offLoad=function(t){this.off("load",t)},r.prototype.fetch=function(r){this.useNative?this._ssoLoad(r):BK.isBrowser?r(8,n[8]):BK.Advertisement.fetchBannerAd(function(t,e,i){0==t?this._innerGameBanner=i:BK.Script.log(1,1,"fetchBannerAd failed. retCode:"+t+"msg:"+e),r(t,e)}.bind(this))},r.prototype._sendSso=function(r){BK.MQQ.SsoRequest.send(r.reqData,r.reqCmd),r.respCmd&&BK.MQQ.SsoRequest.addListener(r.respCmd,this,function(t,e,i){void 0!==i&&void 0!==i.bannerId&&r.callback&&this.bannerId==i.bannerId&&r.callback(t,i)}.bind(this))},r.prototype._ssoLoad=function(t){var e=1001;this.param.viewId&&(e=this.param.viewId),this._sendSso({reqCmd:this.ssoCMD.LOAD_REQ,reqData:{bannerId:this.bannerId,viewId:e},respCmd:this.ssoCMD.LOAD_RESP,callback:t})},r.prototype._ssoShow=function(){this._sendSso({reqCmd:this.ssoCMD.SHOW_REQ,reqData:{bannerId:this.bannerId,style:this.param.style}})},r.prototype._ssoClose=function(){this._sendSso({reqCmd:this.ssoCMD.CLOSE_REQ,reqData:{bannerId:this.bannerId}})},r.prototype._ssoHide=function(){this._sendSso({reqCmd:this.ssoCMD.HIDE_REQ,reqData:{bannerId:this.bannerId}})},r}(a);t.BannerAd=e,t.createBannerAd=function(t){return new e(t)};var i=function(e){function t(){var t=e.call(this)||this;return t.autoShow=!1,BK.Advertisement.fetchVideoAd(1,function(t,e,i){0==t?(this.emit("load"),i.setEventCallack(function(t,e){this.emit("close_game")}.bind(this),function(t,e){this.emit("play_finish")}.bind(this),function(t,e){0==t?this.emit("video_close"):this.emit("error",{msg:"close error",code:-1})}.bind(this),function(t,e){0==t&&this.emit("play_start")}.bind(this)),this.handle=i,1==this.autoShow&&this.handle.jump()):this.emit("error",{msg:e,code:t})}.bind(t)),t}return s(t,e),t.prototype.show=function(){this.handle?this.handle.jump():this.autoShow=!0},t.prototype.onPlayStart=function(t){this.on("play_start",t)},t.prototype.offPlayStart=function(t){this.off("play_start",t)},t.prototype.onPlayFinish=function(t){this.on("play_finish",t)},t.prototype.offPlayFinish=function(t){this.off("play_finish",t)},t.prototype.onLoad=function(t){this.on("load",t)},t.prototype.offLoad=function(t){this.off("load",t)},t.prototype.onError=function(t){this.on("error",t)},t.prototype.offError=function(t){this.off("error",t)},t.prototype.onClose=function(t){this.on("video_close",t)},t.prototype.offClose=function(t){this.off("video_close",t)},t}(a);t.createVideoAd=function(){return new i}}(o||(o={})),t.exports={createBannerAd:o.createBannerAd,createVideoAd:o.createVideoAd}},"./src/mqq/share/screenshot.ts":function(t,e,i){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0}),function(t){var d;function f(t){(void 0===t.x||t.x<0||t.x>BK.Director.screenPixelSize.width)&&(t.x=0),(void 0===t.y||t.y<0||t.y>BK.Director.screenPixelSize.height)&&(t.y=0),(void 0===t.width||t.width<=0||t.width>BK.Director.screenPixelSize.width-t.x)&&(t.x=0,t.width=BK.Director.screenPixelSize.width),(void 0===t.height||t.height<=0||t.height>BK.Director.screenPixelSize.height-t.y)&&(t.y=0,t.height=BK.Director.screenPixelSize.height)}function e(e){try{f(e.range);var t=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);BK.Render.renderToTexture(BK.Director.root,t),t.writeToDiskWithXY(e.path,e.range.x,e.range.y,e.range.width,e.range.height),_(e)}catch(t){e.fail&&e.fail({code:-1,msg:JSON.stringify(t)}),e.complete&&e.complete()}}function i(e){try{f(e.range),(d=new BK.WebGL).DEPTH_BUFFER_BIT=256,d.STENCIL_BUFFER_BIT=1024,d.COLOR_BUFFER_BIT=16384,d.TRIANGLES=4,d.TEXTURE_BINDING_2D=32873,d.ARRAY_BUFFER=34962,d.ARRAY_BUFFER_BINDING=34964,d.ELEMENT_ARRAY_BUFFER=34963,d.ELEMENT_ARRAY_BUFFER_BINDING=34965,d.STATIC_DRAW=35044,d.UNSIGNED_BYTE=5121,d.UNSIGNED_SHORT=5123,d.FLOAT=5126,d.RGBA=6408,d.FRAGMENT_SHADER=35632,d.VERTEX_SHADER=35633,d.LINK_STATUS=35714,d.CURRENT_PROGRAM=35725,d.NEAREST=9728,d.LINEAR=9729,d.TEXTURE_MAG_FILTER=10240,d.TEXTURE_MIN_FILTER=10241,d.TEXTURE_WRAP_S=10242,d.TEXTURE_WRAP_T=10243,d.TEXTURE_2D=3553,d.TEXTURE0=33984,d.TEXTURE1=33985,d.ACTIVE_TEXTURE=34016,d.REPEAT=10497,d.CLAMP_TO_EDGE=33071,d.MIRRORED_REPEAT=33648,d.FRAMEBUFFER=36160,d.RENDERBUFFER=36161,d.COLOR_ATTACHMENT0=36064,d.DEPTH_ATTACHMENT=36096,d.STENCIL_ATTACHMENT=36128,d.NONE=0,d.FRAMEBUFFER_COMPLETE=36053,d.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,d.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,d.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,d.FRAMEBUFFER_UNSUPPORTED=36061,d.FRAMEBUFFER_BINDING=36006,d.RENDERBUFFER_BINDING=36007,d.INVALID_FRAMEBUFFER_OPERATION=1286;var t=new BK.Buffer(e.range.height*e.range.width*4);d.glReadPixels(e.range.x,e.range.y,e.range.width,e.range.height,d.RGBA,d.UNSIGNED_BYTE,t),s=t,h=(a=e).path,c=a.range,u=h.substr(0,h.lastIndexOf(".")),l=h.substr(h.lastIndexOf(".")+1),BK.Image.saveImage(s,c.width,c.height,u,l),r=(i=e).path,o=i.range,(n=new BK.Canvas(o.width,o.height)).scales(1,-1),n.drawImage(r,0,0,o.width,o.height,0,-o.height,o.width,o.height),n.saveTo(r),n.dispose(),_(e)}catch(t){e.fail&&e.fail({code:-1,msg:JSON.stringify(t)}),e.complete&&e.complete()}var i,r,o,n,s,a,h,c,u,l}function _(r){BK.FileUtil.isFileExist(r.path)?r.isUpload?BK.Upload.upload({path:r.path,success:function(t){var e=t.code,i=t.url;r.success&&r.success({code:e,path:i}),r.complete&&r.complete()},fail:function(t){var e=t.code,i=t.msg;r.fail&&r.fail({code:e,msg:i}),r.complete&&r.complete()}}):(r.success&&r.success({code:0,path:r.path}),r.complete&&r.complete()):(r.fail&&r.fail({code:-1,msg:"fail to shot, no such file or directory "+r.path}),r.complete&&r.complete())}t.shot=function(t){BK.isBrowser?i(t):e(t)},t.shotBK=e,t.shotGL=i}(r=e.Screenshot||(e.Screenshot={})),t.exports=r},"./src/mqq/share/share.ts":function(t,e,i){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0}),function(t){function e(e){try{var t="cs.share_game_result.local",i={cmd:t,from:GameStatusInfo.platform,roomId:GameStatusInfo.roomId,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,gameVersion:GameStatusInfo.gameVersion,title:e.title?e.title:"\u8f7b\u6e38\u620f",summary:e.summary?e.summary:"\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~",picUrl:e.qqImgUrl?e.qqImgUrl:s({title:e.title?e.title:"\u8f7b\u6e38\u620f",subTitle:e.summary?e.summary:"\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~"}),detailUrl:e.msgUrl?e.msgUrl:""};BK.SsoRequest.request({reqCmd:t,data:i})}catch(t){e.fail&&e.fail({code:-1,msg:JSON.stringify(t)}),e.complete&&e.complete()}}function i(e){try{e.range?BK.Screenshot.shot({path:"GameSandBox://screenshot.png",range:e.range,isUpload:!0,success:function(t){BK.Share.share({qqImgUrl:t.path,socialPicPath:"GameSandBox://screenshot.png",title:e.title?e.title:"\u8f7b\u6e38\u620f",summary:e.summary?e.summary:"\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~",extendInfo:e.extendInfo?e.extendInfo:"",success:function(t){e.success&&e.success(t),e.complete&&e.complete()},fail:function(t){e.fail&&e.fail(t),e.complete&&e.complete()}})},fail:function(t){e.fail&&e.fail(t),e.complete&&e.complete()}}):(e.fail&&e.fail({code:-1,msg:"fail to shot, need range"}),e.complete&&e.complete())}catch(t){e.fail&&e.fail({code:-1,msg:JSON.stringify(t)}),e.complete&&e.complete()}}function r(e){try{var t="cs.share_game_in_ark.local",i=e.success?"sc.share_game_to_friend_result.local":t;BK.isBrowser&&"android"===GameStatusInfo.platform&&0===GameStatusInfo.QQVer.indexOf("7.6.0")&&(t="cs.game_shell_share_callback.local"),o({cmd:t,gameId:GameStatusInfo.gameId,roomId:GameStatusInfo.roomId,gameMode:GameStatusInfo.gameMode,isSelectFriend:e.isToFriend?1:0,summary:e.summary?e.summary:"\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~",extendInfo:e.extendInfo?e.extendInfo:"",picUrl:e.qqImgUrl},t,i,e)}catch(t){e.fail&&e.fail({code:-1,msg:JSON.stringify(t)}),e.complete&&e.complete()}}function o(t,e,i,r){BK.SsoRequest.request({data:t,reqCmd:e,respCmd:i,success:function(t){var e=t.code,i=(t.cmd,t.data);r.success&&(n(0===e?0:1),r.success({code:e,data:i}))},fail:function(t){var e=t.code,i=(t.cmd,t.data);r.fail&&(n(0===e?0:1),r.fail({code:e,msg:i}))},complete:function(){r.complete&&r.complete()}})}function n(t){var e=t.toString();BK.QQ.uploadData("clickShowOffButton","",e,"","","")}function s(t){if(BK.FileUtil.isFileExist("GameSandBox://compose.png"))return"GameSandBox://compose.png";var e=BK.Image.loadImage("GameRes://inviteIcon.png");if(e){var i=e.height,r=e.width;if(Math.abs(i/r-304/540)<.01)return function(t){var e=t.title,i=t.subTitle,r=new BK.Canvas(750,750),o="bottom";if(r.fillColor={r:1,g:1,b:1,a:1},r.fillRect(0,0,750,750),BK.FileUtil.isFileExist("GameRes://share_logo.png")){r.drawImage("GameRes://share_logo.png",0,0,125,28,32,32,126,27)}if(BK.FileUtil.isFileExist("GameRes://inviteIcon.png")){var n=BK.Image.loadImage("GameRes://inviteIcon.png");n&&r.drawImage("GameRes://inviteIcon.png",0,0,n.width,n.height,0,330,750,420)}r.fillColor={r:0,g:0,b:0,a:1},r.drawStyle=0,r.setTextAlign(1),r.setTextSize(40),r.textBaseLine=o,r.textAlign="left",r.fillText(e,35,258);r.fillColor={r:137/255,g:137/255,b:137/255,a:.5},r.drawStyle=0,r.setTextAlign(1),r.setTextSize(30),r.textBaseLine=o,r.textAlign="left",r.fillText(i,35,215);r.fillColor={r:1,g:1,b:1,a:1};var s="http://cmshow.qq.com/apollo/html/game-platform/scan-game.html?gameId="+GameStatusInfo.gameId.toString()+"&src=203";BK.QRCode.makeQRCodeToFileSync({path:"GameSandBox://qrcode.png",content:s,config:{width:256,height:256,colorDark:{r:0,g:0,b:0,a:1},colorLight:{r:1,g:1,b:1,a:1},correctLevel:2}}),r.drawImage("GameSandBox://qrcode.png",0,0,256,256,600,64,120,120);return r.fillColor={r:0,g:0,b:0,a:1},r.drawStyle=0,r.setTextAlign(1),r.setTextSize(19),r.textBaseLine=o,r.textAlign="left",r.fillText("\u957f\u6309\u626b\u7801\u5373\u73a9",600,28),r.saveTo("GameSandBox://compose.png"),r.dispose(),"GameSandBox://compose.png"}(t)}return""}t.shareLink=e,t.shareShot=i,t.share=function(t){t.msgUrl?e(t):t.range&&!BK.isBrowser?i(t):void 0!==t.isToFriend?r(t):BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.6.3")?r(t):function(e){try{var t="cs.game_shell_share_callback.local",i=e.success&&e.fail?"sc.share_game_to_friend_result.local":t,r={gameName:e.title?e.title:"\u8f7b\u6e38\u620f",summary:e.summary?e.summary:"\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~",extendInfo:e.extendInfo?e.extendInfo:"",localPicPath:e.socialPicPath?e.socialPicPath:s({title:e.title?e.title:"\u8f7b\u6e38\u620f",subTitle:e.summary?e.summary:"\u4e00\u8d77\u6765\u73a9\u6e38\u620f\u5427~"}),picUrl:e.qqImgUrl,activityId:0,reqCode:1,inner:1};o(r,t,i,e)}catch(t){e.fail&&e.fail({code:-1,msg:JSON.stringify(t)}),e.complete&&e.complete()}}(t)}}(r=e.Share||(e.Share={})),t.exports=r},"./src/mqq/share/upload.ts":function(t,e,i){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0}),(r=e.Upload||(e.Upload={})).upload=function(s){try{!function(t,r){if(BK.isBrowser){var e="cs.get_file_data.local",i={cmd:e,path:t};r&&BK.SsoRequest.request({data:i,reqCmd:e,respCmd:e,success:function(t){t.code,t.cmd;var e=t.data,i=function(t){var e,i,r,o,n,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=.75*t.length,h=t.length,c=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u=new ArrayBuffer(a),l=new Uint8Array(u);for(e=0;e<h;e+=4)i=s.indexOf(t[e]),r=s.indexOf(t[e+1]),o=s.indexOf(t[e+2]),n=s.indexOf(t[e+3]),l[c++]=i<<2|r>>4,l[c++]=(15&r)<<4|o>>2,l[c++]=(3&o)<<6|63&n;return l}(e);r(0,i)},fail:function(t){t.code,t.cmd,t.data,r(-1)},complete:function(){}})}else{var o=BK.FileUtil.readFile(t);r(0,o)}}(s.path,function(t,i){var r,e,o,n;i&&0<i.length?(r=function(t,e){0===t&&e?function(t,e,o){for(var i=1024<t.length?1024:t.length,r=new Uint8Array(i),n=0;n<i/2;n++)r[n]=t.readUint8Buffer();t.jumpBytes(t.length-i);for(var n=i/2;n<i;n++)r[n]=t.readUint8Buffer();t.rewind();var s=new Date,a=s.getFullYear().toString()+(s.getMonth()+1<10?"0"+(s.getMonth()+1):""+s.getMonth()+1)+(s.getDate()<10?"0"+s.getDate():""+s.getDate())+(s.getHours()<10?"0"+s.getHours():""+s.getHours())+(s.getMinutes()<10?"0"+s.getMinutes():""+s.getMinutes()),h=e.signTime,c=e.tmpSecretId,u=e.sessionToken,l="/"+GameStatusInfo.gameId+"_"+BK.Crypt.md5ToHexSync({data:function(t){for(var e=[],i=0;i<t.byteLength;i++)e[i]=t[i];return e}(r)})+"_"+a+".png",d=e.upLoadPrefUrl.replace(new RegExp("http://","gm"),""),f=e.downloadUrl,_=e.signature,p="put\n"+l+"\n\nhost="+d+"&x-cos-storage-class=nearline\n",m="sha1\n"+h+"\n"+BK.Crypt.sha1ToHexSync({data:p})+"\n",g=BK.Crypt.hmacSha1ToHexSync({key:_,data:m}),v="q-sign-algorithm=sha1&q-ak="+c+"&q-sign-time="+h+"&q-key-time="+h+"&q-header-list=host;x-cos-storage-class&q-url-param-list=&q-signature="+g,S=new BK.HttpUtil("https://"+d+l,"put");S.setHttpHeader("host",d),S.setHttpHeader("x-cos-storage-class","nearline"),S.setHttpHeader("x-cos-security-token",u),S.setHttpHeader("authorization",v),S.setHttpRawBody(t),S.requestAsync(function(t,e){var i,r;i=f+l,r=o,200===e?r.success&&r.success({code:0,url:i}):r.fail&&r.fail({code:-1,msg:"fail to upload"}),r.complete&&r.complete()})}(i,e,s):(s.fail&&s.fail({code:-1,msg:"fail to fetch signature"}),s.complete&&s.complete())},e=(new Date).getTime()/1e3-1,n={cmd:o="cs.fetch_cloud_signature.local",now:e,delta:600},r&&BK.SsoRequest.request({data:n,reqCmd:o,respCmd:o,success:function(t){var e=t.code,i=(t.cmd,t.data);r(e,i)},fail:function(t){var e=t.code,i=(t.cmd,t.data);r(e,i)},complete:function(){}})):(s.fail&&s.fail({code:-1,msg:"fail to get file data  "+s.path}),s.complete&&s.complete())})}catch(t){s.fail&&s.fail({code:-1,msg:JSON.stringify(t)}),s.complete&&s.complete()}},t.exports=r},"./src/mqq/sso/sso.ts":function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.seqId=1,t.setCallback(),t}return o(t,e),t.prototype.request=function(t){var e=this;t.respCmd=t.respCmd?t.respCmd:t.reqCmd,null!=t.isListener&&null!=t.isListener||(t.isListener=!0);var i=t.reqCmd,r=t.respCmd,o=t.data,n=t.isListener,s=t.success,a=t.fail,h=t.complete;if(!i&&!r)throw new Error("Sso request cmd is required");if(n){var c=this.getEvent(r,o),u=function(t){0==t.code?s&&s({code:t.code,cmd:t.cmd,data:t.data}):a&&a({code:t.code,cmd:t.cmd,data:t.data}),h&&h()};return this.once(c,u),this.send(i,o),{abort:function(){e.off(c,u)}}}return this.send(i,o),null},t.prototype.send=function(t,e){BK.isBrowser?__browserMsg.send(JSON.stringify(e),t):BK.MQQ.SsoRequest.send(e,t)},t.prototype.getEvent=function(t,e){return e&&0==t.indexOf("apollo")?(e.seqId=this.seqId++,JSON.stringify({cmd:t,seqId:e.seqId})):t},t.prototype.setCallback=function(){var r=this,o=BK.MQQ.SsoRequest.callback;BK.MQQ.SsoRequest.callback=function(t,e,i){r.dispatchEvent(t,e,i),o(t,e,i)};var n=x;x=function(t,e,i){r.dispatchEvent(t,e,i),n(t,e,i)}},t.prototype.dispatchEvent=function(t,e,i){i?"number"==typeof i.seqId?this.emit(JSON.stringify({cmd:e,seqId:i.seqId}),{code:t,cmd:e,data:i}):this.emit(e,{code:t,cmd:e,data:i}):this.emit(e,{code:t,cmd:e,null:null})},t}(i("./src/common/emitter.ts"));e.SsoRequest=n,t.exports=new n},"./src/net/http.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=i("./src/deprecate/http-util.ts"),f=i("./src/util/buffer.ts"),_=function(){function t(t,e,i){this.statusCode=t,this.headers=e,this._body=i}return t.prototype.text=function(){var t=this._body.readAsString(!0);return void 0===t?"":t},t.prototype.jsonObject=function(){var t=this._body.readAsString(!0);return t?JSON.parse(t):null},t.prototype.arrayBuffer=function(){return f.BKBufferToArrayBuffer(this._body)},t}();e.request=function(t){var e=t.url,i=t.method,r=t.headers,o=t.body,n=t.success,s=t.fail,a=t.complete,h=t.uploadProgress,c=t.downloadProgress;if(!e)throw new Error("HTTP request url is required");var u=new d(e,i);if(o&&u.setHttpRawBody("string"==typeof o?o:f.arrayBufferToBKBuffer(o)),r)for(var l in r)u.setHttpHeader(l,r[l]);u.setHttpUploadProgressListener(h),u.setHttpDownloadProgressListener(c),n||s||a||BK.Script.log(0,1,"[WARNING] send HTTP request without any callback"),u.sendRequest(function(t,e,i){t<0?s&&s({msg:i.readAsString(!0)}):n&&n(new _(t,e,i)),a&&a()})}},"./src/net/transparent-webview.ts":function(t,e,i){"use strict";var r=function(){function t(t){this.taskId=-1,this.opt=t}return t.prototype._requestOpen=function(t){if(!t||!t.url)throw Error("Url is null or undefined!");var e=1;t.transparent,e=t.transparent&&1==t.transparent?1:0;var i=1;t.orientation&&(i=t.orientation);var r={gameOrientation:i,openId:GameStatusInfo.openId,transparent:e,businessType:2,url:t.url};BK.SsoRequest.request({data:r,reqCmd:"cs.openWebViewWithoutUrl.local",success:function(t){BK.Console.log("requestOpen! success ",t.code,t.cmd,JSON.stringify(t.data)),this.taskId=t.data.taskId}.bind(this),fail:function(t){var e=t.code,i=t.cmd,r=t.data;BK.Console.log("requestOpen! fail",e,i,JSON.stringify(r))},complete:function(){BK.Console.log("requestOpen! complete")}})},t.prototype._prepareReceive=function(){var t=void 0;t="ios"==GameStatusInfo.platform?"sc.catchPeopleWebMessage.local":"sc.apolloGameWebMessage.local",BK.SsoRequest.on(t,function(t){this.receiveCallback&&this.receiveCallback(t.code,t.data)}.bind(this))},t.prototype.onReceiveMsg=function(t){this.receiveCallback=t},t.prototype.send=function(t){t.taskId=this.taskId;BK.SsoRequest.request({data:t,reqCmd:"cs.apolloGameTargetWebMessage.local",success:function(t){BK.Console.log("send! success ",t.code,t.cmd,JSON.stringify(t.data))}.bind(this),fail:function(t){var e=t.code,i=t.cmd,r=t.data;BK.Console.log("send! fail",e,i,JSON.stringify(r))},complete:function(){BK.Console.log("send! complete")}})},t.prototype.open=function(){this._requestOpen(this.opt),this._prepareReceive()},t.prototype.close=function(){var t={taskId:this.taskId};BK.SsoRequest.request({data:t,reqCmd:"cs.closeWebViewWithoutUrl.local",success:function(t){BK.Console.log("close! success ",t.code,t.cmd,JSON.stringify(t.data))}.bind(this),fail:function(t){var e=t.code,i=t.cmd,r=t.data;BK.Console.log("close! fail",e,i,JSON.stringify(r))},complete:function(){BK.Console.log("send! complete")}})},t}();t.exports=function(t){return new r(t)}},"./src/render/animationSprite.ts":function(t,e,i){"use strict";var r=function(){function t(t){this.paused=!1,this.delayUnits=1/30,this.tmpPlayingIdx=0,this.previousTs=-1,this.playedCount=0,this.currDisplayIdx=0,this.currTexturePath="",this.currDisplaySum=0,this.repeatCount=0,this.stoped=!1,this.size={width:0,height:0},this.readyTextureInfo(t),this.onInit(this.size.width,this.size.height),this.displayFrame(0),this.paused=!0,BK.Director.ticker.add(function(t,e,i){i.update(t,e)},this)}return t.prototype.readyTextureInfo=function(t){var e=this;this.textureInfoArr=[],t.forEach(function(t){t.texturePath&&(t.texture=new BK.Texture(t.texturePath),e.textureInfoArr.push(t),e.size={width:t.frameInfo.sourceSize.w,height:t.frameInfo.sourceSize.h})})},t.prototype.onInit=function(t,e){this.createSprites(t,e);var i=Object.getOwnPropertyNames(this.__nativeObj),r=this;i.forEach(function(t){var e=t;Object.defineProperty(r,e,{get:function(){return this.__nativeObj[e]},set:function(t){this.__nativeObj[e]=t}})},this),Object.defineProperty(this,"size",{get:function(){return this.__nativeObj.contentSize},set:function(t){this.__nativeObj.contentSize=t,this.displayFrame(this.currDisplayIdx)}}),Object.defineProperty(this,"anchor",{get:function(){return this.__nativeObj.localAnchor},set:function(t){this.__nativeObj.localAnchor=t,this.displayFrame(this.currDisplayIdx)}})},t.prototype.setTexture=function(t){this.__nativeObj.setTexture(t)},t.prototype.dispose=function(){BK.Director.ticker.remove(this),this.__nativeObj.dispose()},t.prototype.removeChild=function(t){return this.__nativeObj.removeChild(t)},t.prototype.removeChildById=function(t,e){return this.__nativeObj.removeChildById(t,e)},t.prototype.removeChildByName=function(t,e){return this.__nativeObj.removeChildByName(t,e)},t.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},t.prototype.addChild=function(t,e){return this.__nativeObj.addChild(t,e)},t.prototype.hittest=function(t){return this.__nativeObj.hittest(t)},t.prototype.convertToWorldSpace=function(t){return this.__nativeObj.convertToWorldSpace(t)},t.prototype.convertToNodeSpace=function(t){return this.__nativeObj.convertToNodeSpace(t)},t.prototype.createSprites=function(t,e){this.__nativeObj=new BK.SpriteNode(t,e,{},0,1,1,1),this.contentSprite=new BK.SpriteNode(t,e,{},0,1,1,1),this.__nativeObj.addChild(this.contentSprite)},t.prototype.displayFrame=function(t){if(0<this.textureInfoArr.length){var e=this.textureInfoArr[t];if(e){this.currDisplayIdx=t;var i=e.texture,r=e.frameInfo;if(1==e.frameInfo.trimmed){var o=e.frameInfo.spriteSourceSize.x,n=e.frameInfo.spriteSourceSize.y,s=e.frameInfo.spriteSourceSize.w,a=e.frameInfo.spriteSourceSize.h,h=e.frameInfo.sourceSize,c=this.__nativeObj.contentSize;o=c.width*o/h.w,n=c.height*n/h.h,s=c.width*s/h.w,a=c.height*a/h.h,this.contentSprite.position={x:o,y:n},this.contentSprite.contentSize={width:s,height:a}}else this.contentSprite.contentSize=this.__nativeObj.contentSize;this.currTexturePath&&this.currTexturePath==e.texturePath||(BK.Script.log(1,-1,"this.currTexture != tex"),this.currTexturePath=e.texturePath,this.contentSprite.setTexture(i)),this.contentSprite.adjustTexturePosition(r.frame.x,r.frame.y,r.frame.w,r.frame.h,r.rotated)}else BK.Script.log(1,-1,"displayFrame failed! textureInfo is null. index is "+t)}else BK.Script.log(1,-1,"displayFrame failed! textureInfoArr.length is 0")},t.prototype.render=function(){this.tmpPlayingIdx>this.textureInfoArr.length-1&&(this.tmpPlayingIdx=0),this.displayFrame(this.tmpPlayingIdx),this.tmpPlayingIdx++,this.currDisplaySum++,this.updateCallback()},t.prototype.update=function(t,e){0==this.paused&&(this.previousTs<0?(this.previousTs=t,this.render()):t-this.previousTs>1e3*this.delayUnits&&(this.previousTs=t,this.render()))},t.prototype.doPlay=function(t,e){void 0===t&&(t=0),void 0===e&&(e=-1),t>this.textureInfoArr.length-1?this.tmpPlayingIdx=0:this.tmpPlayingIdx=t,this.paused=!1,this.repeatCount=e,this.currDisplaySum=0,this.playedCount=0},t.prototype.doStop=function(t){this.stoped=!0,void 0===t&&(t=-1),this.paused=!0,-1<t&&this.displayFrame(t)},t.prototype.updateCallback=function(){var t=this.textureInfoArr.length;this.currDisplaySum%t==0&&(this.playedCount=parseInt(String(this.currDisplaySum/t)),this.completeCallback&&this.completeCallback(this,this.playedCount),0<this.repeatCount&&this.repeatCount<=this.playedCount&&(this.endCallback&&this.endCallback(this,this.playedCount),this.stop()))},t.prototype.setCompleteCallback=function(i){this.completeCallback=function(t,e){i({animationSprite:t,count:e})}},t.prototype.setEndCallback=function(i){this.endCallback=function(t,e){i({animationSprite:t,count:e})}},t.prototype.play=function(t){t?this.doPlay(t.beginFrameIndex,t.repeatCount):this.doPlay()},t.prototype.stop=function(t){this.doStop(t)},t.prototype.setPosition=function(t){if(!t)throw new Error("position can not be undefined!");if("number"!=typeof t.x)throw new Error("position.x must be a number!");if("number"!=typeof t.y)throw new Error("position.y must be a number!");this.position=t},t.prototype.setSize=function(t){if(!t)throw new Error("size can not be undefined!");if("number"!=typeof t.width)throw new Error("size.width must be a number!");if("number"!=typeof t.height)throw new Error("size.height must be a number!");this.size=t},t.prototype.setAnchor=function(t){if(!t)throw new Error("anchor can not be undefined!");if("number"!=typeof t.x)throw new Error("anchor.x must be a number!");if("number"!=typeof t.y)throw new Error("anchor.y must be a number!");this.anchor=t},t.prototype.setFrameDuration=function(t){if("number"!=typeof t)throw new Error("duration must be a number!");this.delayUnits=t},t.prototype.pause=function(){this.paused=!0},t.prototype.resume=function(){this.stoped?BK.Script.log(1,1,"animationSprite is stopped,can't continue!"):this.paused=!1},t}();t.exports=r},"./src/render/image.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/util/buffer.ts");BK.ImageNativeClass=BK.Image;var r=function(){function t(){}return t.dispose=function(t){return BK.ImageNativeClass.dispose(t)},t.saveImage=function(t,e,i,r,o,n){return t instanceof ArrayBuffer?t=s.arrayBufferToBKBuffer(t):t instanceof Object&&void 0===e&&(e=t.width,i=t.height,r=t.path,o=t.ext,n=t.isFlipY?t.isFlipY:0),BK.ImageNativeClass.saveImage(t,e,i,r,o,n)},t.loadImageWithBase64=function(t){if(!t)return BK.Script.log(1,0,"buffer is empty"),null;if(t.buffer&&(t=t.buffer),t instanceof ArrayBuffer&&(t=s.arrayBufferToBKBuffer(t)),t.readAsString&&(t=t.readAsString()),t){var e=t.indexOf("data:image"),i=t.indexOf("base64,");0==e&&0<i&&(t=t.substring(i+"base64,".length,t.length-1)),BK.Script.log(1,1,"loadImageWithBase64 "+t);var r=BK.Misc.decodeBase64FromString(t);return BK.ImageNativeClass.loadImage(r)}return null},t.loadImage=function(t,e){if(t)return t.image&&(e=t.format?t.format:void 0),t instanceof ArrayBuffer&&(t=s.arrayBufferToBKBuffer(t)),e?BK.ImageNativeClass.loadImage(t,e):BK.ImageNativeClass.loadImage(t);BK.Script.log(1,1,"BK.Image.loadImage failed! ")},t.loadImages=function(e){if(!e)return BK.Script.log(1,1,"object.file is null"),e.fail&&e.fail({errmsg:"object.file is null"}),void(e.complete&&e.complete());if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0"))if(e&&e.file){for(var t=new Array,i=0;i<e.file.length;i++)e.file[i].path&&t.push({tag:3,path:e.file[i].path,format:e.file[i].format?e.file[i].format:6});var r=BK.ImageNativeClass.loadImageAsync(t);BK.taskManager.pushTask(r,t,function(t){e.success&&e.success(t),e.complete&&e.complete()})}else e.fail&&e.fail({errmsg:"object.file is null"}),e.complete&&e.complete();else{var o=[];if(e&&e.file)for(i=0;i<e.file.length;i++){var n=e.file[i];if(n.path){var s=BK.ImageNativeClass.loadImage(n.path,e.file[i].format?e.file[i].format:6);o.push({errcode:s?0:-1,errmsg:s?"":"load image failed!",path:n.path,image:s})}}e.success&&e.success(o),e.complete&&e.complete()}},t}();t.exports=r},"./src/render/spriteNine.ts":function(t,e,i){"use strict";var r=function(){function t(t){if(!t)throw Error("initParam can not be undefined!");if(!t.texture)throw Error("initParam.texture can not be undefined!");var e=t.textureWidth,i=t.textureHeight,r=t.texture,o=t.grid,n=t.offset,s=t.rotated;this._size={width:0,height:0},this.__nativeObj=new BK.Node,this.onInit(),i||(i=r.size.height),e||(e=r.size.width),o?this._grid=o:(this._grid={left:0,top:0,right:0,bottom:0},o=this._grid),n||(n={x:0,y:0}),this._size={width:i,height:i},this._leftTop=new BK.Sprite(o.left,o.top,r,0,1,1,1),this._leftTop.position={x:0,y:i-o.top},this._leftTop.zOrder=99999,this._leftTop.name="_leftTop",this.__nativeObj.addChild(this._leftTop),this._centerTop=new BK.Sprite(e-o.left-o.right,o.top,r,0,1,1,1),this._centerTop.position={x:o.left,y:i-o.top},this._centerTop.zOrder=99999,this._centerTop.name="_centerTop",this.__nativeObj.addChild(this._centerTop),this._rightTop=new BK.Sprite(o.right,o.top,r,0,1,1,1),this._rightTop.position={x:e-o.right,y:i-o.top},this._rightTop.zOrder=99999,this._rightTop.name="_rightTop",this.__nativeObj.addChild(this._rightTop),this._leftCenter=new BK.Sprite(o.left,i-o.top-o.bottom,r,0,1,1,1),this._leftCenter.position={x:0,y:o.bottom},this._leftCenter.name="_leftCenter",this.__nativeObj.addChild(this._leftCenter),this._centerCenter=new BK.Sprite(e-o.left-o.right,i-o.top-o.bottom,r,0,1,1,1),this._centerCenter.position={x:o.left,y:o.bottom},this._centerCenter.name="_centerCenter",this.__nativeObj.addChild(this._centerCenter),this._rightCenter=new BK.Sprite(o.right,i-o.bottom-o.top,r,0,1,1,1),this._rightCenter.position={x:e-o.right,y:o.bottom},this._rightCenter.name="_rightCenter",this.__nativeObj.addChild(this._rightCenter),this._leftBottom=new BK.Sprite(o.left,o.bottom,r,0,1,1,1),this._leftBottom.position={x:0,y:0},this._leftBottom.name="_leftBottom",this.__nativeObj.addChild(this._leftBottom),this._centerBottom=new BK.Sprite(e-o.left-o.right,o.bottom,r,0,1,1,1),this._centerBottom.position={x:o.left,y:0},this._centerBottom.name="_centerBottom",this.__nativeObj.addChild(this._centerBottom),this._rightBottom=new BK.Sprite(o.right,o.bottom,r,0,1,1,1),this._rightBottom.position={x:e-o.right,y:0},this._rightBottom.name="_rightBottom",this.__nativeObj.addChild(this._rightBottom),1==s?(this._leftTop.adjustTexturePosition(n.x+(i-o.top),n.y+(e-o.left),o.left,o.top,s),this._centerTop.adjustTexturePosition(n.x+(i-o.top),n.y+o.right,e-o.left-o.right,o.top,s),this._rightTop.adjustTexturePosition(n.x+(i-o.top),n.y,o.right,o.top,s),this._leftCenter.adjustTexturePosition(n.x+o.bottom,n.y+(e-o.left),o.left,i-o.top-o.bottom,s),this._centerCenter.adjustTexturePosition(n.x+o.bottom,n.y+o.right,e-o.left-o.right,i-o.top-o.bottom,s),this._rightCenter.adjustTexturePosition(n.x+o.bottom,n.y,o.right,i-o.bottom-o.top,s),this._leftBottom.adjustTexturePosition(n.x,n.y+(e-o.left),o.left,o.bottom,s),this._centerBottom.adjustTexturePosition(n.x,n.y+o.right,e-o.left-o.right,o.bottom,s),this._rightBottom.adjustTexturePosition(n.x,n.y,o.right,o.bottom,s)):(this._leftTop.adjustTexturePosition(0+n.x,i-o.top+n.y,o.left,o.top),this._centerTop.adjustTexturePosition(o.left+n.x,i-o.top+n.y,e-o.left-o.right,o.top),this._rightTop.adjustTexturePosition(e-o.right+n.x,i-o.top+n.y,o.right,o.top),this._leftCenter.adjustTexturePosition(0+n.x,o.bottom+n.y,o.left,i-o.top-o.bottom),this._centerCenter.adjustTexturePosition(o.left+n.x,o.bottom+n.y,e-o.left-o.right,i-o.top-o.bottom),this._rightCenter.adjustTexturePosition(e-o.right+n.x,o.bottom+n.y,o.right,i-o.bottom-o.top),this._leftBottom.adjustTexturePosition(0+n.x,0+n.y,o.left,o.bottom),this._centerBottom.adjustTexturePosition(o.left+n.x,0+n.y,e-o.left-o.right,o.bottom),this._rightBottom.adjustTexturePosition(e-o.right+n.x,0+n.y,o.right,o.bottom))}return t.prototype.onInit=function(){var t=Object.getOwnPropertyNames(this.__nativeObj),i=this;t.forEach(function(t){var e=t;"size"!=e&&Object.defineProperty(i,e,{get:function(){return this.__nativeObj[e]},set:function(t){this.__nativeObj[e]=t}})},this)},t.prototype.pos=function(t,e){this.__nativeObj.position={x:t,y:e}},t.prototype.dispose=function(){this.__nativeObj.dispose()},t.prototype.attachBody=function(t){this.__nativeObj.attachComponent(t)},t.prototype.addChild=function(t){this.__nativeObj.addChild(t)},t.prototype.removeChildById=function(t,e){return this.__nativeObj.removeChildById(t,e)},t.prototype.removeChildByName=function(t,e){return this.__nativeObj.removeChildByName(t,e)},t.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},t.prototype.hittest=function(t){return this.__nativeObj.hittest(t)},t.prototype.setSize=function(t){if(!t)throw Error("size can not be undefined!");if("number"!=typeof t.width)throw Error("size.width must be a number!");if("number"!=typeof t.height)throw Error("size.height must be a number!");this.size=t},t.prototype.setPosition=function(t){if(!t)throw Error("position can not be undefined!");if("number"!=typeof t.x)throw Error("position.x must be a number!");if("number"!=typeof t.y)throw Error("position.y must be a number!");this.position=t},t}();Object.defineProperty(r.prototype,"alpha",{get:function(){return this._rightBottom.vertexColor.a},set:function(t){this._leftTop.vertexColor={r:1,g:1,b:1,a:t},this._centerTop.vertexColor={r:1,g:1,b:1,a:t},this._rightTop.vertexColor={r:1,g:1,b:1,a:t},this._leftCenter.vertexColor={r:1,g:1,b:1,a:t},this._centerCenter.vertexColor={r:1,g:1,b:1,a:t},this._rightCenter.vertexColor={r:1,g:1,b:1,a:t},this._leftBottom.vertexColor={r:1,g:1,b:1,a:t},this._centerBottom.vertexColor={r:1,g:1,b:1,a:t},this._rightBottom.vertexColor={r:1,g:1,b:1,a:t}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"size",{get:function(){return this._size},set:function(t){var e=(this._size=t).width-this._grid.left-this._grid.right,i=t.height-this._grid.top-this._grid.bottom;this._leftTop.position={x:0,y:t.height-this._grid.top},this._leftCenter.size={width:this._grid.left,height:i},this._leftCenter.position={x:0,y:this._grid.bottom},this._rightCenter.size={width:this._grid.right,height:i},this._rightCenter.position={x:t.width-this._grid.right,y:this._grid.bottom},this._centerCenter.size={width:e,height:i},this._centerTop.size={width:e,height:this._grid.top},this._centerTop.position={x:this._grid.left,y:t.height-this._grid.top},this._centerBottom.size={width:e,height:this._grid.bottom},this._centerBottom.position={x:this._grid.left,y:0},this._rightCenter.size={width:this._grid.right,height:i},this._rightCenter.position={x:t.width-this._grid.right,y:this._grid.bottom},this._rightBottom.position={x:t.width-this._grid.right,y:0},this._rightTop.position={x:t.width-this._grid.right,y:t.height-this._grid.top}},enumerable:!0,configurable:!0}),t.exports=r},"./src/render/spriteSet.ts":function(t,e,i){"use strict";var r=function(){function t(t){if(this.flipU=0,this.flipV=1,this.stretchX=1,this.stretchY=1,this.size={width:0,height:0},this.currTexturePath="",!t)throw Error("initParam can not be undefined!");if(!t.textureInfo)throw Error("initParam.textureInfo can not be undefined!");t.flipU&&(this.flipU=t.flipU),t.flipV&&(this.flipV=t.flipV),t.stretchX&&(this.stretchX=t.stretchX),t.stretchY&&(this.stretchY=t.stretchY),t.width&&(this.size.width=t.width),t.height&&(this.size.height=t.height),this.textureInfo=t.textureInfo,this.onInit(this.size.width,this.size.height),this.adjustWithTextureInfo(t.textureInfo)}return t.prototype.onInit=function(t,e){this.createSprites({width:t,height:e});var i=this;Object.getOwnPropertyNames(this.__nativeObj).forEach(function(t){var e=t;Object.defineProperty(i,e,{get:function(){return this.__nativeObj[e]},set:function(t){this.__nativeObj[e]=t}})},this),Object.defineProperty(this,"size",{get:function(){return this.__nativeObj.contentSize},set:function(t){this.__nativeObj.contentSize=t,this.updateSize(this.textureInfo)}}),Object.defineProperty(this,"anchor",{get:function(){return this.__nativeObj.localAnchor},set:function(t){this.__nativeObj.localAnchor=t}})},t.prototype.updateSize=function(t){if(1==t.frameInfo.trimmed){var e=t.frameInfo.spriteSourceSize.x,i=t.frameInfo.spriteSourceSize.y,r=t.frameInfo.spriteSourceSize.w,o=t.frameInfo.spriteSourceSize.h,n=t.frameInfo.sourceSize,s=this.__nativeObj.contentSize;e=s.width*e/n.w,i=s.height*i/n.h,r=s.width*r/n.w,o=s.height*o/n.h,this.contentSprite.position={x:e,y:i},this.contentSprite.contentSize={width:r,height:o}}else this.contentSprite.contentSize=this.__nativeObj.contentSize},t.prototype.adjustWithTextureInfo=function(t){if(t){var e=(this.textureInfo=t).texture,i=t.frameInfo;this.updateSize(t),this.currTexturePath=t.texturePath,e=new BK.Texture(this.currTexturePath),this.contentSprite.setTexture(e),this.contentSprite.adjustTexturePosition(i.frame.x,i.frame.y,i.frame.w,i.frame.h,i.rotated)}},t.prototype.setTexture=function(t){this.__nativeObj.setTexture(t)},t.prototype.dispose=function(){BK.Director.ticker.remove(this),this.__nativeObj.dispose()},t.prototype.removeChild=function(t){return this.__nativeObj.removeChild(t)},t.prototype.removeChildById=function(t,e){return this.__nativeObj.removeChildById(t,e)},t.prototype.removeChildByName=function(t,e){return this.__nativeObj.removeChildByName(t,e)},t.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},t.prototype.addChild=function(t,e){return this.__nativeObj.addChild(t,e)},t.prototype.hittest=function(t){return this.__nativeObj.hittest(t)},t.prototype.convertToWorldSpace=function(t){return this.__nativeObj.convertToWorldSpace(t)},t.prototype.convertToNodeSpace=function(t){return this.__nativeObj.convertToNodeSpace(t)},t.prototype.createSprites=function(t){if(!t)throw Error("size can not be undefined!");if("number"!=typeof t.width)throw Error("size.width must be a number!");if("number"!=typeof t.height)throw Error("size.height must be a number!");this.__nativeObj=new BK.SpriteNode(t.width,t.height,{},this.flipU,this.flipV,this.stretchX,this.stretchY),this.contentSprite=new BK.SpriteNode(t.width,t.height,{},this.flipU,this.flipV,this.stretchX,this.stretchY),this.__nativeObj.addChild(this.contentSprite)},t}();t.exports=r},"./src/render/spriteSetCache.ts":function(t,e,i){"use strict";var r,o;(o=r||(r={}))[o.mirrorRepeat=0]="mirrorRepeat",o[o.repeatToEdge=1]="repeatToEdge",o[o.selfRepeat=2]="selfRepeat";var n=function(){function t(){this.fullWidth=0,this.fullHeight=0,this.sheets={},this.jsonConfigs={}}return t.prototype.getFrameInfoByFilename=function(t){for(var e in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(e)){var i=this.jsonConfigs[e],r=(this.sheets[e],i.frames),o=i.meta;this.fullWidth=o.size.w,this.fullHeight=o.size.h;for(var n=0;n<r.length;n++){var s=r[n];if(t==s.filename){var a={x:0,y:1,width:0,height:0},h=s.rotated,c=s.trimmed,u=s.spriteSourceSize,l=s.sourceSize;return a.height=(a.width=(a.y=h?(a.x=s.frame.x,this.fullHeight-s.frame.y-s.frame.w):(a.x=s.frame.x,this.fullHeight-s.frame.y-s.frame.h),s.frame.w),s.frame.h),u.y=l.h-u.y-u.h,l.width=l.w,l.height=l.h,u.width=u.w,u.height=u.h,{filename:t,frame:a,rotated:h,trimmed:c,spriteSourceSize:u,sourceSize:l}}}}return null},t.prototype.getTexturePathByFilename=function(t){for(var e in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(e))for(var i=this.jsonConfigs[e].frames,r=0;r<i.length;r++){if(i[r].filename==t)return e}return null},t.prototype.getTextureByFilename=function(t){var e=this.getFrameInfoByFilename(t),i=this.getTexturePathByFilename(t);return e&&i?new BK.Texture(i):(BK.Script.log(0,0,"getTexture Failed.Please check path"),null)},t.prototype.getTextureInfoByFilename=function(t){var e=this.getFrameInfoByFilename(t),i=this.getTexturePathByFilename(t);return e&&i?{frameInfo:e,texturePath:i,texture:this.getTextureByFilename(t)}:null},t.prototype.loadSet=function(t){if(!t)throw Error("loadSetParam can not be undefined!");var e=t.jsonPath,i=t.texturePath,r=t.format,o=t.minFilter,n=t.magFilter,s=t.uWrap,a=t.vWrap,h=BK.FileUtil.readFile(e).readAsString();if(h){var c=JSON.parse(h);void 0===i&&(i=e.replace(/.json$/,".png")),this.jsonConfigs[i]=c,void 0===r&&(r=4),r=4,void 0===o&&(o=1),void 0===n&&(n=1),void 0===s&&(s=1),void 0===a&&(a=1);var u=new BK.Texture(i,r,o,n,s,a);this.sheets[i]=u}else BK.Script.log(0,0,"loadSheet Failed.Please check path")},t.prototype.removeSet=function(t){if(this.jsonConfigs[t])for(var e in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(e)){var i=this.jsonConfigs[e];e==t&&(delete this.jsonConfigs[t],BK.Script.log(0,0,"Delete jsonConfigs key:"+e+" val:"+i))}if(this.sheets[t])for(var e in this.sheets)if(this.sheets.hasOwnProperty(e)){i=this.sheets[e];e==t&&(delete this.sheets[t],BK.Script.log(0,0,"Delete sheets key:"+e+" val:"+i))}},t.prototype.getSprite=function(t){if(!t)throw Error("spriteInfo can not be undefined!");var e=t.filename,i=t.width,r=t.height,o=this.getTextureInfoByFilename(e);if(o){var n,s=o.frameInfo,a=o.texturePath,h=new BK.Texture(a);return i||(i=s.frame.width),r||(r=s.frame.height),BK.Script.log(0,0,"getSprite  texture:"+h+" width:"+i+" height:"+r),s.trimmed?n=new BK.SpriteSet({textureInfo:o,width:i,height:r}):((n=new BK.Sprite(i,r,h,0,1,1,1)).adjustTexturePosition(s.frame.x,s.frame.y,s.frame.width,s.frame.height,s.rotated),n)}return null},t.prototype.createSpriteSet=function(t){if(!t)throw Error("spriteInfo can not be undefined!");var e=t.filename,i=t.width,r=t.height,o=this.getTextureInfoByFilename(e);if(o){var n=o.frameInfo,s=o.texturePath,a=new BK.Texture(s);return i||(i=n.frame.width),r||(r=n.frame.height),BK.Script.log(0,0,"SheetSprite  texture:"+a+" width:"+i+" height:"+r),new BK.SpriteSet({textureInfo:o,width:i,height:r})}return null},t}();BK&&(BK.RepeatMode=r),t.exports=new n},"./src/render/texture.ts":function(t,e,i){"use strict";BK.Texture.createTextures=function(o){if(!o)return BK.Script.log(1,1,"object.file is null"),o.fail&&o.fail({errmsg:"object.file is null"}),void(o.complete&&o.complete());if(o&&o.file){for(var t=[],e=0;e<o.file.length;e++)o.file[e].path&&t.push({path:o.file[e].path,format:o.file[e].format?o.file[e].format:6});BK.Image.loadImages({file:t,success:function(t){for(var e=0;e<t.length;e++)if(0==t[e].errcode){var i=t[e].image,r=null;(r=0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")?BK.Texture.createBitmapTexture(i.width,i.height,i.format,t[e].path):BK.Texture.createBitmapTexture(i.width,i.height,i.format))?(r.uploadData(i.buffer),t[e].texture=r):(t[e].errcode=-2,t[e].errmsg="createTexture null, failed"),delete t[e].image}else t[e].errcode=-3,t[e].errmsg="createImage null, failed";o.success&&o.success(t),o.complete&&o.complete()},fail:function(t){o.fail&&o.fail(t),o.complete&&o.complete()}})}else o.fail&&o.fail({errmsg:"object.file is null"}),o.complete&&o.complete()},t.exports=BK.Texture},"./src/task/TaskManager.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this.taskQ=[],this.initTaskObserver()}return t.prototype.initTaskObserver=function(){0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")&&BK.Director.ticker.add(function(){for(var t=BK.TaskManager.getCompleteQueue();0<t.length;)for(var e=t.shift(),i=0;i<this.taskQ.length;i++){var r=this.taskQ[i];if(r.taskId==e.id){this.taskQ.splice(i,1);var o=e.res.length;if(o!==r.taskInfo.length)BK.Console.error("task not complete");else for(var n=0;n<o;n++)e.res[n].encoding=r.taskInfo[o-1-n].encoding;r.callback(e.res);break}}}.bind(this))},t.prototype.pushTask=function(t,e,i){-1!=t&&this.taskQ.push({taskId:t,taskInfo:e,callback:i})},t.prototype.cancelTask=function(t){-1!=t&&0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")&&BK.TaskManager.cancelTask(t)},t}();e.TaskManager=r,t.exports=r},"./src/ui/dialog.ts":function(t,e,i){"use strict";var r;!function(t){var e=function(){function t(){}return t.show=function(r){if(r&&r.complete){var t="sc.xy_toast_show_complete.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,e,i){r.complete()})}else BK.MQQ.SsoRequest.removeListener("sc.xy_toast_show_complete.local",this);BK.MQQ.dialog.show("toast",JSON.stringify(r))},t.hide=function(r){if(r&&r.complete){var t="sc.xy_toast_hide_complete.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,e,i){r.complete()})}else BK.MQQ.SsoRequest.removeListener("sc.xy_toast_hide_complete.local",this);BK.MQQ.dialog.hide("toast")},t}();t.toast=e;var i=function(){function t(){}return t.show=function(r){if(r&&r.complete){var t="sc.xy_loading_show_complete.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,e,i){r.complete()})}else BK.MQQ.SsoRequest.removeListener("sc.xy_loading_show_complete.local",this);BK.MQQ.dialog.show("loading",JSON.stringify(r))},t.hide=function(r){if(r&&r.complete){var t="sc.xy_loading_hide_complete.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,e,i){r.complete()})}else BK.MQQ.SsoRequest.removeListener("sc.xy_loading_hide_complete.local",this);BK.MQQ.dialog.hide("loading")},t}();t.loading=i;var r=function(){function t(){}return t.show=function(r){if(r&&r.success){var t="sc.xy_alert_show_success.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,e,i){r.success(i)})}else BK.MQQ.SsoRequest.removeListener("sc.xy_alert_show_success.local",this);if(r&&r.complete){t="sc.xy_alert_show_complete.local";BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(t,e,i){r.complete()})}else BK.MQQ.SsoRequest.removeListener("sc.xy_alert_show_complete.local",this);BK.MQQ.dialog.show("alert",JSON.stringify(r))},t}();t.alert=r}(r||(r={})),t.exports=r},"./src/ui/ui.ts":function(t,e,s){"use strict";var i;!function(t){var e=new(s("./src/common/emitter.ts")),i={keyboardInput:"keyboardInput",keyboardConfirm:"keyboardConfirm"},r=s("./src/ui/dialog.ts");function o(t){e.emit(i.keyboardConfirm,{text:t})}function n(t){e.emit(i.keyboardInput,{text:t})}t.onKeyboardInput=function(t){if(!t)throw new Error("listener can't be undefined!");e.on(i.keyboardInput,t)},t.offKeyboardInput=function(t){if(!t)throw new Error("listener can't be undefined!");e.off(i.keyboardInput,t)},t.onKeyboardConfirm=function(t){if(!t)throw new Error("listener can't be undefined!");e.on(i.keyboardConfirm,t)},t.offKeyboardConfirm=function(t){if(!t)throw new Error("listener can't be undefined!");e.off(i.keyboardConfirm,t)},t.showKeyboard=function(t){t&&t.defaultText&&BK.Editor.setText(t.defaultText+""),BK.Editor.showKeyBoard(o,n),t&&t.complete&&t.complete()},t.hideKeyboard=function(t){BK.Editor.hideKeyBoard(),t&&t.complete&&t.complete()},t.updateKeyboard=function(t){t&&(t.text?BK.Editor.setText(t.text+""):BK.Editor.setText(""),t.complete&&t.complete())},t.showToast=function(t){r.toast.show(t)},t.hideToast=function(t){r.toast.hide(t)},t.showLoading=function(t){r.loading.show(t)},t.hideLoading=function(t){r.loading.hide(t)},t.showAlert=function(t){r.alert.show(t)}}(i||(i={})),t.exports=i},"./src/util/buffer.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=BK.Director.queryDeviceInfo(),o=!("ios"===r.platform&&Number(r.version.split(".")[0])<10);e.isSupportArrayBuffer=o;var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function n(t,e,i){var r,o=new Uint8Array(t,e||0,i||t.byteLength),n=o.length,s="";for(r=0;r<n;r+=3)s+=l[o[r]>>2],s+=l[(3&o[r])<<4|o[r+1]>>4],s+=l[(15&o[r+1])<<2|o[r+2]>>6],s+=l[63&o[r+2]];return n%3==2?s=s.substring(0,s.length-1)+"=":n%3==1&&(s=s.substring(0,s.length-2)+"=="),s}function s(t,e){if(o&&BK.Misc.toArrayBuffer){var i=new ArrayBuffer(t.length);return BK.Misc.toArrayBuffer(t,i),i}return BK.Misc.toArrayBufferCompatible?BK.Misc.toArrayBufferCompatible(t,e):BK.Misc.BKBufferToArrayBuffer(t)}function a(t){if(o&&BK.Misc.toBKBuffer)return BK.Misc.toBKBuffer(t,t.byteOffset,t.byteLength);if(0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.5"))return function(t){function e(t,e){var i=40960,r=e.length,o={type:t,length:e.byteLength,offset:0};switch(t){case 0:for(var n=0;0<r;){var s=Math.min(r,i),a=new Int8Array(e.buffer,n*Int8Array.BYTES_PER_ELEMENT,s);o.offset=n,BK.Misc.transferArrayBuffer.apply(o,a),n+=i,r-=i}break;case 1:for(n=0;0<r;)s=Math.min(r,i),a=new Int16Array(e.buffer,n*Int16Array.BYTES_PER_ELEMENT,s),o.offset=n,BK.Misc.transferArrayBuffer.apply(o,a),n+=i,r-=i;break;case 2:for(n=0;0<r;)s=Math.min(r,i),a=new Int32Array(e.buffer,n*Int32Array.BYTES_PER_ELEMENT,s),o.offset=n,BK.Misc.transferArrayBuffer.apply(o,a),n+=i,r-=i;break;case 3:for(n=0;0<r;)s=Math.min(r,i),a=new Uint8Array(e.buffer,n*Uint8Array.BYTES_PER_ELEMENT,s),o.offset=n,BK.Misc.transferArrayBuffer.apply(o,a),n+=i,r-=i;break;case 5:for(n=0;0<r;)s=Math.min(r,i),a=new Uint16Array(e.buffer,n*Uint16Array.BYTES_PER_ELEMENT,s),o.offset=n,BK.Misc.transferArrayBuffer.apply(o,a),n+=i,r-=i;break;case 6:for(n=0;0<r;)s=Math.min(r,i),a=new Uint32Array(e.buffer,n*Uint32Array.BYTES_PER_ELEMENT,s),o.offset=n,BK.Misc.transferArrayBuffer.apply(o,a),n+=i,r-=i;break;case 7:for(n=0;0<r;)s=Math.min(r,i),a=new Float32Array(e.buffer,n*Float32Array.BYTES_PER_ELEMENT,s),o.offset=n,BK.Misc.transferArrayBuffer.apply(o,a),n+=i,r-=i}}return t instanceof Int8Array==1?e(0,t):t instanceof Int16Array==1?e(1,t):t instanceof Int32Array==1?e(2,t):t instanceof Uint8Array==1?e(3,t):t instanceof Uint16Array==1?e(5,t):t instanceof Uint32Array==1?e(6,t):t instanceof Float32Array==1&&e(7,t),BK.Misc.getTransferedArrayBuffer()}(t);var e=n(t.buffer,t.byteOffset,t.byteLength);return BK.Misc.decodeBase64FromString(e)}BK.Misc.BKBufferToArrayBuffer=function(t){return t.rewind(),function(t){var e,i,r,o,n,s=.75*t.length,a=t.length,h=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var c=new ArrayBuffer(s),u=new Uint8Array(c);for(e=0;e<a;e+=4)i=l.indexOf(t[e]),r=l.indexOf(t[e+1]),o=l.indexOf(t[e+2]),n=l.indexOf(t[e+3]),u[h++]=i<<2|r>>4,u[h++]=(15&r)<<4|o>>2,u[h++]=(3&o)<<6|63&n;return c}(BK.Misc.encodeBase64FromBuffer(t))},BK.Misc.arrayBufferToBKBuffer=function(t,e,i){if(o&&BK.Misc.toBKBuffer)return BK.Misc.toBKBuffer(t,e,i);var r=n(t,e,i);return BK.Misc.decodeBase64FromString(r)},BK.Misc.typedArrayToBKBuffer=function(t){if(o&&BK.Misc.toBKBuffer)return BK.Misc.toBKBuffer(t,t.byteOffset,t.byteLength);var e=n(t.buffer,t.byteOffset,t.byteLength);return BK.Misc.decodeBase64FromString(e)},e.typedArrayToBKBuffer=a,e.BKBufferToInt8Array=function(t){return new Int8Array(s(t,0))},e.BKBufferToInt16Array=function(t){return new Int16Array(s(t,1))},e.BKBufferToInt32Array=function(t){return new Int32Array(s(t,2))},e.BKBufferToUint8Array=function(t){return new Uint8Array(s(t,3))},e.BKBufferToUint16Array=function(t){return new Uint16Array(s(t,5))},e.BKBufferToUint32Array=function(t){return new Uint32Array(s(t,6))},e.BKBufferToFloat32Array=function(t){return new Float32Array(s(t,7))},e.BKBufferToArrayBuffer=function(t){return s(t,0)},e.arrayBufferToBKBuffer=function(t){return a(new Int8Array(t))}},"./src/util/console.ts":function(t,e,i){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0}),function(t){var h=2048,e={};function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];r(1,0,t)}function r(t,e,i){for(var r="",o=0,n=i;o<n.length;o++){var s=n[o];-1!=r.indexOf("%d")&&"number"==typeof s?r=r.replace("%d",s.toString()):-1!=r.indexOf("%s")&&"string"==typeof s?r=r.replace("%s",s):-1!=r.indexOf("%o")&&"object"==typeof s?r=r.replace("%o",JSON.stringify(s)):"object"==typeof s?r=r+JSON.stringify(s)+" ":null==s?r+="undefined ":r=r+s.toString()+" "}if(r.length>h)for(var a=0;a<=r.length/h;a++)BK.Script.log(t,e,r.slice(a*h,(a+1)*h));else BK.Script.log(t,e,r)}t.log=i,t.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];r(0,0,t)},t.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];r(1,-1,t)},t.time=function(t){e[t]=BK.Time.timestamp},t.timeEnd=function(t){i(t,":",1e3*(BK.Time.timestamp-e[t]),"ms"),delete e[t]}}(r=e.Console||(e.Console={})),t.exports=r},"./src/util/util.ts":function(t,e,i){"use strict";var r;(r||(r={})).buffer=function(){},t.exports=r},"./src/webgl/WebGLBuffer.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){void 0===t&&(t=0),this._bufferid=t}return Object.defineProperty(t.prototype,"bufferId",{get:function(){return this._bufferid},set:function(t){this._bufferid=t},enumerable:!0,configurable:!0}),t}();e.default=r},"./src/webgl/WebGLFramebuffer.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){void 0===t&&(t=0),this._framabufferid=t}return Object.defineProperty(t.prototype,"framebufferId",{get:function(){return this._framabufferid},set:function(t){this._framabufferid=t},enumerable:!0,configurable:!0}),t}();e.default=r},"./src/webgl/WebGLProgram.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){void 0===t&&(t=0),this._programid=t}return Object.defineProperty(t.prototype,"programId",{get:function(){return this._programid},set:function(t){this._programid},enumerable:!0,configurable:!0}),t}();e.default=r},"./src/webgl/WebGLRenderbuffer.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){void 0===t&&(t=0),this._renderbufferid=t}return Object.defineProperty(t.prototype,"renderbufferId",{get:function(){return this._renderbufferid},set:function(t){this._renderbufferid=t},enumerable:!0,configurable:!0}),t}();e.default=r},"./src/webgl/WebGLRenderingContext.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,o=i("./src/webgl/WebGLBuffer.ts"),n=i("./src/webgl/WebGLFramebuffer.ts"),s=i("./src/webgl/WebGLRenderbuffer.ts"),a=i("./src/webgl/WebGLProgram.ts"),h=i("./src/webgl/WebGLShader.ts"),c=i("./src/webgl/WebGLTexture.ts"),u=i("./src/webgl/WebGLUniformLocation.ts"),l=i("./src/util/buffer.ts");function d(t){return Array.isArray(t)?l.typedArrayToBKBuffer(new Int32Array(t)):l.typedArrayToBKBuffer(t)}function f(t){return Array.isArray(t)?l.typedArrayToBKBuffer(new Float32Array(t)):l.typedArrayToBKBuffer(t)}e.bkWebGLGetInstance=function(){return r||(r=_.getInstance()),renderTicker&&renderTicker.setTickerCallBack(function(t,e){}),r};var _=function(){function t(){this.firstFrameUpload=!1,this.DEPTH_BUFFER_BIT=256,this.STENCIL_BUFFER_BIT=1024,this.COLOR_BUFFER_BIT=16384,this.POINTS=0,this.LINES=1,this.LINE_LOOP=2,this.LINE_STRIP=3,this.TRIANGLES=4,this.TRIANGLE_STRIP=5,this.TRIANGLE_FAN=6,this.ZERO=0,this.ONE=1,this.SRC_COLOR=768,this.ONE_MINUS_SRC_COLOR=769,this.SRC_ALPHA=770,this.ONE_MINUS_SRC_ALPHA=771,this.DST_ALPHA=772,this.ONE_MINUS_DST_ALPHA=773,this.DST_COLOR=774,this.ONE_MINUS_DST_COLOR=775,this.SRC_ALPHA_SATURATE=776,this.FUNC_ADD=32774,this.BLEND_EQUATION=32777,this.BLEND_EQUATION_RGB=32777,this.BLEND_EQUATION_ALPHA=34877,this.FUNC_SUBTRACT=32778,this.FUNC_REVERSE_SUBTRACT=32779,this.BLEND_DST_RGB=32968,this.BLEND_SRC_RGB=32969,this.BLEND_DST_ALPHA=32970,this.BLEND_SRC_ALPHA=32971,this.CONSTANT_COLOR=32769,this.ONE_MINUS_CONSTANT_COLOR=32770,this.CONSTANT_ALPHA=32771,this.ONE_MINUS_CONSTANT_ALPHA=32772,this.BLEND_COLOR=32773,this.ARRAY_BUFFER=34962,this.ELEMENT_ARRAY_BUFFER=34963,this.ARRAY_BUFFER_BINDING=34964,this.ELEMENT_ARRAY_BUFFER_BINDING=34965,this.STREAM_DRAW=35040,this.STATIC_DRAW=35044,this.DYNAMIC_DRAW=35048,this.BUFFER_SIZE=34660,this.BUFFER_USAGE=34661,this.CURRENT_VERTEX_ATTRIB=34342,this.FRONT=1028,this.BACK=1029,this.FRONT_AND_BACK=1032,this.CULL_FACE=2884,this.BLEND=3042,this.DITHER=3024,this.STENCIL_TEST=2960,this.DEPTH_TEST=2929,this.SCISSOR_TEST=3089,this.POLYGON_OFFSET_FILL=32823,this.SAMPLE_ALPHA_TO_COVERAGE=32926,this.SAMPLE_COVERAGE=32928,this.NO_ERROR=0,this.INVALID_ENUM=1280,this.INVALID_VALUE=1281,this.INVALID_OPERATION=1282,this.OUT_OF_MEMORY=1285,this.CW=2304,this.CCW=2305,this.LINE_WIDTH=2849,this.ALIASED_POINT_SIZE_RANGE=33901,this.ALIASED_LINE_WIDTH_RANGE=33902,this.CULL_FACE_MODE=2885,this.FRONT_FACE=2886,this.DEPTH_RANGE=2928,this.DEPTH_WRITEMASK=2930,this.DEPTH_CLEAR_VALUE=2931,this.DEPTH_FUNC=2932,this.STENCIL_CLEAR_VALUE=2961,this.STENCIL_FUNC=2962,this.STENCIL_FAIL=2964,this.STENCIL_PASS_DEPTH_FAIL=2965,this.STENCIL_PASS_DEPTH_PASS=2966,this.STENCIL_REF=2967,this.STENCIL_VALUE_MASK=2963,this.STENCIL_WRITEMASK=2968,this.STENCIL_BACK_FUNC=34816,this.STENCIL_BACK_FAIL=34817,this.STENCIL_BACK_PASS_DEPTH_FAIL=34818,this.STENCIL_BACK_PASS_DEPTH_PASS=34819,this.STENCIL_BACK_REF=36003,this.STENCIL_BACK_VALUE_MASK=36004,this.STENCIL_BACK_WRITEMASK=36005,this.VIEWPORT=2978,this.SCISSOR_BOX=3088,this.COLOR_CLEAR_VALUE=3106,this.COLOR_WRITEMASK=3107,this.UNPACK_ALIGNMENT=3317,this.PACK_ALIGNMENT=3333,this.MAX_TEXTURE_SIZE=3379,this.MAX_VIEWPORT_DIMS=3386,this.SUBPIXEL_BITS=3408,this.RED_BITS=3410,this.GREEN_BITS=3411,this.BLUE_BITS=3412,this.ALPHA_BITS=3413,this.DEPTH_BITS=3414,this.STENCIL_BITS=3415,this.POLYGON_OFFSET_UNITS=10752,this.POLYGON_OFFSET_FACTOR=32824,this.TEXTURE_BINDING_2D=32873,this.SAMPLE_BUFFERS=32936,this.SAMPLES=32937,this.SAMPLE_COVERAGE_VALUE=32938,this.SAMPLE_COVERAGE_INVERT=32939,this.COMPRESSED_TEXTURE_FORMATS=34467,this.DONT_CARE=4352,this.FASTEST=4353,this.NICEST=4354,this.GENERATE_MIPMAP_HINT=33170,this.BYTE=5120,this.UNSIGNED_BYTE=5121,this.SHORT=5122,this.UNSIGNED_SHORT=5123,this.INT=5124,this.UNSIGNED_INT=5125,this.FLOAT=5126,this.DEPTH_COMPONENT=6402,this.ALPHA=6406,this.RGB=6407,this.RGBA=6408,this.LUMINANCE=6409,this.LUMINANCE_ALPHA=6410,this.UNSIGNED_SHORT_4_4_4_4=32819,this.UNSIGNED_SHORT_5_5_5_1=32820,this.UNSIGNED_SHORT_5_6_5=33635,this.FRAGMENT_SHADER=35632,this.VERTEX_SHADER=35633,this.MAX_VERTEX_ATTRIBS=34921,this.MAX_VERTEX_UNIFORM_VECTORS=36347,this.MAX_VARYING_VECTORS=36348,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,this.MAX_TEXTURE_IMAGE_UNITS=34930,this.MAX_FRAGMENT_UNIFORM_VECTORS=36349,this.SHADER_TYPE=35663,this.DELETE_STATUS=35712,this.LINK_STATUS=35714,this.VALIDATE_STATUS=35715,this.ATTACHED_SHADERS=35717,this.ACTIVE_UNIFORMS=35718,this.ACTIVE_ATTRIBUTES=35721,this.SHADING_LANGUAGE_VERSION=35724,this.CURRENT_PROGRAM=35725,this.NEVER=512,this.LESS=513,this.EQUAL=514,this.LEQUAL=515,this.GREATER=516,this.NOTEQUAL=517,this.GEQUAL=518,this.ALWAYS=519,this.KEEP=7680,this.REPLACE=7681,this.INCR=7682,this.DECR=7683,this.INVERT=5386,this.INCR_WRAP=34055,this.DECR_WRAP=34056,this.VENDOR=7936,this.RENDERER=7937,this.VERSION=7938,this.NEAREST=9728,this.LINEAR=9729,this.NEAREST_MIPMAP_NEAREST=9984,this.LINEAR_MIPMAP_NEAREST=9985,this.NEAREST_MIPMAP_LINEAR=9986,this.LINEAR_MIPMAP_LINEAR=9987,this.TEXTURE_MAG_FILTER=10240,this.TEXTURE_MIN_FILTER=10241,this.TEXTURE_WRAP_S=10242,this.TEXTURE_WRAP_T=10243,this.TEXTURE_2D=3553,this.TEXTURE=5890,this.TEXTURE_CUBE_MAP=34067,this.TEXTURE_BINDING_CUBE_MAP=34068,this.TEXTURE_CUBE_MAP_POSITIVE_X=34069,this.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,this.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,this.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,this.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,this.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,this.MAX_CUBE_MAP_TEXTURE_SIZE=34076,this.TEXTURE0=33984,this.TEXTURE1=33985,this.TEXTURE2=33986,this.TEXTURE3=33987,this.TEXTURE4=33988,this.TEXTURE5=33989,this.TEXTURE6=33990,this.TEXTURE7=33991,this.TEXTURE8=33992,this.TEXTURE9=33993,this.TEXTURE10=33994,this.TEXTURE11=33995,this.TEXTURE12=33996,this.TEXTURE13=33997,this.TEXTURE14=33998,this.TEXTURE15=33999,this.TEXTURE16=34e3,this.TEXTURE17=34001,this.TEXTURE18=34002,this.TEXTURE19=34003,this.TEXTURE20=34004,this.TEXTURE21=34005,this.TEXTURE22=34006,this.TEXTURE23=34007,this.TEXTURE24=34008,this.TEXTURE25=34009,this.TEXTURE26=34010,this.TEXTURE27=34011,this.TEXTURE28=34012,this.TEXTURE29=34013,this.TEXTURE30=34014,this.TEXTURE31=34015,this.ACTIVE_TEXTURE=34016,this.REPEAT=10497,this.CLAMP_TO_EDGE=33071,this.MIRRORED_REPEAT=33648,this.FLOAT_VEC2=35664,this.FLOAT_VEC3=35665,this.FLOAT_VEC4=35666,this.INT_VEC2=35667,this.INT_VEC3=35668,this.INT_VEC4=35669,this.BOOL=35670,this.BOOL_VEC2=35671,this.BOOL_VEC3=35672,this.BOOL_VEC4=35673,this.FLOAT_MAT2=35674,this.FLOAT_MAT3=35675,this.FLOAT_MAT4=35676,this.SAMPLER_2D=35678,this.SAMPLER_CUBE=35680,this.VERTEX_ATTRIB_ARRAY_ENABLED=34338,this.VERTEX_ATTRIB_ARRAY_SIZE=34339,this.VERTEX_ATTRIB_ARRAY_STRIDE=34340,this.VERTEX_ATTRIB_ARRAY_TYPE=34341,this.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,this.VERTEX_ATTRIB_ARRAY_POINTER=34373,this.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,this.IMPLEMENTATION_COLOR_READ_TYPE=35738,this.IMPLEMENTATION_COLOR_READ_FORMAT=35739,this.COMPILE_STATUS=35713,this.LOW_FLOAT=36336,this.MEDIUM_FLOAT=36337,this.HIGH_FLOAT=36338,this.LOW_INT=36339,this.MEDIUM_INT=36340,this.HIGH_INT=36341,this.FRAMEBUFFER=36160,this.RENDERBUFFER=36161,this.RGBA4=32854,this.RGB5_A1=32855,this.RGB565=36194,this.DEPTH_COMPONENT16=33189,this.STENCIL_INDEX8=36168,this.DEPTH_STENCIL=34041,this.RENDERBUFFER_WIDTH=36162,this.RENDERBUFFER_HEIGHT=36163,this.RENDERBUFFER_INTERNAL_FORMAT=36164,this.RENDERBUFFER_RED_SIZE=36176,this.RENDERBUFFER_GREEN_SIZE=36177,this.RENDERBUFFER_BLUE_SIZE=36178,this.RENDERBUFFER_ALPHA_SIZE=36179,this.RENDERBUFFER_DEPTH_SIZE=36180,this.RENDERBUFFER_STENCIL_SIZE=36181,this.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,this.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,this.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,this.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,this.COLOR_ATTACHMENT0=36064,this.DEPTH_ATTACHMENT=36096,this.STENCIL_ATTACHMENT=36128,this.DEPTH_STENCIL_ATTACHMENT=33306,this.NONE=0,this.FRAMEBUFFER_COMPLETE=36053,this.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,this.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,this.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,this.FRAMEBUFFER_UNSUPPORTED=36061,this.FRAMEBUFFER_BINDING=36006,this.RENDERBUFFER_BINDING=36007,this.MAX_RENDERBUFFER_SIZE=34024,this.INVALID_FRAMEBUFFER_OPERATION=1286,this.UNPACK_FLIP_Y_WEBGL=37440,this.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,this.CONTEXT_LOST_WEBGL=37442,this.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,this.BROWSER_DEFAULT_WEBGL=37444,this.SHADER_BINARY_FORMATS=36344,this.NUM_SHADER_BINARY_FORMATS=36345,this.NUM_COMPRESSED_TEXTURE_FORMATS=34466,this.total_size=1e5,this.next_index=0,this.bufferdata_pointer=0,this.gl=new BK.WebGL,this.viewport(0,0,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height)}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.viewport=function(t,e,i,r){this.gl.glViewport(t,e,i,r)},t.prototype.bindAttribLocation=function(t,e,i){this.gl.glBindAttribLocation(t.programId,e,i)},t.prototype.createProgram=function(){var t=this.gl.glCreateProgram();return new a.default(t)},t.prototype.deleteProgram=function(t){if(!(t instanceof a.default))throw new TypeError("program argument type error");this.gl.glDeleteProgram(t.programId)},t.prototype.getActiveAttrib=function(t,e){if(!(t instanceof a.default))throw new TypeError("program argument type error");return this.gl.glGetActiveAttrib(t.programId,e)},t.prototype.getActiveUniform=function(t,e){if(!(t instanceof a.default))throw new TypeError("program argument type error");return this.gl.glGetActiveUniform(t.programId,e)},t.prototype.getAttribLocation=function(t,e){if(!(t instanceof a.default))throw new TypeError("program argument type error");return this.gl.glGetAttribLocation(t.programId,e)},t.prototype.getProgramParameter=function(t,e){if(!(t instanceof a.default))throw new TypeError("program argument type error");return this.gl.glGetProgramParameter(t.programId,e)},t.prototype.getProgramInfoLog=function(t){if(!(t instanceof a.default))throw new TypeError("program argument type error");return this.gl.glGetProgramInfoLog(t.programId)},t.prototype.isProgram=function(t){if(!(t instanceof a.default))throw new TypeError("program argument type error");return this.gl.glIsProgram(t.programId)},t.prototype.linkProgram=function(t){if(!(t instanceof a.default))throw new TypeError("program argument type error");t&&this.gl.glLinkProgram(t.programId)},t.prototype.useProgram=function(t){if(!(t instanceof a.default))throw new TypeError("program argument type error");t&&this.gl.glUseProgram(t.programId)},t.prototype.validateProgram=function(t){if(!(t instanceof a.default))throw new TypeError("program argument type error");this.gl.glValidateProgram(t.programId)},t.prototype.bindBuffer=function(t,e){this.gl.glBindBuffer(t,e?e.bufferId:null)},t.prototype.createBuffer=function(){return new o.default(this.gl.glCreateBuffer())},t.prototype.isBuffer=function(t){return t&&this.gl.glIsBuffer(t.bufferId)},t.prototype.deleteBuffer=function(t){t&&this.gl.glDeleteBuffer(t.bufferId)},t.prototype.getBufferParameter=function(t,e){return this.gl.glGetBufferParameter(t,e)},t.prototype.bindFramebuffer=function(t,e){this.gl.glBindFramebuffer(t,e?e.framebufferId:null)},t.prototype.createFramebuffer=function(){return new n.default(this.gl.glCreateFramebuffer())},t.prototype.deleteFramebuffer=function(t){t&&this.gl.glDeleteFramebuffer(t.framebufferId)},t.prototype.isFramebuffer=function(t){return t&&this.gl.glIsFramebuffer(t.framebufferId)},t.prototype.getFramebufferAttachmentParameter=function(t,e,i){return this.gl.glGetFramebufferAttachmentParameter(t,e,i)},t.prototype.bindRenderbuffer=function(t,e){this.gl.glBindRenderbuffer(t,e?e.renderbufferId:null)},t.prototype.createRenderbuffer=function(){return new s.default(this.gl.glCreateRenderbuffer())},t.prototype.deleteRenderbuffer=function(t){t&&this.gl.glDeleteRenderbuffer(t.renderbufferId)},t.prototype.isRenderbuffer=function(t){return t&&this.gl.glIsRenderbuffer(t.renderbufferId)},t.prototype.getRenderbufferParameter=function(t,e){return this.gl.glGetRenderbufferParameter(t,e)},t.prototype.attachShader=function(t,e){if(!(t instanceof a.default))throw new TypeError("program argument type error");if(!(e instanceof h.default))throw new TypeError("shader argument type error");this.gl.glAttachShader(t.programId,e.shaderId)},t.prototype.compileShader=function(t){if(!(t instanceof h.default))throw new TypeError("shader argument type error");this.gl.glCompileShader(t.shaderId)},t.prototype.getShaderParameter=function(t,e){if(!(t instanceof h.default))throw new TypeError("shader argument type error");return this.gl.glGetShaderParameter(t.shaderId,e)},t.prototype.createShader=function(t){var e=this.gl.glCreateShader(t);return new h.default(e)},t.prototype.deleteShader=function(t){if(!(t instanceof h.default))throw new TypeError("shader argument type error");this.gl.glDeleteShader(t.shaderId)},t.prototype.detachShader=function(t,e){if(!(t instanceof a.default))throw new TypeError("program argument type error");if(!(e instanceof h.default))throw new TypeError("shader argument type error");this.gl.glDetachShader(t.programId,e.shaderId)},t.prototype.getShaderInfoLog=function(t){if(!(t instanceof h.default))throw new TypeError("shader argument type error");return this.gl.glGetShaderInfoLog(t.shaderId)},t.prototype.getShaderSource=function(t){if(!(t instanceof h.default))throw new TypeError("shader argument type error");return this.gl.glGetShaderSource(t.shaderId)},t.prototype.isShader=function(t){if(!(t instanceof h.default))throw new TypeError("shader argument type error");return this.gl.glIsShader(t.shaderId)},t.prototype.shaderSource=function(t,e){if(!(t instanceof h.default))throw new TypeError("shader argument type error");this.gl.glShaderSource(t.shaderId,e)},t.prototype.getAttachedShaders=function(t){if(!(t instanceof a.default))throw new TypeError("program argument type error");var e=this.gl.glGetAttachedShaders(t.programId);return new h.default(e)},t.prototype.bindTexture=function(t,e){if(!(e instanceof c.default))throw new TypeError("texture argument type error");this.gl.glBindTexture(t,e.textureId)},t.prototype.compressedTexImage2D=function(t,e,i,r,o,n,s){this.gl.glCompressedTexImage2D(t,e,i,r,o,n,s)},t.prototype.compressedTexSubImage2D=function(t,e,i,r,o,n,s,a){this.gl.glCompressedTexSubImage2D(t,e,i,r,o,n,s,a)},t.prototype.copyTexImage2D=function(t,e,i,r,o,n,s,a){this.gl.glCopyTexImage2D(t,e,i,r,o,n,s,a)},t.prototype.copyTexSubImage2D=function(t,e,i,r,o,n,s,a){this.gl.glCopyTexSubImage2D(t,e,i,r,o,n,s,a)},t.prototype.createTexture=function(){return new c.default(this.gl.glCreateTexture())},t.prototype.deleteTexture=function(t){if(!(t instanceof c.default))throw new TypeError("texture argument type error");this.gl.glDeleteTexture(t.textureId)},t.prototype.generateMipmap=function(t){this.gl.glGenerateMipmap(t)},t.prototype.getTexParameter=function(t,e){return this.gl.glGetTexParameter(t,e)},t.prototype.isTexture=function(t){if(!(t instanceof c.default))throw new TypeError("texture argument type error");return this.gl.glIsTexture(t.textureId)},t.prototype.texImage2D=function(t,e,i){switch(arguments.length){case 6:var r=arguments[3],o=arguments[4],n=arguments[5];if(l.isSupportArrayBuffer)Object.prototype.hasOwnProperty.call(n,"__nativeObj")?this.gl.glTexImage2D(t,e,i,r,o,n.__nativeObj):this.gl.glTexImage2D(t,e,i,r,o,n);else if(n instanceof ArrayBuffer){var s=l.arrayBufferToBKBuffer(n);this.gl.glTexImage2D(t,e,i,r,o,s)}else this.gl.glTexImage2D(t,e,i,r,o,n);break;case 9:var a=arguments[3],h=arguments[4],c=arguments[5];r=arguments[6],o=arguments[7],n=arguments[8];this.gl.glTexImage2D(t,e,i,a,h,c,r,o,n)}},t.prototype.texSubImage2D=function(t,e,i,r){switch(arguments.length){case 7:var o=arguments[4],n=arguments[5],s=arguments[6];if(l.isSupportArrayBuffer)Object.prototype.hasOwnProperty.call(s,"__nativeObj")?this.gl.glTexSubImage2D(t,e,i,r,o,n,s.__nativeObj):this.gl.glTexSubImage2D(t,e,i,r,o,n,s);else if(s instanceof ArrayBuffer){var a=l.arrayBufferToBKBuffer(s);this.gl.glTexSubImage2D(t,e,i,r,o,n,a)}else this.gl.glTexSubImage2D(t,e,i,r,o,n,s);break;case 9:var h=arguments[4],c=arguments[5];o=arguments[6],n=arguments[7],s=arguments[8];this.gl.glTexSubImage2D(t,e,i,r,h,c,o,n,s)}},t.prototype.texParameterf=function(t,e,i){this.gl.glTexParameterf(t,e,i)},t.prototype.texParameteri=function(t,e,i){this.gl.glTexParameteri(t,e,i)},t.prototype.activeTexture=function(t){this.gl.glActiveTexture(t)},t.prototype.framebufferTexture2D=function(t,e,i,r,o){if(!(r instanceof c.default))throw new TypeError("texture argument type error");this.gl.glFramebufferTexture2D(t,e,i,r.textureId,o)},t.prototype.getShaderPrecisionFormat=function(t,e){return this.gl.glGetShaderPrecisionFormat(t,e)},t.prototype.getParameter=function(t){switch(t){case r.ACTIVE_TEXTURE:case r.ALPHA_BITS:case r.ARRAY_BUFFER_BINDING:case r.BLUE_BITS:case r.CULL_FACE_MODE:case r.CURRENT_PROGRAM:case r.DEPTH_BITS:case r.DEPTH_FUNC:case r.ELEMENT_ARRAY_BUFFER_BINDING:case r.FRAMEBUFFER_BINDING:case r.FRONT_FACE:case r.GENERATE_MIPMAP_HINT:case r.GREEN_BITS:case r.IMPLEMENTATION_COLOR_READ_FORMAT:case r.IMPLEMENTATION_COLOR_READ_TYPE:case r.MAX_COMBINED_TEXTURE_IMAGE_UNITS:case r.MAX_CUBE_MAP_TEXTURE_SIZE:case r.MAX_FRAGMENT_UNIFORM_VECTORS:case r.MAX_RENDERBUFFER_SIZE:case r.MAX_TEXTURE_IMAGE_UNITS:case r.MAX_TEXTURE_SIZE:case r.MAX_VARYING_VECTORS:case r.MAX_VERTEX_ATTRIBS:case r.MAX_VERTEX_TEXTURE_IMAGE_UNITS:case r.MAX_VERTEX_UNIFORM_VECTORS:case r.MAX_VIEWPORT_DIMS:case r.NUM_COMPRESSED_TEXTURE_FORMATS:case r.NUM_SHADER_BINARY_FORMATS:case r.PACK_ALIGNMENT:case r.RED_BITS:case r.RENDERBUFFER_BINDING:case r.SAMPLE_BUFFERS:case r.SAMPLES:case r.STENCIL_BACK_FAIL:case r.STENCIL_BACK_FUNC:case r.STENCIL_BACK_PASS_DEPTH_FAIL:case r.STENCIL_BACK_PASS_DEPTH_PASS:case r.STENCIL_BACK_REF:case r.STENCIL_BACK_VALUE_MASK:case r.STENCIL_BACK_WRITEMASK:case r.STENCIL_BITS:case r.STENCIL_CLEAR_VALUE:case r.STENCIL_FAIL:case r.STENCIL_FUNC:case r.STENCIL_PASS_DEPTH_FAIL:case r.STENCIL_PASS_DEPTH_PASS:case r.STENCIL_REF:case r.STENCIL_VALUE_MASK:case r.STENCIL_WRITEMASK:case r.SUBPIXEL_BITS:case r.TEXTURE_BINDING_2D:case r.TEXTURE_BINDING_CUBE_MAP:case r.UNPACK_ALIGNMENT:case r.BLEND_DST_ALPHA:case r.BLEND_DST_RGB:case r.BLEND_EQUATION_ALPHA:case r.BLEND_EQUATION_RGB:case r.BLEND_SRC_ALPHA:case r.BLEND_SRC_RGB:return this.gl.glGetParameterInt(t,1);case r.ALIASED_LINE_WIDTH_RANGE:case r.ALIASED_POINT_SIZE_RANGE:case r.DEPTH_RANGE:case r.MAX_VIEWPORT_DIMS:return this.gl.glGetParameterFloat(t,2);case r.BLEND:case r.CULL_FACE:case r.DEPTH_TEST:case r.DEPTH_WRITEMASK:case r.DITHER:case r.POLYGON_OFFSET_FILL:case r.SAMPLE_ALPHA_TO_COVERAGE:case r.SAMPLE_COVERAGE:case r.SAMPLE_COVERAGE_INVERT:case r.SCISSOR_TEST:case r.STENCIL_TEST:return this.gl.glGetParameterBool(t,1);case r.BLEND_COLOR:case r.COLOR_CLEAR_VALUE:return this.gl.glGetParameterFloat(t,4);case r.SCISSOR_BOX:case r.VIEWPORT:return this.gl.glGetParameterInt(t,4);case r.COLOR_WRITEMASK:return this.gl.glGetParameterBool(t,4);case r.POLYGON_OFFSET_FACTOR:case r.POLYGON_OFFSET_UNITS:case r.SAMPLE_COVERAGE_VALUE:return this.gl.glGetParameterFloat(t,1);case r.SHADER_BINARY_FORMATS:var e=this.gl.glGetParameterInt(r.NUM_SHADER_BINARY_FORMATS,1);return this.gl.glGetParameterInt(t,e);case r.COMPRESSED_TEXTURE_FORMATS:e=this.gl.glGetParameterInt(r.NUM_COMPRESSED_TEXTURE_FORMATS,1);return this.gl.glGetParameterInt(t,e)}},t.prototype.getUniform=function(t,e){return this.gl.glGetUniform(t.programId,e.uniformLocationId)},t.prototype.getUniformLocation=function(t,e){return new u.default(this.gl.glGetUniformLocation(t.programId,e))},t.prototype.uniform1f=function(t,e){this.gl.glUniform1f(t.uniformLocationId,e)},t.prototype.uniform2f=function(t,e,i){this.gl.glUniform2f(t.uniformLocationId,e,i)},t.prototype.uniform3f=function(t,e,i,r){this.gl.glUniform3f(t.uniformLocationId,e,i,r)},t.prototype.uniform4f=function(t,e,i,r,o){this.gl.glUniform4f(t.uniformLocationId,e,i,r,o)},t.prototype.uniform1i=function(t,e){this.gl.glUniform1i(t.uniformLocationId,e)},t.prototype.uniform2i=function(t,e,i){this.gl.glUniform2i(t.uniformLocationId,e,i)},t.prototype.uniform3i=function(t,e,i,r){this.gl.glUniform3i(t.uniformLocationId,e,i,r)},t.prototype.uniform4i=function(t,e,i,r,o){this.gl.glUniform4i(t.uniformLocationId,e,i,r,o)},t.prototype.uniform1fv=function(t,e){this.gl.glUniform1fv(t.uniformLocationId,f(e))},t.prototype.uniform2fv=function(t,e){this.gl.glUniform2fv(t.uniformLocationId,f(e))},t.prototype.uniform3fv=function(t,e){this.gl.glUniform3fv(t.uniformLocationId,f(e))},t.prototype.uniform4fv=function(t,e){this.gl.glUniform4fv(t.uniformLocationId,f(e))},t.prototype.uniform1iv=function(t,e){this.gl.glUniform1iv(t.uniformLocationId,d(e))},t.prototype.uniform2iv=function(t,e){this.gl.glUniform2iv(t.uniformLocationId,d(e))},t.prototype.uniform3iv=function(t,e){this.gl.glUniform3iv(t.uniformLocationId,d(e))},t.prototype.uniform4iv=function(t,e){this.gl.glUniform4iv(t.uniformLocationId,d(e))},t.prototype.uniformMatrix2fv=function(t,e,i){this.gl.glUniformMatrix2fv(t.uniformLocationId,e,f(i))},t.prototype.uniformMatrix3fv=function(t,e,i){this.gl.glUniformMatrix3fv(t.uniformLocationId,e,f(i))},t.prototype.uniformMatrix4fv=function(t,e,i){this.gl.glUniformMatrix4fv(t.uniformLocationId,e,f(i))},t.prototype.sampleCoverage=function(t,e){this.gl.glSampleCoverage(t,e)},t.prototype.scissor=function(t,e,i,r){this.gl.glScissor(t,e,i,r)},t.prototype.stencilFunc=function(t,e,i){this.gl.glStencilFunc(t,e,i)},t.prototype.stencilFuncSeparate=function(t,e,i,r){this.gl.glStencilFuncSeparate(t,e,i,r)},t.prototype.stencilMask=function(t){this.gl.glStencilMask(t)},t.prototype.stencilMaskSeparate=function(t,e){this.gl.glStencilMaskSeparate(t,e)},t.prototype.stencilOp=function(t,e,i){this.gl.glStencilOp(t,e,i)},t.prototype.stencilOpSeparate=function(t,e,i,r){this.gl.glStencilOpSeparate(t,e,i,r)},t.prototype.vertexAttrib1f=function(t,e){this.gl.glVertexAttrib1f(t,e)},t.prototype.vertexAttrib2f=function(t,e,i){this.gl.glVertexAttrib2f(t,e,i)},t.prototype.vertexAttrib3f=function(t,e,i,r){this.gl.glVertexAttrib3f(t,e,i,r)},t.prototype.vertexAttrib4f=function(t,e,i,r,o){this.gl.glVertexAttrib4f(t,e,i,r,o)},t.prototype.vertexAttrib1fv=function(t,e){this.gl.glVertexAttrib1fv(t,f(e))},t.prototype.vertexAttrib2fv=function(t,e){this.gl.glVertexAttrib2fv(t,f(e))},t.prototype.vertexAttrib3fv=function(t,e){this.gl.glVertexAttrib3fv(t,f(e))},t.prototype.vertexAttrib4fv=function(t,e){this.gl.glVertexAttrib4fv(t,f(e))},t.prototype.vertexAttribPointer=function(t,e,i,r,o,n){this.gl.glVertexAttribPointer(t,e,i,r,o,n)},t.prototype.getVertexAttrib=function(t,e){return this.gl.glGetVertexAttrib(t,e)},t.prototype.flush=function(){this.gl.glFlush()},t.prototype.framebufferRenderbuffer=function(t,e,i,r){this.gl.glFramebufferRenderbuffer(t,e,i,r.renderbufferId)},t.prototype.frontFace=function(t){this.gl.glFrontFace(t)},t.prototype.getError=function(){return this.gl.glGetError()},t.prototype.getVertexAttribOffset=function(t,e){this.gl.glGetVertexAttribOffset(t,e)},t.prototype.hint=function(t,e){this.gl.glHint(t,e)},t.prototype.isEnabled=function(t){return this.gl.glIsEnabled(t)},t.prototype.lineWidth=function(t){this.gl.glLineWidth(t)},t.prototype.pixelStorei=function(t,e){this.gl.glPixelStorei(t,e)},t.prototype.polygonOffset=function(t,e){this.gl.glPolygonOffset(t,e)},t.prototype.readPixels=function(t,e,i,r,o,n,s){},t.prototype.renderbufferStorage=function(t,e,i,r){this.gl.glRenderbufferStorage(t,e,i,r)},t.prototype.colorMask=function(t,e,i,r){this.gl.glColorMask(t,e,i,r)},t.prototype.cullFace=function(t){this.gl.glCullFace(t)},t.prototype.depthFunc=function(t){this.gl.glDepthFunc(t)},t.prototype.depthMask=function(t){this.gl.glDepthMask(t)},t.prototype.depthRange=function(t,e){this.gl.glDepthRange(t,e)},t.prototype.disable=function(t){this.gl.glDisable(t)},t.prototype.disableVertexAttribArray=function(t){this.gl.glDisableVertexAttribArray(t)},t.prototype.drawArrays=function(t,e,i){this.gl.glDrawArrays(t,e,i),0<i&&this.checkFirstFrames()},t.prototype.drawElements=function(t,e,i,r){this.gl.glDrawElements(t,e,i,r),0<e&&this.checkFirstFrames()},t.prototype.checkFirstFrames=function(){0==this.firstFrameUpload&&(BK.MQQ.SsoRequest.send({},"cs.first_frame_drawn.local"),this.firstFrameUpload=!0)},t.prototype.enable=function(t){this.gl.glEnable(t)},t.prototype.enableVertexAttribArray=function(t){this.gl.glEnableVertexAttribArray(t)},t.prototype.finish=function(){this.gl.glFinish()},t.prototype.blendColor=function(t,e,i,r){return this.gl.glBlendColor(t,e,i,r)},t.prototype.blendEquation=function(t){return t in[this.FUNC_ADD,this.FUNC_SUBTRACT,this.FUNC_REVERSE_SUBTRACT]?this.gl.glBlendEquation(t):this.INVALID_ENUM},t.prototype.blendEquationSeparate=function(t,e){return this.gl.glBlendEquationSeparate(t,e)},t.prototype.blendFunc=function(t,e){this.gl.glBlendFunc(t,e)},t.prototype.blendFuncSeparate=function(t,e,i,r){this.gl.glBlendFuncSeparate(t,e,i,r)},t.prototype.bufferData=function(t,e,i){if("number"==typeof e)this.gl.glBufferData(t,e,i);else if(l.isSupportArrayBuffer)ArrayBuffer,this.gl.glBufferData(t,e,i);else if(e instanceof ArrayBuffer){var r=l.arrayBufferToBKBuffer(e);this.gl.glBufferData(t,r,i)}else{r=l.arrayBufferToBKBuffer(e.buffer);this.gl.glBufferData(t,r,i)}},t.prototype.bufferSubData=function(t,e,i){if(l.isSupportArrayBuffer)ArrayBuffer,this.gl.glBufferSubData(t,e,i);else if(i instanceof ArrayBuffer){var r=l.arrayBufferToBKBuffer(i);this.gl.glBufferSubData(t,e,r)}else{r=l.arrayBufferToBKBuffer(i.buffer);this.gl.glBufferSubData(t,e,r)}},t.prototype.checkFramebufferStatus=function(t){return this.gl.glCheckFramebufferStatus(t)},t.prototype.clear=function(t){this.gl.glClear(t)},t.prototype.clearColor=function(t,e,i,r){this.gl.glClearColor(t,e,i,r)},t.prototype.clearDepth=function(t){this.gl.glClearDepth(t)},t.prototype.clearStencil=function(t){this.gl.glClearStencil(t)},t.prototype.glCommit=function(){this.gl.commit()},t.prototype.getExtension=function(){return{}},t.prototype.getSupportedExtensions=function(){return[]},t.prototype.getContextAttributes=function(){return{alpha:!0,antialias:!0,depth:!0,failIfMajorPerformanceCaveat:!1,powerPreference:"default",premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!0}},t.prototype.isContextLost=function(){return!1},t.prototype.flushCommand=function(){0<this.next_index&&(this.gl.flushCommand(this.next_index,this.buffer_data),this.next_index=0)},t.prototype.OpenOptMode=function(){this.flushCommand&&l.isSupportArrayBuffer},t}();e.WebGLRenderingContext=_},"./src/webgl/WebGLShader.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){void 0===t&&(t=0),this._shaderid=t}return Object.defineProperty(t.prototype,"shaderId",{get:function(){return this._shaderid},set:function(t){this._shaderid=t},enumerable:!0,configurable:!0}),t}();e.default=r},"./src/webgl/WebGLTexture.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){void 0===t&&(t=0),this._textureid=t}return Object.defineProperty(t.prototype,"textureId",{get:function(){return this._textureid},set:function(t){this._textureid=t},enumerable:!0,configurable:!0}),t}();e.default=r},"./src/webgl/WebGLUniformLocation.ts":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){this._uniformLocationId=t}return Object.defineProperty(t.prototype,"uniformLocationId",{get:function(){return this._uniformLocationId},set:function(t){this._uniformLocationId=t},enumerable:!0,configurable:!0}),t}();e.default=r},"./webpack/pack.ts":function(t,e,i){BK.isBrowser;if(BK.Console=i("./src/util/console.ts"),BK.SsoRequest=i("./src/mqq/sso/sso.ts"),!BK.isBrowser){BK.HttpUtil=i("./src/deprecate/http-util.ts"),BK.Http=i("./src/net/http.ts"),bkWebGLGetInstance=i("./src/webgl/WebGLRenderingContext.ts").bkWebGLGetInstance,WebGLRenderingContext=i("./src/webgl/WebGLRenderingContext.ts").WebGLRenderingContext,BK.Util=i("./src/util/util.ts"),BK.Util.Buffer=i("./src/util/buffer.ts"),BK.UI=i("./src/ui/ui.ts");var r=i("./src/basics/lifecycle/lifecycle.ts");if(BK.onEnterForeground=r.onEnterForeground,BK.onEnterBackground=r.onEnterBackground,BK.onMaximize=r.onMaximize,BK.onMinimize=r.onMinimize,BK.onGameClose=r.onGameClose,BK.onNetworkChange=r.onNetworkChange,BK.onGameShare=r.onGameShare,BK.onGameShareComplete=r.onGameShareComplete,BK.offEnterForeground=r.offEnterForeground,BK.offEnterBackground=r.offEnterBackground,BK.offMaximize=r.offMaximize,BK.offMinimize=r.offMinimize,BK.offGameClose=r.offGameClose,BK.offNetworkChange=r.offNetworkChange,BK.offGameShare=r.offGameShare,BK.offGameShareComplete=r.offGameShareComplete,BK.Crypt=i("./src/common/crypt.ts"),0==BK.Misc.qqVerLessthan(GameStatusInfo.QQVer,"7.8.0")){var o=i("./src/gme/audio.ts")();BK.createAudioContext=o.AudioFactory.createAudioContext,BK.Audio=o.Audio2,BK.AudioManager=o.AudioManager,BK.onAudioInterruptionStart=o.AudioManager.onAudioInterruptionStart,BK.onAudioInterruptionEnd=o.AudioManager.onAudioInterruptionEnd}BK.Device=i("./src/basics/device/device.ts");var n=i("./src/task/TaskManager.ts");BK.taskManager=new n;var s=i("./src/fileSystem/FileSystem.ts");BK.fileSystem=new s,BK.QRCode=i("./src/common/qrcode.ts");var a=i("./src/basics/storage/Storage.ts");BK.localStorage=a.localStorage,BK.sessionStorage=a.sessionStorage,BK.storageEventListener=i("./src/basics/Storage/StorageEventListener.ts"),BK.AnimationSprite=i("./src/render/animationSprite.ts"),BK.SpriteSet=i("./src/render/spriteSet.ts"),BK.SpriteSetCache=i("./src/render/spriteSetCache.ts"),BK.SpriteNine=i("./src/render/spriteNine.ts"),BK.loadSubpackage=i("./src/basics/subpackage/subpackage.ts"),BK.Texture=i("./src/render/texture.ts"),BK.Image=i("./src/render/image.ts"),BK.createWebView=i("./src/net/transparent-webview.ts")}BK.Share=i("./src/mqq/share/share.ts"),BK.Upload=i("./src/mqq/share/upload.ts"),BK.Screenshot=i("./src/mqq/share/screenshot.ts");var h=i("./src/mqq/advertisement/advertisement.ts");BK.Advertisement.createBannerAd=h.createBannerAd,BK.Advertisement.createVideoAd=h.createVideoAd,BK.getSystemInfoSync=i("./src/basics/system/system.ts").getSystemInfoSync}});BK.Script.log(1,1,"qqPlayCore.js load end");